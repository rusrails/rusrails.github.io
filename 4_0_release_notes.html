<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="product" property="twitter:card"/>
<meta content="@rusrails" property="twitter:site"/>
<meta content="Rusrails: Заметки о релизе Ruby on Rails 4.0" property="twitter:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="twitter:description"/>
<meta content="@rusrails" property="twitter:creator"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="twitter:image"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Заметки о релизе Ruby on Rails 4.0" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/4_0_release_notes" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Заметки о релизе Ruby on Rails 4.0
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/classic-to-zeitwerk-howto">Как перейти с Classic на Zeitwerk</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
              <p></p>
              <a class="twitter-follow-button" data-lang="ru" href="https://twitter.com/rusrails"></a>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#apgreyd-do-rails-4-0">1. Апгрейд до Rails 4.0</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#sozdanie-prilozheniya-rails-4-0">2. Создание приложения Rails 4.0</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#storonnie-gemy">2.1. Сторонние гемы</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#zhivite-na-grani">2.2. Живите на грани</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#osnovnye-osobennosti">3. Основные особенности</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#apgreyd">3.1. Апгрейд</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#actionpack">3.2. ActionPack</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#osnovnoe">3.3. Основное</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#bezopasnost">3.4. Безопасность</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#izvlechenie-osobennostey-v-gemy">4. Извлечение особенностей в гемы</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#dokumentatsiya">5. Документация</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#railties">6. Railties</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya">6.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya">6.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-mailer">7. Action Mailer</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya2">7.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya2">7.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-model">8. Active Model</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya3">8.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya3">8.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-support">9. Active Support</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya4">9.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya4">9.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-pack">10. Action Pack</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya5">10.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya5">10.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-record">11. Active Record</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya6">11.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarevaniya6">11.2. Устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#blagodarnosti">12. Благодарности</a>
</h4>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='zametki-o-relize-ruby-on-rails-4-0' class='inside_page_header'> Заметки о релизе Ruby on Rails 4.0</h2><p>Ключевые новинки в Rails 4.0:</p><ul><li>Ruby 2.0 предпочтителен; 1.9.3+ требуется
</li><li>Строгие параметры (Strong Parameters)
</li><li>Turbolinks
</li><li>Кэширование &quot;матрешкой&quot; (Russian Doll Caching)
</li></ul><p>Эти заметки о релизе покрывают только основные изменения. Чтобы узнать о различных исправлениях программных ошибок и изменениях, обратитесь к логам изменений или к <a href="https://github.com/rails/rails/commits/4-0-stable">списку коммитов</a> в главном репозитории Rails на GitHub.</p><h3 id='apgreyd-do-rails-4-0' class='inside_page_header'><a href="#apgreyd-do-rails-4-0">1.</a> Апгрейд до Rails 4.0</h3><p>Прежде чем апгрейднуть существующее приложение, было бы хорошо иметь перед этим покрытие тестами. Также, до попытки обновиться до Rails 4.0, необходимо сначала произвести апгрейд до Rails 3.2 и убедиться, что приложение все еще выполняется так, как нужно. Список вещей, которые нужно выполнить для апгрейда доступен в руководстве <a href="/upgrading-ruby-on-rails#upgrading-from-rails-3-2-to-rails-4-0">Апгрейд Ruby on Rails</a></p><h3 id='sozdanie-prilozheniya-rails-4-0' class='inside_page_header'><a href="#sozdanie-prilozheniya-rails-4-0">2.</a> Создание приложения Rails 4.0</h3><div class="code_container">
  <pre><code class="highlight console"><span class="gp">#</span><span class="w"> </span>Необходим установленный RubyGem <span class="s1">'rails'</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new myapp
<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>myapp
</code></pre>
</div>
<h4 id='storonnie-gemy' class='inside_page_header'><a href="#storonnie-gemy">2.1.</a> Сторонние гемы</h4><p>Сейчас Rails использует <code>Gemfile</code> в корне приложения, чтобы определить гемы, требуемые для запуска вашего приложения. Этот <code>Gemfile</code> обрабатывается гемом <a href="http://github.com/carlhuda/bundler">Bundler</a>, который затем устанавливает все зависимости. Он может даже установить все зависимости локально в ваше приложение, и оно не будет зависеть от системных гемов.</p><p>Подробнее: - <a href="https://bundler.io">домашняя страница Bundler</a></p><h4 id='zhivite-na-grani' class='inside_page_header'><a href="#zhivite-na-grani">2.2.</a> Живите на грани</h4><p><code>Bundler</code> и <code>Gemfile</code> замораживает ваше приложение Rails с помощью новой отдельной команды <code>bundle</code>. Если хотите установить напрямую из репозитория Git, передайте флажок <code>--edge</code>:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new myapp <span class="nt">--edge</span>
</code></pre>
</div>
<p>Если имеется локальная копия репозитория Rails, и необходимо сгенерировать приложение используя ее, передайте флажок <code>--dev</code>:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> /path/to/rails/railties/bin/rails new myapp <span class="nt">--dev</span>
</code></pre>
</div>
<h3 id='osnovnye-osobennosti' class='inside_page_header'><a href="#osnovnye-osobennosti">3.</a> Основные особенности</h3><p><a href="4_0_release_notes/rails4_features.png"><img src='/assets/4_0_release_notes/rails4_features-5fcf9ff91508738a246a33c1865362c473c5c326109c7f0d3181064f4a094bd6.png' title='' alt='Rails 4.0' class='img-polaroid' /></a></p><h4 id='apgreyd' class='inside_page_header'><a href="#apgreyd">3.1.</a> Апгрейд</h4><ul><li><strong>Ruby 1.9.3</strong> (<a href="https://github.com/rails/rails/commit/a0380e808d3dbd2462df17f5d3b7fcd8bd812496">коммит</a>) - Предпочтителен Ruby 2.0; требуется 1.9.3+
</li><li><strong><a href="https://www.youtube.com/watch?v=z6YgD6tVPQs">Новая политика устареваний</a></strong> - Устаревшие особенности показывают предупреждения в Rails 4.0, и будут убраны в Rails 4.1.
</li><li><strong>Кэширование страниц и экшнов ActionPack</strong> (<a href="https://github.com/rails/rails/commit/b0a7068564f0c95e7ef28fc39d0335ed17d93e90">коммит</a>) - Кэширование страниц и экшнов было извлечено в отдельный гем. Кэширование страниц и экшнов требовало слишком много человеческого вмешательства (вручную прекращать кэш, когда обновляются лежащие в основе объекты модели). Вместо этого используйте кэширование по принципу &quot;русской матрешки&quot; (Russian doll caching).
</li><li><strong>Обсерверы ActiveRecord</strong> (<a href="https://github.com/rails/rails/commit/ccecab3ba950a288b61a516bf9b6962e384aae0b">коммит</a>) - Обсерверы извлечены в отдельный гем. Обсерверы требовались только для кэширования страниц и экшнов и могли привести к спагетти-коду.
</li><li><strong>Хранилище сессии ActiveRecord</strong> (<a href="https://github.com/rails/rails/commit/0ffe19056c8e8b2f9ae9d487b896cad2ce9387ad">коммит</a>) - Хранилище сессии ActiveRecord извлечено в отдельный гем. Хранение сессий в SQL затратное. Используйте вместо него сессии куки, сессии memcache или произвольные хранилища сессии.
</li><li><strong>Защита от массового назначения ActiveModel</strong> (<a href="https://github.com/rails/rails/commit/f8c9a4d3e88181cee644f91e1342bfe896ca64c6">коммит</a>) - Защита от массового назначения Rails 3 устарела. Вместо нее используйте строгие параметры (strong parameters).
</li><li><strong>ActiveResource</strong> (<a href="https://github.com/rails/rails/commit/f1637bf2bb00490203503fbd943b73406e043d1d">коммит</a>) - ActiveResource извлечен в отдельный гем. ActiveResource не был широко используемым.
</li><li><strong>убраны vendor/plugins</strong> (<a href="https://github.com/rails/rails/commit/853de2bd9ac572735fa6cf59fcf827e485a231c3">коммит</a>) - Для управления установленными гемами используйте <code>Gemfile</code>.
</li></ul><h4 id='actionpack' class='inside_page_header'><a href="#actionpack">3.2.</a> ActionPack</h4><ul><li><strong>Strong parameters</strong> (<a href="https://github.com/rails/rails/commit/a8f6d5c6450a7fe058348a7f10a908352bb6c7fc">коммит</a>) - Позволяет обновлять объекты модели только разрешенными параметрами (<code>params.permit(:title, :text)</code>).
</li><li><strong>Routing concerns</strong> (<a href="https://github.com/rails/rails/commit/0dd24728a088fcb4ae616bb5d62734aca5276b1b">коммит</a>) - В маршрутном DSL, выделяет общие подмаршруты (<code>comments</code> из <code>/posts/1/comments</code> and <code>/videos/1/comments</code>).
</li><li><strong>ActionController::Live</strong> (<a href="https://github.com/rails/rails/commit/af0a9f9eefaee3a8120cfd8d05cbc431af376da3">коммит</a>) - Потоковый JSON с помощью <code>response.stream</code>.
</li><li><strong>Декларативные ETags</strong> (<a href="https://github.com/rails/rails/commit/ed5c938fa36995f06d4917d9543ba78ed506bb8d">коммит</a>) - Добавляет на уровне контроллера дополнения к etag, которые будут частью вычисления etag.
</li><li><strong><a href="https://37signals.com/svn/posts/3113-how-key-based-cache-expiration-works">Кэширование Russian doll</a></strong> (<a href="https://github.com/rails/rails/commit/4154bf012d2bec2aae79e4a49aa94a70d3e91d49">коммит</a>) - Кэширует вложенные фрагменты вью. Каждый фрагмент прекращается на основе набора зависимостей (ключа кэширования). Ключ кэширования - это обычно версия шаблона и объект модели.
</li><li><strong>Turbolinks</strong> (<a href="https://github.com/rails/rails/commit/e35d8b18d0649c0ecc58f6b73df6b3c8d0c6bb74">коммит</a>) - Обслуживает только первую страницу HTML. Когда пользователь переходит на следующую страницу, использует pushState для обновления URL и использует AJAX для обновления title и body.
</li><li><strong>Извлечение ActionView из ActionController</strong> (<a href="https://github.com/rails/rails/commit/78b0934dd1bb84e8f093fb8ef95ca99b297b51cd">коммит</a>) - ActionView был отделен от ActionPack, и будет вынесен в отдельный гем в Rails 4.1.
</li><li><strong>Независимость от ActiveModel</strong> (<a href="https://github.com/rails/rails/commit/166dbaa7526a96fdf046f093f25b0a134b277a68">коммит</a>) - ActionPack больше не зависит от ActiveModel.
</li></ul><h4 id='osnovnoe' class='inside_page_header'><a href="#osnovnoe">3.3.</a> Основное</h4><ul><li><strong>ActiveModel::Model</strong> (<a href="https://github.com/rails/rails/commit/3b822e91d1a6c4eab0064989bbd07aae3a6d0d08">коммит</a>) - <code>ActiveModel::Model</code> - это миксин, чтобы обычные объекты Ruby могли работать с ActionPack &quot;из коробки&quot; (например, <code>form_for</code>).
</li><li><strong>Новый API скоупов</strong> (<a href="https://github.com/rails/rails/commit/50cbc03d18c5984347965a94027879623fc44cce">коммит</a>) - Скоупы должны быть всегда вызываемыми.
</li><li><strong>Выгрузка кэша схемы</strong> (<a href="https://github.com/rails/rails/commit/5ca4fc95818047108e69e22d200e7a4a22969477">коммит</a>) - Чтобы улучшить время загрузки Rails, вместо загрузки схемы непосредственно из базы данных, загружает схему из файла выгрузки.
</li><li><strong>Поддержка указания уровня изоляции транзакции</strong> (<a href="https://github.com/rails/rails/commit/392eeecc11a291e406db927a18b75f41b2658253">коммит</a>) - Выбирайте, что более важно - повторяемые чтения или улучшенное быстродействие (менее блокирующее).
</li><li><strong>Dalli</strong> (<a href="https://github.com/rails/rails/commit/82663306f428a5bbc90c511458432afb26d2f238">коммит</a>) - Используется клиент Dalli в качестве хранилища сессии в memcache.
</li><li><strong>start &amp; finish для уведомлений</strong> (<a href="https://github.com/rails/rails/commit/f08f8750a512f741acb004d0cebe210c5f949f28">коммит</a>) - Инструменты Active Support сообщают подписчикам о начале и завершении уведомлений.
</li><li><strong>Тредобезопасность по умолчанию</strong> (<a href="https://github.com/rails/rails/commit/5d416b907864d99af55ebaa400fff217e17570cd">коммит</a>) - Rails может быть запущен на тредовых серверах приложений без дополнительных настроек. Заметка: Проверьте, что используемые вами гемы тредобезопасны.
</li></ul><div class="note"><p>Убедитесь, что используемые вами гемы тредобезопасны.</p></div><ul><li><strong>Метод PATCH</strong> (<a href="https://github.com/rails/rails/commit/eed9f2539e3ab5a68e798802f464b8e4e95e619e">коммит</a>) - В Rails PATCH заменил PUT. PATCH используется для частичного обновления ресурсов.
</li></ul><h4 id='bezopasnost' class='inside_page_header'><a href="#bezopasnost">3.4.</a> Безопасность</h4><ul><li><strong>match не соответствует всем методам</strong> (<a href="https://github.com/rails/rails/commit/90d2802b71a6e89aedfe40564a37bd35f777e541">коммит</a>) - В маршрутном DSL, match требует указания метода или методов HTTP.
</li><li><strong>Сущности html экранируются по умолчанию</strong> (<a href="https://github.com/rails/rails/commit/5f189f41258b83d49012ec5a0678d827327e7543">коммит</a>) - Строки, рендерящиеся в erb, экранируются, если не обернуты в <code>raw</code>, или вызван <code>html_safe</code>.
</li><li><strong>Новые заголовки безопасности</strong> (<a href="https://github.com/rails/rails/commit/6794e92b204572d75a07bd6413bdae6ae22d5a82">коммит</a>) - Rails посылает следующие заголовки с каждым запросом HTTP: <code>X-Frame-Options</code> (предотвращает кликджекинг, запрещая браузеру встраивать страницу в фрейм), <code>X-XSS-Protection</code> (говорит браузеру прерывать инъекцию скрипта) и <code>X-Content-Type-Options</code> (предотвращает открытие браузером jpeg как exe).
</li></ul><h3 id='izvlechenie-osobennostey-v-gemy' class='inside_page_header'><a href="#izvlechenie-osobennostey-v-gemy">4.</a> Извлечение особенностей в гемы</h3><p>В Rails 4.0 некоторые особенности были извлечены в гемы. Можно просто добавить извлеченный гем в свой <code>Gemfile</code>, чтобы вернуть функциональность.</p><ul><li>Динамические и основанные на хэше методы поиска (<a href="https://github.com/rails/activerecord-deprecated_finders">Github</a>)
</li><li>Защита от массового назначения в моделях Active Record (<a href="https://github.com/rails/protected_attributes">Github</a>, <a href="https://github.com/rails/rails/pull/7251">Pull Request</a>)
</li><li>ActiveRecord::SessionStore (<a href="https://github.com/rails/activerecord-session_store">Github</a>, <a href="https://github.com/rails/rails/pull/7436">Pull Request</a>)
</li><li>Обсерверы Active Record (<a href="https://github.com/rails/rails-observers">Github</a>, <a href="https://github.com/rails/rails/commit/39e85b3b90c58449164673909a6f1893cba290b2">Commit</a>)
</li><li>Active Resource (<a href="https://github.com/rails/activeresource">Github</a>, <a href="https://github.com/rails/rails/pull/572">Pull Request</a>, <a href="http://yetimedia-blog-blog.tumblr.com/post/35233051627/activeresource-is-dead-long-live-activeresource">Blog</a>)
</li><li>Кэширование экшна (<a href="https://github.com/rails/actionpack-action_caching">Github</a>, <a href="https://github.com/rails/rails/pull/7833">Pull Request</a>)
</li><li>Кэширование страницы (<a href="https://github.com/rails/actionpack-page_caching">Github</a>, <a href="https://github.com/rails/rails/pull/7833">Pull Request</a>)
</li><li>Sprockets (<a href="https://github.com/rails/sprockets-rails">Github</a>)
</li><li>Тесты производительности (<a href="https://github.com/rails/rails-perftest">Github</a>, <a href="https://github.com/rails/rails/pull/8876">Pull Request</a>)
</li></ul><h3 id='dokumentatsiya' class='inside_page_header'><a href="#dokumentatsiya">5.</a> Документация</h3><ul><li><p>Руководства были переписаны на GitHub Flavored Markdown.</p></li><li><p>Руководства имеют адаптивный дизайн.</p></li></ul><h3 id='railties' class='inside_page_header'><a href="#railties">6.</a> Railties</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/railties/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya' class='inside_page_header'><a href="#znachimye-izmeneniya">6.1.</a> Значимые изменения</h4><ul><li><p>Новые места расположения для тестов <code>test/models</code>, <code>test/helpers</code>, <code>test/controllers</code> и <code>test/mailers</code>. Также добавлены соответствующие задачи rake. (<a href="https://github.com/rails/rails/pull/7878">Pull Request</a>)</p></li><li><p>Исполняемые файлы приложения теперь находятся в директории <code>bin/</code>. Запустите <code>rake rails:update:bin</code> чтобы получить <code>bin/bundle</code>, <code>bin/rails</code> и <code>bin/rake</code>.</p></li><li><p>Тредобезопасность включена по умолчанию</p></li><li><p>Была убрана возможность использования произвольного билдера, передав <code>--builder</code> (или <code>-b</code>) в <code>rails new</code>. Вместо нее рассмотрите шаблоны приложения. (<a href="https://github.com/rails/rails/pull/9401">Pull Request</a>)</p></li></ul><h4 id='ustarevaniya' class='inside_page_header'><a href="#ustarevaniya">6.2.</a> Устаревания</h4><ul><li><p><code>config.threadsafe!</code> устарело в пользу <code>config.eager_load</code>, которая предоставляет более тонкую настройку того, что будет лениво загружаться.</p></li><li><p><code>Rails::Plugin</code> больше нет. Вместо добавления плагинов в <code>vendor/plugins</code>, используйте гемы, или bundler с путем, или зависимости git.</p></li></ul><h3 id='action-mailer' class='inside_page_header'><a href="#action-mailer">7.</a> Action Mailer</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/actionmailer/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya2' class='inside_page_header'><a href="#znachimye-izmeneniya2">7.1.</a> Значимые изменения</h4><h4 id='ustarevaniya2' class='inside_page_header'><a href="#ustarevaniya2">7.2.</a> Устаревания</h4><h3 id='active-model' class='inside_page_header'><a href="#active-model">8.</a> Active Model</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/activemodel/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya3' class='inside_page_header'><a href="#znachimye-izmeneniya3">8.1.</a> Значимые изменения</h4><ul><li><p>Добавлен <code>ActiveModel::ForbiddenAttributesProtection</code>, простой модуль для защиты атрибутов от массового назначения, когда передаются неразрешенные атрибуты.</p></li><li><p>Добавлен <code>ActiveModel::Model</code>, примесь, чтобы объекты Ruby могли работать с Action Pack &quot;из коробки&quot;.</p></li></ul><h4 id='ustarevaniya3' class='inside_page_header'><a href="#ustarevaniya3">8.2.</a> Устаревания</h4><h3 id='active-support' class='inside_page_header'><a href="#active-support">9.</a> Active Support</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/activesupport/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya4' class='inside_page_header'><a href="#znachimye-izmeneniya4">9.1.</a> Значимые изменения</h4><ul><li><p>Заменен устаревший гем <code>memcache-client</code> на <code>dalli</code> в <code>ActiveSupport::Cache::MemCacheStore</code>.</p></li><li><p>Оптимизирован <code>ActiveSupport::Cache::Entry</code> для уменьшения расхода памяти и процессора.</p></li><li><p>Словоизменения теперь могут быть определены для локали. <code>singularize</code> и <code>pluralize</code> принимают локаль как дополнительный аргумент.</p></li><li><p><code>Object#try</code> теперь будет возвращать nil вместо вызова NoMethodError, если вызывающий объект не реализует этот метод, но все еще можно получить старое поведение, используя новый метод <code>Object#try!</code>.</p></li><li><p><code>String#to_date</code> теперь вызывает <code>ArgumentError: invalid date</code> вместо <code>NoMethodError: undefined method &#39;div&#39; for nil:NilClass</code> при получения неверной даты. Это то же самое, что и <code>Date.parse</code>, и он принимает больше неправильных дат, чем 3.x, такие как:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># ActiveSupport 3.x</span>
<span class="s2">"asdf"</span><span class="p">.</span><span class="nf">to_date</span> <span class="c1"># =&gt; NoMethodError: undefined method `div' for nil:NilClass</span>
<span class="s2">"333"</span><span class="p">.</span><span class="nf">to_date</span> <span class="c1"># =&gt; NoMethodError: undefined method `div' for nil:NilClass</span>

<span class="c1"># ActiveSupport 4</span>
<span class="s2">"asdf"</span><span class="p">.</span><span class="nf">to_date</span> <span class="c1"># =&gt; ArgumentError: invalid date</span>
<span class="s2">"333"</span><span class="p">.</span><span class="nf">to_date</span> <span class="c1"># =&gt; Fri, 29 Nov 2013</span>
</code></pre>
</div>
</li></ul><h4 id='ustarevaniya4' class='inside_page_header'><a href="#ustarevaniya4">9.2.</a> Устаревания</h4><ul><li><p>Устарел метод <code>ActiveSupport::TestCase#pending</code>, используйте вместо него <code>skip</code> из minitest.</p></li><li><p><code>ActiveSupport::Benchmarkable#silence</code> устарел из-за недостатков в тредобезопасности. Он будет убран без замен в Rails 4.1.</p></li><li><p>Устарел <code>ActiveSupport::JSON::Variable</code>. Определяйте собственные методы <code>#as_json</code> и <code>#encode_json</code> для собственных строковых литер JSON.</p></li><li><p>Устарел метод совместимости <code>Module#local_constant_names</code>, используйте вместо него <code>Module#local_constants</code> (который возвращает символы).</p></li><li><p>Устарел <code>ActiveSupport::BufferedLogger</code>. Используйте <code>ActiveSupport::Logger</code> или <code>logger</code> из стандартной библиотеки Ruby.</p></li><li><p>Устарели <code>assert_present</code> и <code>assert_blank</code> в пользу <code>assert object.blank?</code> и <code>assert object.present?</code></p></li></ul><h3 id='action-pack' class='inside_page_header'><a href="#action-pack">10.</a> Action Pack</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/actionpack/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya5' class='inside_page_header'><a href="#znachimye-izmeneniya5">10.1.</a> Значимые изменения</h4><ul><li>Изменена таблица стилей для страниц исключений для режима development. Также дополнительно отображается строчка кода и фрагмент, который вызвал исключение на всех страницах исключений.
</li></ul><h4 id='ustarevaniya5' class='inside_page_header'><a href="#ustarevaniya5">10.2.</a> Устаревания</h4><h3 id='active-record' class='inside_page_header'><a href="#active-record">11.</a> Active Record</h3><p>Обратитесь к <a href="https://github.com/rails/rails/blob/4-0-stable/activerecord/CHANGELOG.md">Changelog</a> за полными изменениями.</p><h4 id='znachimye-izmeneniya6' class='inside_page_header'><a href="#znachimye-izmeneniya6">11.1.</a> Значимые изменения</h4><ul><li><p>Улучшены способы написания миграций <code>change</code>, что делает старые методы <code>up</code> &amp; <code>down</code> больше не нужными.</p><ul><li>Методы <code>drop_table</code> и <code>remove_column</code> теперь обратимые, если дана вся необходимая информация.
Метод <code>remove_column</code> принимает несколько имен столбцов; вместо использования <code>remove_columns</code> (который необратимый).
Метод <code>change_table</code> также обратимый, если его блок не вызывает <code>remove</code>, <code>change</code> или <code>change_default</code>
</li><li>Новый метод <code>reversible</code> делает возможным определить код для исполнения при выполнении или откате миграции.
Смотрите руководство <a href="/active-record-migrations#using-reversible">Миграции Active Record</a>
</li><li>Новый метод <code>revert</code> обратит всю миграцию или предоставленный блок.
Если миграция откатывается, данная миграция / блок выполняется обычно.
Смотрите руководство <a href="/active-record-migrations#reverting-previous-migrations">Миграции Active Record</a>
</li></ul></li><li><p>Добавлена поддержка массивов PostgreSQL. Для создания столбца array может быть использован любой тип данных, с полной поддержкой миграций и выгрузкой схемы.</p></li><li><p>Добавлен <code>Relation#load</code> для явной загрузки записи и возврата <code>self</code>.</p></li><li><p><code>Model.all</code> теперь возвращает <code>ActiveRecord::Relation</code>, а не массив с записями. Используйте <code>Relation#to_a</code>, если вы действительно хотите массив. В некоторых особенных случаях это может вызвать повреждения при апгрейде.</p></li><li><p>Добавлен <code>ActiveRecord::Migration.check_pending!</code>, вызывающий ошибку, если миграции ожидают выполнения.</p></li><li><p>Добавлена поддержка произвольного кодирования для <code>ActiveRecord::Store</code>. Теперь можно установить собственное кодирование следующим образом:</p><div class="code_container">
  <pre><code class="highlight plaintext">store :settings, accessors: [ :color, :homepage ], coder: JSON
</code></pre>
</div>
</li><li><p>Соединения <code>mysql</code> и <code>mysql2</code> будут по умолчанию устанавливать <code>SQL_MODE=STRICT_ALL_TABLES</code>, чтобы избежать тихих потерь данных. Это может быть отключено, определив <code>strict: false</code> в <code>database.yml</code>.</p></li><li><p>Убрана IdentityMap.</p></li><li><p>Убрано автоматическое выполнение запросов EXPLAIN. Опция <code>active_record.auto_explain_threshold_in_seconds</code> больше не используется и должна быть убрана.</p></li><li><p>Добавлены <code>ActiveRecord::NullRelation</code> и <code>ActiveRecord::Relation#none</code>, реализующие паттерн нулевого объекта для класса Relation.</p></li><li><p>Добавлен миграционный хелпер <code>create_join_table</code> для создания соединительных таблиц HABTM.</p></li><li><p>Могут быть созданы записи PostgreSQL hstore.</p></li></ul><h4 id='ustarevaniya6' class='inside_page_header'><a href="#ustarevaniya6">11.2.</a> Устаревания</h4><ul><li><p>Устарел старый API поиска, основанный на хэше. Это означает, что методы, ранее принимающие &quot;опции поиска&quot;, больше так не делают.</p></li><li><p>Устарели все динамические методы, кроме <code>find_by_...</code> и <code>find_by_...!</code> устарели. Вот как можно переписать код:</p><ul><li><code>find_all_by_...</code> может быть переписан с использованием <code>where(...)</code>.
</li><li><code>find_last_by_...</code> может быть переписан с использованием <code>where(...).last</code>.
</li><li><code>scoped_by_...</code> может быть переписан с использованием <code>where(...)</code>.
</li><li><code>find_or_initialize_by_...</code> может быть переписан с использованием <code>find_or_initialize_by(...)</code>.
</li><li><code>find_or_create_by_...</code> может быть переписан с использованием <code>find_or_create_by(...)</code>.
</li><li><code>find_or_create_by_...!</code> может быть переписан с использованием <code>find_or_create_by!(...)</code>.
</li></ul></li></ul><h3 id='blagodarnosti' class='inside_page_header'><a href="#blagodarnosti">12.</a> Благодарности</h3><p>Взгляните <a href="https://contributors.rubyonrails.org/">на полный список контрибьюторов Rails</a>, на людей, которые потратили много часов, сделав Rails стабильнее и надёжнее. Спасибо им всем.</p>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
              <a target="blank" href="http://twitter.com/rusrails"><img src="/assets/twitter-50e0e767c8793dec313a7dc5cfbcfe2067e3e89ea6ec64784eb7c6640f578758.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-8ee447905888b153d8458707061a14b1f15f69b6733e871a3ad91d80ae89e87b.js"></script>
  </body>
</html>

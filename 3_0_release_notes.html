<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="product" property="twitter:card"/>
<meta content="@rusrails" property="twitter:site"/>
<meta content="Rusrails: Заметки о релизе Ruby on Rails 3.0" property="twitter:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="twitter:description"/>
<meta content="@rusrails" property="twitter:creator"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="twitter:image"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Заметки о релизе Ruby on Rails 3.0" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/3_0_release_notes" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Заметки о релизе Ruby on Rails 3.0
    </title>
    <link rel="stylesheet" media="screen" href="/assets/application-4f65588939909a694017a295c9ca934821f6a6358454c26c5360579d7ee0054d.css" />
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TAQ2+FPwdfc7W93WHGI3DnN3hebS7BbMvjn3peJBm63sb3GE96OeVSS7pp45s6BTTpsDCOdsUfe/hPZG9mHJpQ==" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <form class="navbar-search pull-right" action="/search" accept-charset="UTF-8" method="get">
            <input type="text" name="search" id="search" class="search-query" placeholder="Поиск.." />
</form>          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/classic-to-zeitwerk-howto">Как перейти с Classic на Zeitwerk</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - ?</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
              <p></p>
              <a class="twitter-follow-button" data-lang="ru" href="https://twitter.com/rusrails"></a>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#apgreyd-do-rails-3">1. Апгрейд до Rails 3</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#rails-3-trebuet-kak-minimum-ruby-1-8-7">1.1. Rails 3 требует как минимум Ruby 1.8.7</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ob-ekt-rails-application">1.2. Объект Rails Application</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#script-zamenen-na-script-rails">1.3. script/* заменен на script/rails</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#zavisimosti-i-config-gem">1.4. Зависимости и config.gem</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#protsess-apgreyda">1.5. Процесс апгрейда</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#sozdanie-prilozheniya-rails-3-0">2. Создание приложения Rails 3.0</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#storonnie-gemy">2.1. Сторонние гемы</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#zhivite-na-grani">2.2. Живите на грани</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#arhitekturnye-izmeneniya-rails">3. Архитектурные изменения Rails</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#railties-restrung">3.1. Railties Restrung</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#vse-komponenty-yadra-rails-byli-razdeleny">3.2. Все компоненты ядра Rails были разделены</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#abstraktsiya-active-model">3.3. Абстракция Active Model</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#abstraktsiya-kontrollera">3.4. Абстракция контроллера</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#integratsiya-arel">3.5. Интеграция Arel</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#izvlechenie-mail">3.6. Извлечение Mail</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#internatsionalizatsiya">4. Интернационализация</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#railties">5. Railties</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#action-pack">6. Action Pack</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#abstract-controller">6.1. Abstract Controller</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#action-controller">6.2. Action Controller</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#action-dispatch">6.3. Action Dispatch</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#action-view">6.4. Action View</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#nenavyazchivyy-javascript">6.4.1. Ненавязчивый JavaScript</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#helpery-s-blokami">6.5. Хелперы с блоками</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#drugie-izmeneniya">6.5.1. Другие изменения</a>
</h6>      </li>
      <li>
        <h4>
          <a href="#active-model">7. Active Model</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#abstraktsiya-orm-i-interfeys-action-pack">7.1. Абстракция ORM и интерфейс Action Pack</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#validatsii">7.2. Валидации</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-record">8. Active Record</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#interfeys-zaprosov">8.1. Интерфейс запросов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#uluchsheniya">8.2. Улучшения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#patchi-i-ustarevaniya">8.3. Патчи и устаревания</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-resource">9. Active Resource</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#active-support">10. Active Support</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#action-mailer">11. Action Mailer</a>
</h4>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='zametki-o-relize-ruby-on-rails-3-0' class='inside_page_header'> Заметки о релизе Ruby on Rails 3.0</h2><p>Rails 3.0 это волшебство! Он приготовит вам ужин и постирает белье. Вы не сможете понять как вы жили без него. Это Лучшая Версия Rails, Какой Еще Не Было!</p><p>Но если серьезно, это действительно замечательная вещь. В него вложены все замечательные идеи, внесенные присоединившейся командой Merb, сделан фокус на минимизацию и скорость фреймворка и удобный API. Если вы переходите на Rails 3.0 с Merb 1.x, то вам многое будет знакомым. Если переходите с Rails 2.x, то вы его тоже полюбите.</p><p>Даже если вам не интересны подробности об оптимизации &quot;внутренностей&quot;, в Rails 3.0 есть что показать. У нас много новых возможностей и улучшений API. Сейчас очень подходящий момент стать разработчиком на Rails. Некоторые из ключевых возможностей:</p><ul><li>Совершенно новый роутинг на основе объявлений RESTful
</li><li>Новое Action Mailer API, похожее на Action Controller (теперь без головной боли посылающее multipart сообщения!)
</li><li>Новый сцепляемый язык запросов Active Record, построенный на основе relational algebra
</li><li>Ненавязчивые хелперы JavaScript с драйверами для Prototype, jQuery и в будущем других фреймворков (конец встроенному JS)
</li><li>Удобное управление зависимостями с помощью Bundler
</li></ul><p>Помимо всего этого, мы попытались как можно лучше указать об устаревании прежнего API с помощью хороших предупреждений. Это означает, что можно перенести ваше существующее приложение на Rails 3 без необходимости немедленного переписывания всего вашего старого кода в соответствии с последними best practices.</p><p>Эти заметки о релизе покрывают только основные изменения, но не включают все мелкие исправления программных ошибок и изменения. Rails 3.0 содержит почти 4,000 коммитов от более чем 250 авторов! Чтобы увидеть все, обратитесь к <a href="https://github.com/rails/rails/commits/3-0-stable">списку коммитов</a> в главном репозитории Rails на GitHub.</p>
<hr>
<p>Чтобы установить Rails 3:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">#</span><span class="w"> </span>Используйте <span class="nb">sudo</span>, если этого требует установка
<span class="gp">$</span><span class="w"> </span><span class="nb">gem install rails</span>
</code></pre>
</div>
<h3 id='apgreyd-do-rails-3' class='inside_page_header'><a href="#apgreyd-do-rails-3">1.</a> Апгрейд до Rails 3</h3><p>Прежде чем апгрейднуть существующее приложение, было бы хорошо иметь перед этим покрытие тестами. Также, до попытки обновиться до Rails 3, необходимо сначала произвести апгрейд до Rails 2.3.5 и убедиться, что приложение все еще выполняется так, как нужно. Затем обратите внимание на следующие изменения:</p><h4 id='rails-3-trebuet-kak-minimum-ruby-1-8-7' class='inside_page_header'><a href="#rails-3-trebuet-kak-minimum-ruby-1-8-7">1.1.</a> Rails 3 требует как минимум Ruby 1.8.7</h4><p>Rails 3.0 требует Ruby 1.8.7 или выше. Поддержка всех прежних версий Ruby была официально прекращена, и следует произвести апгрейд как можно раньше. Rails 3.0 также совместим с Ruby 1.9.2.</p><div class="info"><p>Отметьте, что в Ruby 1.8.7 p248 и p249 имеются программные ошибки маршаллинга, ломающие Rails 3.0. Хотя в Ruby Enterprise Edition это было исправлено, начиная с релиза 1.8.7-2010.02. В ветке 1.9, Ruby 1.9.1 не пригоден к использованию, поскольку он иногда вылетает в Rails 3.0, поэтому, если хотите использовать Rails 3.0 с 1.9.x перепрыгивайте на 1.9.2 для гладкой работы.</p></div><h4 id='ob-ekt-rails-application' class='inside_page_header'><a href="#ob-ekt-rails-application">1.2.</a> Объект Rails Application</h4><p>Как часть внутренней работы по поддержке запуска нескольких приложений на Rails в одном процессе, Rails 3 представляет концепцию объекта Application. Этот объект содержит все настройки, специфичные для приложения, и очень похож по сути на <code>config/environment.rb</code> из прежних версий Rails.</p><p>Теперь каждое приложение Rails должно иметь соответствующий объект application. Этот объект определяется в <code>config/application.rb</code>. При апгрейде существующего приложения до Rails 3, необходимо добавить этот файл и переместить подходящие конфигурации из <code>config/environment.rb</code> в <code>config/application.rb</code>.</p><h4 id='script-zamenen-na-script-rails' class='inside_page_header'><a href="#script-zamenen-na-script-rails">1.3.</a> script/* заменен на script/rails</h4><p>Новый <code>script/rails</code> заменяет все ранее использовавшиеся скрипты из директории <code>script</code>. Впрочем, сейчас не нужно запускать даже <code>script/rails</code>, команда <code>rails</code> обнаруживает его при вызове из корня приложения Rails и запускает этот скрипт. Пример изменившегося использования:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>console                      <span class="c"># вместо script/console</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>g scaffold post title:string <span class="c"># вместо script/generate scaffold post title:string</span>
</code></pre>
</div>
<p>Запустите <code>rails --help</code>, чтобы увидеть список всех опций.</p><h4 id='zavisimosti-i-config-gem' class='inside_page_header'><a href="#zavisimosti-i-config-gem">1.4.</a> Зависимости и config.gem</h4><p>Метода <code>config.gem</code> больше нет, он был заменен использованием <code>bundler</code> и <code>Gemfile</code>, смотрите <a href="#vendoring-gems">Внешние Гемы</a> ниже.</p><h4 id='protsess-apgreyda' class='inside_page_header'><a href="#protsess-apgreyda">1.5.</a> Процесс апгрейда</h4><p>Для упрощения и автоматизации процесса апгрейда был создан плагин <a href="https://github.com/rails/rails_upgrade">Rails Upgrade</a>.</p><p>Просто установите плагин, затем запустите <code>rake rails:upgrade:check</code> для проверки, какие части вашего приложения следует обновить (с ссылками на информацию, как это сделать). Он также предлагает задачу по генерации <code>Gemfile</code>, основанного на текущих вызовах <code>config.gem</code>, и задачу по генерации нового маршрутного файла из старого. Чтобы получить плагин, просто запустите:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby </span>script/plugin <span class="nb">install git</span>://github.com/rails/rails_upgrade.git
</code></pre>
</div>
<p>Пример того, как это все работает, можно увидеть в <a href="http://omgbloglol.com/post/364624593/rails-upgrade-is-now-an-official-plugin">Rails Upgrade is now an Official Plugin</a></p><p>Помимо Rails Upgrade tool, если нужна помощь, есть люди в IRC и <a href="https://groups.google.com/group/rubyonrails-talk">rubyonrails-talk</a>, которые, возможно, сталкивались с подобными проблемами. Напишите в свой блог о своем опыте апгрейда, чтобы другие смогли воспользоваться вашими знаниями!</p><h3 id='sozdanie-prilozheniya-rails-3-0' class='inside_page_header'><a href="#sozdanie-prilozheniya-rails-3-0">2.</a> Создание приложения Rails 3.0</h3><div class="code_container">
  <pre><code class="highlight console"><span class="gp">#</span><span class="w"> </span>Уже должен быть установлен руби-гем <span class="s1">'rails'</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new myapp
<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>myapp
</code></pre>
</div>
<h4 id='storonnie-gemy' class='inside_page_header'><a href="#storonnie-gemy">2.1.</a> Сторонние гемы</h4><p>Сейчас Rails использует <code>Gemfile</code> в корне приложения, чтобы определить гемы, требуемые для запуска вашего приложения. Этот <code>Gemfile</code> обрабатывается <a href="https://github.com/bundler/bundler">Bundler</a>, который затем устанавливает все зависимости. Он может даже установить все зависимости локально в ваше приложение, и оно не будет зависеть от системных гемов.</p><p>Подробнее: - <a href="https://bundler.io/">домашняя страница Bundler</a></p><h4 id='zhivite-na-grani' class='inside_page_header'><a href="#zhivite-na-grani">2.2.</a> Живите на грани</h4><p><code>Bundler</code> и <code>Gemfile</code> замораживает ваше приложение Rails с помощью отдельной команды <code>bundle</code>, поэтому <code>rake freeze</code> более не актуальна и была отброшена.</p><p>Если хотите установить напрямую из репозитория Git, передайте флажок <code>--edge</code>:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new myapp <span class="nt">--edge</span>
</code></pre>
</div>
<p>Если имеется локальная копия репозитория Rails, и необходимо сгенерировать приложение используя ее, передайте флажок <code>--dev</code>:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> /path/to/rails/bin/rails new myapp <span class="nt">--dev</span>
</code></pre>
</div>
<h3 id='arhitekturnye-izmeneniya-rails' class='inside_page_header'><a href="#arhitekturnye-izmeneniya-rails">3.</a> Архитектурные изменения Rails</h3><p>Имеется шесть больших изменений в архитектуре Rails.</p><h4 id='railties-restrung' class='inside_page_header'><a href="#railties-restrung">3.1.</a> Railties Restrung</h4><p>Railties был обновлен, чтобы предоставить совместимое с плагинами API для всего фреймворка Rails, а также полностью переписаны генераторы и зависимости Rails, в результате разработчики смогут в значительной степени внедрять свой код в генераторы и фреймворк приложения совместимым и определенным образом.</p><h4 id='vse-komponenty-yadra-rails-byli-razdeleny' class='inside_page_header'><a href="#vse-komponenty-yadra-rails-byli-razdeleny">3.2.</a> Все компоненты ядра Rails были разделены</h4><p>В связи с объединением Merb и Rails, одним из заданий было устранение тесно связанных вместе компонентов ядра Rails. Это было достигнуто, и теперь все компоненты ядра Rails используют то же API, что вы можете использовать для своих плагинов. Это означает, что каждый сделанный вами плагин или замена любого компонента ядра (например, DataMapper или Sequel) имеют доступ ко всей функциональности, к которой имеют доступ компоненты ядра Rails, и могут расширять и улучшать ее как угодно.</p><p>Подробнее: - <a href="http://yehudakatz.com/2009/07/19/rails-3-the-great-decoupling/">The Great Decoupling</a></p><h4 id='abstraktsiya-active-model' class='inside_page_header'><a href="#abstraktsiya-active-model">3.3.</a> Абстракция Active Model</h4><p>Частью разделения компонентов ядра было выделение всех связей из Action Pack в Active Record. Теперь это выполнено. Всем новым плагинам ORM теперь всего лишь нужно внедрить интерфейсы Active Model, чтобы работать с Action Pack.</p><p>Подробнее: - <a href="http://yehudakatz.com/2010/01/10/activemodel-make-any-ruby-object-feel-like-activerecord/">Make Any Ruby Object Feel Like ActiveRecord</a></p><h4 id='abstraktsiya-kontrollera' class='inside_page_header'><a href="#abstraktsiya-kontrollera">3.4.</a> Абстракция контроллера</h4><p>Другой крупной частью разделения компонентов ядра было создание основного суперкласса, отделенного от терминов HTTP, для управления рендерингом вью и т.д. Создание <code>AbstractController</code> позволило существенно упростить <code>ActionController</code> и <code>ActionMailer</code>, убрав общий код из этих библиотек, и поместив его в Abstract Controller.</p><p>Подробнее: - <a href="http://yehudakatz.com/2009/06/11/rails-edge-architecture/">Rails Edge Architecture</a></p><h4 id='integratsiya-arel' class='inside_page_header'><a href="#integratsiya-arel">3.5.</a> Интеграция Arel</h4><p><a href="https://github.com/brynary/arel">Arel</a> (или Active Relation) был принят в качестве основы Active Record, и теперь требуется в Rails. Arel предоставляет абстракцию SQL, упрощающую Active Record и предоставляющую основы для функциональности relation в Active Record.</p><p>Подробнее: - <a href="https://web.archive.org/web/20120718093140/http://magicscalingsprinkles.wordpress.com/2010/01/28/why-i-wrote-arel/">Why I wrote Arel</a>.</p><h4 id='izvlechenie-mail' class='inside_page_header'><a href="#izvlechenie-mail">3.6.</a> Извлечение Mail</h4><p>В Action Mailer с самого начала были monkey патчи, пре-парсеры и даже агенты для отправки и получения, все вдобавок к встроенному в исходник TMail. Версия 3 изменила все это, так что вся функциональность, связанная с сообщениями email была выделена в гем <a href="https://github.com/mikel/mail">Mail</a>. Это, опять же, уменьшило повторение кода и помогло определить границы между Action Mailer и парсером email.</p><p>Подробнее: - <a href="http://lindsaar.net/2010/1/26/new-actionmailer-api-in-rails-3">New Action Mailer API in Rails 3</a></p><h3 id='internatsionalizatsiya' class='inside_page_header'><a href="#internatsionalizatsiya">4.</a> Интернационализация</h3><p>В Rails 3 было проделано много работы над поддержкой I18n, включая гем <a href="https://github.com/svenfuchs/i18n">I18n</a>, поддерживающий разные улучшения производительности.</p><ul><li>I18n для любого объекта - поведение I18n может быть добавлено к любому объекту, включая <code>ActiveModel::Translation</code> и <code>ActiveModel::Validations</code>. Для переводов также имеется <code>errors.messages</code> fallback.
</li><li>У атрибутов имеются переводы по умолчанию.
</li><li>Form Submit Tag автоматически ставит правильный статус (Create или Update), в зависимости от статуса объекта, и, таким образом, ставит правильный перевод.
</li><li>Label теперь также работает с I18n, просто передайте в него имя атрибута.
</li></ul><p>Подробнее: - <a href="http://blog.plataformatec.com.br/2010/02/rails-3-i18n-changes/">Rails 3 I18n changes</a></p><h3 id='railties' class='inside_page_header'><a href="#railties">5.</a> Railties</h3><p>В связи с разделением главных фреймворков Rails, в Railties проведена огромная переделка, чтобы он связывал фреймворки, engine-ы или плагины настолько просто и безболезненно, насколько это возможно:</p><ul><li>У каждого приложения теперь есть собственное пространство имен, к примеру, приложение стартует с помощью <code>YourAppName.boot</code>, что позволяет взаимодействовать с другими приложениями намного проще.
</li><li>Теперь все в <code>Rails.root/app</code> добавляется в путь загрузки, поэтому можно сделать <code>app/observers/user_observer.rb</code> и Rails загрузит его безо всяких модификаций.
</li><li>Теперь Rails 3.0 предоставляет объект <code>Rails.config</code>, представляющий централизованное хранилище всех типов гибких конфигурационных опций Rails.
</li></ul><p>Генератор приложения получает дополнительные флажки, позволяющие опустить установку test-unit, Active Record, Prototype и Git. Также добавлен новый флажок <code>--dev</code>, настраивающий приложение с <code>Gemfile</code>, указывающим на вашу версию Rails (определенную путем к исходникам <code>rails</code>). Подробнее смотрите <code>rails --help</code>.</p><p>Генераторы Railties требуют большого внимания, основываясь на том, что:</p><ul><li>Генераторы были полностью переписаны и обратно не совместимы.
</li><li>API шаблонов Rails и API генераторов были объединены (сейчас они фактически те же самые).
</li><li>Генераторы больше не загружаются по специальным путям, они должны быть в путях загрузки Ruby, поэтому вызов <code>rails generate foo</code> будет искать <code>generators/foo_generator</code>.
</li><li>Новые генераторы предоставляют хуки, таким образом в них могут быть легко внедрен любой шаблон engine, ORM, тестовый фреймворк.
</li><li>Новые генераторы позволяют переопределить шаблоны, поместив копию в <code>Rails.root/lib/templates</code>.
</li><li>Также представлен <code>Rails::Generators::TestCase</code>, поэтому вы можете создать собственные генераторы и протестировать их.
</li></ul><p>Также несколько переделаны вью, генерируемые с помощью генераторов Railties:</p><ul><li>Сейчас вью используют теги <code>div</code> вместо тегов <code>p</code>.
</li><li>Сейчас сгенерированные скаффолды используют партиалы <code>_form</code>, вместо повторения кода во вью edit и new.
</li><li>Сейчас формы скаффолда используют <code>f.submit</code>, возвращающий &quot;Create ModelName&quot; или &quot;Update ModelName&quot;, в зависимости от состояния переданного объекта.
</li></ul><p>Наконец, ряд улучшений был добавлен в задачи rake:</p><ul><li>Был добавлен <code>rake db:forward</code>, позволяющий откатить ваши миграции с возвратом отдельно или в группах.
</li><li>Был добавлен <code>rake routes CONTROLLER=x</code>, позволяющий просмотреть маршруты только к одному контроллеру.
</li></ul><p>Теперь Railties объявил устаревшим:</p><ul><li><code>RAILS_ROOT</code> в пользу <code>Rails.root</code>,
</li><li><code>RAILS_ENV</code> в пользу <code>Rails.env</code>, и
</li><li><code>RAILS_DEFAULT_LOGGER</code> в пользу <code>Rails.logger</code>.
</li></ul><p><code>PLUGIN/rails/tasks</code> и <code>PLUGIN/tasks</code> больше не загружаются, все задачи теперь должны быть в <code>PLUGIN/lib/tasks</code>.</p><p>Подробнее:</p><ul><li><a href="http://blog.plataformatec.com.br/2010/01/discovering-rails-3-generators">Discovering Rails 3 generators</a>
</li><li><a href="http://quaran.to/blog/2010/02/03/the-rails-module/">The Rails Module (in Rails 3)</a>
</li></ul><h3 id='action-pack' class='inside_page_header'><a href="#action-pack">6.</a> Action Pack</h3><p>В Action Pack произошло множество внутренних и внешних изменений.</p><h4 id='abstract-controller' class='inside_page_header'><a href="#abstract-controller">6.1.</a> Abstract Controller</h4><p>В Abstract Controller были извлечены части общего назначения из Action Controller в виде модуля, годного в использовании любой библиотекой, используемой для рендеринга шаблонов или партиалов, хелперов, переводов, логирования и любой части цикла отклика на запрос. Теперь эта абстракция позволяет <code>ActionMailer::Base</code> быть унаследованным от <code>AbstractController</code> и всего лишь оборачивать Rails DSL в гем Mail.</p><p>Это также предоставило возможность вычистить Action Controller, упростив его код.</p><p>Однако отметьте, что Abstract Controller не имеет публичного API, и его не стоит запускать в повседневном использовании Rails.</p><p>Подробнее: - <a href="http://yehudakatz.com/2009/06/11/rails-edge-architecture/">Rails Edge Architecture</a></p><h4 id='action-controller' class='inside_page_header'><a href="#action-controller">6.2.</a> Action Controller</h4><ul><li>В <code>application_controller.rb</code> теперь по умолчанию есть <code>protect_from_forgery</code>.
</li><li><code>cookie_verifier_secret</code> устарел, вместо этого теперь назначается <code>Rails.application.config.cookie_secret</code>, и был перемещен в отдельный файл: <code>config/initializers/cookie_verification_secret.rb</code>.
</li><li><code>session_store</code> настраивалось в <code>ActionController::Base.session</code>, а теперь перемещено в <code>Rails.application.config.session_store</code>. Значения по умолчанию устанавливаются в <code>config/initializers/session_store.rb</code>.
</li><li><code>cookies.secure</code> позволяет устанавливать зашифрованные значения куки с помощью <code>cookie.secure[:key] =&gt; value</code>.
</li><li><code>cookies.permanent</code> позволяет устанавливать постоянные значения хэш куки <code>cookie.permanent[:key] =&gt; value</code>, вызывая исключение на шифрованных значениях, если не проходит верификация.
</li><li>Теперь можно передать <code>:notice =&gt; &#39;This is a flash message&#39;</code> или <code>:alert =&gt; &#39;Something went wrong&#39;</code> в вызове <code>format</code> внутри блока <code>respond_to</code>. Хэш <code>flash[]</code> все еще работает по-прежнему.
</li><li>Теперь в контроллеры добавился метод <code>respond_with</code>, упрощающий старые блоки <code>format</code>.
</li><li>Добавленный <code>ActionController::Responder</code> дает гибкость в том, как будут получены сгенерированные вами отклики.
</li></ul><p>Устарело:</p><ul><li><code>filter_parameter_logging</code> устарел в пользу <code>config.filter_parameters &lt;&lt; :password</code>.
</li></ul><p>Подробнее:
* <a href="https://www.engineyard.com/blog/render-options-in-rails-3">Render Options in Rails 3</a>
* <a href="https://weblog.rubyonrails.org/2009/8/31/three-reasons-love-responder">Three reasons to love ActionController::Responder</a></p><h4 id='action-dispatch' class='inside_page_header'><a href="#action-dispatch">6.3.</a> Action Dispatch</h4><p>Action Dispatch это новшество в Rails 3.0, он представляет новую, более чистую реализацию роутинга.</p><ul><li>Большая чистка и переписывание роутера, теперь роутер Rails является <code>rack_mount</code> с лежащим в основе Rails DSL, это отдельная самодостаточная часть программы.
</li><li>Маршруты, определяемые для каждого приложения, теперь помещаются в пространство имен модуля вашего приложения, что означает:
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># Вместо:</span>

<span class="no">ActionController</span><span class="o">::</span><span class="no">Routing</span><span class="o">::</span><span class="no">Routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span> <span class="o">|</span><span class="n">map</span><span class="o">|</span>
  <span class="n">map</span><span class="p">.</span><span class="nf">resources</span> <span class="ss">:posts</span>
<span class="k">end</span>

<span class="c1"># Будет:</span>

<span class="no">AppName</span><span class="o">::</span><span class="no">Application</span><span class="p">.</span><span class="nf">routes</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:posts</span>
<span class="k">end</span>
</code></pre>
</div>
<ul><li>В роутер добавлен метод <code>match</code>, также можно к соответствующему маршруту передать любое приложение Rack.
</li><li>В роутер добавлен метод <code>constraints</code>, позволяющий защитить маршруты определенными ограничениями.
</li><li>В роутер добавлен метод <code>scope</code>, позволяющий вложить маршруты в пространство имен для разных языков или различных экшнов, например:
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">scope</span> <span class="s1">'es'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:projects</span><span class="p">,</span> <span class="ss">:path_names</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:edit</span> <span class="o">=&gt;</span> <span class="s1">'cambiar'</span> <span class="p">},</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">'proyecto'</span>
<span class="k">end</span>

<span class="c1"># Даст вам экшн edit по адресу /es/proyecto/1/cambiar</span>
</code></pre>
</div>
<ul><li>В роутер добавлен метод <code>root</code> как ярлык к <code>match &#39;/&#39;, :to =&gt; path</code>.
</li><li>В match можно передать несколько опциональных сегментов, например <code>match &quot;/:controller(/:action(/:id))(.:format)&quot;</code>, каждый сегмент в скобках является опциональным.
</li><li>Маршруты могут быть выражены с помощью блоков, к примеру можно вызвать <code>controller :home { match &#39;/:action&#39; }</code>.
</li></ul><div class="note"><p>Старый стиль команд <code>map</code> все еще работает, как и прежде, для обратной совместимости, однако будет убран в релизе 3.1.</p></div><p>Устарело</p><ul><li>Обработка всех маршрутов в нересурсных приложениях (<code>/:controller/:action/:id</code>) теперь закомментирована.
</li><li>:path_prefix в маршрутах больше не существует, а :name_prefix теперь автоматически добавляет &quot;_&quot; в конец заданного значения.
</li></ul><p>Подробнее:</p><ul><li><a href="http://yehudakatz.com/2009/12/26/the-rails-3-router-rack-it-up/">The Rails 3 Router: Rack it Up</a>
</li><li><a href="https://medium.com/fusion-of-thoughts/revamped-routes-in-rails-3-b6d00654e5b0">Revamped Routes in Rails 3</a>
</li><li><a href="http://yehudakatz.com/2009/12/20/generic-actions-in-rails-3/">Generic Actions in Rails 3</a>
</li></ul><h4 id='action-view' class='inside_page_header'><a href="#action-view">6.4.</a> Action View</h4><h5 id='nenavyazchivyy-javascript' class='inside_page_header'><a href="#nenavyazchivyy-javascript">6.4.1.</a> Ненавязчивый JavaScript</h5><p>Произошло масштабное переписывание хелперов Action View, реализованы хуки Unobtrusive JavaScript (UJS) и убраны старые команды встроенного AJAX. Это позволило Rails использовать любой совместимый драйвер UJS для внедрения хуков UJS в хелперах.</p><p>Это означает, что все прежние хелперы <code>remote_&lt;method&gt;</code> были убраны из ядра Rails и перемещены в <a href="https://github.com/rails/prototype_legacy_helper">Prototype Legacy Helper</a>. Для получения хуков UJS в HTML, теперь нужно передать <code>:remote =&gt; true</code>. Для примера:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">form_for</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre>
</div>
<p>Создаст:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"http://host.com"</span> <span class="na">id=</span><span class="s">"create-post"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">data-remote=</span><span class="s">"true"</span><span class="nt">&gt;</span>
</code></pre>
</div>
<h4 id='helpery-s-blokami' class='inside_page_header'><a href="#helpery-s-blokami">6.5.</a> Хелперы с блоками</h4><p>Хелперы наподобие <code>form_for</code> или <code>div_for</code>, вставляющие содержимое из блока, теперь используют <code>&lt;%=</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_for</span> <span class="vi">@post</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  ...
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>От ваших собственных подобных хелперов ожидается, что они возвращают строку, а не добавляют к результирующему буферу вручную.</p><p>Хелперы с другим поведением, наподобие <code>cache</code> или <code>content_for</code>, не затронуты этим изменением, им нужен <code>&lt;%</code> как и прежде.</p><h5 id='drugie-izmeneniya' class='inside_page_header'><a href="#drugie-izmeneniya">6.5.1.</a> Другие изменения</h5><ul><li>Больше не нужно вызывать <code>h(string)</code> для экранирования HTML, это осуществляется по умолчанию во всех шаблонах вью. Если хотите неэкранированную строку, вызывайте <code>raw(string)</code>.
</li><li>Теперь по умолчанию хелперы выводят HTML5.
</li><li>Хелпер формы label теперь берет значения из I18n с отдельным значением, таким образом <code>f.label :name</code> возьмет перевод <code>:name</code>.
</li><li>Метка I18n для select теперь :en.helpers.select вместо :en.support.select.
</li><li>Теперь не нужно помещать знак минуса в конце интерполяции руби в шаблоне ERB для того, чтобы убрать перевод строки в результирующем HTML.
</li><li>В Action View добавлен хелпер <code>grouped_collection_select</code>.
</li><li>Добавлен <code>content_for?</code>, позволяющий проверить существование содержимого во вью до рендеринга.
</li><li>Передача в хелперы форм <code>:value =&gt; nil</code> установит атрибут поля <code>value</code> как nil вместо значения по умолчанию
</li><li>Передача в хелперы форм <code>:id =&gt; nil</code> приведет к тому, что эти поля будут отрендерены без атрибута <code>id</code>
</li><li>Передача <code>:alt =&gt; nil</code> в <code>image_tag</code> приведет к тому, что тег <code>img</code> отрендерится без атрибута <code>alt</code>
</li></ul><h3 id='active-model' class='inside_page_header'><a href="#active-model">7.</a> Active Model</h3><p>Active Model это новшество в Rails 3.0. Он представляет уровень абстракции для любой библиотеки ORM для использования во взаимодействии с Rails с применением интерфейса Active Model.</p><h4 id='abstraktsiya-orm-i-interfeys-action-pack' class='inside_page_header'><a href="#abstraktsiya-orm-i-interfeys-action-pack">7.1.</a> Абстракция ORM и интерфейс Action Pack</h4><p>Частью разделения компонентов ядра было выделение всех связей из Action Pack в Active Record. Теперь это выполнено. Всем новым плагинам ORM теперь всего лишь нужно внедрить интерфейсы Active Model, чтобы работать с Action Pack.</p><p>Подробнее: - <a href="http://yehudakatz.com/2010/01/10/activemodel-make-any-ruby-object-feel-like-activerecord/">Make Any Ruby Object Feel Like ActiveRecord</a></p><h4 id='validatsii' class='inside_page_header'><a href="#validatsii">7.2.</a> Валидации</h4><p>Валидации были перемещены из Active Record в Active Model, предоставляя интерфейс для валидаций, работающий во всех библиотеках ORM в Rails 3.</p><ul><li>Теперь имеется краткий метод <code>validates :attribute, options_hash</code> позволяющий передать опции для всех валидационных методов класса, в метод валидации можно передать более одной опции.
</li><li>У метода <code>validates</code> имеются следующие опции:
<ul><li><code>:acceptance =&gt; Boolean</code>.
</li><li><code>:confirmation =&gt; Boolean</code>.
</li><li><code>:exclusion =&gt; { :in =&gt; Enumerable }</code>.
</li><li><code>:inclusion =&gt; { :in =&gt; Enumerable }</code>.
</li><li><code>:format =&gt; { :with =&gt; Regexp, :on =&gt; :create }</code>.
</li><li><code>:length =&gt; { :maximum =&gt; Fixnum }</code>.
</li><li><code>:numericality =&gt; Boolean</code>.
</li><li><code>:presence =&gt; Boolean</code>.
</li><li><code>:uniqueness =&gt; Boolean</code>.
</li></ul></li></ul><div class="note"><p>Все валидационные методы стиля Rails 2.3 все еще поддерживаются в Rails 3.0, новый метод валидации разработан как дополнительная помощь при валидации модели, а не как замена существующего API.</p></div><p>Также можно передать объект валидатора, который можно повторно использовать в разных моделях, использующих Active Model:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">TitleValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">EachValidator</span>
  <span class="no">Titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Mr.'</span><span class="p">,</span> <span class="s1">'Mrs.'</span><span class="p">,</span> <span class="s1">'Dr.'</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">unless</span> <span class="no">Titles</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'must be a valid title'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>
  <span class="nb">attr_accessor</span> <span class="ss">:title</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># Или для Active Record</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Также есть поддержка самоанализа:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">User</span><span class="p">.</span><span class="nf">validators</span>
<span class="no">User</span><span class="p">.</span><span class="nf">validators_on</span><span class="p">(</span><span class="ss">:login</span><span class="p">)</span>
</code></pre>
</div>
<p>Подробнее:</p><ul><li><a href="http://thelucid.com/2010/01/08/sexy-validation-in-edge-rails-rails-3/">Sexy Validation in Rails 3</a>
</li><li><a href="http://lindsaar.net/2010/1/31/validates_rails_3_awesome_is_true">Rails 3 Validations Explained</a>
</li></ul><h3 id='active-record' class='inside_page_header'><a href="#active-record">8.</a> Active Record</h3><p>Active Record было уделено много внимания в Rails 3.0, включая абстрагирование в Active Model, полное обновление интерфейса запросов с применением Arel, обновления валидаций и многие улучшения и исправления. Rails 2.x API будет полностью поддерживаемым с целью совместимости, до версии 3.1.</p><h4 id='interfeys-zaprosov' class='inside_page_header'><a href="#interfeys-zaprosov">8.1.</a> Интерфейс запросов</h4><p>Теперь Active Record, благодаря использованию Arel, возвращает relations на свои основные методы. Существующее API Rails 2.3.x все еще поддерживается и не будет объявлено устаревшим до Rails 3.1, и не будет убрано до Rails 3.2, однако новое API представляет следующие новые методы, все возвращающие relations, позволяющие сцеплять их вместе:</p><ul><li><code>where</code> - Представляет условия для relation, которое будет возвращено.
</li><li><code>select</code> - Выбирает, какие атрибуты моделей будут возращены из БД.
</li><li><code>group</code> - Группирует relation по представленному атрибуту.
</li><li><code>having</code> - Представляет выражение для ограничения сгруппированных relations (ограничение GROUP BY).
</li><li><code>joins</code> - Соединяет relation с другой таблицей.
</li><li><code>clause</code> - Представляет выражение, ограничивающее соединенные relations (ограничение JOIN).
</li><li><code>includes</code> - Включает предварительную загрузку других relations.
</li><li><code>order</code> - Сортирует relation, основываясь на представленном выражении.
</li><li><code>limit</code> - Ограничивает relation представленным количеством записей.
</li><li><code>lock</code> - Блокирует записи, возвращенные из таблицы.
</li><li><code>readonly</code> - Возвращает копию данных только для чтения.
</li><li><code>from</code> - Предоставляет способ для выбора relation из более чем одной таблицы.
</li><li><code>scope</code> - (ранее <code>named_scope</code>) возвращает relations и может быть сцеплен с другим методом для relation.
</li><li><code>with_scope</code> - и <code>with_exclusive_scope</code> теперь также возвращают relations и могут быть сцеплены.
</li><li><code>default_scope</code> - также работает с relations.
</li></ul><p>Подробнее:</p><ul><li><a href="http://m.onkey.org/2010/1/22/active-record-query-interface">Active Record Query Interface</a>
</li><li><a href="http://hasmanyquestions.wordpress.com/2010/01/17/let-your-sql-growl-in-rails-3/">Let your SQL Growl in Rails 3</a>
</li></ul><h4 id='uluchsheniya' class='inside_page_header'><a href="#uluchsheniya">8.2.</a> Улучшения</h4><ul><li>Добавлен <code>:destroyed?</code> к объектам Active Record.
</li><li>Добавлена <code>:inverse_of</code> к связям Active Record, позволяющая получить экземпляр уже загруженной связи без запроса к базе данных.
</li></ul><h4 id='patchi-i-ustarevaniya' class='inside_page_header'><a href="#patchi-i-ustarevaniya">8.3.</a> Патчи и устаревания</h4><p>Кроме того, в ветке Active Record сделано много исправлений:</p><ul><li>Поддержка SQLite 2 была отброшена в пользу SQLite 3.
</li><li>Поддержка порядка следования столбцов в MySQL.
</li><li>В адаптере PostgreSQL теперь исправлена поддержка <code>TIME ZONE</code>, теперь не будут вставляться неправильные значения.
</li><li>Поддержка нескольких схем в именах таблицы для PostgreSQL.
</li><li>PostgreSQL поддерживает тип данных столбца XML.
</li><li><code>table_name</code> теперь кэшируется.
</li><li>Много работы выполнено по адаптеру Oracle, также с множеством исправлений программных ошибок.
</li></ul><p>А также следующее объявлено устаревшим:</p><ul><li><code>named_scope</code> в классе Active Record устарел и был переименован в просто <code>scope</code>.
</li><li>В методах <code>scope</code> следует перейти к использованию методов relation, вместо метода поиска <code>:conditions =&gt; {}</code>, например <code>scope :since, lambda {|time| where(&quot;created_at &gt; ?&quot;, time) }</code>.
</li><li><code>save(false)</code> устарел в пользу <code>save(:validate =&gt; false)</code>.
</li><li>I18n сообщений об ошибках для Active Record должна быть изменена с :en.activerecord.errors.template на <code>:en.errors.template</code>.
</li><li><code>model.errors.on</code> устарел в пользу <code>model.errors[]</code>
</li><li>validates_presence_of =&gt; validates... :presence =&gt; true
</li><li><code>ActiveRecord::Base.colorize_logging</code> и <code>config.active_record.colorize_logging</code> устарели в пользу <code>Rails::LogSubscriber.colorize_logging</code> и <code>config.colorize_logging</code>
</li></ul><div class="note"><p>Хотя реализация State Machine была в ветке Active Record несколько месяцев, она была убрана из релиза Rails 3.0.</p></div><h3 id='active-resource' class='inside_page_header'><a href="#active-resource">9.</a> Active Resource</h3><p>Часть Active Resource также была извлечена в Active Model, позволив легко использовать объекты Active Resource с Action Pack.</p><ul><li>Добавлены валидации с помощью Active Model.
</li><li>Добавлены хуки обсерверов.
</li><li>Поддержка прокси HTTP.
</li><li>Добавлена поддержка дайджест-аутентификации.
</li><li>Именование модели перемещено в Active Model.
</li><li>Изменены атрибуты Active Resource на Hash with indifferent access.
</li><li>Добавлены псевдонимы <code>first</code>, <code>last</code> и <code>all</code> для эквивалентных скоупов поиска.
</li><li>Теперь <code>find_every</code> не возвращает ошибку <code>ResourceNotFound</code>, если ничего не возвращено.
</li><li>Добавлен <code>save!</code>, вызывающий <code>ResourceInvalid</code> если объект не <code>valid?</code>.
</li><li>К моделям Active Resource добавлены <code>update_attribute</code> и <code>update_attributes</code>.
</li><li>Добавлен <code>exists?</code>.
</li><li>Переименован <code>SchemaDefinition</code> в <code>Schema</code> и <code>define_schema</code> в <code>schema</code>.
</li><li>Использован <code>format</code> из Active Resources, а не <code>content-type</code> на удаленных ошибках для загрузки ошибок.
</li><li>Использован <code>instance_eval</code> для блока схемы.
</li><li>Исправлен <code>ActiveResource::ConnectionError#to_s</code>, когда <code>@response</code> не отвечал на #code или #message, для совместимости с Ruby 1.9.
</li><li>Добавлена поддержка для ошибок в формате JSON.
</li><li>Гарантировано, что <code>load</code> работает с числовыми массивами.
</li><li>Распознается отклик 410 от удаленного (remote) ресурса, как то, что ресурс был удален (deleted).
</li><li>Добавлена возможность установить опции SSL на соединениях Active Resource.
</li><li>Настройки тайм-аута соединения также влияют на <code>Net::HTTP</code> <code>open_timeout</code>.
</li></ul><p>Устарело:</p><ul><li><code>save(false)</code> устарел в пользу <code>save(:validate =&gt; false)</code>.
</li><li>Ruby 1.9.2: <code>URI.parse</code> и <code>.decode</code> устарели и больше не используются в библиотеке.
</li></ul><h3 id='active-support' class='inside_page_header'><a href="#active-support">10.</a> Active Support</h3><p>В Active Support были направлены большие усилия на то, чтобы сделать его раздробленным, это означает, что вам больше не нужно требовать всю библиотеку Active Support, чтобы пользоваться ее частью. Это позволило различным частям компонентов ядра Rails выполняться быстрее.</p><p>Вот основные изменения в Active Support:</p><ul><li>Большая чистка всей библиотеки от неиспользуемых методов.
</li><li>Active Support более не предоставляет внешние библиотеки TZInfo, Memcache Client и Builder, все они включены как зависимости и устанавливаются с помощью команды <code>bundle install</code>.
</li><li>Безопасные буферы реализованы в <code>ActiveSupport::SafeBuffer</code>.
</li><li>Добавлены <code>Array.uniq_by</code> и <code>Array.uniq_by!</code>.
</li><li>Убран <code>Array#rand</code> и бэкпортирован <code>Array#sample</code> из Ruby 1.9.
</li><li>Исправлена программная ошибка в методе <code>TimeZone.seconds_to_utc_offset</code>, возвращающий неправильное значение.
</li><li>Добавлена промежуточная программа <code>ActiveSupport::Notifications</code>.
</li><li><code>ActiveSupport.use_standard_json_time_format</code> теперь по умолчанию true.
</li><li><code>ActiveSupport.escape_html_entities_in_json</code> теперь по умолчанию false.
</li><li><code>Integer#multiple_of?</code> принимает ноль как аргумент, возвращает false если получатель не ноль.
</li><li><code>string.chars</code> переименован в <code>string.mb_chars</code>.
</li><li><code>ActiveSupport::OrderedHash</code> теперь может быть десериализован с помощью YAML.
</li><li>Добавлен парсер на основе SAX для XmlMini, с использованием LibXML и Nokogiri.
</li><li>Добавлен <code>Object#presence</code>, возвращающий объект, если он <code>#present?</code>, в ином случае возвращающий <code>nil</code>.
</li><li>Добавлено расширение для <code>String#exclude?</code>, возвращающее противоположность <code>#include?</code>.
</li><li>Добавлен <code>to_i</code> к <code>DateTime</code> в <code>ActiveSupport</code>, таким образом <code>to_yaml</code> правильно работает в моделях с атрибутами <code>DateTime</code>.
</li><li>Добавлен <code>Enumerable#exclude?</code> в пару к <code>Enumerable#include?</code>, чтобы избежать условия <code>!x.include?</code>.
</li><li>Включена по умолчанию экранизация XSS для rails.
</li><li>Поддержка многоуровневого объединения в <code>ActiveSupport::HashWithIndifferentAccess</code>.
</li><li><code>Enumerable#sum</code> теперь работает для всех перечисляемых типов, даже если они не отвечают на <code>:size</code>.
</li><li><code>inspect</code> на нулевой продолжительности возвращает &#39;0 seconds&#39; вместо пустой строки.
</li><li>Добавлены <code>element</code> и <code>collection</code> в <code>ModelName</code>.
</li><li><code>String#to_time</code> и <code>String#to_datetime</code> обрабатывают дробные секунды.
</li><li>Добавлена поддержка для новых колбэков для объекта охватывающего фильтра, отвечающего на <code>:before</code> и <code>:after</code>, используемых в предварительных и последующих колбэках.
</li><li>Метод <code>ActiveSupport::OrderedHash#to_a</code> возвращает упорядоченный набор массивов. Соответствует <code>Hash#to_a</code> из Ruby 1.9.
</li><li><code>MissingSourceFile</code> существует как константа, но сейчас всего лишь равна <code>LoadError</code>.
</li><li>Добавлен <code>Class#class_attribute</code> для возможности объявить атрибуты на уровне класса, значения которых наследуются и перезаписываются подклассами.
</li><li>Окончательно убран <code>DeprecatedCallbacks</code> в <code>ActiveRecord::Associations</code>.
</li><li><code>Object#metaclass</code> теперь <code>Kernel#singleton_class</code>, для соответствия Ruby.
</li></ul><p>Следующие методы были убраны, поскольку они теперь доступны в Ruby 1.8.7 и 1.9.</p><ul><li><code>Integer#even?</code> и <code>Integer#odd?</code>
</li><li><code>String#each_char</code>
</li><li><code>String#start_with?</code> и <code>String#end_with?</code> (псевдонимы в третьем лице все еще остались)
</li><li><code>String#bytesize</code>
</li><li><code>Object#tap</code>
</li><li><code>Symbol#to_proc</code>
</li><li><code>Object#instance_variable_defined?</code>
</li><li><code>Enumerable#none?</code>
</li></ul><p>Патч безопасности для REXML остался в Active Support, поскольку ранним версиям Ruby 1.8.7 он все еще нужен. Active Support знает, нужно его применять или нет.</p><p>Следующие методы были убраны, поскольку они больше не используются во фреймворке:</p><ul><li><code>Kernel#daemonize</code>
</li><li><code>Object#remove_subclasses_of</code> <code>Object#extend_with_included_modules_from</code>, <code>Object#extended_by</code>
</li><li><code>Class#remove_class</code>
</li><li><code>Regexp#number_of_captures</code>, <code>Regexp.unoptionalize</code>, <code>Regexp.optionalize</code>, <code>Regexp#number_of_captures</code>
</li></ul><h3 id='action-mailer' class='inside_page_header'><a href="#action-mailer">11.</a> Action Mailer</h3><p>Action Mailer получил новый API в связи с заменой TMail на новый <a href="https://github.com/mikel/mail">Mail</a> в качестве библиотеки для электронных писем. В самом Action Mailer была переписана практически каждая строчка кода. В результате теперь Action Mailer просто наследуется от Abstract Controller и оборачивает гем Mail в Rails DSL. Это значительно уменьшило количество кода и дублирование других библиотек в Action Mailer.</p><ul><li>По умолчанию все рассыльщики теперь находятся в <code>app/mailers</code>.
</li><li>Теперь можно отослать email с использованием нового API тремя методами: <code>attachments</code>, <code>headers</code> and <code>mail</code>.
</li><li>Теперь в Action Mailer имеется нативная поддержка для встроенных прикрепленных файлов с помощью метода <code>attachments.inline</code>.
</li><li>Методы рассылки Action Mailer теперь возвращают объекты <code>Mail::Message</code>, которые затем могут быть отосланы с помощью метода <code>deliver</code> на них.
</li><li>Все методы доставки теперь абстрагированы в геме Mail.
</li><li>Метод отправки письма может принимать хэш всех валидных полей заголовка письма в паре с их значением.
</li><li>Метод доставки <code>mail</code> работает подобно <code>respond_to</code> из Action Controller, и можно явно или неявно рендерить шаблоны. Action Mailer превратит email в multipart email по необходимости.
</li><li>В вызов <code>format.mime_type</code> в блоке mail можно передать proc и явно отрендерить определенные типы текста, или добавить макет или различные шаблоны. Вызов <code>render</code> внутри proc происходит из Abstract Controller и поддерживает те же опции.
</li><li>Юнит-тесты рассыльщика перенесены в функциональные тесты.
</li><li>Теперь Action Mailer делегирует все автоматическое кодирование полей заголовка и тела письма в гем Mail
</li><li>Action Mailer автоматически закодирует поля заголовка и тело письма
</li></ul><p>Устарело:</p><ul><li><code>:charset</code>, <code>:content_type</code>, <code>:mime_version</code>, <code>:implicit_parts_order</code> устарели в пользу стиля объявления <code>ActionMailer.default :key =&gt; value</code>.
</li><li>Динамические методы рассыльщика <code>create_method_name</code> и <code>deliver_method_name</code> устарели, просто вызывайте <code>method_name</code>, который возвратит объект <code>Mail::Message</code>.
</li><li><code>ActionMailer.deliver(message)</code> устарел, просто вызывайте <code>message.deliver</code>.
</li><li><code>template_root</code> устарел, передавайте опции в вызов render в proc из метода <code>format.mime_type</code> внутри блока генерации письма <code>mail</code>
</li><li>Метод <code>body</code> для определения переменных экземпляра устарел (<code>body {:ivar =&gt; value}</code>), всего лишь определите переменные экземпляра непосредственно в методе, и они будут доступны во вью.
</li><li>Нахождение рассыльщиков в <code>app/models</code> устарело, вместо этого используйте <code>app/mailers</code>.
</li></ul><p>Подробнее:</p><ul><li><a href="http://lindsaar.net/2010/1/26/new-actionmailer-api-in-rails-3">New Action Mailer API in Rails 3</a>
</li><li><a href="http://lindsaar.net/2010/1/23/mail-gem-version-2-released">New Mail Gem for Ruby</a>
</li></ul>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
              <a target="blank" href="http://twitter.com/rusrails"><img src="/assets/twitter-50e0e767c8793dec313a7dc5cfbcfe2067e3e89ea6ec64784eb7c6640f578758.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-8ee447905888b153d8458707061a14b1f15f69b6733e871a3ad91d80ae89e87b.js"></script>
  </body>
</html>

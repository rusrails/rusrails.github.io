<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="product" property="twitter:card"/>
<meta content="@rusrails" property="twitter:site"/>
<meta content="Rusrails: Основы Active Model" property="twitter:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="twitter:description"/>
<meta content="@rusrails" property="twitter:creator"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="twitter:image"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Основы Active Model" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/active-model-basics" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Основы Active Model
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/classic-to-zeitwerk-howto">Как перейти с Classic на Zeitwerk</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
              <p></p>
              <a class="twitter-follow-button" data-lang="ru" href="https://twitter.com/rusrails"></a>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#chto-takoe-active-model">1. Что такое Active Model?</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#api">1.1. API</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#model">1.2. Модель</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#atributy">1.3. Атрибуты</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#metod-attribute_names">1.3.1. Метод: <code>attribute_names</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#metod-attributes">1.3.2. Метод: <code>attributes</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#attribute-assignment">1.4. Назначение Атрибутов</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#psevdonim-metoda-attributes">1.4.1. Псевдоним метода: <code>attributes=</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#metody-atributov">1.5. Методы атрибутов</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#metod-alias_attribute">1.5.1. Метод: <code>alias_attribute</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#kolbeki">1.6. Колбэки</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#opredelenie-konkretnyh-kolbekov">1.6.1. Определение конкретных колбэков</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#opredelenie-kolbekov-s-klassom">1.6.2. Определение колбэков с классом</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#preryvanie-kolbekov">1.6.3. Прерывание колбэков</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#conversion">1.7. Преобразование</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#to_model">1.7.1. to_model</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_key">1.7.2. to_key</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_param">1.7.3. to_param</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_partial_path">1.7.4. to_partial_path</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#gryaznyy-ob-ekt">1.8. Грязный объект</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#pryamoy-zapros-k-ob-ektu-o-spiske-vseh-izmenennyh-atributov">1.8.1. Прямой запрос к объекту о списке всех измененных атрибутов</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#aktsessor-metody-na-osnove-atributov">1.8.2. Акцессор-методы на основе атрибутов</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#naming">1.9. Именование</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#nastroyka-nazvaniya-modeli">1.9.1. Настройка названия модели</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#securepassword">1.10. SecurePassword</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#serializatsiya">1.11. Сериализация</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#activemodel-serializers-json">1.11.1. ActiveModel::Serializers::JSON</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#translation">1.12. Перевод</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#validations">1.13. Валидации</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#metody-i-optsii-validatsii">1.13.1. Методы и опции валидации</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#oshibki">1.13.2. Ошибки</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#testy-sovmestimosti">1.14. Тесты совместимости</a>
</h5>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='osnovy-active-model' class='inside_page_header'> Основы Active Model</h2><p>Это руководство познакомит вас со всем необходимым для начала использования Active Model. Active Model предоставляет способ хелперам Action Pack и Action View взаимодействовать с обычными объектами на чистом Ruby. Также он помогает с созданием гибкой, настраиваемой ORM для использования вне фреймворка Rails.</p><p>После прочтение данного руководства, вы узнаете:</p><ul><li>Что такое Active Model, и как он относится к Active Record.
</li><li>О разных модулях, включенных в Active Model.
</li><li>Как использовать Active Model в ваших классах.
</li></ul>
<hr>
<h3 id='chto-takoe-active-model' class='inside_page_header'><a href="#chto-takoe-active-model">1.</a> Что такое Active Model?</h3><p>Чтобы понять Active Model, вам нужно немного знать об <a href="/active-record-basics">Active Record</a>. Active Record - это ORM (Object Relational Mapper), который соединяет объекты, данные которых требуют постоянного хранения, с реляционной базой данных. Однако он обладает функциональностью, которая полезна вне ORM, например, валидация, колбэки, переводы, возможность создавать пользовательские атрибуты и т.д.</p><p>Некоторые из этих функций были абстрагированы из Active Record для формирования Active Model. Active Model - это библиотека, содержащая различные модули, которые можно использовать для обычных объектов Ruby, которым требуются функции, похожие на модели, но которые не привязаны к какой-либо таблице в базе данных.</p><p>Итак, Active Record предоставляет интерфейс для определения моделей, соответствующих таблицам базы данных, а Active Model предоставляет функционал для создания похожих на модели классов Ruby, которым не обязательно требуется поддержка базы данных. Active Model можно использовать независимо от Active Record.</p><p>Некоторые из этих модулей описаны ниже.</p><h4 id='api' class='inside_page_header'><a href="#api">1.1.</a> API</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/API.html"><code>ActiveModel::API</code></a> добавляет возможность классу работать с <a href="https://api.rubyonrails.org/files/actionpack/README_rdoc.html">Action Pack</a> и <a href="/action-view-overview">Action View</a> прямо из коробки.</p><p>При включении <code>ActiveModel::API</code>, по умолчанию включаются другие модули, добавляющие особенности, такие как:</p><ul><li><a href="#attribute-assignment">Назначение атрибутов</a>
</li><li><a href="#conversion">Преобразование</a>
</li><li><a href="#naming">Именование</a>
</li><li><a href="#translation">Перевод</a>
</li><li><a href="#validations">Валидации</a>
</li></ul><p>Вот пример класса, включающего <code>ActiveModel::API</code>, и как его можно использовать:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">EmailContact</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">API</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:message</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>

  <span class="k">def</span> <span class="nf">deliver</span>
    <span class="k">if</span> <span class="n">valid?</span>
      <span class="c1"># Доставляем письмо</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">email_contact</span> <span class="o">=</span> <span class="no">EmailContact</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"David"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"david@example.com"</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"Hello World"</span><span class="p">)</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">email_contact</span><span class="p">.</span><span class="nf">to_model</span> <span class="o">==</span> <span class="n">email_contact</span> <span class="c1"># Преобразование</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">email_contact</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># Именование</span>
<span class="p">=&gt;</span> <span class="s2">"EmailContact"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">EmailContact</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span> <span class="c1"># Перевод, если установлена локаль</span>
<span class="p">=&gt;</span> <span class="s2">"Name"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">email_contact</span><span class="p">.</span><span class="nf">valid?</span> <span class="c1"># Валидации</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">empty_contact</span> <span class="o">=</span> <span class="no">EmailContact</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">empty_contact</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<p>Любой класс, включающий <code>ActiveModel::API</code>, может быть использован с <code>form_with</code>, <code>render</code> и любыми другими <a href="https://api.rubyonrails.org/classes/ActionView/Helpers.html">вспомогательными методами Action View</a>, точно так же, как и объекты Active Record.</p><p>Например, <code>form_with</code> можно использовать, чтобы создать форму для объекта <code>EmailContact</code> следующим образом:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="no">EmailContact</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>что приведет к следующему HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/email_contacts"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"email_contact[name]"</span> <span class="na">id=</span><span class="s">"email_contact_name"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p><code>render</code> может быть использован для отрисовки партиала с объектом:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@email_contact</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<div class="note"><p>Дополнительную информацию об использовании <code>form_with</code> и <code>render</code> с объектами, совместимыми с <code>ActiveModel::API</code>, можно найти в руководствах <a href="/form-helpers">по хелперам форм</a> и <a href="layouts-and-rendering">по макетам и рендерингу</a> соответственно.</p></div><h4 id='model' class='inside_page_header'><a href="#model">1.2.</a> Модель</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Model.html"><code>ActiveModel::Model</code></a> по умолчанию включает <a href="#api">ActiveModel::API</a> для взаимодействия с Action Pack и Action View. Это рекомендуемый подход для реализации Ruby-классов, похожих на модели. В будущем он будет расширен для добавления дополнительных функций.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'bob'</span><span class="p">,</span> <span class="ss">age: </span><span class="s1">'18'</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "bob"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">age</span>  <span class="c1"># =&gt; "18"</span>
</code></pre>
</div>
<h4 id='atributy' class='inside_page_header'><a href="#atributy">1.3.</a> Атрибуты</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Attributes.html"><code>ActiveModel::Attributes</code></a> позволяет определять типы данных, устанавливать значения по умолчанию, а также обрабатывать преобразование и сериализацию для обычных объектов Ruby. Это может быть полезно для данных форм, которые будут выполнять преобразование, похожее на Active Record, для таких вещей, как даты и логические значения в обычных объектах.</p><p>Для того, чтобы использовать <code>Attributes</code>, включите этот модуль в ваш класс модели и определите свои атрибуты с помощью макроса <code>attribute</code>. Он принимает имя, тип приведения, значение по умолчанию и любые другие опции, поддерживаемые типом атрибута.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Attributes</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">:date</span>
  <span class="n">attribute</span> <span class="ss">:active</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Jane"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"Jane"</span>

<span class="c"># Преобразует строку в дату, установленную атрибутом
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">date_of_birth</span> <span class="o">=</span> <span class="s2">"2020-01-01"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">date_of_birth</span>
<span class="p">=&gt;</span> <span class="no">Wed</span><span class="p">,</span> <span class="mo">01</span> <span class="no">Jan</span> <span class="mi">2020</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">date_of_birth</span><span class="p">.</span><span class="nf">class</span>
<span class="p">=&gt;</span> <span class="no">Date</span>

<span class="c"># Использует значение по умолчанию, установленное атрибутом
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">active</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="c"># Преобразует число в логическое значение, установленное атрибутом
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">active</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">active</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<p>При использовании <code>ActiveModel::Attributes</code> доступны дополнительные методы, описанные ниже.</p><h5 id='metod-attribute_names' class='inside_page_header'><a href="#metod-attribute_names">1.3.1.</a> Метод: <code>attribute_names</code></h5><p>Метод <code>attribute_names</code> возвращает массив имен атрибутов.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">attribute_names</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"date_of_birth"</span><span class="p">,</span> <span class="s2">"active"</span><span class="p">]</span>
</code></pre>
</div>
<h5 id='metod-attributes' class='inside_page_header'><a href="#metod-attributes">1.3.2.</a> Метод: <code>attributes</code></h5><p>Метод <code>attributes</code> возвращает хэш всех атрибутов с их именами в качестве ключей и значениями атрибутов в качестве значений.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">attributes</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Jane"</span><span class="p">,</span> <span class="s2">"date_of_birth"</span> <span class="o">=&gt;</span> <span class="no">Wed</span><span class="p">,</span> <span class="mo">01</span> <span class="no">Jan</span> <span class="mi">2020</span><span class="p">,</span> <span class="s2">"active"</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">}</span>
</code></pre>
</div>
<h4 id='attribute-assignment' class='inside_page_header'><a href="#attribute-assignment">1.4.</a> Назначение Атрибутов</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/AttributeAssignment.html"><code>ActiveModel::AttributeAssignment</code></a> позволяет устанавливать атрибуты объекта путем передачи хэша атрибутов, где ключи соответствуют именам атрибутов. Это удобно, когда вы хотите установить сразу несколько атрибутов.</p><p>Рассмотрим следующий класс:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">AttributeAssignment</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">:active</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="c"># Устанавливаем несколько атрибутов за раз
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">assign_attributes</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John"</span><span class="p">,</span> <span class="ss">date_of_birth: </span><span class="s2">"1998-01-01"</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span><span class="p">)</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"John"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">date_of_birth</span>
<span class="p">=&gt;</span> <span class="no">Thu</span><span class="p">,</span> <span class="mo">01</span> <span class="no">Jan</span> <span class="mi">1998</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">active</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<p>Если переданный хеш отвечает на метод <code>permitted?</code> и возвращаемое значение этого метода равно <code>false</code>, то возникает исключение <code>ActiveModel::ForbiddenAttributesError</code>.</p><div class="note"><p><code>permitted?</code> используется для интеграции со <a href="https://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">strong params</a> при назначении атрибута params из запроса.</p></div><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="c"># Используется проверка strong parameters, создаем хэш атрибутов, подобный params из запроса
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">params</span> <span class="o">=</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"John"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=</span><span class="kt">&gt;</span> <span class="s2">"John"</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">false</span><span class="o">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">assign_attributes</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="c1"># Вызывает ActiveModel::ForbiddenAttributesError</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="kp">nil</span>

<span class="c"># Разрешаем атрибуты, для которых мы желаем разрешить назначение
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">permitted_params</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=</span><span class="kt">&gt;</span> <span class="s2">"John"</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">true</span><span class="o">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">assign_attributes</span><span class="p">(</span><span class="n">permitted_params</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"John"</span>
</code></pre>
</div>
<h5 id='psevdonim-metoda-attributes' class='inside_page_header'><a href="#psevdonim-metoda-attributes">1.4.1.</a> Псевдоним метода: <code>attributes=</code></h5><p>Метод <code>assign_attributes</code> имеет псевдоним <code>attributes=</code>.</p><div class="info"><p>Псевдоним метода - это метод, который выполняет то же самое действие, что и другой метод, но называется по-другому. Псевдонимы существуют для улучшения читаемости и удобства.</p></div><p>В следующем примере показано использование метода <code>attributes=</code> для одновременной установки нескольких атрибутов:</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">attributes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"John"</span><span class="p">,</span> <span class="ss">date_of_birth: </span><span class="s2">"1998-01-01"</span><span class="p">,</span> <span class="ss">active: </span><span class="kp">false</span> <span class="p">}</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"John"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">date_of_birth</span>
<span class="p">=&gt;</span> <span class="s2">"1998-01-01"</span>
</code></pre>
</div>
<div class="info"><p><code>assign_attributes</code> и <code>attributes=</code> - оба являются вызовами методов и принимают в качестве аргумента хэш атрибутов для назначения. Во многих случаях в Ruby разрешено опускать круглые скобки <code>()</code> при вызове метода и фигурные скобки <code>{}</code> при определении хэша. <br><br>
Методы-сеттеры, такие как <code>attributes=</code>, обычно пишутся без скобок <code>()</code>, хотя их использование не приведет к ошибкам. Однако хэш в таком случае всегда должен быть заключен в фигурные скобки <code>{}</code>. Например, <code>person.attributes=({ name: &quot;John&quot; })</code> - это правильно, а <code>person.attributes = name: &quot;John&quot;</code> приведет к ошибке <code>SyntaxError</code>.<br><br>
Другие вызовы методов вроде <code>assign_attributes</code> могут принимать хэш-аргумент как с круглыми скобками <code>()</code>, так и с фигурными скобками <code>{}</code>. Например, <code>assign_attributes name: &quot;John&quot;</code> и <code>assign_attributes({ name: &quot;John&quot; })</code> - оба варианта являются корректным кодом Ruby. Однако запись <code>assign_attributes { name: &quot;John&quot; }</code> вызовет ошибку <code>SyntaxError</code>, поскольку Ruby не сможет отличить хэш-аргумент от блока кода.</p></div><h4 id='metody-atributov' class='inside_page_header'><a href="#metody-atributov">1.5.</a> Методы атрибутов</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/AttributeMethods.html"><code>ActiveModel::AttributeMethods</code></a> позволяет динамически определять методы для атрибутов модели. Этот модуль особенно полезен для упрощения доступа к атрибутам и их обработки. Он также может добавлять пользовательские префиксы и суффиксы к методам класса. Для определения префиксов, суффиксов и методов, их использующих, выполните следующие действия:</p><ul><li>Включите <code>ActiveModel::AttributeMethods</code> в ваш класс.
</li><li>Вызовите необходимые методы, такие как <code>attribute_method_suffix</code>, <code>attribute_method_prefix</code>, <code>attribute_method_affix</code>.
</li><li>После вызова других методов вызовите <code>define_attribute_methods</code> для указания атрибутов, к которым следует применять префикс и суффикс.
</li><li>Определите различные общие методы <code>_attribute</code>, которые вы объявили. Параметр <code>attribute</code> в этих методах будет заменен аргументом, переданным в <code>define_attribute_methods</code>. В приведенном ниже примере это <code>name</code>.
</li></ul><div class="note"><p><code>attribute_method_prefix</code> и <code>attribute_method_suffix</code> используются для определения префиксов и суффиксов, которые будут использоваться для создания методов. <code>attribute_method_affix</code> используется для одновременного определения как префикса, так и суффикса.</p></div><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">AttributeMethods</span>

  <span class="n">attribute_method_affix</span> <span class="ss">prefix: </span><span class="s2">"reset_"</span><span class="p">,</span> <span class="ss">suffix: </span><span class="s2">"_to_default!"</span>
  <span class="n">attribute_method_prefix</span> <span class="s2">"first_"</span><span class="p">,</span> <span class="s2">"last_"</span>
  <span class="n">attribute_method_suffix</span> <span class="s2">"_short?"</span>

  <span class="n">define_attribute_methods</span> <span class="s2">"name"</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span>

  <span class="kp">private</span>
    <span class="c1"># Вызов метода атрибута для 'first_name'</span>
    <span class="k">def</span> <span class="nf">first_attribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
      <span class="n">public_send</span><span class="p">(</span><span class="n">attribute</span><span class="p">).</span><span class="nf">split</span><span class="p">.</span><span class="nf">first</span>
    <span class="k">end</span>

    <span class="c1"># Вызов метода атрибута для 'last_name'</span>
    <span class="k">def</span> <span class="nf">last_attribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
      <span class="n">public_send</span><span class="p">(</span><span class="n">attribute</span><span class="p">).</span><span class="nf">split</span><span class="p">.</span><span class="nf">last</span>
    <span class="k">end</span>

    <span class="c1"># Вызов метода атрибута для 'name_short?'</span>
    <span class="k">def</span> <span class="nf">attribute_short?</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
      <span class="n">public_send</span><span class="p">(</span><span class="n">attribute</span><span class="p">).</span><span class="nf">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="k">end</span>

    <span class="c1"># Вызов метода атрибута 'reset_name_to_default!'</span>
    <span class="k">def</span> <span class="nf">reset_attribute_to_default!</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
      <span class="n">public_send</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">="</span><span class="p">,</span> <span class="s2">"Default Name"</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Jane Doe"</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name</span>
<span class="p">=&gt;</span> <span class="s2">"Jane"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">last_name</span>
<span class="p">=&gt;</span> <span class="s2">"Doe"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name_short?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">reset_name_to_default!</span>
<span class="p">=&gt;</span> <span class="s2">"Default Name"</span>
</code></pre>
</div>
<p>Если вы вызовете метод, который не определен, возникнет ошибка <code>NoMethodError</code>.</p><h5 id='metod-alias_attribute' class='inside_page_header'><a href="#metod-alias_attribute">1.5.1.</a> Метод: <code>alias_attribute</code></h5><p><code>ActiveModel::AttributeMethods</code> позволяет создавать псевдонимы для методов атрибутов с помощью метода <code>alias_attribute</code>.</p><p>В примере ниже создается псевдонимный атрибут для <code>name</code> под названием <code>full_name</code>. Они возвращают одно и то же значение, но псевдоним <code>full_name</code> лучше отражает тот факт, что атрибут включает в себя имя и фамилию.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">AttributeMethods</span>

  <span class="n">attribute_method_suffix</span> <span class="s2">"_short?"</span>
  <span class="n">define_attribute_methods</span> <span class="ss">:name</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span>

  <span class="n">alias_attribute</span> <span class="ss">:full_name</span><span class="p">,</span> <span class="ss">:name</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">attribute_short?</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
      <span class="n">public_send</span><span class="p">(</span><span class="n">attribute</span><span class="p">).</span><span class="nf">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Joe Doe"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"Joe Doe"</span>

<span class="c"># `full_name` - псевдоним для `name`, и возвращает то же самое значение
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">full_name</span>
<span class="p">=&gt;</span> <span class="s2">"Joe Doe"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name_short?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="c"># `full_name_short?` псевдоним для `name_short?`, и возвращает то же самое значение
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">full_name_short?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<h4 id='kolbeki' class='inside_page_header'><a href="#kolbeki">1.6.</a> Колбэки</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Callbacks.html"><code>ActiveModel::Callbacks</code></a> предоставляет обычным объектам Ruby возможность использовать <a href="/active-record-callbacks">колбэки в стиле Active Record</a>. Колбэки позволяют вам подключаться к событиям жизненного цикла модели, таким как <code>before_update</code> и <code>after_create</code>, а также определять собственную логику, которая будет выполняться в определенные моменты жизненного цикла модели.</p><p>Вы можете реализовать <code>ActiveModel::Callbacks</code>, выполнив следующие действия:</p><ul><li>Расширьте ваш класс с помощью <code>ActiveModel::Callbacks</code>.
</li><li>Используйте <code>define_model_callbacks</code> для определения списка методов, с которыми должны быть связаны колбэки. Когда вы указываете метод, такой как <code>:update</code>, он автоматически включает все три колбэка по умолчанию (<code>before</code>, <code>around</code> и <code>after</code>) для события <code>:update</code>.
</li><li>Внутри определенного метода используйте <code>run_callbacks</code>, который выполнит цепочку колбэков, когда будет вызвано определенное событие.
</li><li>Затем в своем классе вы можете использовать методы <code>before_update</code>, <code>after_update</code> и <code>around_update</code> так же, как вы использовали бы их в модели Active Record.
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">extend</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Callbacks</span>

  <span class="n">define_model_callbacks</span> <span class="ss">:update</span>

  <span class="n">before_update</span> <span class="ss">:reset_me</span>
  <span class="n">after_update</span> <span class="ss">:finalize_me</span>
  <span class="n">around_update</span> <span class="ss">:log_me</span>

  <span class="c1"># метод `define_model_callbacks` содержит `run_callbacks`, который запустит колбэк(и) для заданного события</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">run_callbacks</span><span class="p">(</span><span class="ss">:update</span><span class="p">)</span> <span class="k">do</span>
      <span class="nb">puts</span> <span class="s2">"update method called"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="c1"># Когда на объекте вызван update, этот метод будет вызван колбэком `before_update`</span>
    <span class="k">def</span> <span class="nf">reset_me</span>
      <span class="nb">puts</span> <span class="s2">"reset_me method: called before the update method"</span>
    <span class="k">end</span>

    <span class="c1"># Когда на объекте вызван update, этот метод будет вызван колбэком `after_update`</span>
    <span class="k">def</span> <span class="nf">finalize_me</span>
      <span class="nb">puts</span> <span class="s2">"finalize_me method: called after the update method"</span>
    <span class="k">end</span>

    <span class="c1"># Когда на объекте вызван update, этот метод будет вызван колбэком `around_update`</span>
    <span class="k">def</span> <span class="nf">log_me</span>
      <span class="nb">puts</span> <span class="s2">"log_me method: called around the update method"</span>
      <span class="k">yield</span>
      <span class="nb">puts</span> <span class="s2">"log_me method: block successfully called"</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Класс, описанный выше, выведет следующее, что указывает на очередность вызова колбэков:</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">update</span>
<span class="go">reset_me method: called before the update method
log_me method: called around the update method
update method called
log_me method: block successfully called
finalize_me method: called after the update method
</span><span class="p">=&gt;</span> <span class="kp">nil</span>
</code></pre>
</div>
<p>В соответствии с приведенным выше примером, при определении колбэка &#39;around&#39; необходимо выполнять <code>yield</code> для блока, иначе он не будет выполнен.</p><div class="note"><p><code>method_name</code>, передаваемый в <code>define_model_callbacks</code>, не должен заканчиваться на <code>!</code>, <code>?</code> или <code>=</code>. Кроме того, многократное определение одного и того же колбэка перезапишет предыдущие определения колбэков.</p></div><h5 id='opredelenie-konkretnyh-kolbekov' class='inside_page_header'><a href="#opredelenie-konkretnyh-kolbekov">1.6.1.</a> Определение конкретных колбэков</h5><p>Вы можете создавать определенные колбэки, передавая опцию <code>only</code> методу <code>define_model_callbacks</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">define_model_callbacks</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:after</span><span class="p">,</span> <span class="ss">:before</span><span class="p">]</span>
</code></pre>
</div>
<p>Это создаст только колбэки <code>before_create</code> / <code>after_create</code> и <code>before_update</code> / <code>after_update</code>, пропуская <code>around_*</code>. Опция будет применяться ко всем колбэкам, определенным в данном вызове метода. Можно вызвать <code>define_model_callbacks</code> несколько раз, чтобы указать разные события жизненного цикла:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">define_model_callbacks</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">only: :after</span>
<span class="n">define_model_callbacks</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">only: :before</span>
<span class="n">define_model_callbacks</span> <span class="ss">:destroy</span><span class="p">,</span> <span class="ss">only: :around</span>
</code></pre>
</div>
<p>В этом случае будут созданы только методы <code>after_create</code>, <code>before_update</code> и <code>around_destroy</code>.</p><h5 id='opredelenie-kolbekov-s-klassom' class='inside_page_header'><a href="#opredelenie-kolbekov-s-klassom">1.6.2.</a> Определение колбэков с классом</h5><p>Для большего контроля над тем, когда и в каком контексте будут вызваны ваши колбэки, вы можете передать класс в <code>before_&lt;type&gt;</code>, <code>after_&lt;type&gt;</code> и <code>around_&lt;type&gt;</code>. колбэк вызовет метод <code>&lt;action&gt;_&lt;type&gt;</code> этого класса, передав экземпляр класса в качестве аргумента.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">extend</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Callbacks</span>

  <span class="n">define_model_callbacks</span> <span class="ss">:create</span>
  <span class="n">before_create</span> <span class="no">PersonCallbacks</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PersonCallbacks</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">before_create</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="c1"># `obj` - экземпляр Person, для которого вызывается колбэк</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<h5 id='preryvanie-kolbekov' class='inside_page_header'><a href="#preryvanie-kolbekov">1.6.3.</a> Прерывание колбэков</h5><p>Цепочку колбэков можно прервать в любой момент времени, выбросив <code>:abort</code>. Это аналогично работе колбэков Active Record.</p><p>В приведенном ниже примере, поскольку мы бросаем <code>:abort</code> перед обновлением в методе <code>reset_me</code>, оставшаяся цепочка колбэков, включая <code>before_update</code>, будет прервана, и тело метода <code>update</code> не будет выполнено.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">extend</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Callbacks</span>

  <span class="n">define_model_callbacks</span> <span class="ss">:update</span>

  <span class="n">before_update</span> <span class="ss">:reset_me</span>
  <span class="n">after_update</span> <span class="ss">:finalize_me</span>
  <span class="n">around_update</span> <span class="ss">:log_me</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">run_callbacks</span><span class="p">(</span><span class="ss">:update</span><span class="p">)</span> <span class="k">do</span>
      <span class="nb">puts</span> <span class="s2">"update method called"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">reset_me</span>
      <span class="nb">puts</span> <span class="s2">"reset_me method: called before the update method"</span>
      <span class="kp">throw</span> <span class="ss">:abort</span>
      <span class="nb">puts</span> <span class="s2">"reset_me method: some code after abort"</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">finalize_me</span>
      <span class="nb">puts</span> <span class="s2">"finalize_me method: called after the update method"</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">log_me</span>
      <span class="nb">puts</span> <span class="s2">"log_me method: called around the update method"</span>
      <span class="k">yield</span>
      <span class="nb">puts</span> <span class="s2">"log_me method: block successfully called"</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">update</span>
<span class="go">reset_me method: called before the update method
</span><span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<h4 id='conversion' class='inside_page_header'><a href="#conversion">1.7.</a> Преобразование</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Conversion.html"><code>ActiveModel::Conversion</code></a> - это набор методов для преобразования объекта в различные форматы для различных целей. Обычно используется для преобразования объекта в строку или число для построения URL, полей формы и так далее.</p><p>Модуль <code>ActiveModel::Conversion</code> добавляет классам следующие методы: <code>to_model</code>, <code>to_key</code>, <code>to_param</code> и <code>to_partial_path</code>.</p><p>Возвращаемое значение методов зависит от определения <code>persisted?</code> и наличия <code>id</code>. Метод <code>persisted?</code> должен возвращать <code>true</code>, если объект был сохранен в базе данных или хранилище, в противном случае должен возвращать <code>false</code>. <code>id</code> должен возвращать идентификатор объекта, если он был сохранен, или nil, если не был сохранен.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Conversion</span>
  <span class="nb">attr_accessor</span> <span class="ss">:id</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="vi">@id</span> <span class="o">=</span> <span class="nb">id</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">persisted?</span>
    <span class="nb">id</span><span class="p">.</span><span class="nf">present?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<h5 id='to_model' class='inside_page_header'><a href="#to_model">1.7.1.</a> to_model</h5><p>Метод <code>to_model</code> возвращает сам объект.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_model</span> <span class="o">==</span> <span class="n">person</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
</div>
<p>Если ваша модель не ведёт себя как объект Active Model, вам следует определить метод <code>:to_model</code> самостоятельно. Он должен возвращать прокси-объект, который заворачивает ваш объект и предоставляет методы, совместимые с Active Model.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">def</span> <span class="nf">to_model</span>
    <span class="c1"># A proxy object that wraps your object with Active Model compliant methods.</span>
    <span class="no">PersonModel</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<h5 id='to_key' class='inside_page_header'><a href="#to_key">1.7.2.</a> to_key</h5><p>Метод <code>to_key</code> возвращает массив ключевых атрибутов объекта, если таковые имеются, независимо от того, сохранен ли объект. Если ключевых атрибутов нет, метод возвращает nil.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_key</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
<div class="note"><p>Ключевой атрибут - это атрибут, используемый для идентификации объекта. Например, в модели, поддерживаемой базой данных, ключевым атрибутом является первичный ключ.</p></div><h5 id='to_param' class='inside_page_header'><a href="#to_param">1.7.3.</a> to_param</h5><p>Метод <code>to_param</code> возвращает строковое представление ключа объекта, пригодное для использования в URL, или <code>nil</code>, если метод <code>persisted?</code> возвращает <code>false</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_param</span>
<span class="p">=&gt;</span> <span class="s2">"1"</span>
</code></pre>
</div>
<h5 id='to_partial_path' class='inside_page_header'><a href="#to_partial_path">1.7.4.</a> to_partial_path</h5><p>Метод <code>to_partial_path</code> возвращает строку, представляющую путь, связанный с объектом. Action Pack использует этот путь для поиска подходящего партиала для отображения объекта.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_partial_path</span>
<span class="p">=&gt;</span> <span class="s2">"people/person"</span>
</code></pre>
</div>
<h4 id='gryaznyy-ob-ekt' class='inside_page_header'><a href="#gryaznyy-ob-ekt">1.8.</a> Грязный объект</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Dirty.html"><code>ActiveModel::Dirty</code></a> - это полезный инструмент в Ruby on Rails, который позволяет отслеживать изменения, внесенные в атрибуты модели перед их сохранением. Эта функциональность позволяет вам определить, какие атрибуты объекта были изменены, каковы их предыдущие и текущие значения, и выполнять действия на основе этих изменений. Это особенно полезно для аудита, проверки данных и условной логики в вашем приложении. Он позволяет отслеживать изменения в вашем объекте так же, как и в Active Record.</p><p>Объект становится грязным после одного или нескольких изменений его атрибутов, и при этом он не был сохранен. У него имеются акцессор-методы на основе атрибутов.</p><p>Для использования <code>ActiveModel::Dirty</code> необходимо выполнить следующие шаги:</p><ul><li>Подключите модуль в ваш класс.
</li><li>Определите методы атрибутов, изменения которых вы хотите отслеживать, с помощью <code>define_attribute_methods</code>.
</li><li>Вызовите <code>[attr_name]_will_change!</code> перед каждым изменением отслеживаемого атрибута.
</li><li>Вызовите <code>changes_applied</code> после сохранения изменений.
</li><li>Вызовите <code>clear_changes_information</code> для сброса информации об изменениях, когда это необходимо.
</li><li>Используйте <code>restore_attributes</code> для восстановления предыдущих данных объекта.
</li></ul><p>После этого вы можете использовать методы, предоставляемые <code>ActiveModel::Dirty</code>, чтобы запросить у объекта список всех измененных атрибутов, их исходные значения и внесенные изменения.</p><p>Рассмотрим класс <code>Person</code> с атрибутами <code>first_name</code> и <code>last_name</code> и определим, как использовать <code>ActiveModel::Dirty</code> для отслеживания изменений этих атрибутов.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Dirty</span>

  <span class="nb">attr_reader</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span>
  <span class="n">define_attribute_methods</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@first_name</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="vi">@last_name</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">first_name</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">first_name_will_change!</span> <span class="k">unless</span> <span class="n">value</span> <span class="o">==</span> <span class="vi">@first_name</span>
    <span class="vi">@first_name</span> <span class="o">=</span> <span class="n">value</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">last_name</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">last_name_will_change!</span> <span class="k">unless</span> <span class="n">value</span> <span class="o">==</span> <span class="vi">@last_name</span>
    <span class="vi">@last_name</span> <span class="o">=</span> <span class="n">value</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">save</span>
    <span class="c1"># Записываем данные - очищает грязные данные и перемещает `changes` в `previous_changes`.</span>
    <span class="n">changes_applied</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">reload!</span>
    <span class="c1"># Очищает все грязные данные: текущие изменения и предыдущие изменения.</span>
    <span class="n">clear_changes_information</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">rollback!</span>
    <span class="c1"># Восстанавливает все предыдущие данные предоставленных атрибутов.</span>
    <span class="n">restore_attributes</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<h5 id='pryamoy-zapros-k-ob-ektu-o-spiske-vseh-izmenennyh-atributov' class='inside_page_header'><a href="#pryamoy-zapros-k-ob-ektu-o-spiske-vseh-izmenennyh-atributov">1.8.1.</a> Прямой запрос к объекту о списке всех измененных атрибутов</h5><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="c"># Вновь инициализированный объект `Person` неизмененный:
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">changed?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name</span> <span class="o">=</span> <span class="s2">"Jane Doe"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name</span>
<span class="p">=&gt;</span> <span class="s2">"Jane Doe"</span>
</code></pre>
</div>
<p><strong><code>changed?</code></strong> возвращает <code>true</code> если любой из атрибутов имеет несохраненные изменения, в противном случае <code>false</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">changed?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
</div>
<p><strong><code>changed</code></strong> возвращает массив с именем атрибутов, содержащих несохраненные изменения.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">changed</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"first_name"</span><span class="p">]</span>
</code></pre>
</div>
<p><strong><code>changed_attributes</code></strong> возвращает хэш атрибутов с несохраненными изменениями, указывающий их изначальные значения, наподобие <code>attr =&gt; original value</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">changed_attributes</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"first_name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>
</code></pre>
</div>
<p><strong><code>changes</code></strong> возвращает хэш изменений с именами атрибутов в качестве ключей и значениями массивами из оригинального и нового значений, наподобие <code>attr =&gt; [original value, new value]</code>.</p><div class="code_container">
  <pre><code class="highlight plaintext">irb&gt; person.changes
=&gt; {"first_name" =&gt; [nil, "Jane Doe"]}
</code></pre>
</div>
<p><strong><code>previous_changes</code></strong> возвращает хэш атрибутов, которые были изменены до того, как модель была сохранена (то есть до вызова <code>changes_applied</code>).</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">previous_changes</span>
<span class="p">=&gt;</span> <span class="p">{}</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">previous_changes</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"first_name"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"Jane Doe"</span><span class="p">]}</span>
</code></pre>
</div>
<h5 id='aktsessor-metody-na-osnove-atributov' class='inside_page_header'><a href="#aktsessor-metody-na-osnove-atributov">1.8.2.</a> Акцессор-методы на основе атрибутов</h5><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">changed?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name</span> <span class="o">=</span> <span class="s2">"John Doe"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name</span>
<span class="p">=&gt;</span> <span class="s2">"John Doe"</span>
</code></pre>
</div>
<p><strong><code>[attr_name]_changed?</code></strong> проверяет, был ли некоторый атрибут изменен или нет.</p><div class="code_container">
  <pre><code class="highlight plaintext">irb&gt; person.first_name_changed?
=&gt; true
</code></pre>
</div>
<p><strong><code>[attr_name]_was</code></strong> отслеживает предыдущее значение атрибута.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name_was</span>
<span class="p">=&gt;</span> <span class="kp">nil</span>
</code></pre>
</div>
<p><strong><code>[attr_name]_change</code></strong> отслеживает оба предыдущее и текущее значения измененного атрибута. Возвращает массив с <code>[original value, new value]</code>, если изменен, в противном случае <code>nil</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name_change</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"John Doe"</span><span class="p">]</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">last_name_change</span>
<span class="p">=&gt;</span> <span class="kp">nil</span>
</code></pre>
</div>
<p><strong><code>[attr_name]_previously_changed?</code></strong> проверяет, был ли некоторый атрибут изменен до сохранения модели (то есть до вызова <code>changes_applied</code>).</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name_previously_changed?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">save</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name_previously_changed?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
</div>
<p><strong><code>[attr_name]_previous_change</code></strong> отслеживает оба предыдущее и текущее значения измененного атрибута до сохранения модели (то есть до вызова <code>changes_applied</code>). Возвращает массив с <code>[original value, new value]</code>, если изменен, в противном случае <code>nil</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">first_name_previous_change</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">"John Doe"</span><span class="p">]</span>
</code></pre>
</div>
<h4 id='naming' class='inside_page_header'><a href="#naming">1.9.</a> Именование</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Naming.html"><code>ActiveModel::Naming</code></a> добавляет метод класса и вспомогательные методы для упрощения именования и управления маршрутизацией. Модуль определяет метод класса <code>model_name</code>, который с помощью методов из <a href="https://api.rubyonrails.org/classes/ActiveSupport/Inflector.html"><code>ActiveSupport::Inflector</code></a> создает несколько акцессоров.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">extend</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Naming</span>
<span class="k">end</span>
</code></pre>
</div>
<p><strong><code>name</code></strong> возвращает имя модели.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"Person"</span>
</code></pre>
</div>
<p><strong><code>singular</code></strong> возвращает имя в единственном числе записи или класса.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">singular</span>
<span class="p">=&gt;</span> <span class="s2">"person"</span>
</code></pre>
</div>
<p><strong><code>plural</code></strong> возвращает имя во множественном числе записи или класса.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">plural</span>
<span class="p">=&gt;</span> <span class="s2">"people"</span>
</code></pre>
</div>
<p><strong><code>element</code></strong> удаляет пространство имен и возвращает имя в единственном числе snake_cased. Обычно этот метод используется хелперами Action Pack и/или Action View для помощи в отрисовке по имени партиалов/форм.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">element</span>
<span class="p">=&gt;</span> <span class="s2">"person"</span>
</code></pre>
</div>
<p><strong><code>human</code></strong> преобразует название модели в более понятный для человека формат, используя библиотеку I18n. По умолчанию он применяет знак подчеркивания, а затем преобразует его в более читаемый вид.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">human</span>
<span class="p">=&gt;</span> <span class="s2">"Person"</span>
</code></pre>
</div>
<p><strong><code>collection</code></strong> удаляет пространство имен и возвращает имя во множественном числе snake_cased. Обычно этот метод используется хелперами Action Pack и/или Action View для помощи в отрисовке по имени партиалов/форм.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">collection</span>
<span class="p">=&gt;</span> <span class="s2">"people"</span>
</code></pre>
</div>
<p><strong><code>param_key</code></strong> возвращает строку для использования в именах параметров.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">param_key</span>
<span class="p">=&gt;</span> <span class="s2">"person"</span>
</code></pre>
</div>
<p><strong><code>i18n_key</code></strong> возвращает имя ключа i18n. Он применяет знак подчеркивания к имени модели и затем возвращает как символ.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">i18n_key</span>
<span class="p">=&gt;</span> <span class="ss">:person</span>
</code></pre>
</div>
<p><strong><code>route_key</code></strong> возвращает строку при генерации имен маршрутов.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">route_key</span>
<span class="p">=&gt;</span> <span class="s2">"people"</span>
</code></pre>
</div>
<p><strong><code>singular_route_key</code></strong> возвращает строку при генерации имен маршрутов.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">singular_route_key</span>
<span class="p">=&gt;</span> <span class="s2">"person"</span>
</code></pre>
</div>
<p><strong><code>uncountable?</code></strong> идентифицирует, является ли имя записи или класса исчисляемым.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">model_name</span><span class="p">.</span><span class="nf">uncountable?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>
<div class="note"><p>Некоторые методы <code>Naming</code>, такие как <code>param_key</code>, <code>route_key</code> и <code>singular_route_key</code>, ведут себя по-разному для моделей с пространством имен в зависимости от того, находятся ли они внутри изолированного <a href="/engines">Engine</a>.</p></div><h5 id='nastroyka-nazvaniya-modeli' class='inside_page_header'><a href="#nastroyka-nazvaniya-modeli">1.9.1.</a> Настройка названия модели</h5><p>Иногда вы можете захотеть изменить название модели, которое используется в хелперах форм и генерации URL. Это может быть полезно в ситуациях, когда вы хотите использовать более понятное для пользователя название модели, при этом сохраняя возможность ссылаться на нее с использованием полного пространства имен.</p><p>Например, предположим, в вашем Rails-приложении есть пространство имен <code>Person</code>, и вы хотите создать форму для нового <code>Person::Profile</code>.</p><p>По умолчанию Rails сгенерирует форму с URL <code>/person/profiles</code>, который включает пространство имен <code>person</code>. Однако, если вы хотите, чтобы URL просто указывал на <code>profiles</code> без пространства имен, вы можете настроить метод <code>model_name</code> следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Person</span>
  <span class="k">class</span> <span class="nc">Profile</span>
    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model_name</span>
      <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"Profile"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>При такой настройке, когда вы используете хелпер <code>form_with</code> для создания формы добавления нового объекта <code>Person::Profile</code>, Rails сгенерирует форму с URL <code>/profiles</code> вместо <code>/person/profiles</code>. Это происходит потому, что метод <code>model_name</code> переопределен для возвращения значения <code>Profile</code>.</p><p>Помимо этого, хелперы путей будут генерироваться без пространства имен, поэтому вы сможете использовать <code>profiles_path</code> вместо <code>person_profiles_path</code> для генерации URL к ресурсу <code>profiles</code>. Для использования хелпера <code>profiles_path</code> вам необходимо определить маршруты для модели <code>Person::Profile</code> в файле <code>config/routes.rb</code> следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:profiles</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Следовательно, для методов, описанных в предыдущем разделе, модель будет возвращать следующие значения:</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">name</span> <span class="o">=</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Person</span><span class="o">::</span><span class="no">Profile</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"Profile"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveModel</span><span class="o">::</span><span class="no">Name</span><span class="p">:</span><span class="mh">0x000000014c5dbae0</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">name</span><span class="p">.</span><span class="nf">singular</span>
<span class="p">=&gt;</span> <span class="s2">"profile"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">name</span><span class="p">.</span><span class="nf">singular_route_key</span>
<span class="p">=&gt;</span> <span class="s2">"profile"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="nb">name</span><span class="p">.</span><span class="nf">route_key</span>
<span class="p">=&gt;</span> <span class="s2">"profiles"</span>
</code></pre>
</div>
<h4 id='securepassword' class='inside_page_header'><a href="#securepassword">1.10.</a> SecurePassword</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/SecurePassword.html"><code>ActiveModel::SecurePassword</code></a> предназначен для безопасного хранения паролей в зашифрованном виде. При подключении этого модуля появляется метод класса <code>has_secure_password</code>, который по умолчанию определяет акцессор <code>password</code> с некоторыми встроенными валидациями.</p><p>Для работы <code>ActiveModel::SecurePassword</code> необходима библиотека <a href="https://github.com/bcrypt-ruby/bcrypt-ruby" title="BCrypt"><code>bcrypt</code></a>, для ее использования добавьте этот гем в ваш <code>Gemfile</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">gem</span> <span class="s2">"bcrypt"</span>
</code></pre>
</div>
<p><code>ActiveModel::SecurePassword</code> требует наличия атрибута <code>password_digest</code>.</p><p>Он также автоматически добавляет следующие валидации:</p><ul><li>Обязательное наличие пароля при создании.
</li><li>Подтверждение пароля (с помощью атрибута <code>password_confirmation</code>).
</li><li>Максимальная длина пароля составляет 72 символа (ограничение библиотеки <code>bcrypt</code>, которая обрезает строку перед шифрованием).
</li></ul><div class="note"><p>Если подтверждение пароля не требуется, просто оставьте поле <code>password_confirmation</code> пустым (т.е. не включайте его в форму). При значении <code>nil</code> этого атрибута валидация подтверждения не будет выполняться.</p></div><p>Для дополнительной настройки можно отключить все валидации по умолчанию, передав аргумент <code>validations: false</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">SecurePassword</span>

  <span class="n">has_secure_password</span>
  <span class="n">has_secure_password</span> <span class="ss">:recovery_password</span><span class="p">,</span> <span class="ss">validations: </span><span class="kp">false</span>

  <span class="nb">attr_accessor</span> <span class="ss">:password_digest</span><span class="p">,</span> <span class="ss">:recovery_password_digest</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="c"># Когда пароль пустой.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="c"># Когда подтверждение не соответствует паролю.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"aditya"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password_confirmation</span> <span class="o">=</span> <span class="s2">"nomatch"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="c"># Когда длина пароля превышает 72.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="nf">password_confirmation</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">100</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="c"># Когда предоставлен только password без password_confirmation.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"aditya"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="c"># Когда все валидации проходят.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="nf">password_confirmation</span> <span class="o">=</span> <span class="s2">"aditya"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">recovery_password</span> <span class="o">=</span> <span class="s2">"42password"</span>
<span class="err">
</span><span class="c"># `authenticate` это псевдоним для `authenticate_password`
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"aditya"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span><span class="kt">&gt;</span> <span class="c1"># == person</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s2">"notright"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate_password</span><span class="p">(</span><span class="s2">"aditya"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span><span class="kt">&gt;</span> <span class="c1"># == person</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate_password</span><span class="p">(</span><span class="s2">"notright"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate_recovery_password</span><span class="p">(</span><span class="s2">"aditya"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate_recovery_password</span><span class="p">(</span><span class="s2">"42password"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span><span class="kt">&gt;</span> <span class="c1"># == person</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">authenticate_recovery_password</span><span class="p">(</span><span class="s2">"notright"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">password_digest</span>
<span class="p">=&gt;</span> <span class="s2">"$2a$04$gF8RfZdoXHvyTjHhiU4ZsO.kQqV9oonYZu31PRE4hLQn3xM2qkpIy"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">recovery_password_digest</span>
<span class="p">=&gt;</span> <span class="s2">"$2a$04$iOfhwahFymCs5weB3BNH/uXkTG65HR.qpW.bNhEjFP3ftli3o5DQC"</span>
</code></pre>
</div>
<h4 id='serializatsiya' class='inside_page_header'><a href="#serializatsiya">1.11.</a> Сериализация</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Serialization.html"><code>ActiveModel::Serialization</code></a> предназначен для базовой сериализации объектов. Вам потребуется определить хэш атрибутов, который будет содержать атрибуты, которые вы хотите сериализовать. Атрибуты должны быть строками, а не символами.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serialization</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span>

  <span class="k">def</span> <span class="nf">attributes</span>
    <span class="c1"># Определение сериализуемых атрибутов</span>
    <span class="p">{</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">capitalized_name</span>
    <span class="c1"># Объявленные методы потом могут быть включены в сериализованный хэш</span>
    <span class="nb">name</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">capitalize</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Теперь вы можете получить сериализованный хэш вашего объекта с помощью метода <code>serializable_hash</code>. Допустимые опции для <code>serializable_hash</code> включают <code>:only</code>, <code>:except</code>, <code>:methods</code> и <code>:include</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>

<span class="c"># Устанавливаем атрибуты name и age и сериализуем объект
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"bob"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">age</span> <span class="o">=</span> <span class="mi">22</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"bob"</span><span class="p">,</span> <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">}</span>

<span class="c"># Используем опцию methods для включения метода capitalized_name
</span><span class="gp">irb&gt;</span><span class="w">  </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span><span class="p">(</span><span class="ss">methods: :capitalized_name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"bob"</span><span class="p">,</span> <span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">,</span> <span class="s2">"capitalized_name"</span> <span class="o">=&gt;</span> <span class="s2">"Bob"</span><span class="p">}</span>

<span class="c"># Используем опцию only для включения только атрибута name
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span><span class="p">(</span><span class="ss">only: :name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"bob"</span><span class="p">}</span>

<span class="c"># Используем опцию except для исключения атрибута name
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span><span class="p">(</span><span class="ss">except: :name</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"age"</span> <span class="o">=&gt;</span> <span class="mi">22</span><span class="p">}</span>
</code></pre>
</div>
<p>Пример использования опции <code>includes</code> требует немного более сложной ситуации, как описано ниже:</p><div class="code_container">
  <pre><code class="highlight ruby">  <span class="k">class</span> <span class="nc">Person</span>
    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serialization</span>
    <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:notes</span> <span class="c1"># Эмулируем has_many :notes</span>

    <span class="k">def</span> <span class="nf">attributes</span>
      <span class="p">{</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="nc">Note</span>
    <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serialization</span>
    <span class="nb">attr_accessor</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span>

    <span class="k">def</span> <span class="nf">attributes</span>
      <span class="p">{</span> <span class="s2">"title"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"text"</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">note</span> <span class="o">=</span> <span class="no">Note</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">note</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s2">"Weekend Plans"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">note</span><span class="p">.</span><span class="nf">text</span> <span class="o">=</span> <span class="s2">"Some text here"</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Napoleon"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">]</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Napoleon"</span><span class="p">}</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">serializable_hash</span><span class="p">(</span><span class="ss">include: </span><span class="p">{</span> <span class="ss">notes: </span><span class="p">{</span> <span class="ss">only: </span><span class="s2">"title"</span> <span class="p">}})</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Napoleon"</span><span class="p">,</span> <span class="s2">"notes"</span> <span class="o">=&gt;</span> <span class="p">[{</span><span class="s2">"title"</span> <span class="o">=&gt;</span> <span class="s2">"Weekend Plans"</span><span class="p">}]}</span>
</code></pre>
</div>
<h5 id='activemodel-serializers-json' class='inside_page_header'><a href="#activemodel-serializers-json">1.11.1.</a> ActiveModel::Serializers::JSON</h5><p>Active Model также предоставляет модуль <a href="https://api.rubyonrails.org/classes/ActiveModel/Serializers/JSON.html"><code>ActiveModel::Serializers::JSON</code></a> для сериализации / десериализации в формат JSON.</p><p>Для использования сериализации в JSON формате замените подключаемый модуль с <code>ActiveModel::Serialization</code> на <code>ActiveModel::Serializers::JSON</code>. Он уже включает в себя функциональность предыдущего, поэтому его отдельное подключение не требуется.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serializers</span><span class="o">::</span><span class="no">JSON</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span>

  <span class="k">def</span> <span class="nf">attributes</span>
    <span class="p">{</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Метод <code>as_json</code>, как и <code>serializable_hash</code>, возвращает хэш, представляющий модель, где ключи являются строками. Метод <code>to_json</code> возвращает строку в формате JSON, представляющую модель.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="c"># Хэш, представляющий модель, где ключи - это строки.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">as_json</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>

<span class="c"># Строка JSON, представляющая модель
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_json</span>
<span class="p">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:null}"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Bob"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">as_json</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Bob"</span><span class="p">}</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">to_json</span>
<span class="p">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Bob</span><span class="se">\"</span><span class="s2">}"</span>
</code></pre>
</div>
<p>Также можно определить атрибуты для модели из строки JSON. Для этого сначала нужно определить в классе метод <code>attributes=</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Serializers</span><span class="o">::</span><span class="no">JSON</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span>

  <span class="k">def</span> <span class="nf">attributes</span><span class="o">=</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
    <span class="nb">hash</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
      <span class="n">public_send</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">="</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">attributes</span>
    <span class="p">{</span> <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Теперь есть возможность создавать экземпляры <code>Person</code> и устанавливать атрибуты с помощью <code>from_json</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">json</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Bob"</span> <span class="p">}.</span><span class="nf">to_json</span>
<span class="p">=&gt;</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Bob</span><span class="se">\"</span><span class="s2">}"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Person</span><span class="p">:</span><span class="mh">0x00000100c773f0</span> <span class="vi">@name</span><span class="o">=</span><span class="s2">"Bob"</span><span class="kt">&gt;</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span>
<span class="p">=&gt;</span> <span class="s2">"Bob"</span>
</code></pre>
</div>
<h4 id='translation' class='inside_page_header'><a href="#translation">1.12.</a> Перевод</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Translation.html"><code>ActiveModel::Translation</code></a> предоставляет интеграцию между вашим объектом и <a href="/i18n">фреймворком интернационализации Rails (i18n)</a>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">extend</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Translation</span>
<span class="k">end</span>
</code></pre>
</div>
<p>С помощью метода <code>human_attribute_name</code> можно преобразовывать имена атрибутов в более удобочитаемый формат. Удобочитаемый формат определяется в вашем(-их) файле(-ах) локали.</p><ul><li>config/locales/app.pt-BR.yml
</li></ul><div class="code_container">
  <pre><code class="highlight yaml"><span class="c1"># config/locales/app.pt-BR.yml</span>
<span class="na">pt-BR</span><span class="pi">:</span>
  <span class="na">activemodel</span><span class="pi">:</span>
    <span class="na">attributes</span><span class="pi">:</span>
      <span class="na">person</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Nome"</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="s2">"Name"</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">I18n</span><span class="p">.</span><span class="nf">locale</span> <span class="o">=</span> <span class="ss">:"pt-BR"</span>
<span class="p">=&gt;</span> <span class="ss">:"pt-BR"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Person</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="s2">"Nome"</span>
</code></pre>
</div>
<h4 id='validations' class='inside_page_header'><a href="#validations">1.13.</a> Валидации</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations.html"><code>ActiveModel::Validations</code></a> предоставляет возможности для валидации объектов, что играет важную роль в обеспечении целостности и согласованности данных в вашем приложении. Встраивая валидации в свои модели, вы можете определять правила, регламентирующие корректность значений атрибутов, и предотвращать недопустимые данные.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>

  <span class="nb">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:token</span>

  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">format: </span><span class="p">{</span> <span class="ss">with: </span><span class="no">URI</span><span class="o">::</span><span class="no">MailTo</span><span class="o">::</span><span class="no">EMAIL_REGEXP</span> <span class="p">}</span>
  <span class="n">validates!</span> <span class="ss">:token</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">token</span> <span class="o">=</span> <span class="s2">"2b1f325"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"Jane Doe"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">email</span> <span class="o">=</span> <span class="s2">"me"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">false</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">email</span> <span class="o">=</span> <span class="s2">"jane.doe@gmail.com"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="kp">true</span>

<span class="c"># `token` использует validate! и вызовет исключение когда не установлен.
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">token</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="s2">"Token can't be blank (ActiveModel::StrictValidationFailed)"</span>
</code></pre>
</div>
<h5 id='metody-i-optsii-validatsii' class='inside_page_header'><a href="#metody-i-optsii-validatsii">1.13.1.</a> Методы и опции валидации</h5><p>Вы можете добавить валидации, используя некоторые из следующих методов:</p><ul><li><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validate"><code>validate</code></a>: Добавляет проверку через метод или блок к классу.</p></li><li><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates"><code>validates</code></a>: Атрибут может быть передан методу <code>validates</code>, который предоставляет сокращение для всех стандартных валидаторов.</p></li><li><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates-21"><code>validates!</code></a> или установка <code>strict: true</code>: Используется для определения валидаций, которые не могут быть исправлены конечными пользователями и считаются исключительными. Каждый валидатор, определенный с восклицательным знаком или опцией <code>:strict</code>, установленной в значение true, всегда будет вызывать <code>ActiveModel::StrictValidationFailed</code> вместо добавления к ошибкам, когда проверка не удается.</p></li><li><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_with"><code>validates_with</code></a>: Передает запись в указанный класс или классы и позволяет им добавлять ошибки на основе более сложных условий.</p></li><li><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html#method-i-validates_each"><code>validates_each</code></a>: Проверяет каждый атрибут в блоке.</p></li></ul><p>Некоторые из приведенных ниже опций могут использоваться с определенными валидаторами. Чтобы определить, можно ли использовать опцию с конкретным валидатором, ознакомьтесь с документацией <a href="https://api.rubyonrails.org/classes/ActiveModel/Validations/ClassMethods.html">здесь</a>.</p><ul><li><p><code>:on</code>: Указывает контекст, в котором добавлять валидацию. Вы можете передать символ или массив символов. (например, <code>on: :create</code>, или <code>on: :custom_validation_context</code>, или <code>on: [:create, :custom_validation_context]</code>). Валидации без опции <code>:on</code> будут выполняться независимо от контекста. Валидации с некоторой опцией <code>:on</code> будут выполняться только в указанном контексте. Вы можете передать контекст при валидации с помощью <code>valid?(:context)</code>.</p></li><li><p><code>:if</code>: Указывает метод, proc или строку для вызова, чтобы определить, должна ли выполняться валидация (например, <code>if: :allow_validation</code>, или <code>if: -&gt; { signup_step &gt; 2 }</code>). Метод, proc или строка должны возвращать или вычисляться в значение <code>true</code> или <code>false</code>.</p></li><li><p><code>:unless</code>: Указывает метод, proc или строку для вызова, чтобы определить, не должна ли выполняться валидация (например, <code>unless: :skip_validation</code>, или <code>unless: Proc.new { |user| user.signup_step &lt;= 2 }</code>). Метод, proc или строка должны возвращать или вычисляться в значение <code>true</code> или <code>false</code>.</p></li><li><p><code>:allow_nil</code>: Пропустите валидацию, если атрибут <code>nil</code>.</p></li><li><p><code>:allow_blank</code>: Пропустите валидацию, если атрибут пустой.</p></li><li><p><code>:strict</code>: Если опция <code>:strict</code> установлена в значение true, она будет вызывать <code>ActiveModel::StrictValidationFailed</code> вместо добавления ошибки. Опция <code>:strict</code> также может быть установлена в любое другое исключение.</p></li></ul><div class="note"><p>Многократный вызов <code>validate</code> на одном и том же методе перезапишет предыдущие определения.</p></div><h5 id='oshibki' class='inside_page_header'><a href="#oshibki">1.13.2.</a> Ошибки</h5><p><code>ActiveModel::Validations</code> автоматически добавляет метод <code>errors</code> к вашим экземплярам, инициализированным новым объектом <a href="https://api.rubyonrails.org/classes/ActiveModel/Errors.html"><code>ActiveModel::Errors</code></a> (вам не нужно делать это вручную).</p><p>Вызовите <code>valid?</code> на объекте, чтобы проверить, является ли объект валидным. Если объект не является валидным, он вернет <code>false</code>, а ошибки будут добавлены в объект <code>errors</code>.</p><div class="code_container">
  <pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
<span class="err">
</span><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">email</span> <span class="o">=</span> <span class="s2">"me"</span>
<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">valid?</span>
<span class="p">=&gt;</span> <span class="c1"># Raises Token can't be blank (ActiveModel::StrictValidationFailed)</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">to_hash</span>
<span class="p">=&gt;</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">],</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"is invalid"</span><span class="p">]}</span>

<span class="gp">irb&gt;</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span>
<span class="p">=&gt;</span> <span class="p">[</span><span class="s2">"Name can't be blank"</span><span class="p">,</span> <span class="s2">"Email is invalid"</span><span class="p">]</span>
</code></pre>
</div>
<h4 id='testy-sovmestimosti' class='inside_page_header'><a href="#testy-sovmestimosti">1.14.</a> Тесты совместимости</h4><p><a href="https://api.rubyonrails.org/classes/ActiveModel/Lint/Tests.html"><code>ActiveModel::Lint::Tests</code></a> позволяет проверить, совместим ли объект с Active Model API. Включая <code>ActiveModel::Lint::Tests</code> в ваш TestCase, он будет включать тесты, которые сообщают вам, полностью ли ваш объект соответствует, или, если нет, какие аспекты API не реализованы.</p><p>Эти тесты не пытаются определить семантическую правильность возвращаемых значений. Например, вы можете реализовать <code>valid?</code> так, чтобы он всегда возвращал <code>true</code>, и тесты пройдут. Вы должны сами позаботиться о том, чтобы значения имели смысловое значение.</p><p>Ожидается, что объекты, которые вы передаете, будут возвращать совместимый объект при вызове <code>to_model</code>. Вполне допустимо, чтобы <code>to_model</code> возвращал <code>self</code>.</p><ul><li><p><code>app/models/person.rb</code></p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">API</span>
<span class="k">end</span>
</code></pre>
</div>
</li><li><p><code>test/models/person_test.rb</code></p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"test_helper"</span>

<span class="k">class</span> <span class="nc">PersonTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Tests</span>

  <span class="n">setup</span> <span class="k">do</span>
    <span class="vi">@model</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
</li></ul><p>Тестовые методы можно найти <a href="https://api.rubyonrails.org/classes/ActiveModel/Lint/Tests.html">здесь</a>.</p><p>Чтобы запустить тесты, используйте следующую команду:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails test</span>
<span class="go">
Run options: --seed 14596

</span><span class="gp">#</span><span class="w"> </span>Running:
<span class="go">
</span><span class="c">......
</span><span class="go">
Finished in 0.024899s, 240.9735 runs/s, 1204.8677 assertions/s.

6 runs, 30 assertions, 0 failures, 0 errors, 0 skips
</span></code></pre>
</div>


            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
              <a target="blank" href="http://twitter.com/rusrails"><img src="/assets/twitter-50e0e767c8793dec313a7dc5cfbcfe2067e3e89ea6ec64784eb7c6640f578758.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-8ee447905888b153d8458707061a14b1f15f69b6733e871a3ad91d80ae89e87b.js"></script>
  </body>
</html>

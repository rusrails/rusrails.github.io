<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="product" property="twitter:card"/>
<meta content="@rusrails" property="twitter:site"/>
<meta content="Rusrails: Обзор Action View" property="twitter:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="twitter:description"/>
<meta content="@rusrails" property="twitter:creator"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="twitter:image"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Обзор Action View" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/action-view-overview" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Обзор Action View
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/classic-to-zeitwerk-howto">Как перейти с Classic на Zeitwerk</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_2_release_notes">Версия 7.2 - ?</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
              <p></p>
              <a class="twitter-follow-button" data-lang="ru" href="https://twitter.com/rusrails"></a>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#chto-takoe-action-view">1. Что такое Action View?</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#ispolzovanie-action-view-s-rails">2. Использование Action View с Rails</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#shablony">3. Шаблоны</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#erb">3.1. ERB</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#jbuilder">3.2. Jbuilder</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#builder">3.3. Builder</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#kompilyatsiya-shablonov">3.4. Компиляция шаблонов</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#partialy">4. Партиалы</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#rendering-partialov">4.1. Рендеринг партиалов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ispolzovanie-partialov-dlya-uproscheniya-vyu">4.2. Использование партиалов для упрощения вью</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#peredacha-dannyh-v-partialy-s-pomoschyu-optsii-locals">4.3. Передача данных в партиалы с помощью опции <code>locals</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ispolzovanie-local_assigns">4.4. Использование <code>local_assigns</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#render-bez-optsiy-partial-i-locals">4.5. <code>render</code> без опций <code>partial</code> и <code>locals</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#optsii-as-i-object">4.6. Опции <code>as</code> и <code>object</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#rendering-kollektsiy">4.7. Рендеринг коллекций</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#razdelyayuschie-shablony">4.8. Разделяющие шаблоны</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#peremennye-schetchika">4.9. Переменные счетчика</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#local-assigns-with-pattern-matching">4.10. <code>local_assigns</code> с соответствием образцу</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#strict-locals">4.11. Строгие локальные переменные</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#makety">5. Макеты</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#makety-dlya-partialov">5.1. Макеты для партиалов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#kollektsii-s-maketami-dlya-partialov">5.2. Коллекции с макетами для партиалов</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#helpers">6. Хелперы</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#lokalizovannye-vyu">7. Локализованные вью</a>
</h4>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='obzor-action-view' class='inside_page_header'> Обзор Action View</h2><p>После прочтения этого руководства вы узнаете:</p><ul><li>Что такое Action View, и как его использовать вместе с Rails.
</li><li>Как лучше использовать шаблоны, партиалы и макеты.
</li><li>Как использовать локализованные вью.
</li></ul>
<hr>
<h3 id='chto-takoe-action-view' class='inside_page_header'><a href="#chto-takoe-action-view">1.</a> Что такое Action View?</h3><p>Action View - это V в <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a>. <a href="/action-controller-overview">Action Controller</a> и Action View работают вместе для обработки веб-запросов. Action Controller отвечает за взаимодействие с уровнем модели (в MVC) и получение данных. Затем Action View отвечает за отрисовку тела ответа на веб-запрос, используя эти данные.</p><p>По умолчанию шаблоны Action View (также называемые просто &quot;вью&quot;) пишутся с использованием Embedded Ruby (ERB), который позволяет использовать код Ruby внутри HTML-документов.</p><p>Action View предоставляет множество <a href="#helpers">вспомогательных методов - хелперов</a> для динамического создания HTML-тегов для форм, дат и строк. Также можно добавлять в ваше приложение собственные хелперы по мере необходимости.</p><div class="note"><p>Action View может использовать функции Active Model, такие как <a href="https://api.rubyonrails.org/classes/ActiveModel/Conversion.html#method-i-to_param"><code>to_param</code></a> и <a href="https://api.rubyonrails.org/classes/ActiveModel/Conversion.html#method-i-to_partial_path"><code>to_partial_path</code></a> для упрощения кода. Это не означает, что Action View зависит от Active Model. Action View является независимым пакетом, который можно использовать с любой библиотекой Ruby.</p></div><h3 id='ispolzovanie-action-view-s-rails' class='inside_page_header'><a href="#ispolzovanie-action-view-s-rails">2.</a> Использование Action View с Rails</h3><p>Шаблоны Action View (также называемые &quot;вью&quot;) хранятся во вложенных папках внутри директории <code>app/views</code>. Там есть вложенная папка, соответствующая имени каждого контроллера. Файлы вью внутри этой папки используются для отрисовки конкретных вью в ответ на экшны контроллера.</p><p>Например, при использовании генератора скаффолда для создания ресурса <code>article</code>, Rails создает следующие файлы в <code>app/views/articles</code>:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate scaffold article
<span class="go">      [...]
      invoke  scaffold_controller
      create    app/controllers/articles_controller.rb
      invoke    erb
      create      app/views/articles
      create      app/views/articles/index.html.erb
      create      app/views/articles/edit.html.erb
      create      app/views/articles/show.html.erb
      create      app/views/articles/new.html.erb
      create      app/views/articles/_form.html.erb
      [...]
</span></code></pre>
</div>
<p>Именование файлов следует соглашениям Rails. Их названия совпадают с названиями связанных экшнов контроллера. Например, <code>index.html.erb</code>, <code>edit.html.erb</code> и т.д.</p><p>Соблюдая это соглашение, Rails автоматически найдет и отрисует соответствующую вью в конце экшна контроллера, без необходимости его явного указания. Например, экшн <code>index</code> в <code>articles_controller.rb</code> автоматически отрисует вью <code>index.html.erb</code> из директории <code>app/views/articles/</code>. Важны как название файла, так и его расположение.</p><p>Итоговый HTML, возвращаемый клиенту, формируется из комбинации файла ERB <code>.html.erb</code>, обертывающего его шаблона макета и всех партиалов, на которые может ссылаться файл ERB. В оставшейся части этого руководства вы найдете более подробную информацию о каждом из трех компонентов: шаблонов (<code>Templates</code>), партиалов (<code>Partials</code>) и макетов (<code>Layouts</code>).</p><h3 id='shablony' class='inside_page_header'><a href="#shablony">3.</a> Шаблоны</h3><p>Шаблоны Action View могут быть написаны в разных форматах. Если файл шаблона имеет расширение <code>.erb</code>, он использует встроенный Ruby для создания HTML-ответа. Если шаблон имеет расширение <code>.jbuilder</code>, он использует гем <a href="https://github.com/rails/jbuilder">Jbuilder</a> для создания JSON-ответа. А шаблон с расширением <code>.builder</code> использует библиотеку <a href="https://github.com/jimweirich/builder"><code>Builder::XmlMarkup</code></a> для создания XML-ответа.</p><p>Rails использует расширение файла для различения различных систем шаблонов. Например, HTML-файл, использующий систему шаблонов ERB, будет иметь расширение <code>.html.erb</code>, а JSON-файл, использующий систему шаблонов Jbuilder, будет иметь расширение <code>.json.jbuilder</code>. Другие библиотеки также могут добавлять свои типы шаблонов и соответствующие им расширения файлов.</p><h4 id='erb' class='inside_page_header'><a href="#erb">3.1.</a> ERB</h4><p>ERB шаблон - это способ внедрить код Ruby внутрь статического HTML с помощью специальных тегов ERB, таких как <code>&lt;% %&gt;</code> и <code>&lt;%= %&gt;</code>.</p><p>При обработке Rails вью в формате ERB, заканчивающихся на <code>.html.erb</code>, он выполняет встроенный код Ruby и заменяет теги ERB на динамический вывод. Это динамическое содержимое объединяется со статической разметкой HTML для формирования окончательного HTML-ответа.</p><p>Внутри ERB-шаблона Ruby-код можно включать с помощью тегов <code>&lt;% %&gt;</code> и <code>&lt;%= %&gt;</code>. Тег <code>&lt;% %&gt;</code> (без <code>=</code>) используется, когда вы хотите выполнить код Ruby, но не выводить его результат напрямую, например, для условий или циклов. Тег <code>&lt;%= %&gt;</code> используется для кода Ruby, который генерирует вывод, который вы хотите отобразить внутри шаблона. Например, для вывода атрибута модели, как <code>person.name</code> в этом примере:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Names<span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@people</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Name: <span class="cp">&lt;%=</span> <span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Цикл настроен с помощью обычных встраиваемых тегов (<code>&lt;% %&gt;</code>), а имя вставлено с помощью выводящих встраиваемых тегов (<code>&lt;%= %&gt;</code>).</p><p>Имейте в виду, что функции вроде <code>print</code> и <code>puts</code> не будут отображаться во вью при использовании ERB-шаблонов. Таким образом, следующий код не будет работать:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# WRONG %&gt;</span>
Hi, Mr. <span class="cp">&lt;%</span> <span class="nb">puts</span> <span class="s2">"Frodo"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>В предыдущем примере показано, что комментарии в ERB можно добавлять с помощью тега <code>&lt;%# %&gt;</code>.</p><p>Для подавления ведущих и завершающих пробелов вы можете использовать <code>&lt;%-</code> <code>-%&gt;</code> взаимозаменяемо с <code>&lt;%</code> и <code>%&gt;</code></p><h4 id='jbuilder' class='inside_page_header'><a href="#jbuilder">3.2.</a> Jbuilder</h4><p><code>Jbuilder</code> - это гем, поддерживаемый командой Rails и включенный в стандартный <code>Gemfile</code> Rails. Он используется для создания JSON-ответов с помощью шаблонов.</p><p>Если у вас его нет, вы можете добавить следующую строку в ваш <code>Gemfile</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">gem</span> <span class="s2">"jbuilder"</span>
</code></pre>
</div>
<p>Объект <code>Jbuilder</code> с именем <code>json</code> автоматически становится доступным для шаблонов с расширением <code>.jbuilder</code>.</p><p>Вот базовый пример:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">json</span><span class="p">.</span><span class="nf">name</span><span class="p">(</span><span class="s2">"Alex"</span><span class="p">)</span>
<span class="n">json</span><span class="p">.</span><span class="nf">email</span><span class="p">(</span><span class="s2">"alex@example.com"</span><span class="p">)</span>
</code></pre>
</div>
<p>что произведет:</p><div class="code_container">
  <pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alex"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alex@example.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>Больше примеров смотрите в <a href="https://github.com/rails/jbuilder#jbuilder">документации Jbuilder</a>.</p><h4 id='builder' class='inside_page_header'><a href="#builder">3.3.</a> Builder</h4><p>Шаблоны Builder — это более программная альтернатива ERB. Они похожи на JBuilder, но используются для создания XML, а не JSON.</p><p>Объект <code>XmlMarkup</code> с именем <code>xml</code> автоматически становится доступным для шаблонов с расширением <code>.builder</code>.</p><p>Вот простой пример:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">xml</span><span class="p">.</span><span class="nf">em</span><span class="p">(</span><span class="s2">"emphasized"</span><span class="p">)</span>
<span class="n">xml</span><span class="p">.</span><span class="nf">em</span> <span class="p">{</span> <span class="n">xml</span><span class="p">.</span><span class="nf">b</span><span class="p">(</span><span class="s2">"emph &amp; bold"</span><span class="p">)</span> <span class="p">}</span>
<span class="n">xml</span><span class="p">.</span><span class="nf">a</span><span class="p">(</span><span class="s2">"A Link"</span><span class="p">,</span> <span class="s2">"href"</span> <span class="o">=&gt;</span> <span class="s2">"https://rubyonrails.org"</span><span class="p">)</span>
<span class="n">xml</span><span class="p">.</span><span class="nf">target</span><span class="p">(</span><span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"compile"</span><span class="p">,</span> <span class="s2">"option"</span> <span class="o">=&gt;</span> <span class="s2">"fast"</span><span class="p">)</span>
</code></pre>
</div>
<p>которые создадут:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;em&gt;</span>emphasized<span class="nt">&lt;/em&gt;</span>
<span class="nt">&lt;em&gt;&lt;b&gt;</span>emph <span class="ni">&amp;amp;</span> bold<span class="nt">&lt;/b&gt;&lt;/em&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://rubyonrails.org"</span><span class="nt">&gt;</span>A link<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;target</span> <span class="na">option=</span><span class="s">"fast"</span> <span class="na">name=</span><span class="s">"compile"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Любой метод с блоком будет трактован как разметка тега XML с вложенной разметкой в блоке. Например, следующее:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">xml</span><span class="p">.</span><span class="nf">div</span> <span class="p">{</span>
  <span class="n">xml</span><span class="p">.</span><span class="nf">h1</span><span class="p">(</span><span class="vi">@person</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
  <span class="n">xml</span><span class="p">.</span><span class="nf">p</span><span class="p">(</span><span class="vi">@person</span><span class="p">.</span><span class="nf">bio</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
<p>создаст что-то вроде:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;h1&gt;</span>David Heinemeier Hansson<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;p&gt;</span>A product of Danish Design during the Winter of '79...<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>
<p>Больше примеров смотрите в <a href="https://github.com/jimweirich/builder">документации Builder</a>.</p><h4 id='kompilyatsiya-shablonov' class='inside_page_header'><a href="#kompilyatsiya-shablonov">3.4.</a> Компиляция шаблонов</h4><p>По умолчанию Rails компилирует каждый шаблон в метод для его отрисовки. В среде development при изменении шаблона Rails проверяет время модификации файла и перекомпилирует его.</p><p>Также существует фрагментное кеширование, когда разные части страницы нужно кэшировать и обновлять по отдельности. Подробнее об этом читайте в <a href="/caching-with-rails#fragment-caching">руководстве по кешированию</a>.</p><h3 id='partialy' class='inside_page_header'><a href="#partialy">4.</a> Партиалы</h3><p>Частичные шаблоны, обычно просто называемые &quot;партиалами&quot;, - это способ разбить шаблоны вью на более мелкие фрагменты, пригодные для повторного использования. С помощью партиалов вы можете извлечь часть кода из вашего основного шаблона в отдельный меньший файл и отрисовать этот файл в основном шаблоне. Вы также можете передавать данные в файлы партиалов из основного шаблона.</p><p>Давайте разберемся на практике с помощью примеров:</p><h4 id='rendering-partialov' class='inside_page_header'><a href="#rendering-partialov">4.1.</a> Рендеринг партиалов</h4><p>Для того, чтобы отрисовать партиал внутри вью, используйте метод <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a> внутри этого вью:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"product"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Этот код будет искать файл с названием <code>_product.html.erb</code> в той же папке, чтобы отрисовать его внутри этой вью. По соглашению, имена файлов партиалов начинаются с подчеркивания. Это помогает отличать их от обычных файлов вью. Однако, при ссылке на партиал внутри вью, само подчеркивание не используется. Это верно даже при ссылке на партиал из другой директории:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"application/product"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Этот код найдет и отрисует файл партиала <code>_product.html.erb</code> в <code>app/views/application/</code>.</p><h4 id='ispolzovanie-partialov-dlya-uproscheniya-vyu' class='inside_page_header'><a href="#ispolzovanie-partialov-dlya-uproscheniya-vyu">4.2.</a> Использование партиалов для упрощения вью</h4><p>Еще один способ использования партиалов - рассматривать их как аналоги методов. Это позволяет вынести детали из вью, чтобы легче было понять, что происходит. Например, у вас может быть вью, которая выглядит следующим образом:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"application/ad_banner"</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h1&gt;</span>Products<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span>Here are a few of our fine products:<span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@products</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="n">product</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"application/footer"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Здесь партиалы <code>_ad_banner.html.erb</code> и <code>_footer.html.erb</code> могут содержать контент, который используется на многих страницах вашего приложения. Вам не нужно видеть детали этих разделов, когда вы фокусируетесь на странице продуктов.</p><p>В приведенном выше примере также используется партиал <code>_product.html.erb</code>. Этот партиал содержит детали для отрисовки отдельного продукта и используется для отрисовки каждого продукта из коллекции <code>@products</code>.</p><h4 id='peredacha-dannyh-v-partialy-s-pomoschyu-optsii-locals' class='inside_page_header'><a href="#peredacha-dannyh-v-partialy-s-pomoschyu-optsii-locals">4.3.</a> Передача данных в партиалы с помощью опции <code>locals</code></h4><p>При отрисовке партиала вы можете передавать данные из основной вью в партиал. Для этого используется хэш опций <code>locals:</code>. Каждый ключ в опции <code>locals:</code> доступен как локальная переменная партиала:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/show.html.erb %&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">my_product: </span><span class="vi">@product</span> <span class="p">}</span> <span class="cp">%&gt;</span>

<span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">div</span> <span class="ss">id: </span><span class="n">dom_id</span><span class="p">(</span><span class="n">my_product</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">my_product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>&quot;Локальная переменная партиала&quot; - это переменная, которая существует только внутри данного партиала и доступна только из него. В приведенном выше примере <code>my_product</code> является локальной переменной партиала. Ей было присвоено значение <code>@product</code> при передаче в партиал из исходной вью.</p><p>Имейте в виду, что обычно эту локальную переменную мы просто назвали бы <code>product</code>. В данном примере мы используем <code>my_product</code>, чтобы отличить ее от названия переменной экземпляра и названия шаблона.</p><p>Поскольку <code>locals</code> - это хэш, вы можете передавать несколько переменных по мере необходимости, например <code>locals: { my_product: @product, my_reviews: @reviews }</code>.</p><p>Однако, если шаблон ссылается на переменную, которая <em>не передана</em> в представление как часть опции <code>locals:</code>, шаблон выдаст ошибку <code>ActionView::Template::Error</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">div</span> <span class="ss">id: </span><span class="n">dom_id</span><span class="p">(</span><span class="n">my_product</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">my_product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

  <span class="c">&lt;%# =&gt; raises ActionView::Template::Error for `product_reviews` %&gt;</span>
  <span class="cp">&lt;%</span> <span class="n">product_reviews</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">review</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;%# ... %&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<h4 id='ispolzovanie-local_assigns' class='inside_page_header'><a href="#ispolzovanie-local_assigns">4.4.</a> Использование <code>local_assigns</code></h4><p>Каждый партиал имеет метод под названием <a href="https://api.rubyonrails.org/classes/ActionView/Template.html#method-i-local_assigns">local_assigns</a>. Вы можете использовать этот метод для доступа к ключам, переданным через опцию <code>locals:</code>. Если партиал был отрисован без установленного <code>:some_key</code>, значение <code>local_assigns[:some_key]</code> внутри партиала будет равно <code>nil</code>.</p><p>Например, <code>product_reviews</code> будет иметь значение <code>nil</code> в приведенном ниже примере, поскольку в <code>locals:</code> установлено только значение <code>product</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/show.html.erb %&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="vi">@product</span> <span class="p">}</span> <span class="cp">%&gt;</span>

<span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%</span> <span class="n">local_assigns</span><span class="p">[</span><span class="ss">:product</span><span class="p">]</span>          <span class="c1"># =&gt; "#&lt;Product:0x0000000109ec5d10&gt;" </span><span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="n">local_assigns</span><span class="p">[</span><span class="ss">:product_reviews</span><span class="p">]</span>  <span class="c1"># =&gt; nil </span><span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Одним из вариантов использования <code>local_assigns</code> является необязательная передача локальной переменной, а затем условное выполнение действия в партиале в зависимости от того, установлена ли локальная переменная. Например:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">local_assigns</span><span class="p">[</span><span class="ss">:redirect</span><span class="p">]</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">hidden_field</span> <span class="ss">:redirect</span><span class="p">,</span> <span class="ss">value: </span><span class="kp">true</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Еще один пример из <code>_blob.html.erb</code> Active Storage. В данном случае размер устанавливается в зависимости от того, установлена ли локальная переменная <code>in_gallery</code> при отрисовке партиала, который содержит эту строку:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">blob</span><span class="p">.</span><span class="nf">representation</span><span class="p">(</span><span class="ss">resize_to_limit: </span><span class="n">local_assigns</span><span class="p">[</span><span class="ss">:in_gallery</span><span class="p">]</span> <span class="p">?</span> <span class="p">[</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span> <span class="p">]</span> <span class="p">:</span> <span class="p">[</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span> <span class="p">])</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<h4 id='render-bez-optsiy-partial-i-locals' class='inside_page_header'><a href="#render-bez-optsiy-partial-i-locals">4.5.</a> <code>render</code> без опций <code>partial</code> и <code>locals</code></h4><p>В предыдущих примерах <code>render</code> принимает 2 опции: <code>partial</code> и <code>locals</code>. Однако, если вам нужны только эти опции, вы можете пропустить ключи <code>partial</code> и <code>locals</code> и указать только значения.</p><p>Например, вместо:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="vi">@product</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Можно написать:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"product"</span><span class="p">,</span> <span class="ss">product: </span><span class="vi">@product</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вы также можете использовать эту краткую запись, основанную на соглашениях:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@product</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Этот код будет искать партиал с названием <code>_product.html.erb</code> в <code>app/views/products/</code>. Дополнительно, он передаст локальную переменную <code>product</code> со значением <code>@product</code>.</p><h4 id='optsii-as-i-object' class='inside_page_header'><a href="#optsii-as-i-object">4.6.</a> Опции <code>as</code> и <code>object</code></h4><p>По умолчанию, объекты, передаваемые в шаблон, находятся в локальной переменной с тем же именем, что и шаблон. Таким образом, при условии, что:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@product</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>внутри партиала <code>_product.html.erb</code> вы получите переменную экземпляра <code>@product</code> в локальной переменной <code>product</code>, как если бы вы написали:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="vi">@product</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Опция <code>object</code> позволяет указать другое имя. Это полезно, когда объект шаблона находится в другом месте (например, в другой переменной экземпляра или в локальной переменной).</p><p>Например, вместо:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="vi">@item</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>можно написать:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">object: </span><span class="vi">@item</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Эта строка присваивает переменную экземпляра <code>@item</code> локальной переменной партиала с именем <code>product</code>. А что, если вы хотите изменить имя локальной переменной с <code>product</code> по умолчанию на что-то другое? Для этого можно использовать опцию <code>:as</code>.</p><p>С помощью опции <code>:as</code> вы можете указать другое имя для локальной переменной, например:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">object: </span><span class="vi">@item</span><span class="p">,</span> <span class="ss">as: </span><span class="s2">"item"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Это эквивалентно:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">item: </span><span class="vi">@item</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<h4 id='rendering-kollektsiy' class='inside_page_header'><a href="#rendering-kollektsiy">4.7.</a> Рендеринг коллекций</h4><p>Во вью часто приходится перебирать коллекцию, например <code>@products</code>, и отрисовывать шаблон партиала для каждого элемента коллекции. Этот шаблон реализован как единый метод, который принимает массив и отрисовывает партиал для каждого элемента массива.</p><p>Поэтому такой пример для рендеринга всех продуктов:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="vi">@products</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">product</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">product: </span><span class="n">product</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>может быть переписан с помощью одной строчки:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">collection: </span><span class="vi">@products</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Когда партиал вызывается с коллекцией, у отдельных экземпляров партиала есть доступ к рендерящемуся члену коллекции через переменную с именем партиала. В этом случае, поскольку партиал называется <code>_product.html.erb</code>, вы можете использовать <code>product</code> для ссылки на элемент коллекции, который отрисовывается.</p><p>Вы также можете использовать следующую краткую запись для отрисовки коллекций, основанную на соглашениях.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@products</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выше предполагается, что <code>@products</code> - это коллекция экземпляров <code>Product</code>. Rails использует соглашения об именах, чтобы определить название используемого партиала, анализируя при этом имя модели в коллекции, в данном случае <code>Product</code>. Фактически, вы даже можете отрисовать коллекцию, состоящую из экземпляров разных моделей, используя этот сокращенный синтаксис, и Rails выберет подходящий партиал для каждого элемента коллекции.</p><h4 id='razdelyayuschie-shablony' class='inside_page_header'><a href="#razdelyayuschie-shablony">4.8.</a> Разделяющие шаблоны</h4><p>Также можете определить второй партиал, который будет отрендерен между экземплярами главного партиала, используя опцию <code>:spacer_template</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="vi">@products</span><span class="p">,</span> <span class="ss">spacer_template: </span><span class="s2">"product_ruler"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Rails отрендерит партиал <code>_product_ruler.html.erb</code> (без переданных в него данных) между каждой парой партиалов <code>_product.html.erb</code>.</p><h4 id='peremennye-schetchika' class='inside_page_header'><a href="#peremennye-schetchika">4.9.</a> Переменные счетчика</h4><p>Rails также предоставляет внутри партиала, вызываемого из коллекции, счетчик. Эта переменная названа по имени партиала с добавлением суффикса <code>_counter</code>. Например, при отрисовке коллекции <code>@products</code> партиал <code>_product.html.erb</code> может получить доступ к переменной <code>product_counter</code>. Эта переменная указывает на количество раз, которое партиал был отрисован внутри ограничивающей его вью, начиная с значения <code>0</code> при первой отрисовке.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# index.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"product"</span><span class="p">,</span> <span class="ss">collection: </span><span class="vi">@products</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# _product.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">product_counter</span> <span class="cp">%&gt;</span> # 0 для первого продукта, 1 для второго продукта...
</code></pre>
</div>
<p>То же самое работает, когда вы изменяете имя локальной переменной с помощью опции <code>as:</code>. Например, если бы вы использовали <code>as: :item</code> в своем коде, тогда счетчик назывался бы <code>item_counter</code>.</p><p>Примечание: Следующие два раздела, <a href="#strict-locals">Строгие локальные переменные</a> и <a href="#local-assigns-with-pattern-matching"><code>local_assigns</code> с соответствием образцу</a>, посвящены более продвинутым функциям использования партиалов и включены сюда для полноты картины.</p><h4 id='local-assigns-with-pattern-matching' class='inside_page_header'><a href="#local-assigns-with-pattern-matching">4.10.</a> <code>local_assigns</code> с соответствием образцу</h4><p>Поскольку <code>local_assigns</code> является <code>Hash</code>, он совместим с <a href="https://docs.ruby-lang.org/en/master/syntax/pattern_matching_rdoc.html">оператором присваивания с помощью соответствия образцу в Ruby 3.1</a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">local_assigns</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">product</span><span class="p">:,</span> <span class="o">**</span><span class="n">options</span> <span class="p">}</span>
<span class="n">product</span> <span class="c1"># =&gt; "#&lt;Product:0x0000000109ec5d10&gt;"</span>
<span class="n">options</span> <span class="c1"># =&gt; {}</span>
</code></pre>
</div>
<p>Когда ключи, кроме <code>:product</code>, присваиваются локальной хэш-переменной для партиала, их можно включить в вызов вспомогательных методов:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%</span> <span class="n">local_assigns</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">product</span><span class="p">:,</span> <span class="o">**</span><span class="n">options</span> <span class="p">}</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">div</span> <span class="ss">id: </span><span class="n">dom_id</span><span class="p">(</span><span class="n">product</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="c">&lt;%# app/views/products/show.html.erb %&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"products/product"</span><span class="p">,</span> <span class="ss">product: </span><span class="vi">@product</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"card"</span> <span class="cp">%&gt;</span>
<span class="c">&lt;%# =&gt; &lt;div id="product_1" class="card"&gt;
  #      &lt;h1&gt;A widget&lt;/h1&gt;
  #    &lt;/div&gt;
%&gt;</span>
</code></pre>
</div>
<p>Присваивание с помощью соответствия образцу также поддерживает переименование переменных:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">local_assigns</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">product: </span><span class="n">record</span> <span class="p">}</span>
<span class="n">product</span>             <span class="c1"># =&gt; "#&lt;Product:0x0000000109ec5d10&gt;"</span>
<span class="n">record</span>              <span class="c1"># =&gt; "#&lt;Product:0x0000000109ec5d10&gt;"</span>
<span class="n">product</span> <span class="o">==</span> <span class="n">record</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Вы также можете условно читать переменную, а затем переходить к значению по умолчанию, если ключ не входит в опцию <code>locals:</code>, используя метод <code>fetch</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%</span> <span class="n">local_assigns</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="ss">:related_products</span><span class="p">,</span> <span class="p">[]).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">related_product</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;%# ... %&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Совмещение оператора присваивания с помощью соответствия образцу в Ruby 3.1 с вызовами <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-with_defaults">Hash#with_defaults</a> позволяет компактно назначать значения по умолчанию локальным переменным в партиале.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/products/_product.html.erb %&gt;</span>

<span class="cp">&lt;%</span> <span class="n">local_assigns</span><span class="p">.</span><span class="nf">with_defaults</span><span class="p">(</span><span class="ss">related_products: </span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">product</span><span class="p">:,</span> <span class="ss">related_products: </span><span class="p">}</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">div</span> <span class="ss">id: </span><span class="n">dom_id</span><span class="p">(</span><span class="n">product</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">product</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

  <span class="cp">&lt;%</span> <span class="n">related_products</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">related_product</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;%# ... %&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<div class="info"><p>По умолчанию партиалы принимают любые <code>locals</code> в качестве именованных аргументов. Чтобы определить, какие <code>locals</code> принимает партиал, используйте специальный комментарий `locals:. Подробнее об этом можно узнать в разделе <a href="#strict-locals">Строгие локальные переменные</a>.</p></div><h4 id='strict-locals' class='inside_page_header'><a href="#strict-locals">4.11.</a> Строгие локальные переменные</h4><p>Партиалы Action View принимают любое количество <code>locals</code> в качестве именованных аргументов. С помощью специального комментария <code>locals:</code> вы можете контролировать, сколько и какие <code>locals</code> принимает шаблон, устанавливать значения по умолчанию и многое другое.</p><p>Ниже приведены примеры использования специального комментария <code>locals:</code>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_message.html.erb %&gt;</span>

<span class="c">&lt;%# locals: (message:) -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанный код делает <code>message</code> обязательной локальной переменной. Рендеринг партиала без аргумента локальной переменной <code>:message</code> приведет к ошибке:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">render</span> <span class="s2">"messages/message"</span>
<span class="c1"># =&gt; ActionView::Template::Error: missing local: :message for app/views/messages/_message.html.erb</span>
</code></pre>
</div>
<p>Если установлено значение по умолчанию, оно может быть использовано, если <code>message</code> не передается в <code>locals:</code>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_message.html.erb %&gt;</span>

<span class="c">&lt;%# locals: (message: "Hello, world!") -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Рендеринг партиала без локальной переменной <code>:message</code> приведет к использованию значения по умолчанию, установленного в специальном комментарии <code>locals:</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">render</span> <span class="s2">"messages/message"</span>
<span class="c1"># =&gt; "Hello, world!"</span>
</code></pre>
</div>
<p>Рендеринг партиала с локальными переменными, не указанными в специальном комментарии <code>local:</code>, также приведет к ошибке:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">render</span> <span class="s2">"messages/message"</span><span class="p">,</span> <span class="ss">unknown_local: </span><span class="s2">"will raise"</span>
<span class="c1"># =&gt; ActionView::Template::Error: unknown local: :unknown_local for app/views/messages/_message.html.erb</span>
</code></pre>
</div>
<p>Вы можете разрешить необязательные аргументы локальных переменных с помощью оператора двойного разбиения <code>**</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_message.html.erb %&gt;</span>

<span class="c">&lt;%# locals: (message: "Hello, world!", **attributes) -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">p</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Либо вы можете полностью отключить <code>locals</code>, установив <code>locals:</code> в пустые скобки <code>()</code>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_message.html.erb %&gt;</span>

<span class="c">&lt;%# locals: () %&gt;</span>
</code></pre>
</div>
<p>Рендеринг партиала с <em>любыми</em> аргументами локальных переменных приведет к ошибке:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">render</span> <span class="s2">"messages/message"</span><span class="p">,</span> <span class="ss">unknown_local: </span><span class="s2">"will raise"</span>
<span class="c1"># =&gt; ActionView::Template::Error: no locals accepted for app/views/messages/_message.html.erb</span>
</code></pre>
</div>
<p>Action View обработает специальный комментарий <code>locals:</code> во всех шаблонизаторах, которые поддерживают комментарии, начинающиеся с символа <code>#</code>, и прочитает его на любой строке внутри партиала.</p><div class="warning"><p>Поддерживаются только именованные аргументы. Определение позиционных или блочных аргументов вызовет ошибку Action View во время отрисовки.</p></div><h3 id='makety' class='inside_page_header'><a href="#makety">5.</a> Макеты</h3><p>Макеты используются для рендеринга общего шаблона вью поверх результатов экшнов контроллеров Rails. В Rails-приложении может быть несколько макетов, в которых могут быть отрисованы страницы.</p><p>Например, в приложении может быть один макет для зарегистрированного пользователя и другой для маркетинговой части сайта. Макет для зарегистрированного пользователя может включать верхнюю панель навигации, которая должна присутствовать во многих экшнах контроллера. Макет продаж для SaaS-приложения может включать верхнюю панель навигации для таких страниц, как &quot;Цены&quot; и &quot;Контакты&quot;. Различные макеты могут иметь разное содержимое шапки и колонтитула.</p><p>Чтобы найти макет для текущего экшна контроллера, Rails сначала ищет файл в <code>app/views/layouts</code> с тем же базовым именем, что и у контроллера. Например, для рендеринга экшнов из класса <code>ProductsController</code> будет использоваться файл <code>app/views/layouts/products.html.erb</code>.</p><p>Если макет, специфичный для контроллера, не существует, Rails использует <code>app/views/layouts/application.html.erb</code>.</p><p>Вот пример простого макета в файле <code>application.html.erb</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="s2">"Your Rails App"</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">csp_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"application"</span><span class="p">,</span> <span class="s2">"data-turbo-track"</span><span class="p">:</span> <span class="s2">"reload"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">javascript_importmap_tags</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Home"</span><span class="p">,</span> <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Products"</span><span class="p">,</span> <span class="n">products_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="c">&lt;!-- Additional navigation links here --&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>

<span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;footer&gt;</span>
  <span class="nt">&lt;p&gt;</span><span class="ni">&amp;copy;</span> <span class="cp">&lt;%=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span><span class="p">.</span><span class="nf">year</span> <span class="cp">%&gt;</span> Your Company<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</code></pre>
</div>
<p>В примере макета выше, содержимое вью будет отрисовано на месте <code>&lt;%= yield %&gt;</code> и окружено тем же содержимым <code>&lt;head&gt;</code>, <code>&lt;nav&gt;</code> и <code>&lt;footer&gt;</code>.</p><p>Rails предоставляет дополнительные способы назначения определенных макетов отдельным контроллерам и экшнам. Подробнее о макетах в целом вы можете узнать в руководстве <a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>.</p><h4 id='makety-dlya-partialov' class='inside_page_header'><a href="#makety-dlya-partialov">5.1.</a> Макеты для партиалов</h4><p>К партиалам можно применять собственные макеты. Они отличаются от тех, которые применяются к экшнам контроллера, но работают схожим образом.</p><p>Предположим, вы хотите отобразить статью на странице, которая должна быть обернута в <code>div</code> для целей отображения. Сначала вы создадите новую <code>Article</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Article</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">body: </span><span class="s1">'Partial Layouts are cool!'</span><span class="p">)</span>
</code></pre>
</div>
<p>В шаблоне <code>show</code> вы отрисуете партиал <code>_article</code>, обернутый в макет <code>box</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/articles/show.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s1">'article'</span><span class="p">,</span> <span class="ss">layout: </span><span class="s1">'box'</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Макет <code>box</code> просто оборачивает партиал <code>_article</code> в <code>div</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/articles/_box.html.erb %&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"box"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>
<p>Отметьте, что у макета партиала есть доступ к локальной переменной <code>article</code>, переданной в вызов <code>render</code>, хотя в данном случае она не используется внутри <code>_box.html.erb</code>.</p><p>В отличие от макетов приложения, макеты для партиалов по-прежнему имеют префикс подчеркивания в своем названии.</p><p>Вы также можете отрисовать блок кода внутри макета партиала вместо использования <code>yield</code>. Например, если бы у вас не было партиала <code>_article</code>, вы могли бы сделать следующее:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# app/views/articles/show.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span><span class="p">(</span><span class="ss">layout: </span><span class="s1">'box'</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="p">})</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Допустим, что мы используем тот же партиал <code>_box</code>, мы получим тот же результат, что и в предыдущем примере.</p><h4 id='kollektsii-s-maketami-dlya-partialov' class='inside_page_header'><a href="#kollektsii-s-maketami-dlya-partialov">5.2.</a> Коллекции с макетами для партиалов</h4><p>При отрисовке коллекций также можно использовать опцию <code>:layout</code>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"article"</span><span class="p">,</span> <span class="ss">collection: </span><span class="vi">@articles</span><span class="p">,</span> <span class="ss">layout: </span><span class="s2">"special_layout"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Макет будет отрисован вместе с партиалом для каждого элемента коллекции. Переменные текущего объекта и счетчика объектов, <code>article</code> и <code>article_counter</code> в приведенном выше примере, также будут доступны в макете, так же как и внутри партиала.</p><h3 id='helpers' class='inside_page_header'><a href="#helpers">6.</a> Хелперы</h3><p>Rails предоставляет множество вспомогательных методов для использования с Action View. Эти методы включают:</p><ul><li>Форматирование дат, строк и чисел
</li><li>Создание ссылок HTML на картинки, видео, таблицы стилей и т.д...
</li><li>Очистку содержимого
</li><li>Создание форм
</li><li>Локализацию содержимого
</li></ul><p>Подробнее о хелперах можно узнать в <a href="/action-view-helpers">руководстве по хелперам Action View</a> и <a href="/form-helpers">руководстве по хелперам форм Action View</a>.</p><h3 id='lokalizovannye-vyu' class='inside_page_header'><a href="#lokalizovannye-vyu">7.</a> Локализованные вью</h3><p>В Action View есть возможность рендерить различные шаблоны в зависимости от текущей локали.</p><p>Например, предположим, что у вас есть <code>ArticlesController</code> с экшном <code>show</code>. По умолчанию вызов этого экшна отрендерит <code>app/views/articles/show.html.erb</code>. Но если вы установите <code>I18n.locale = :de</code>, то Action View попытается сначала отрендерить шаблон <code>app/views/articles/show.de.html.erb</code>. Если локализованный шаблон отсутствует, будет использована недекорированная версия. Это означает, что не нужно предоставлять локализованные вью для всех случаев, но они будут предпочтительными и будут использоваться, если станут доступны.</p><p>Ту же технику можно использовать для локализации страниц ошибок в директории public. Например, установка <code>I18n.locale = :de</code> и создание <code>public/500.de.html</code> и <code>public/404.de.html</code> позволит иметь локализованные страницы ошибок.</p><p>Подробнее об API интернационализации Rails (I18n) можно прочитать в руководстве <a href="/i18n">API интернационализации Rails (I18n)</a>.</p>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
              <a target="blank" href="http://twitter.com/rusrails"><img src="/assets/twitter-50e0e767c8793dec313a7dc5cfbcfe2067e3e89ea6ec64784eb7c6640f578758.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-8ee447905888b153d8458707061a14b1f15f69b6733e871a3ad91d80ae89e87b.js"></script>
  </body>
</html>

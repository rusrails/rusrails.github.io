<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="product" property="twitter:card"/>
<meta content="@rusrails" property="twitter:site"/>
<meta content="Rusrails: Расширения ядра Active Support" property="twitter:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="twitter:description"/>
<meta content="@rusrails" property="twitter:creator"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="twitter:image"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Расширения ядра Active Support" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/active-support-core-extensions" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Расширения ядра Active Support
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/classic-to-zeitwerk-howto">Как перейти с Classic на Zeitwerk</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
              <p></p>
              <a class="twitter-follow-button" data-lang="ru" href="https://twitter.com/rusrails"></a>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#kak-zagruzit-rasshireniya-yadra">1. Как загрузить расширения ядра</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#avtonomnyy-active-support">1.1. Автономный Active Support</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#podbor-opredeleniy">1.1.1. Подбор определений</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#zagruzka-sgruppirovannyh-rasshireniy-yadra">1.1.2. Загрузка сгруппированных расширений ядра</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#zagruzka-vseh-rasshireniy-yadra">1.1.3. Загрузка всех расширений ядра</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#zagruzka-vsego-active-support">1.1.4. Загрузка всего Active Support</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#active-support-v-prilozhenii-na-ruby-on-rails">1.2. Active Support в приложении на Ruby on Rails</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-ko-vsem-ob-ektam">2. Расширения ко всем объектам</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#blank-i-present">2.1. <code>blank?</code> и <code>present?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#presence">2.2. <code>presence</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#duplicable">2.3. <code>duplicable?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#deep_dup">2.4. <code>deep_dup</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#try">2.5. <code>try</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#class_eval-args-amp-block">2.6. <code>class_eval(*args, &amp;block)</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#acts_like-duck">2.7. <code>acts_like?(duck)</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#to_param">2.8. <code>to_param</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#to_query">2.9. <code>to_query</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#with_options">2.10. <code>with_options</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#podderzhka-json">2.11. Поддержка JSON</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#peremennye-ekzemplyara">2.12. Переменные экземпляра</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#instance_values">2.12.1. <code>instance_values</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#instance_variable_names">2.12.2. <code>instance_variable_names</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#otklyuchenie-preduprezhdeniy-i-isklyucheniya">2.13. Отключение предупреждений и исключения</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#in">2.14. <code>in?</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-module">3. Расширения для <code>Module</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#atributy">3.1. Атрибуты</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#alias_attribute">3.1.1. <code>alias_attribute</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#vnutrennie-atributy">3.1.2. Внутренние атрибуты</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#atributy-modulya">3.1.3. Атрибуты модуля</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#roditeli">3.2. Родители</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#module_parent">3.2.1. <code>module_parent</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#module_parent_name">3.2.2. <code>module_parent_name</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#parents">3.2.3. <code>parents</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#anonymous">3.3. Anonymous</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#delegirovanie-metoda">3.4. Делегирование метода</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#delegate">3.4.1. <code>delegate</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#delegate_missing_to">3.4.2. <code>delegate_missing_to</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#pereopredelenie-metodov">3.5. Переопределение методов</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#extensions-to-class">4. Расширения для <code>Class</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#atributy-klassa">4.1. Атрибуты класса</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#class_attribute">4.1.1. <code>class_attribute</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#cattr_reader-cattr_writer-i-cattr_accessor">4.1.2. <code>cattr_reader</code>, <code>cattr_writer</code> и <code>cattr_accessor</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#podklassy-i-potomki">4.2. Подклассы и потомки</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#subclasses">4.2.1. <code>subclasses</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#descendants">4.2.2. <code>descendants</code></a>
</h6>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-string">5. Расширения для <code>String</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#bezopasnost-vyvoda">5.1. Безопасность вывода</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#motivatsiya">5.1.1. Мотивация</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#bezopasnye-stroki">5.1.2. Безопасные строки</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#preobrazovanie">5.1.3. Преобразование</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#konversiya-i-prinuzhdenie">5.1.4. Конверсия и принуждение</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#kopirovanie">5.1.5. Копирование</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#remove">5.2. <code>remove</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#squish">5.3. <code>squish</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#truncate">5.4. <code>truncate</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#truncate_bytes">5.5. <code>truncate_bytes</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#truncate_words">5.6. <code>truncate_words</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#inquiry">5.7. <code>inquiry</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#starts_with-i-ends_with">5.8. <code>starts_with?</code> и <code>ends_with?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#strip_heredoc">5.9. <code>strip_heredoc</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#indent">5.10. <code>indent</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dostup">5.11. Доступ</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#at-position">5.11.1. <code>at(position)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#from-position">5.11.2. <code>from(position)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to-position">5.11.3. <code>to(position)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#first-limit-1">5.11.4. <code>first(limit = 1)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#last-limit-1">5.11.5. <code>last(limit = 1)</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#izmeneniya-slov">5.12. Изменения слов</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#pluralize">5.12.1. <code>pluralize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#singularize">5.12.2. <code>singularize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#camelize">5.12.3. <code>camelize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#underscore">5.12.4. <code>underscore</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#titleize">5.12.5. <code>titleize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#dasherize">5.12.6. <code>dasherize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#demodulize">5.12.7. <code>demodulize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#deconstantize">5.12.8. <code>deconstantize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#parameterize">5.12.9. <code>parameterize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#tableize">5.12.10. <code>tableize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#classify">5.12.11. <code>classify</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#constantize">5.12.12. <code>constantize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#humanize">5.12.13. <code>humanize</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#foreign_key">5.12.14. <code>foreign_key</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#upcase_first">5.12.15. <code>upcase_first</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#downcase_first">5.12.16. <code>downcase_first</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#konvertirovanie">5.13. Конвертирование</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#to_date-to_time-to_datetime">5.13.1. <code>to_date</code>, <code>to_time</code>, <code>to_datetime</code></a>
</h6>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-symbol">6. Расширения для <code>Symbol</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#starts_with-i-ends_with2">6.1. <code>starts_with?</code> и <code>ends_with?</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-numeric">7. Расширения для <code>Numeric</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#bayty">7.1. Байты</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#vremya">7.2. Время</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#formatirovanie">7.3. Форматирование</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-integer">8. Расширения для <code>Integer</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#multiple_of">8.1. <code>multiple_of?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ordinal">8.2. <code>ordinal</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ordinalize">8.3. <code>ordinalize</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#vremya2">8.4. Время</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-bigdecimal">9. Расширения для <code>BigDecimal</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#to_s">9.1. <code>to_s</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-enumerable">10. Расширения для <code>Enumerable</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#sum">10.1. <code>sum</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#index_by">10.2. <code>index_by</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#index_with">10.3. <code>index_with</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#many">10.4. <code>many?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#exclude">10.5. <code>exclude?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#including">10.6. <code>including</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#excluding">10.7. <code>excluding</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#pluck">10.8. <code>pluck</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#pick">10.9. <code>pick</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-array">11. Расширения для <code>Array</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#dostup2">11.1. Доступ</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#izvlechenie">11.2. Извлечение</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#izvlechenie-optsiy">11.3. Извлечение опций</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#preobrazovanie2">11.4. Преобразование</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#to_sentence">11.4.1. <code>to_sentence</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_fs">11.4.2. <code>to_fs</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_xml">11.4.3. <code>to_xml</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#oborachivanie">11.5. Оборачивание</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dublirovanie">11.6. Дублирование</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#gruppirovka">11.7. Группировка</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#in_groups_of-number-fill_with-nil">11.7.1. <code>in_groups_of(number, fill_with = nil)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#in_groups-number-fill_with-nil">11.7.2. <code>in_groups(number, fill_with = nil)</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#split-value-nil">11.7.3. <code>split(value = nil)</code></a>
</h6>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-hash">12. Расширения для <code>Hash</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#konversiya">12.1. Конверсия</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#to_xml2">12.1.1. <code>to_xml</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#ob-edinenie">12.2. Объединение</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#reverse_merge-i-reverse_merge">12.2.1. <code>reverse_merge</code> и <code>reverse_merge!</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#reverse_update">12.2.2. <code>reverse_update</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#deep_merge-i-deep_merge">12.2.3. <code>deep_merge</code> и <code>deep_merge!</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#glubokoe-dublirovanie">12.3. Глубокое дублирование</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#rabota-s-klyuchami">12.4. Работа с ключами</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#except-i-except">12.4.1. <code>except</code> и <code>except!</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#stringify_keys-i-stringify_keys">12.4.2. <code>stringify_keys</code> и <code>stringify_keys!</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#symbolize_keys-i-symbolize_keys">12.4.3. <code>symbolize_keys</code> и <code>symbolize_keys!</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#to_options-i-to_options">12.4.4. <code>to_options</code> и <code>to_options!</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#assert_valid_keys">12.4.5. <code>assert_valid_keys</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#rabota-so-znacheniyam">12.5. Работа со значениям</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#deep_transform_values-i-deep_transform_values">12.5.1. <code>deep_transform_values</code> и <code>deep_transform_values!</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#narezka">12.6. Нарезка</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#izvlechenie2">12.7. Извлечение</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#indifferentnyy-dostup">12.8. Индифферентный доступ</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-regexp">13. Расширения для <code>Regexp</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#multiline">13.1. <code>multiline?</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-range">14. Расширения для <code>Range</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#to_fs2">14.1. <code>to_fs</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#i-include">14.2. <code>===</code> и <code>include?</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#overlaps">14.3. <code>overlaps?</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-date">15. Расширения для <code>Date</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#vychisleniya">15.1. Вычисления</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#date-current">15.1.1. <code>Date.current</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#imenovannye-daty">15.1.2. Именованные даты</a>
</h6>      </li>
      <li>
        <h7>
          <a href="#beginning_of_week-end_of_week">15.1.2.1. <code>beginning_of_week</code>, <code>end_of_week</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#monday-sunday">15.1.2.2. <code>monday</code>, <code>sunday</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#prev_week-next_week">15.1.2.3. <code>prev_week</code>, <code>next_week</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#beginning_of_month-end_of_month">15.1.2.4. <code>beginning_of_month</code>, <code>end_of_month</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#quarter-beginning_of_quarter-end_of_quarter">15.1.2.5. <code>quarter</code>, <code>beginning_of_quarter</code>, <code>end_of_quarter</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#beginning_of_year-end_of_year">15.1.2.6. <code>beginning_of_year</code>, <code>end_of_year</code></a>
</h7>      </li>
      <li>
        <h6>
          <a href="#drugie-vychisleniya-dat">15.1.3. Другие вычисления дат</a>
</h6>      </li>
      <li>
        <h7>
          <a href="#years_ago-years_since">15.1.3.1. <code>years_ago</code>, <code>years_since</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#months_ago-months_since">15.1.3.2. <code>months_ago</code>, <code>months_since</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#weeks_ago">15.1.3.3. <code>weeks_ago</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#advance">15.1.3.4. <code>advance</code></a>
</h7>      </li>
      <li>
        <h6>
          <a href="#izmenenie-komponentov">15.1.4. Изменение компонентов</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#dlitelnosti">15.1.5. Длительности</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#vremennye-metki">15.1.6. Временные метки</a>
</h6>      </li>
      <li>
        <h7>
          <a href="#beginning_of_day-end_of_day">15.1.6.1. <code>beginning_of_day</code>, <code>end_of_day</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#beginning_of_hour-end_of_hour">15.1.6.2. <code>beginning_of_hour</code>, <code>end_of_hour</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#beginning_of_minute-end_of_minute">15.1.6.3. <code>beginning_of_minute</code>, <code>end_of_minute</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#ago-since">15.1.6.4. <code>ago</code>, <code>since</code></a>
</h7>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-datetime">16. Расширения для <code>DateTime</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#vychisleniya2">16.1. Вычисления</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#imenovannye-datetime">16.1.1. Именованные Datetime</a>
</h6>      </li>
      <li>
        <h7>
          <a href="#datetime-current">16.1.1.1. <code>DateTime.current</code></a>
</h7>      </li>
      <li>
        <h6>
          <a href="#drugie-rasshireniya">16.1.2. Другие расширения</a>
</h6>      </li>
      <li>
        <h7>
          <a href="#seconds_since_midnight">16.1.2.1. <code>seconds_since_midnight</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#utc">16.1.2.2. <code>utc</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#utc2">16.1.2.3. <code>utc?</code></a>
</h7>      </li>
      <li>
        <h7>
          <a href="#date-time-advance">16.1.2.4. <code>advance</code></a>
</h7>      </li>
      <li>
        <h6>
          <a href="#izmenenie-komponentov2">16.1.3. Изменение компонентов</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#dlitelnosti2">16.1.4. Длительности</a>
</h6>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-time">17. Расширения для <code>Time</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#vychisleniya3">17.1. Вычисления</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#time-current">17.1.1. <code>Time.current</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#all_day-all_week-all_month-all_quarter-i-all_year">17.1.2. <code>all_day</code>, <code>all_week</code>, <code>all_month</code>, <code>all_quarter</code> и <code>all_year</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#prev_day-next_day">17.1.3. <code>prev_day</code>, <code>next_day</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#prev_month-next_month">17.1.4. <code>prev_month</code>, <code>next_month</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#prev_year-next_year">17.1.5. <code>prev_year</code>, <code>next_year</code></a>
</h6>      </li>
      <li>
        <h6>
          <a href="#prev_quarter-next_quarter">17.1.6. <code>prev_quarter</code>, <code>next_quarter</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#konstruktory-time">17.2. Конструкторы Time</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#dlitelnosti3">17.2.1. Длительности</a>
</h6>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-file">18. Расширения для <code>File</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#atomic_write">18.1. <code>atomic_write</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-nameerror">19. Расширения для <code>NameError</code></a>
</h4>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-loaderror">20. Расширения для <code>LoadError</code></a>
</h4>      </li>
      <li>
        <h4>
          <a href="#rasshireniya-dlya-pathname">21. Расширения для Pathname</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#existence">21.1. <code>existence</code></a>
</h5>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='rasshireniya-yadra-active-support' class='inside_page_header'> Расширения ядра Active Support</h2><p>Active Support - это компонент Ruby on Rails, отвечающий за предоставление расширений и утилит для языка Ruby.</p><p>Он предлагает более ценные функции на уровне языка, нацеленные как на разработку приложений на Rails, так и на разработку самого Ruby on Rails.</p><p>После прочтения этого руководства, вы узнаете:</p><ul><li>Что такое расширения ядра.
</li><li>Как загрузить все расширения.
</li><li>Как подобрать только те расширения, которые вам нужны.
</li><li>Какие расширения предоставляет Active Support.
</li></ul><h3 id='kak-zagruzit-rasshireniya-yadra' class='inside_page_header'><a href="#kak-zagruzit-rasshireniya-yadra">1.</a> Как загрузить расширения ядра</h3><h4 id='avtonomnyy-active-support' class='inside_page_header'><a href="#avtonomnyy-active-support">1.1.</a> Автономный Active Support</h4><p>Для обеспечения минимального влияния, Active Support по умолчанию загружает минимальные зависимости. Он разбит на маленькие части, поэтому можно загружать лишь желаемые зависимости. Он также имеет некоторые точки входа, которые по соглашению загружают все относящиеся расширения за раз, или даже все.</p><p>Таким образом, после обычного require:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
</code></pre>
</div>
<p>будут загружены только расширения, требуемые для фреймворка Active Support.</p><h5 id='podbor-opredeleniy' class='inside_page_header'><a href="#podbor-opredeleniy">1.1.1.</a> Подбор определений</h5><p>Этот пример показывает, как загрузить <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-with_indifferent_access"><code>Hash#with_indifferent_access</code></a>. Это расширение включает преобразование <code>Hash</code> в <a href="https://api.rubyonrails.org/classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a>, который позволяет доступ с как строковыми, так и символьными ключами.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre>
</div>
<p>Для каждого отдельного метода, определенного как расширение ядра, в этом руководстве имеется заметка, сообщающая, где такой метод определяется. В случае с <code>with_indifferent_access</code> заметка гласит:</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/indifferent_access.rb</code>.</p></div><p>Это означает, что это можно затребовать следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash/indifferent_access"</span>
</code></pre>
</div>
<p>Active Support был тщательно пересмотрен и теперь подхватывает только те файлы для загрузки, которые содержат строго необходимые зависимости, если такие имеются.</p><h5 id='zagruzka-sgruppirovannyh-rasshireniy-yadra' class='inside_page_header'><a href="#zagruzka-sgruppirovannyh-rasshireniy-yadra">1.1.2.</a> Загрузка сгруппированных расширений ядра</h5><p>Следующий уровень - это просто загрузка всех расширений к <code>Hash</code>. Как правило, расширения к <code>SomeClass</code> доступны за раз при загрузке <code>active_support/core_ext/some_class</code>.</p><p>Таким образом, чтобы загрузить все расширения <code>Hash</code> (в том числе <code>with_indifferent_access</code>):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash"</span>
</code></pre>
</div>
<h5 id='zagruzka-vseh-rasshireniy-yadra' class='inside_page_header'><a href="#zagruzka-vseh-rasshireniy-yadra">1.1.3.</a> Загрузка всех расширений ядра</h5><p>Возможно, вы предпочтете загрузить все расширения ядра, вот файл для этого необходимо:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext"</span>
</code></pre>
</div>
<h5 id='zagruzka-vsego-active-support' class='inside_page_header'><a href="#zagruzka-vsego-active-support">1.1.4.</a> Загрузка всего Active Support</h5><p>И наконец, если необходимо получить доступ ко всему Active Support, просто выполните:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support/all"</span>
</code></pre>
</div>
<p>В действительности это даже не поместит весь Active Support в память, так как некоторые вещи настроены через <code>autoload</code>, поэтому они загружаются только когда используются.</p><h4 id='active-support-v-prilozhenii-na-ruby-on-rails' class='inside_page_header'><a href="#active-support-v-prilozhenii-na-ruby-on-rails">1.2.</a> Active Support в приложении на Ruby on Rails</h4><p>Приложение на Ruby on Rails загружает весь Active Support, кроме случая когда <a href="/configuring#config-active-support-bare"><code>config.active_support.bare</code></a> равен true. В этом случае приложение загрузит только сам фреймворк и подберет файлы для собственных нужд, и позволит подобрать вам файлы самостоятельно на любом уровне, как описано в предыдущем разделе.</p><h3 id='rasshireniya-ko-vsem-ob-ektam' class='inside_page_header'><a href="#rasshireniya-ko-vsem-ob-ektam">2.</a> Расширения ко всем объектам</h3><h4 id='blank-i-present' class='inside_page_header'><a href="#blank-i-present">2.1.</a> <code>blank?</code> и <code>present?</code></h4><p>Следующие значения рассматриваются как пустые в Rails приложении:</p><ul><li><code>nil</code> и <code>false</code>,
</li><li>строки, состоящие только из пробелов (смотрите примечание ниже),
</li><li>пустые массивы и хэши,
</li><li>и любые другие объекты, откликающиеся на <code>empty?</code> и являющиеся пустыми.
</li></ul><div class="info"><p>Предикат для строк использует совместимый с Unicode символьный класс <code>[:space:]</code>, поэтому, к примеру, U+2029 (разделитель параграфов) рассматривается как пробел.</p></div><div class="warning"><p>Отметьте, что числа тут не упомянуты, в частности, 0 и 0.0 <strong>не</strong> являются пустыми.</p></div><p>Например, этот метод из <code>ActionController::HttpAuthentication::Token::ControllerMethods</code> использует <a href="https://api.rubyonrails.org/classes/Object.html#method-i-blank-3F"><code>blank?</code></a> для проверки, существует ли токен:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">login_procedure</span><span class="p">)</span>
  <span class="n">token</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">token_and_options</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="nf">request</span><span class="p">)</span>
  <span class="k">unless</span> <span class="n">token</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="n">login_procedure</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-present-3F"><code>present?</code></a> является эквивалентом <code>!blank?</code>. Этот пример взят из <code>ActionDispatch::Http::Cache::Response</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">set_conditional_cache_control!</span>
  <span class="k">return</span> <span class="k">if</span> <span class="nb">self</span><span class="p">[</span><span class="s2">"Cache-Control"</span><span class="p">].</span><span class="nf">present?</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id='presence' class='inside_page_header'><a href="#presence">2.2.</a> <code>presence</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-presence"><code>presence</code></a> возвращает его получателя, если <code>present?</code>, и <code>nil</code> в противном случае. Он полезен для подобных идиом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:host</span><span class="p">].</span><span class="nf">presence</span> <span class="o">||</span> <span class="s1">'localhost'</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/blank.rb</code>.</p></div><h4 id='duplicable' class='inside_page_header'><a href="#duplicable">2.3.</a> <code>duplicable?</code></h4><p>В Ruby 2.5 большинство объектов могут дублироваться с помощью <code>dup</code> или <code>clone</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">dup</span>           <span class="c1"># =&gt; "foo"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">dup</span>              <span class="c1"># =&gt; ""</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">dup</span>     <span class="c1"># =&gt; (1/1)</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">dup</span>      <span class="c1"># =&gt; (0+0i)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">dup</span>    <span class="c1"># =&gt; TypeError (allocator undefined for Method)</span>
</code></pre>
</div>
<p>Active Support предоставляет <a href="https://api.rubyonrails.org/classes/Object.html#method-i-duplicable-3F"><code>duplicable?</code></a> для запроса к объекту об этой возможности:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">duplicable?</span>        <span class="c1"># =&gt; true</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">duplicable?</span>           <span class="c1"># =&gt; true</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>  <span class="c1"># =&gt; true</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>   <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">duplicable?</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<div class="warning"><p>Любой класс может запретить дублирование, убрав <code>dup</code> и <code>clone</code>, или вызвав исключение в них. Таким образом, только <code>rescue</code> может сказать, является ли данный произвольный объект дублируемым. <code>duplicable?</code> зависит от жестко заданного вышеуказанного перечня, но он намного быстрее, чем <code>rescue</code>. Используйте его только в том случае, если знаете, что жесткий перечень достаточен в конкретном случае.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/object/duplicable.rb</code>.</p></div><h4 id='deep_dup' class='inside_page_header'><a href="#deep_dup">2.4.</a> <code>deep_dup</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-deep_dup"><code>deep_dup</code></a> возвращает &quot;глубокую&quot; копию данного объекта. Обычно при вызове <code>dup</code> на объекте, содержащем другие объекты, Ruby не вызывает <code>dup</code> для них, поэтому он создает &quot;мелкую&quot; копию объекта. Если, к примеру, имеется массив со строкой, это будет выглядеть так:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">push</span> <span class="s1">'another-string'</span>

<span class="c1"># объект был дублирован, поэтому элемент был добавлен только в дубликат</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['string', 'another-string']</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="c1"># первый элемент не был дублирован, он будет изменен в обоих массивах</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['foo']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo', 'another-string']</span>
</code></pre>
</div>
<p>Как видите, после дублирования экземпляра <code>Array</code>, мы получили еще один объект, следовательно мы можем его модифицировать, и исходный объект останется нетронутым. Однако, это не истинно для элементов массива. Поскольку <code>dup</code> не делает &quot;глубокую&quot; копию, строка внутри массива остается тем же самым объектом.</p><p>Если нужна &quot;глубокая&quot; копия объекта, следует использовать <code>deep_dup</code>. Вот пример:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo']</span>
</code></pre>
</div>
<p>Если объект нельзя дублировать, <code>deep_dup</code> просто возвратит его:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="n">number</span><span class="p">.</span><span class="nf">object_id</span> <span class="o">==</span> <span class="n">duplicate</span><span class="p">.</span><span class="nf">object_id</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id='try' class='inside_page_header'><a href="#try">2.5.</a> <code>try</code></h4><p>Когда необходимо вызвать метод на объекте, но только в том случае, если он не <code>nil</code>, то простейшим способом достичь этого является условное выражение, добавляющее ненужный код. Альтернативой является использование <a href="https://api.rubyonrails.org/classes/Object.html#method-i-try"><code>try</code></a>. <code>try</code> похож на <code>Object#public_send</code> за исключением того, что он возвращает <code>nil</code>, если вызван на <code>nil</code>.</p><p>Вот пример:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># без try</span>
<span class="k">unless</span> <span class="vi">@number</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="vi">@number</span><span class="p">.</span><span class="nf">next</span>
<span class="k">end</span>

<span class="c1"># используя try</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:next</span><span class="p">)</span>
</code></pre>
</div>
<p>Другим примером является этот код из <code>ActiveRecord::ConnectionAdapters::AbstractAdapter</code>, где <code>@logger</code> может быть <code>nil</code>. Код использует <code>try</code> и позволяет избегать ненужной проверки.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@logger</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:debug?</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s1">'%s (%.1fms)'</span> <span class="o">%</span> <span class="p">[</span><span class="nb">name</span> <span class="o">||</span> <span class="s1">'SQL'</span><span class="p">,</span> <span class="n">ms</span><span class="p">]</span>
    <span class="vi">@logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">format_log_entry</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">sql</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="s1">' '</span><span class="p">)))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p><code>try</code> также может быть вызван не с аргументами, а с блоком, который будет выполнен, если объект не nil:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@person</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">last_name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre>
</div>
<p>Отметьте, что <code>try</code> поглотит ошибки об отсутствующем методе, возвратив вместо них nil. Если необходимо защититься от таких ошибок, используйте вместо него <a href="https://api.rubyonrails.org/classes/Object.html#method-i-try-21"><code>try!</code></a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span>  <span class="c1"># =&gt; nil</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try!</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span> <span class="c1"># NoMethodError: undefined method `nest' for 1:Integer</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/try.rb</code>.</p></div><h4 id='class_eval-args-amp-block' class='inside_page_header'><a href="#class_eval-args-amp-block">2.6.</a> <code>class_eval(*args, &amp;block)</code></h4><p>Можно вычислить код в контексте синглтон-класса любого объекта, используя <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-class_eval"><code>class_eval</code></a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Proc</span>
  <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="n">block</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
    <span class="n">object</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"__bind_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">usec</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">define_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="nb">method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="n">remove_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="nb">method</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/kernel/singleton_class.rb</code>.</p></div><h4 id='acts_like-duck' class='inside_page_header'><a href="#acts_like-duck">2.7.</a> <code>acts_like?(duck)</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-acts_like-3F"><code>acts_like?</code></a> предоставляет возможность проверить, работает ли некий класс как некоторый другой класс, основываясь на простом соглашении: класс предоставляющий тот же интерфейс, как у <code>String</code> определяет</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">acts_like_string?</span>
<span class="k">end</span>
</code></pre>
</div>
<p>являющийся всего лишь маркером, его содержимое или возвращаемое значение ничего не значит. Затем, код клиента может запросить &quot;безопасную утиную типизацию&quot; следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">some_klass</span><span class="p">.</span><span class="nf">acts_like?</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
</code></pre>
</div>
<p>В Rails имеются классы, действующие как <code>Date</code> или <code>Time</code> и следующие этому соглашению.</p><div class="note"><p>Определено в <code>active_support/core_ext/object/acts_like.rb</code>.</p></div><h4 id='to_param' class='inside_page_header'><a href="#to_param">2.8.</a> <code>to_param</code></h4><p>Все объекты в Rails отвечают на метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-to_param"><code>to_param</code></a>, который предназначен для возврата чего-то, что представляет их в строке запроса или как фрагменты URL.</p><p>По умолчанию <code>to_param</code> просто вызывает <code>to_s</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">7</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "7"</span>
</code></pre>
</div>
<p>Возвращаемое значение <code>to_param</code> <strong>не</strong> должно быть экранировано:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Tom &amp; Jerry"</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "Tom &amp; Jerry"</span>
</code></pre>
</div>
<p>Некоторые классы в Rails переопределяют этот метод.</p><p>Например, <code>nil</code>, <code>true</code> и <code>false</code> возвращают сами себя. <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_param"><code>Array#to_param</code></a> вызывает <code>to_param</code> на элементах и соединяет результат с помощью &quot;/&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="no">String</span><span class="p">].</span><span class="nf">to_param</span> <span class="c1"># =&gt; "0/true/String"</span>
</code></pre>
</div>
<p>В частности, система роутинга Rails вызывает <code>to_param</code> на моделях, чтобы получить значение для местозаполнителя <code>:id</code>. <code>ActiveRecord::Base#to_param</code> возвращает <code>id</code> модели, но можно переопределить этот метод в своих моделях. Например, задав</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>мы получим:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">user_path</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="c1"># =&gt; "/users/357-john-smith"</span>
</code></pre>
</div>
<div class="warning"><p>Контроллерам нужно быть в курсе любых переопределений <code>to_param</code>, поскольку в подобном запросе &quot;357-john-smith&quot; будет значением <code>params[:id]</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/object/to_param.rb</code>.</p></div><h4 id='to_query' class='inside_page_header'><a href="#to_query">2.9.</a> <code>to_query</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-to_query"><code>to_query</code></a> создает строку запроса, который связывает заданный <code>key</code> с возвращаемым значением <code>to_param</code>. Например, для следующего определения <code>to_param</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>мы получим:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">current_user</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span> <span class="c1"># =&gt; "user=357-john-smith"</span>
</code></pre>
</div>
<p>Этот метод экранирует все, что требуется: и ключ, и значение:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">account</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'company[name]'</span><span class="p">)</span>
<span class="c1"># =&gt; "company%5Bname%5D=Johnson+%26+Johnson"</span>
</code></pre>
</div>
<p>поэтому результат готов для использования в строке запроса.</p><p>Массивы возвращают результат применения <code>to_query</code> к каждому элементу с <code>key[]</code> в качестве ключа, и соединяет результат с помощью &quot;&amp;&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.6</span><span class="p">].</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'sample'</span><span class="p">)</span>
<span class="c1"># =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"</span>
</code></pre>
</div>
<p>Хэши также отвечают на <code>to_query</code>, но c другой сигнатурой. Если аргумент не передается, вызов генерирует отсортированную серию присваиваний ключ/значение, вызвав <code>to_query(key)</code> на этих значениях. Затем он соединяет результат с помощью &quot;&amp;&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">to_query</span> <span class="c1"># =&gt; "a=1&amp;b=2&amp;c=3"</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_query"><code>Hash#to_query</code></a> принимает опциональное пространство имен для ключей:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">id: </span><span class="mi">89</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Smith"</span><span class="p">}.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span>
<span class="c1"># =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/to_query.rb</code>.</p></div><h4 id='with_options' class='inside_page_header'><a href="#with_options">2.10.</a> <code>with_options</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-with_options"><code>with_options</code></a> предоставляет способ для выделения общих опций в серии вызовов метода.</p><p>Задав дефолтный хэш опций, <code>with_options</code> предоставляет прокси-объект в блок. Внутри блока методы, вызванные на прокси, отправляются получателю с объединением своих опций. Например, чтобы избавиться от дублирования:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:customers</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:products</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:invoices</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:expenses</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
<span class="k">end</span>
</code></pre>
</div>
<p>заменяем на:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">dependent: :destroy</span> <span class="k">do</span> <span class="o">|</span><span class="n">assoc</span><span class="o">|</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:customers</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:products</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:invoices</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:expenses</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Эта идиома может передавать <em>группировку</em> в ридер (reader). Например скажем, что нужно послать newsletter, язык которого зависит от пользователя. Где-нибудь в рассыльщике можно сгруппировать кусочки, зависимые от локали, следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">I18n</span><span class="p">.</span><span class="nf">with_options</span> <span class="ss">locale: </span><span class="n">user</span><span class="p">.</span><span class="nf">locale</span><span class="p">,</span> <span class="ss">scope: </span><span class="s2">"newsletter"</span> <span class="k">do</span> <span class="o">|</span><span class="n">i18n</span><span class="o">|</span>
  <span class="n">subject</span> <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:subject</span>
  <span class="n">body</span>    <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">user_name: </span><span class="n">user</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="info"><p>Поскольку <code>with_options</code> переадресовывает вызовы получателю, они могут быть вложены. Каждый уровень вложенности будет объединять унаследованные дефолтные значения со своими собственными.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/object/with_options.rb</code>.</p></div><h4 id='podderzhka-json' class='inside_page_header'><a href="#podderzhka-json">2.11.</a> Поддержка JSON</h4><p>Active Support обеспечивает лучшую реализацию <code>to_json</code>, чем гем <code>json</code>, обычно предоставленный для объектов Ruby. Это так, потому что некоторые классы, такие как <code>Hash</code> и <code>Process::Status</code>, нуждаются в специальной обработке для обеспечения подходящего JSON.</p><div class="note"><p>Определено в <code>active_support/core_ext/object/json.rb</code>.</p></div><h4 id='peremennye-ekzemplyara' class='inside_page_header'><a href="#peremennye-ekzemplyara">2.12.</a> Переменные экземпляра</h4><p>Active Support предоставляет несколько методов для облегчения доступа к переменным экземпляра.</p><h5 id='instance_values' class='inside_page_header'><a href="#instance_values">2.12.1.</a> <code>instance_values</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-instance_values"><code>instance_values</code></a> возвращает хэш, который связывает имена переменных экземпляра без &quot;@&quot; с их соответствующими значениями. Ключи являются строками:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_values</span> <span class="c1"># =&gt; {"x" =&gt; 0, "y" =&gt; 1}</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h5 id='instance_variable_names' class='inside_page_header'><a href="#instance_variable_names">2.12.2.</a> <code>instance_variable_names</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Object.html#method-i-instance_variable_names"><code>instance_variable_names</code></a> возвращает массив.  Каждое имя включает знак &quot;@&quot;.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_variable_names</span> <span class="c1"># =&gt; ["@x", "@y"]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/instance_variables.rb</code>.</p></div><h4 id='otklyuchenie-preduprezhdeniy-i-isklyucheniya' class='inside_page_header'><a href="#otklyuchenie-preduprezhdeniy-i-isklyucheniya">2.13.</a> Отключение предупреждений и исключения</h4><p>Методы <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-silence_warnings"><code>silence_warnings</code></a> и <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-enable_warnings"><code>enable_warnings</code></a> изменяют значение <code>$VERBOSE</code> в течение исполнения блока, и сбрасывают в исходное значение после его окончания:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">silence_warnings</span> <span class="p">{</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_set</span> <span class="s2">"RAILS_DEFAULT_LOGGER"</span><span class="p">,</span> <span class="n">logger</span> <span class="p">}</span>
</code></pre>
</div>
<p>Отключение исключений также возможно с помощью <a href="https://api.rubyonrails.org/classes/Kernel.html#method-i-suppress"><code>suppress</code></a>. Этот метод получает определенное количество классов исключений. Если вызывается исключение во время выполнения блока, и <code>kind_of?</code> соответствует любому аргументу, <code>suppress</code> ловит его и возвращает отключенным. В противном случае исключение не захватывается:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># Если пользователь под блокировкой, инкремент теряется, ничего страшного.</span>
<span class="n">suppress</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">StaleObjectError</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_user</span><span class="p">.</span><span class="nf">increment!</span> <span class="ss">:visits</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/kernel/reporting.rb</code>.</p></div><h4 id='in' class='inside_page_header'><a href="#in">2.14.</a> <code>in?</code></h4><p>Предикат <a href="https://api.rubyonrails.org/classes/Object.html#method-i-in-3F"><code>in?</code></a> проверяет, включен ли объект в другой объект. Если переданный элемент не отвечает на <code>include?</code>, будет вызвано исключение <code>ArgumentError</code>.</p><p>Примеры применения <code>in?</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>        <span class="c1"># =&gt; true</span>
<span class="s2">"lo"</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="mi">25</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">30</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span>      <span class="c1"># =&gt; false</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c1"># =&gt; ArgumentError</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/inclusion.rb</code>.</p></div><h3 id='rasshireniya-dlya-module' class='inside_page_header'><a href="#rasshireniya-dlya-module">3.</a> Расширения для <code>Module</code></h3><h4 id='atributy' class='inside_page_header'><a href="#atributy">3.1.</a> Атрибуты</h4><h5 id='alias_attribute' class='inside_page_header'><a href="#alias_attribute">3.1.1.</a> <code>alias_attribute</code></h5><p>В атрибутах модели есть ридер (reader), райтер (writer) и предикат. Можно создать псевдоним к атрибуту модели, в котором будут определены сразу три соответствующих метода, используя <a href="https://api.rubyonrails.org/classes/Module.html#method-i-alias_attribute"><code>alias_attribute</code></a>. Как и в других создающих псевдоним методах, новое имя - это первый аргумент, а старое имя - второй (мнемоническое правило такое: они идут в том же порядке, как если бы делалось присваивание):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># Теперь можно обращаться к столбцу email как "login".</span>
  <span class="c1"># Это имеет больше смысла для кода аутентификации.</span>
  <span class="n">alias_attribute</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/module/aliasing.rb</code>.</p></div><h5 id='vnutrennie-atributy' class='inside_page_header'><a href="#vnutrennie-atributy">3.1.2.</a> Внутренние атрибуты</h5><p>При определении атрибута в классе, который предназначен для подкласса, есть риск коллизии подклассовых имен. Это особенно важно для библиотек.</p><p>Active Support определяет макросы <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_reader"><code>attr_internal_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_writer"><code>attr_internal_writer</code></a> и <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal_accessor"><code>attr_internal_accessor</code></a>. Они ведут себя подобно встроенным в Ruby коллегам <code>attr_*</code>, за исключением того, что они именуют лежащую в основе переменную экземпляра способом, наиболее снижающим коллизии.</p><p>Макрос <a href="https://api.rubyonrails.org/classes/Module.html#method-i-attr_internal"><code>attr_internal</code></a> - это синоним для <code>attr_internal_accessor</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># библиотека</span>
<span class="k">class</span> <span class="nc">ThirdPartyLibrary::Crawler</span>
  <span class="n">attr_internal</span> <span class="ss">:log_level</span>
<span class="k">end</span>

<span class="c1"># код клиента</span>
<span class="k">class</span> <span class="nc">MyCrawler</span> <span class="o">&lt;</span> <span class="no">ThirdPartyLibrary</span><span class="o">::</span><span class="no">Crawler</span>
  <span class="nb">attr_accessor</span> <span class="ss">:log_level</span>
<span class="k">end</span>
</code></pre>
</div>
<p>В предыдущем примере мог быть случай, при котором <code>:log_level</code> не принадлежит публичному интерфейсу библиотеки и используется только для разработки. Код клиента, не подозревающий о потенциальном конфликте, создает подкласс и определяет внутри него свой <code>:log_level</code>. Благодаря <code>attr_internal</code> здесь не будет коллизий.</p><p>По умолчанию внутренняя переменная экземпляра именуется с предшествующим подчеркиванием, <code>@_log_level</code> в примере выше. Это настраивается через <code>Module.attr_internal_naming_format</code>, куда можно передать любую строку в формате <code>sprintf</code> с предшествующими <code>@</code> и <code>%s</code> в любом месте, которая означает место, куда вставляется имя. По умолчанию <code>&quot;@_%s&quot;</code>.</p><p>Rails использует внутренние атрибуты в некоторых местах, например для вью:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">attr_internal</span> <span class="ss">:captures</span>
    <span class="n">attr_internal</span> <span class="ss">:request</span><span class="p">,</span> <span class="ss">:layout</span>
    <span class="n">attr_internal</span> <span class="ss">:controller</span><span class="p">,</span> <span class="ss">:template</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/module/attr_internal.rb</code>.</p></div><h5 id='atributy-modulya' class='inside_page_header'><a href="#atributy-modulya">3.1.3.</a> Атрибуты модуля</h5><p>Макросы <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_reader"><code>mattr_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_writer"><code>mattr_writer</code></a> и <a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_accessor"><code>mattr_accessor</code></a> - это те же самые макросы <code>cattr_*</code>, определенным для класса. Фактически, макросы <code>cattr_*</code> — это всего лишь псевдонимы для макросов <code>mattr_*</code>. Смотрите <a href="#extensions-to-class">Атрибуты класса</a>.</p><p>Например, API логирования Active Storage генерируется с помощью <code>mattr_accessor</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveStorage</span>
  <span class="n">mattr_accessor</span> <span class="ss">:logger</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/module/attribute_accessors.rb</code>.</p></div><h4 id='roditeli' class='inside_page_header'><a href="#roditeli">3.2.</a> Родители</h4><h5 id='module_parent' class='inside_page_header'><a href="#module_parent">3.2.1.</a> <code>module_parent</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parent"><code>module_parent</code></a> на вложенном именованном модуле возвращает модуль, содержащий его соответствующую константу:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent</span> <span class="c1"># =&gt; X::Y</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent</span>       <span class="c1"># =&gt; X::Y</span>
</code></pre>
</div>
<p>Если модуль анонимный или относится к верхнему уровню, <code>module_parent</code> возвращает <code>Object</code>.</p><div class="warning"><p>Отметьте, что в этом случае <code>module_parent_name</code> возвращает <code>nil</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id='module_parent_name' class='inside_page_header'><a href="#module_parent_name">3.2.2.</a> <code>module_parent_name</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parent_name"><code>module_parent_name</code></a> на вложенном именованном модуле возвращает полностью определенное имя модуля, содержащего его соответствующую константу:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent_name</span> <span class="c1"># =&gt; "X::Y"</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent_name</span>       <span class="c1"># =&gt; "X::Y"</span>
</code></pre>
</div>
<p>Для верхнеуровневых и анонимных модулей <code>module_parent_name</code> возвращает <code>nil</code>.</p><div class="warning"><p>Отметьте, что в этом случае <code>module_parent</code> возвращает <code>Object</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h5 id='parents' class='inside_page_header'><a href="#parents">3.2.3.</a> <code>parents</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Module.html#method-i-module_parents"><code>module_parents</code></a> вызывает <code>module_parent</code> на получателе и вверх по иерархии, пока не будет достигнут <code>Object</code>. Цепочка возвращается в массиве, от низшего к высшему:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parents</span> <span class="c1"># =&gt; [X::Y, X, Object]</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parents</span>       <span class="c1"># =&gt; [X::Y, X, Object]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/module/introspection.rb</code>.</p></div><h4 id='anonymous' class='inside_page_header'><a href="#anonymous">3.3.</a> Anonymous</h4><p>У модуля может быть или не быть имени:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "M"</span>

<span class="no">N</span> <span class="o">=</span> <span class="no">Module</span><span class="p">.</span><span class="nf">new</span>
<span class="no">N</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "N"</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; nil</span>
</code></pre>
</div>
<p>Можно проверить, имеет ли модуль имя с помощью предиката <a href="https://api.rubyonrails.org/classes/Module.html#method-i-anonymous-3F"><code>anonymous?</code></a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Отметьте, что быть недостижимым не означает быть анонимным:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>

<span class="n">m</span> <span class="o">=</span> <span class="no">Object</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:remove_const</span><span class="p">,</span> <span class="ss">:M</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<p>хотя анонимный модуль недостижим по определению.</p><div class="note"><p>Определено в <code>active_support/core_ext/module/anonymous.rb</code>.</p></div><h4 id='delegirovanie-metoda' class='inside_page_header'><a href="#delegirovanie-metoda">3.4.</a> Делегирование метода</h4><h5 id='delegate' class='inside_page_header'><a href="#delegate">3.4.1.</a> <code>delegate</code></h5><p>Макрос <a href="https://api.rubyonrails.org/classes/Module.html#method-i-delegate"><code>delegate</code></a> предлагает простой способ передать методы.</p><p>Давайте представим, что у пользователей в неком приложении имеется информация о логинах в модели <code>User</code>, но имена и другие данные в отдельной модели <code>Profile</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
</div>
<p>С такой конфигурацией можно получить имя пользователя через его профиль, <code>user.profile.name</code>, но было бы удобнее обеспечить доступ к такому атрибуту напрямую:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Это как раз то, что делает <code>delegate</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Это короче, и намерения более очевидные.</p><p>Целевой метод должен быть публичным.</p><p>Макрос <code>delegate</code> принимает несколько методов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:twitter</span><span class="p">,</span> <span class="ss">to: :profile</span>
</code></pre>
</div>
<p>При интерполяции в строку опция <code>:to</code> должна стать выражением, вычисляемым объектом, метод которого делегируется. Обычно строка или символ. Такое выражение вычисляется в контексте получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># делегирует константе Rails</span>
<span class="n">delegate</span> <span class="ss">:logger</span><span class="p">,</span> <span class="ss">to: :Rails</span>

<span class="c1"># делегирует классу получателя</span>
<span class="n">delegate</span> <span class="ss">:table_name</span><span class="p">,</span> <span class="ss">to: :class</span>
</code></pre>
</div>
<div class="warning"><p>Если опция <code>:prefix</code> установлена в <code>true</code> - это менее характерно, смотрите ниже.</p></div><p>По умолчанию, если делегирование вызывает <code>NoMethodError</code> и цель является <code>nil</code>, выводится исключение. Можно попросить с помощью опции <code>:allow_nil</code>, чтобы вместо этого возвращался <code>nil</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
</code></pre>
</div>
<p>С <code>:allow_nil</code> вызов <code>user.name</code> возвратит <code>nil</code>, если у пользователя нет профиля.</p><p>Опция <code>:prefix</code> добавляет префикс к имени генерируемого метода. Это может быть удобно, например, для получения более благозвучного имени:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">to: :address</span><span class="p">,</span> <span class="ss">prefix: </span><span class="kp">true</span>
</code></pre>
</div>
<p>Предыдущий пример сгенерирует <code>address_street</code>, а не <code>street</code>.</p><div class="warning"><p>Поскольку в этом случае имя генерируемого метода составляется из имен целевого объекта и целевого метода, опция <code>:to</code> должна быть именем метода.</p></div><p>Также может быть настроен произвольный префикс:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">to: :attachment</span><span class="p">,</span> <span class="ss">prefix: :avatar</span>
</code></pre>
</div>
<p>В предыдущем примере макрос генерирует <code>avatar_size</code>, а не <code>size</code>.</p><p>Опция <code>:private</code> изменяет область видимости методов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">private: </span><span class="kp">true</span>
</code></pre>
</div>
<p>Делегированные методы являются публичными по умолчанию. Передайте <code>private: true</code>, чтобы изменить это.</p><div class="note"><p>Определено в <code>active_support/core_ext/module/delegation.rb</code></p></div><h5 id='delegate_missing_to' class='inside_page_header'><a href="#delegate_missing_to">3.4.2.</a> <code>delegate_missing_to</code></h5><p>Представьте, что нужно делегировать все, отсутствующее в объекте <code>User</code> в <code>Profile</code>. Макрос <a href="https://api.rubyonrails.org/classes/Module.html#method-i-delegate_missing_to"><code>delegate_missing_to</code></a> позволяет реализовать это быстро:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate_missing_to</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Целью может быть все что угодно, вызываемое внутри объекта, например, переменные экземпляра, методы, константы и т.д. Делегируются только публичные методы цели.</p><div class="note"><p>Определено в <code>active_support/core_ext/module/delegation.rb</code>.</p></div><h4 id='pereopredelenie-metodov' class='inside_page_header'><a href="#pereopredelenie-metodov">3.5.</a> Переопределение методов</h4><p>Бывают ситуации, когда нужно определить метод с помощью <code>define_method</code>, но вы не знаете, существует ли уже метод с таким именем. Если так, то выдается предупреждение, если оно включено. Такое поведение хоть и не ошибочно, но не элегантно.</p><p>Метод <a href="https://api.rubyonrails.org/classes/Module.html#method-i-redefine_method"><code>redefine_method</code></a> предотвращает такое потенциальное предупреждение, предварительно убирая существующий метод, если нужно.</p><p>Также можно использовать <a href="https://api.rubyonrails.org/classes/Module.html#method-i-silence_redefinition_of_method"><code>silence_redefinition_of_method</code></a>, если необходимо определить заменяющий метод отдельно (потому что используется <code>delegate</code>, например).</p><div class="note"><p>Определено в <code>active_support/core_ext/module/redefine_method.rb</code>.</p></div><h3 id='extensions-to-class' class='inside_page_header'><a href="#extensions-to-class">4.</a> Расширения для <code>Class</code></h3><h4 id='atributy-klassa' class='inside_page_header'><a href="#atributy-klassa">4.1.</a> Атрибуты класса</h4><h5 id='class_attribute' class='inside_page_header'><a href="#class_attribute">4.1.1.</a> <code>class_attribute</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Class.html#method-i-class_attribute"><code>class_attribute</code></a> объявляет один или более наследуемых атрибутов класса, которые могут быть переопределены на низшем уровне иерархии:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">A</span><span class="p">;</span> <span class="k">end</span>

<span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>

<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:b</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>

<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:c</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>
</code></pre>
</div>
<p>Например, <code>ActionMailer::Base</code> определяет:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">class_attribute</span> <span class="ss">:default_params</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">default_params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">mime_version: </span><span class="s2">"1.0"</span><span class="p">,</span>
  <span class="ss">charset: </span><span class="s2">"UTF-8"</span><span class="p">,</span>
  <span class="ss">content_type: </span><span class="s2">"text/plain"</span><span class="p">,</span>
  <span class="ss">parts_order: </span><span class="p">[</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"text/enriched"</span><span class="p">,</span> <span class="s2">"text/html"</span> <span class="p">]</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre>
</div>
<p>К ним также есть доступ, и они могут быть переопределены на уровне экземпляра:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a1</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">a1</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 1, приходит из A</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 2, переопределено в a2</span>
</code></pre>
</div>
<p>Генерация райтер-метода экземпляра может быть отключена установлением опции <code>:instance_writer</code> в <code>false</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveRecord</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">class_attribute</span> <span class="ss">:table_name_prefix</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"my"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>В модели такая опция может быть полезной как способ предотвращения массового назначения для установки атрибута.</p><p>Генерация ридер-метода экземпляра может быть отключена установлением опции <code>:instance_reader</code> в <code>false</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
<span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># NoMethodError</span>
</code></pre>
</div>
<p>Для удобства <code>class_attribute</code> определяет также предикат экземпляра, являющийся двойным отрицанием того, что возвращает ридер экземпляра. В вышеописанном примере оно может вызываться <code>x?</code>.</p><p>Когда <code>instance_reader</code> равен <code>false</code>, предикат экземпляра возвратит <code>NoMethodError</code>, как и ридер-метод.</p><p>Если не нужен предикат, передайте <code>instance_predicate: false</code>, и он не будет определен.</p><div class="note"><p>Определено в <code>active_support/core_ext/class/attribute.rb</code>.</p></div><h5 id='cattr_reader-cattr_writer-i-cattr_accessor' class='inside_page_header'><a href="#cattr_reader-cattr_writer-i-cattr_accessor">4.1.2.</a> <code>cattr_reader</code>, <code>cattr_writer</code> и <code>cattr_accessor</code></h5><p>Макросы <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_reader"><code>cattr_reader</code></a>, <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_writer"><code>cattr_writer</code></a> и <a href="https://api.rubyonrails.org/classes/Module.html#method-i-cattr_accessor"><code>cattr_accessor</code></a> являются аналогами их коллег <code>attr_*</code>, но для классов. Они инициализируют переменную класса как <code>nil</code>, если она еще не существует, и генерируют соответствующие методы класса для доступа к ней:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Генерирует методы класса для доступа к @@emulate_booleans.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Также можно передать блок в <code>cattr_*</code> для настройки атрибута со значением по умолчанию:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Генерирует методы класса для доступа к @@emulate_booleans со значением по умолчанию true.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Методы экземпляра также создаются для удобства, они всего лишь прокси к атрибуту класса. Таким образом, экземпляры могут менять атрибут класса, но не могут переопределять его, как это происходит в случае с <code>class_attribute</code> (смотрите выше). К примеру, задав</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">cattr_accessor</span> <span class="ss">:field_error_proc</span><span class="p">,</span> <span class="ss">default: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>мы получим доступ к <code>field_error_proc</code> во вью.</p><p>Генерация ридер-метода экземпляра предотвращается установкой <code>:instance_reader</code> в <code>false</code> и генерация райтер-метода экземпляра предотвращается установкой <code>:instance_writer</code> в <code>false</code>. Генерация обоих методов предотвращается установкой <code>:instance_accessor</code> в <code>false</code>. Во всех случаях, должно быть не любое ложное значение, а именно <code>false</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">A</span>
  <span class="k">class</span> <span class="nc">B</span>
    <span class="c1"># first_name ридер экземпляра не генерируется.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
    <span class="c1"># last_name= райтер экземпляра не генерируется.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span>
    <span class="c1"># surname ридер экземпляра или surname= райтер экземпляра не генерируется.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:surname</span><span class="p">,</span> <span class="ss">instance_accessor: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>В модели может быть полезным установить <code>:instance_accessor</code> в <code>false</code> как способ предотвращения массового назначения для установки атрибута.</p><div class="note"><p>Определено в <code>active_support/core_ext/class/attribute_accessors.rb</code>.</p></div><h4 id='podklassy-i-potomki' class='inside_page_header'><a href="#podklassy-i-potomki">4.2.</a> Подклассы и потомки</h4><h5 id='subclasses' class='inside_page_header'><a href="#subclasses">4.2.1.</a> <code>subclasses</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Class.html#method-i-subclasses"><code>subclasses</code></a> возвращает подклассы получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B, D]</span>
</code></pre>
</div>
<p>Порядок, в котором эти классы возвращаются, не определен.</p><div class="note"><p>Определено в <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h5 id='descendants' class='inside_page_header'><a href="#descendants">4.2.2.</a> <code>descendants</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Class.html#method-i-descendants"><code>descendants</code></a> возвращает все классы, которые являются <code>&lt;</code> к его получателю:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A, D]</span>
</code></pre>
</div>
<p>Порядок, в котором эти классы возвращаются, не определен.</p><div class="note"><p>Определено в <code>active_support/core_ext/class/subclasses.rb</code>.</p></div><h3 id='rasshireniya-dlya-string' class='inside_page_header'><a href="#rasshireniya-dlya-string">5.</a> Расширения для <code>String</code></h3><h4 id='bezopasnost-vyvoda' class='inside_page_header'><a href="#bezopasnost-vyvoda">5.1.</a> Безопасность вывода</h4><h5 id='motivatsiya' class='inside_page_header'><a href="#motivatsiya">5.1.1.</a> Мотивация</h5><p>Вставка данных в шаблоны HTML требует дополнительной осторожности. Например, нельзя просто интерполировать <code>@review.title</code> на страницу HTML. С одной стороны, если заголовок рецензии &quot;Flanagan &amp; Matz rules!&quot;, то результат не будет правильно отображен, поскольку амперсанд должен быть экранирован как &quot;&amp;amp;&quot;. К тому же, в зависимости от приложения, это может быть большой дырой в безопасности, так как пользователи могут внедрить вредоносный HTML, устанавливающий вручную изготовленный заголовок рецензии. Смотрите подробную информацию о рисках в разделе о межсайтовом скриптинге в руководстве <a href="/security#cross-site-scripting-xss">Безопасность приложений на Rails</a>.</p><h5 id='bezopasnye-stroki' class='inside_page_header'><a href="#bezopasnye-stroki">5.1.2.</a> Безопасные строки</h5><p>В Active Support есть концепция <em>(html) безопасных</em> строк. Безопасная строка - это та, которая помечена как подлежащая вставке в HTML как есть. Ей можно доверять, независимо от того, была она экранирована или нет.</p><p>Строки рассматриваются как <em>небезопасные</em> по умолчанию:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<p>Можно получить безопасную строку из заданной с помощью метода <a href="https://api.rubyonrails.org/classes/String.html#method-i-html_safe"><code>html_safe</code></a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Важно понять, что <code>html_safe</code> не выполняет какого бы то ни было экранирования, это всего лишь утверждение:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">"&lt;script&gt;...&lt;/script&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
<span class="n">s</span>            <span class="c1"># =&gt; "&lt;script&gt;...&lt;/script&gt;"</span>
</code></pre>
</div>
<p>Вы ответственны за обеспечение вызова <code>html_safe</code> на подходящей строке.</p><p>При присоединении к безопасной строке или с помощью <code>concat</code>/<code>&lt;&lt;</code>, или с помощью <code>+</code>, результат будет безопасной строкой. Небезопасные аргументы экранируются:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span> <span class="c1"># =&gt; "&amp;lt;"</span>
</code></pre>
</div>
<p>Безопасные аргументы непосредственно присоединяются:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="c1"># =&gt; "&lt;"</span>
</code></pre>
</div>
<p>Эти методы не должны использоваться в обычных вью. Небезопасные значения автоматически экранируются:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@review</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# прекрасно, экранируется, если нужно %&gt;</span>
</code></pre>
</div>
<p>Чтобы вставить что-либо дословно, используйте хелпер <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw"><code>raw</code></a> вместо вызова <code>html_safe</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# вставляет @cms.current_template как есть %&gt;</span>
</code></pre>
</div>
<p>или используйте эквивалентную запись <code>&lt;%==</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span><span class="o">=</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# вставляет @cms.current_template как есть %&gt;</span>
</code></pre>
</div>
<p>Хелпер <code>raw</code> вызывает за вас хелпер <code>html_safe</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="n">stringish</span><span class="p">)</span>
  <span class="n">stringish</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/output_safety.rb</code>.</p></div><h5 id='preobrazovanie' class='inside_page_header'><a href="#preobrazovanie">5.1.3.</a> Преобразование</h5><p>Как правило, за исключением, разве что, конкатенации, как объяснялось выше, любой метод, который может изменить строку, дает небезопасную строку. Это <code>downcase</code>, <code>gsub</code>, <code>strip</code>, <code>chomp</code>, <code>underscore</code> и т.д.</p><p>В случае встроенного преобразования, такого как <code>gsub!</code>, получатель сам становится небезопасным.</p><div class="info"><p>Бит безопасности всегда теряется, независимо от того, изменило ли что-то преобразование или нет.</p></div><h5 id='konversiya-i-prinuzhdenie' class='inside_page_header'><a href="#konversiya-i-prinuzhdenie">5.1.4.</a> Конверсия и принуждение</h5><p>Вызов <code>to_s</code> на безопасной строке возвратит безопасную строку, но принуждение с помощью <code>to_str</code> возвратит небезопасную строку.</p><h5 id='kopirovanie' class='inside_page_header'><a href="#kopirovanie">5.1.5.</a> Копирование</h5><p>Вызов <code>dup</code> или <code>clone</code> на безопасной строке создаст безопасные строки.</p><h4 id='remove' class='inside_page_header'><a href="#remove">5.2.</a> <code>remove</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-remove"><code>remove</code></a> уберет все совпадения с шаблоном:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Hello World"</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sr">/Hello /</span><span class="p">)</span> <span class="c1"># =&gt; "World"</span>
</code></pre>
</div>
<p>Также имеется деструктивная версия <code>String#remove!</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id='squish' class='inside_page_header'><a href="#squish">5.3.</a> <code>squish</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-squish"><code>squish</code></a> отсекает начальные и конечные пробелы, а также заменяет внутренние пробелы на один пробел:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">" </span><span class="se">\n</span><span class="s2">  foo</span><span class="se">\n\r</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> bar </span><span class="se">\n</span><span class="s2">"</span><span class="p">.</span><span class="nf">squish</span> <span class="c1"># =&gt; "foo bar"</span>
</code></pre>
</div>
<p>Также имеется разрушительная версия <code>String#squish!</code>.</p><p>Отметьте, что он обрабатывает и ASCII, и Unicode пробелы.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id='truncate' class='inside_page_header'><a href="#truncate">5.4.</a> <code>truncate</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate"><code>truncate</code></a> возвращает копию получателя, сокращенную после заданного <code>length</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
</div>
<p>Многоточие может быть настроено с помощью опции <code>:omission</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh &amp;hellip;"</span>
</code></pre>
</div>
<p>Отметьте, что сокращение учитывает длину строки omission.</p><p>Передайте <code>:separator</code> для сокращения строки по естественным разрывам:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dea..."</span>
<span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">' '</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre>
</div>
<p>Опция <code>:separator</code> может быть регулярным выражением:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh..."</span>
</code></pre>
</div>
<p>В вышеуказанных примерах &quot;dear&quot; обрезается сначала, а затем <code>:separator</code> предотвращает это.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id='truncate_bytes' class='inside_page_header'><a href="#truncate_bytes">5.5.</a> <code>truncate_bytes</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate_bytes"><code>truncate_bytes</code></a> возвращает копию получателя, обрезанную к максимуму <code>bytesize</code> байт:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍👍…"</span>
</code></pre>
</div>
<p>Многоточие может быть настроено с помощью опции <code>:omission</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"🖖"</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍🖖"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id='truncate_words' class='inside_page_header'><a href="#truncate_words">5.6.</a> <code>truncate_words</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-truncate_words"><code>truncate_words</code></a> возвращает копию получателя, сокращенную после заданного количества слов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
</div>
<p>Многоточие может быть настроено с помощью опции <code>:omission</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!&amp;hellip;"</span>
</code></pre>
</div>
<p>Передайте <code>:separator</code> для сокращения строки по естественным разрывам:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">'!'</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear! I shall be late..."</span>
</code></pre>
</div>
<p>Опция <code>:separator</code> может быть регулярным выражением:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="p">)</span>
<span class="c1"># =&gt; "Oh dear! Oh dear!..."</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/filters.rb</code>.</p></div><h4 id='inquiry' class='inside_page_header'><a href="#inquiry">5.7.</a> <code>inquiry</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-inquiry"><code>inquiry</code></a> конвертирует строку в объект <code>StringInquirer</code>, делая проверки равенства более красивыми.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"production"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">production?</span> <span class="c1"># =&gt; true</span>
<span class="s2">"active"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">inactive?</span>       <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inquiry.rb</code>.</p></div><h4 id='starts_with-i-ends_with' class='inside_page_header'><a href="#starts_with-i-ends_with">5.8.</a> <code>starts_with?</code> и <code>ends_with?</code></h4><p>Active Support определяет псевдонимы <code>String#start_with?</code> и <code>String#end_with?</code> (в связи с особенностями английской морфологии, преобразует глаголы в форму 3-го лица):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/starts_ends_with.rb</code>.</p></div><h4 id='strip_heredoc' class='inside_page_header'><a href="#strip_heredoc">5.9.</a> <code>strip_heredoc</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-strip_heredoc"><code>strip_heredoc</code></a> обрезает отступы в heredocs.</p><p>Для примера в</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:usage</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="p">.</span><span class="nf">strip_heredoc</span><span class="sh">
    This command does such and such.

    Supported options are:
      -h         This message
      ...
</span><span class="no">  USAGE</span>
<span class="k">end</span>
</code></pre>
</div>
<p>пользователь увидит используемое сообщение, выровненное по левому краю.</p><p>Технически это выглядит как выделение красной строки в отдельную строку и удаление всех идущих впереди пробелов.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/strip.rb</code>.</p></div><h4 id='indent' class='inside_page_header'><a href="#indent">5.10.</a> <code>indent</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-indent"><code>indent</code></a> устанавливает отступы строчкам получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="o">&lt;&lt;</span><span class="no">EOS</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="sh">
def some_method
  some_code
end
</span><span class="no">EOS</span>
<span class="c1"># =&gt;</span>
  <span class="k">def</span> <span class="nf">some_method</span>
    <span class="n">some_code</span>
  <span class="k">end</span>
</code></pre>
</div>
<p>Второй аргумент, <code>indent_string</code>, определяет, какой отступ строки использовать. По умолчанию <code>nil</code>, что сообщает методу самому догадаться на основе первой строчки с отступом, а если такой нет, то использовать пробел.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"  foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>        <span class="c1"># =&gt; "    foo"</span>
<span class="s2">"foo</span><span class="se">\n\t\t</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "\t\tfoo\n\t\t\t\tbar"</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>    <span class="c1"># =&gt; "\t\tfoo"</span>
</code></pre>
</div>
<p>Хотя <code>indent_string</code> это обычно один пробел или табуляция, он может быть любой строкой.</p><p>Третий аргумент, <code>indent_empty_lines</code>, это флажок, указывающий, должен ли быть отступ для пустых строчек. По умолчанию false.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>            <span class="c1"># =&gt; "  foo\n\n  bar"</span>
<span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "  foo\n  \n  bar"</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-indent-21"><code>indent!</code></a> добавляет отступ строке.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/indent.rb</code>.</p></div><h4 id='dostup' class='inside_page_header'><a href="#dostup">5.11.</a> Доступ</h4><h5 id='at-position' class='inside_page_header'><a href="#at-position">5.11.1.</a> <code>at(position)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-at"><code>at</code></a> возвращает символ строки на позиции <code>position</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id='from-position' class='inside_page_header'><a href="#from-position">5.11.2.</a> <code>from(position)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-from"><code>from</code></a> возвращает подстроку строки, начинающуюся с позиции <code>position</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "hello"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "llo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "lo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id='to-position' class='inside_page_header'><a href="#to-position">5.11.3.</a> <code>to(position)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-to"><code>to</code></a> возвращает подстроку строки с начала до позиции <code>position</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "hel"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "hell"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; "hello"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id='first-limit-1' class='inside_page_header'><a href="#first-limit-1">5.11.4.</a> <code>first(limit = 1)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-first"><code>first</code></a> возвращает подстроку, содержащую первые <code>limit</code> символов строки.</p><p>Вызов <code>str.first(n)</code> эквивалентен <code>str.to(n-1)</code>, если <code>n</code> &gt; 0, и возвращает пустую строку для <code>n</code> == 0.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/access.rb</code>.</p></div><h5 id='last-limit-1' class='inside_page_header'><a href="#last-limit-1">5.11.5.</a> <code>last(limit = 1)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-last"><code>last</code></a> возвращает подстроку, содержащую последние <code>limit</code> символов строки.</p><p>Вызов <code>str.last(n)</code> эквивалентен <code>str.from(-n)</code>, если <code>n</code> &gt; 0, и возвращает пустую строку для <code>n</code> == 0.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/access.rb</code>.</p></div><h4 id='izmeneniya-slov' class='inside_page_header'><a href="#izmeneniya-slov">5.12.</a> Изменения слов</h4><h5 id='pluralize' class='inside_page_header'><a href="#pluralize">5.12.1.</a> <code>pluralize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-pluralize"><code>pluralize</code></a> возвращает множественное число получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"table"</span><span class="p">.</span><span class="nf">pluralize</span>     <span class="c1"># =&gt; "tables"</span>
<span class="s2">"ruby"</span><span class="p">.</span><span class="nf">pluralize</span>      <span class="c1"># =&gt; "rubies"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">pluralize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
</div>
<p>Как показывает предыдущий пример, Active Support знает некоторые неправильные множественные числа и неисчисляемые существительные. Встроенные правила могут быть расширены в <code>config/initializers/inflections.rb</code>. Этот файл генерируется по умолчанию, командой <code>rails new</code>, и имеет инструкции в комментариях.</p><p><code>pluralize</code> также может принимать опциональный параметр <code>count</code>. Если <code>count == 1</code>, будет возвращена единственная форма. Для остальных значений <code>count</code> будет возвращена множественная форма:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "dude"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
</code></pre>
</div>
<p>Active Record использует этот метод для вычисления дефолтного имени таблицы, соответствующей модели:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># active_record/model_schema.rb</span>
<span class="k">def</span> <span class="nf">undecorated_table_name</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
  <span class="n">table_name</span> <span class="o">=</span> <span class="n">model_name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">pluralize_table_names</span> <span class="p">?</span> <span class="n">table_name</span><span class="p">.</span><span class="nf">pluralize</span> <span class="p">:</span> <span class="n">table_name</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='singularize' class='inside_page_header'><a href="#singularize">5.12.2.</a> <code>singularize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-singularize"><code>singularize</code></a> это противоположность <code>pluralize</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"tables"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "table"</span>
<span class="s2">"rubies"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "ruby"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">singularize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
</div>
<p>Связи вычисляют имя соответствующего связанного дефолтного класса, используя этот метод:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">derive_class_name</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">.</span><span class="nf">singularize</span> <span class="k">if</span> <span class="n">collection?</span>
  <span class="n">class_name</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='camelize' class='inside_page_header'><a href="#camelize">5.12.3.</a> <code>camelize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-camelize"><code>camelize</code></a> возвращает получателя в стиле CamelCase:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"product"</span><span class="p">.</span><span class="nf">camelize</span>    <span class="c1"># =&gt; "Product"</span>
<span class="s2">"admin_user"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "AdminUser"</span>
</code></pre>
</div>
<p>Как правило, об этом методе думают, как о преобразующем пути в классы Ruby или имена модулей, где слэши разделяют пространства имен:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"backoffice/session"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "Backoffice::Session"</span>
</code></pre>
</div>
<p>Например, Action Pack использует этот метод для загрузки класса, предоставляющего определенное хранилище сессии:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># action_controller/metal/session_management.rb</span>
<span class="k">def</span> <span class="nf">session_store</span><span class="o">=</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
  <span class="vc">@@session_store</span> <span class="o">=</span> <span class="n">store</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span>
    <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">Session</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">store</span>
<span class="k">end</span>
</code></pre>
</div>
<p><code>camelize</code> принимает опциональный аргумент, он может быть <code>:upper</code> (по умолчанию) или <code>:lower</code>. В последнем случае первая буква становится строчной:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"visual_effect"</span><span class="p">.</span><span class="nf">camelize</span><span class="p">(</span><span class="ss">:lower</span><span class="p">)</span> <span class="c1"># =&gt; "visualEffect"</span>
</code></pre>
</div>
<p>Это может быть удобно для вычисления имен методов на языке, который следует такому соглашению, например JavaScript.</p><div class="info"><p>Как правило, можно рассматривать <code>camelize</code> как противоположность <code>underscore</code>, хотя бывают случаи, когда это не так: <code>&quot;SSLError&quot;.underscore.camelize</code> возвращает <code>&quot;SslError&quot;</code>. Для поддержки подобных случаев, Active Support позволяет указывать акронимы в <code>config/initializers/inflections.rb</code></p></div><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="p">.</span><span class="nf">acronym</span> <span class="s1">'SSL'</span>
<span class="k">end</span>

<span class="s2">"SSLError"</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "SSLError"</span>
</code></pre>
</div>
<p><code>camelize</code> имеет псевдоним <a href="https://api.rubyonrails.org/classes/String.html#method-i-camelcase"><code>camelcase</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='underscore' class='inside_page_header'><a href="#underscore">5.12.4.</a> <code>underscore</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-underscore"><code>underscore</code></a> делает наоборот, от CamelCase к путям:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">underscore</span>   <span class="c1"># =&gt; "product"</span>
<span class="s2">"AdminUser"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "admin_user"</span>
</code></pre>
</div>
<p>Также преобразует &quot;::&quot; обратно в &quot;/&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Backoffice::Session"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "backoffice/session"</span>
</code></pre>
</div>
<p>и понимает строки, начинающиеся с прописной буквы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"visualEffect"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "visual_effect"</span>
</code></pre>
</div>
<p>хотя <code>underscore</code> не принимает никакие аргументы.</p><p>Rails использует <code>underscore</code> чтобы получить имя классов контроллера в нижнем регистре:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># actionpack/lib/abstract_controller/base.rb</span>
<span class="k">def</span> <span class="nf">controller_path</span>
  <span class="vi">@controller_path</span> <span class="o">||=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">).</span><span class="nf">underscore</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Например, это значение можно получить в <code>params[:controller]</code>.</p><div class="info"><p>Как правило, рассматривайте <code>underscore</code> как противоположность <code>camelize</code>, хотя бывают случаи, когда это не так. Например, <code>&quot;SSLError&quot;.underscore.camelize</code> возвратит <code>&quot;SslError&quot;</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='titleize' class='inside_page_header'><a href="#titleize">5.12.5.</a> <code>titleize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-titleize"><code>titleize</code></a> озаглавит слова в получателе:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"alice in wonderland"</span><span class="p">.</span><span class="nf">titleize</span> <span class="c1"># =&gt; "Alice In Wonderland"</span>
<span class="s2">"fermat's enigma"</span><span class="p">.</span><span class="nf">titleize</span>     <span class="c1"># =&gt; "Fermat's Enigma"</span>
</code></pre>
</div>
<p><code>titleize</code> имеет псевдоним <a href="https://api.rubyonrails.org/classes/String.html#method-i-titlecase"><code>titlecase</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='dasherize' class='inside_page_header'><a href="#dasherize">5.12.6.</a> <code>dasherize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-dasherize"><code>dasherize</code></a> заменяет подчеркивания в получателе дефисами:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">dasherize</span>         <span class="c1"># =&gt; "name"</span>
<span class="s2">"contact_data"</span><span class="p">.</span><span class="nf">dasherize</span> <span class="c1"># =&gt; "contact-data"</span>
</code></pre>
</div>
<p>Сериализатор XML моделей использует этот метод для форматирования имен узлов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># active_model/serializers/xml.rb</span>
<span class="k">def</span> <span class="nf">reformat_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">camelize</span> <span class="k">if</span> <span class="n">camelize?</span>
  <span class="n">dasherize?</span> <span class="p">?</span> <span class="nb">name</span><span class="p">.</span><span class="nf">dasherize</span> <span class="p">:</span> <span class="nb">name</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='demodulize' class='inside_page_header'><a href="#demodulize">5.12.7.</a> <code>demodulize</code></h5><p>Для заданной строки с ограниченным именем константы, <a href="https://api.rubyonrails.org/classes/String.html#method-i-demodulize"><code>demodulize</code></a> возвращает само имя константы, то есть правой части этого:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">demodulize</span>                        <span class="c1"># =&gt; "Product"</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">demodulize</span>    <span class="c1"># =&gt; "UsersController"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">demodulize</span> <span class="c1"># =&gt; "ReservationUtils"</span>
<span class="s2">"::Inflections"</span><span class="p">.</span><span class="nf">demodulize</span>                  <span class="c1"># =&gt; "Inflections"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">demodulize</span>                               <span class="c1"># =&gt; ""</span>
</code></pre>
</div>
<p>Active Record, к примеру, использует этот метод для вычисления имени столбца кэширования счетчика:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">counter_cache_column</span>
  <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">_count"</span>
  <span class="k">elsif</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='deconstantize' class='inside_page_header'><a href="#deconstantize">5.12.8.</a> <code>deconstantize</code></h5><p>У заданной строки с ограниченным выражением ссылки на константу <a href="https://api.rubyonrails.org/classes/String.html#method-i-deconstantize"><code>deconstantize</code></a> убирает самый правый сегмент, в основном оставляя имя контейнера константы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">deconstantize</span>                        <span class="c1"># =&gt; ""</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">deconstantize</span>    <span class="c1"># =&gt; "Backoffice"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">deconstantize</span> <span class="c1"># =&gt; "Admin::Hotel"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='parameterize' class='inside_page_header'><a href="#parameterize">5.12.9.</a> <code>parameterize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-parameterize"><code>parameterize</code></a> нормализует получателя способом, который может использоваться в красивых URL.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "john-smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "kurt-godel"</span>
</code></pre>
</div>
<p>Чтобы сохранить регистр строки, установите аргумент <code>preserve_case</code> в true. По умолчанию <code>preserve_case</code> установлен в false.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "John-Smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "Kurt-Godel"</span>
</code></pre>
</div>
<p>Чтобы использовать произвольный разделитель, переопределите аргумент <code>separator</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "john_smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "kurt_godel"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='tableize' class='inside_page_header'><a href="#tableize">5.12.10.</a> <code>tableize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-tableize"><code>tableize</code></a> - это <code>underscore</code> вместе с <code>pluralize</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Person"</span><span class="p">.</span><span class="nf">tableize</span>      <span class="c1"># =&gt; "people"</span>
<span class="s2">"Invoice"</span><span class="p">.</span><span class="nf">tableize</span>     <span class="c1"># =&gt; "invoices"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">tableize</span> <span class="c1"># =&gt; "invoice_lines"</span>
</code></pre>
</div>
<p>Как правило, <code>tableize</code> возвращает имя таблицы, соответствующей заданной модели для простых случаев. На самом деле фактическая реализация в Active Record не является прямым <code>tableize</code>, так как он также демодулизирует имя класса и проверяет несколько опций, которые могут повлиять на возвращаемую строку.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='classify' class='inside_page_header'><a href="#classify">5.12.11.</a> <code>classify</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-classify"><code>classify</code></a> является противоположностью <code>tableize</code>. Он выдает имя класса, соответствующего имени таблицы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"people"</span><span class="p">.</span><span class="nf">classify</span>        <span class="c1"># =&gt; "Person"</span>
<span class="s2">"invoices"</span><span class="p">.</span><span class="nf">classify</span>      <span class="c1"># =&gt; "Invoice"</span>
<span class="s2">"invoice_lines"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "InvoiceLine"</span>
</code></pre>
</div>
<p>Метод понимает ограниченные имена таблиц:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"highrise_production.companies"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "Company"</span>
</code></pre>
</div>
<p>Отметьте, что <code>classify</code> возвращает имя класса как строку. Можете получить фактический объект класса, вызвав <code>constantize</code> на ней, как объяснено далее.</p><div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='constantize' class='inside_page_header'><a href="#constantize">5.12.12.</a> <code>constantize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-constantize"><code>constantize</code></a> решает выражение, ссылающееся на константу, в его получателе:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"Integer"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; Integer</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
<span class="s2">"M::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; 1</span>
</code></pre>
</div>
<p>Если строка вычисляет неизвестную константу, или ее содержимое даже не является валидным именем константы, <code>constantize</code> вызывает <code>NameError</code>.</p><p>Анализ имени константы с помощью <code>constantize</code> начинается всегда с верхнего уровня <code>Object</code>, даже если нет предшествующих &quot;::&quot;.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">X</span> <span class="o">=</span> <span class="ss">:in_Object</span>
<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="ss">:in_M</span>

  <span class="no">X</span>                 <span class="c1"># =&gt; :in_M</span>
  <span class="s2">"::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; :in_Object</span>
  <span class="s2">"X"</span><span class="p">.</span><span class="nf">constantize</span>   <span class="c1"># =&gt; :in_Object (!)</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Таким образом, в общем случае это не эквивалентно тому, что Ruby сделал бы в том же месте, когда вычислял настоящую константу.</p><p>Тестовые случаи рассыльщика получают тестируемый рассыльщик из имени класса теста, используя <code>constantize</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># action_mailer/test_case.rb</span>
<span class="k">def</span> <span class="nf">determine_default_mailer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Test"</span><span class="p">).</span><span class="nf">constantize</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="no">NonInferrableMailerError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='humanize' class='inside_page_header'><a href="#humanize">5.12.13.</a> <code>humanize</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-humanize"><code>humanize</code></a> настраивает имя атрибута для отображения конечным пользователям.</p><p>В частности, он выполняет эти преобразования:</p><ul><li>Применяет правила словоизменения к аргументу.
</li><li>Удаляет любые предшествующие знаки подчеркивания.
</li><li>Убирает суффикс &quot;_id&quot;.
</li><li>Заменяет знаки подчеркивания пробелами.
</li><li>Переводит в нижний регистр все слова, кроме акронимов.
</li><li>Озаглавливает первое слово.
</li></ul><p>Озаглавливание первого слова может быть выключено с помощью установки опции <code>:capitalize</code> в false (по умолчанию true).</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">humanize</span>                         <span class="c1"># =&gt; "Name"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span>                    <span class="c1"># =&gt; "Author"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span><span class="p">(</span><span class="ss">capitalize: </span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "author"</span>
<span class="s2">"comments_count"</span><span class="p">.</span><span class="nf">humanize</span>               <span class="c1"># =&gt; "Comments count"</span>
<span class="s2">"_id"</span><span class="p">.</span><span class="nf">humanize</span>                          <span class="c1"># =&gt; "Id"</span>
</code></pre>
</div>
<p>Если &quot;SSL&quot; был определен как акроним:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s1">'ssl_error'</span><span class="p">.</span><span class="nf">humanize</span> <span class="c1"># =&gt; "SSL error"</span>
</code></pre>
</div>
<p>Метод хелпера <code>full_messages</code> использует <code>humanize</code> как резервный способ для включения имен атрибутов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">full_messages</span>
  <span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="n">full_message</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">full_message</span>
  <span class="c1"># ...</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">).</span><span class="nf">humanize</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="vi">@base</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">default: </span><span class="n">attr_name</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='foreign_key' class='inside_page_header'><a href="#foreign_key">5.12.14.</a> <code>foreign_key</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-foreign_key"><code>foreign_key</code></a> дает имя столбца внешнего ключа из имени класса. Чтобы это сделать он демодулизирует, подчеркивает и добавляет &quot;_id&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span>           <span class="c1"># =&gt; "user_id"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">foreign_key</span>    <span class="c1"># =&gt; "invoice_line_id"</span>
<span class="s2">"Admin::Session"</span><span class="p">.</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; "session_id"</span>
</code></pre>
</div>
<p>Передайте аргумент false, если не хотите подчеркивание в &quot;_id&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "userid"</span>
</code></pre>
</div>
<p>Связи используют этот метод для вывода внешних ключей, например <code>has_one</code> и <code>has_many</code> делают так:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># active_record/associations.rb</span>
<span class="n">foreign_key</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:foreign_key</span><span class="p">]</span> <span class="o">||</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">foreign_key</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='upcase_first' class='inside_page_header'><a href="#upcase_first">5.12.15.</a> <code>upcase_first</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-upcase_first"><code>upcase_first</code></a> озаглавливает первую букву получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"employee salary"</span><span class="p">.</span><span class="nf">upcase_first</span> <span class="c1"># =&gt; "Employee salary"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">upcase_first</span>                <span class="c1"># =&gt; ""</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h5 id='downcase_first' class='inside_page_header'><a href="#downcase_first">5.12.16.</a> <code>downcase_first</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/String.html#method-i-downcase_first"><code>downcase_first</code></a> конвертирует первую букву получателя в нижний регистр:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"If I had read Alice in Wonderland"</span><span class="p">.</span><span class="nf">downcase_first</span> <span class="c1"># =&gt; "if I had read Alice in Wonderland"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">downcase_first</span>                                  <span class="c1"># =&gt; ""</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/string/inflections.rb</code>.</p></div><h4 id='konvertirovanie' class='inside_page_header'><a href="#konvertirovanie">5.13.</a> Конвертирование</h4><h5 id='to_date-to_time-to_datetime' class='inside_page_header'><a href="#to_date-to_time-to_datetime">5.13.1.</a> <code>to_date</code>, <code>to_time</code>, <code>to_datetime</code></h5><p>Методы <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_date"><code>to_date</code></a>, <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_time"><code>to_time</code></a> и <a href="https://api.rubyonrails.org/classes/String.html#method-i-to_datetime"><code>to_datetime</code></a> - в основном удобные обертки для <code>Date._parse</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"2010-07-27"</span><span class="p">.</span><span class="nf">to_date</span>              <span class="c1"># =&gt; Tue, 27 Jul 2010</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_time</span>     <span class="c1"># =&gt; 2010-07-27 23:37:00 +0200</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_datetime</span> <span class="c1"># =&gt; Tue, 27 Jul 2010 23:37:00 +0000</span>
</code></pre>
</div>
<p><code>to_time</code> получает опциональный аргумент <code>:utc</code> или <code>:local</code>, для указания, время какой временной зоны необходимо:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:utc</span><span class="p">)</span>   <span class="c1"># =&gt; 2010-07-27 23:42:00 UTC</span>
<span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:local</span><span class="p">)</span> <span class="c1"># =&gt; 2010-07-27 23:42:00 +0200</span>
</code></pre>
</div>
<p>По умолчанию <code>:local</code>.</p><p>Пожалуйста, обратитесь к документации по <code>Date._parse</code> для получения дополнительной информации.</p><div class="info"><p>Все три возвратят <code>nil</code> для пустых получателей.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/string/conversions.rb</code>.</p></div><h3 id='rasshireniya-dlya-symbol' class='inside_page_header'><a href="#rasshireniya-dlya-symbol">6.</a> Расширения для <code>Symbol</code></h3><h4 id='starts_with-i-ends_with2' class='inside_page_header'><a href="#starts_with-i-ends_with2">6.1.</a> <code>starts_with?</code> и <code>ends_with?</code></h4><p>Active Support определяет сторонние псевдонимы для <code>Symbol#start_with?</code> и <code>Symbol#end_with?</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="ss">:foo</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="ss">:foo</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/symbol/starts_ends_with.rb</code>.</p></div><h3 id='rasshireniya-dlya-numeric' class='inside_page_header'><a href="#rasshireniya-dlya-numeric">7.</a> Расширения для <code>Numeric</code></h3><h4 id='bayty' class='inside_page_header'><a href="#bayty">7.1.</a> Байты</h4><p>Все числа отвечают на эти методы:</p><ul><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-bytes"><code>bytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-kilobytes"><code>kilobytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-megabytes"><code>megabytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-gigabytes"><code>gigabytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-terabytes"><code>terabytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-petabytes"><code>petabytes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-exabytes"><code>exabytes</code></a>
</li></ul><p>Они возвращают соответствующее количество байтов, используя конвертирующий множитель 1024:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">kilobytes</span>   <span class="c1"># =&gt; 2048</span>
<span class="mi">3</span><span class="p">.</span><span class="nf">megabytes</span>   <span class="c1"># =&gt; 3145728</span>
<span class="mf">3.5</span><span class="p">.</span><span class="nf">gigabytes</span> <span class="c1"># =&gt; 3758096384</span>
<span class="o">-</span><span class="mi">4</span><span class="p">.</span><span class="nf">exabytes</span>   <span class="c1"># =&gt; -4611686018427387904</span>
</code></pre>
</div>
<p>Форма в единственном числе является псевдонимом, поэтому можно написать так:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">megabyte</span> <span class="c1"># =&gt; 1048576</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/numeric/bytes.rb</code>.</p></div><h4 id='vremya' class='inside_page_header'><a href="#vremya">7.2.</a> Время</h4><p>Следующие методы:</p><ul><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-seconds"><code>seconds</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-minutes"><code>minutes</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-hours"><code>hours</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-days"><code>days</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-weeks"><code>weeks</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Numeric.html#method-i-fortnights"><code>fortnights</code></a>
</li></ul><p>включают вычисление и объявление времени, наподобие <code>45.minutes + 2.hours + 4.weeks</code>. Их возвращаемое значение также может быть добавлено или вычтено из объектов Time.</p><p>Эти методы могут быть объединены с <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-from_now"><code>from_now</code></a>, <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-ago"><code>ago</code></a> и так далее для уточнения вычисления даты. Например:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># эквивалент для Time.current.advance(days: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># эквивалент для Time.current.advance(weeks: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">weeks</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># эквивалент для Time.current.advance(days: 4, weeks: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">days</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">weeks</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
</div>
<div class="warning"><p>Для других длительностей, обратитесь, пожалуйста, к временному расширению для <code>Integer</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/numeric/time.rb</code></p></div><h4 id='formatirovanie' class='inside_page_header'><a href="#formatirovanie">7.3.</a> Форматирование</h4><p>Включает форматирование чисел различными способами.</p><p>Преобразует число в строковое представление телефонного номера:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">5551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 123-555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">" "</span><span class="p">)</span>
<span class="c1"># =&gt; 123 555 1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">extension: </span><span class="mi">555</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234 x 555</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">country_code: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; +1-123-555-1234</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление валюты:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mf">1234567890.50</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                 <span class="c1"># =&gt; $1,234,567,890.50</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                <span class="c1"># =&gt; $1,234,567,890.51</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:currency</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># =&gt; $1,234,567,890.506</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление процентов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">100</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">)</span>
<span class="c1"># =&gt; 100.000%</span>
<span class="mi">100</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 100%</span>
<span class="mi">1000</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s1">'.'</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">','</span><span class="p">)</span>
<span class="c1"># =&gt; 1.000,000%</span>
<span class="mf">302.24398923423</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># =&gt; 302.24399%</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление числа с разделенными разрядами:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                  <span class="c1"># =&gt; 12,345,678.05</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">"."</span><span class="p">)</span>     <span class="c1"># =&gt; 12.345.678</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">","</span><span class="p">)</span>     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">" "</span><span class="p">)</span>  <span class="c1"># =&gt; 12,345,678 05</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление числа, округленного с определенной точностью:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">)</span>                     <span class="c1"># =&gt; 111.235</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># =&gt; 111.23</span>
<span class="mi">13</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>             <span class="c1"># =&gt; 13.00000</span>
<span class="mf">389.32314</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># =&gt; 389</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">significant: </span><span class="kp">true</span><span class="p">)</span>  <span class="c1"># =&gt; 111</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление с удобочитаемым количеством байт:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                  <span class="c1"># =&gt; 123 Bytes</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                 <span class="c1"># =&gt; 1.21 KB</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                <span class="c1"># =&gt; 12.1 KB</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>              <span class="c1"># =&gt; 1.18 MB</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>           <span class="c1"># =&gt; 1.15 GB</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>        <span class="c1"># =&gt; 1.12 TB</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>     <span class="c1"># =&gt; 1.1 PB</span>
<span class="mi">1234567890123456789</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>  <span class="c1"># =&gt; 1.07 EB</span>
</code></pre>
</div>
<p>Преобразует число в строковое представление с удобочитаемым числом слов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>               <span class="c1"># =&gt; "123"</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>              <span class="c1"># =&gt; "1.23 Thousand"</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>             <span class="c1"># =&gt; "12.3 Thousand"</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>           <span class="c1"># =&gt; "1.23 Million"</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>        <span class="c1"># =&gt; "1.23 Billion"</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>     <span class="c1"># =&gt; "1.23 Trillion"</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>  <span class="c1"># =&gt; "1.23 Quadrillion"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/numeric/conversions.rb</code>.</p></div><h3 id='rasshireniya-dlya-integer' class='inside_page_header'><a href="#rasshireniya-dlya-integer">8.</a> Расширения для <code>Integer</code></h3><h4 id='multiple_of' class='inside_page_header'><a href="#multiple_of">8.1.</a> <code>multiple_of?</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-multiple_of-3F"><code>multiple_of?</code></a> проверяет, является ли целое число множителем аргумента:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/integer/multiple.rb</code>.</p></div><h4 id='ordinal' class='inside_page_header'><a href="#ordinal">8.2.</a> <code>ordinal</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-ordinal"><code>ordinal</code></a> возвращает суффикс порядковой строки, соответствующей полученному целому числу:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinal</span>   <span class="c1"># =&gt; "rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinal</span>  <span class="c1"># =&gt; "st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id='ordinalize' class='inside_page_header'><a href="#ordinalize">8.3.</a> <code>ordinalize</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Integer.html#method-i-ordinalize"><code>ordinalize</code></a> возвращает порядковую строку, соответствующую полученному целому числу. Для сравнения отметьте, что метод <code>ordinal</code> возвращает <strong>только</strong> строковый суффикс.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "1st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "2nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinalize</span>   <span class="c1"># =&gt; "53rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "2009th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinalize</span>  <span class="c1"># =&gt; "-21st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "-134th"</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/integer/inflections.rb</code>.</p></div><h4 id='vremya2' class='inside_page_header'><a href="#vremya2">8.4.</a> Время</h4><p>Следующие методы:</p><ul><li><a href="https://api.rubyonrails.org/classes/Integer.html#method-i-months"><code>months</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/Integer.html#method-i-years"><code>years</code></a>
</li></ul><p>включают объявление и вычисление времени, подобно <code>4.months + 5.years</code>. Их возвращаемое значение также может быть добавлено или вычтено из объектов Time.</p><p>Эти методы могут быть объединены с <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-from_now"><code>from_now</code></a>, <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html#method-i-ago"><code>ago</code></a> и так далее для уточнения вычисления даты. Например:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># эквивалент для Time.current.advance(months: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">month</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># эквивалент для Time.current.advance(years: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">years</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># эквивалент для Time.current.advance(months: 4, years: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">months</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">years</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
</div>
<div class="warning"><p>Для других длительностей, обратитесь, пожалуйста, к временному расширению для <code>Numeric</code>.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/integer/time.rb</code>.</p></div><h3 id='rasshireniya-dlya-bigdecimal' class='inside_page_header'><a href="#rasshireniya-dlya-bigdecimal">9.</a> Расширения для <code>BigDecimal</code></h3><h4 id='to_s' class='inside_page_header'><a href="#to_s">9.1.</a> <code>to_s</code></h4><p>Метод <code>to_s</code> предоставляет спецификатор по умолчанию для &quot;F&quot;. Это означает, что простой вызов <code>to_s</code> приведет к представлению с плавающей запятой вместо инженерной нотации:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span>       <span class="c1"># =&gt; "5.0"</span>
</code></pre>
</div>
<p>Инженерная нотация все еще поддерживается:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>  <span class="c1"># =&gt; "0.5E1"</span>
</code></pre>
</div>
<h3 id='rasshireniya-dlya-enumerable' class='inside_page_header'><a href="#rasshireniya-dlya-enumerable">10.</a> Расширения для <code>Enumerable</code></h3><h4 id='sum' class='inside_page_header'><a href="#sum">10.1.</a> <code>sum</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-sum"><code>sum</code></a> складывает элементы перечисления:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">sum</span> <span class="c1"># =&gt; 6</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">).</span><span class="nf">sum</span>  <span class="c1"># =&gt; 5050</span>
</code></pre>
</div>
<p>Сложение применяется только к элементам, откликающимся на <code>+</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]].</span><span class="nf">sum</span>    <span class="c1"># =&gt; [1, 2, 2, 3, 3, 4]</span>
<span class="sx">%w(foo bar baz)</span><span class="p">.</span><span class="nf">sum</span>             <span class="c1"># =&gt; "foobarbaz"</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">3</span><span class="p">}.</span><span class="nf">sum</span>          <span class="c1"># =&gt; [:a, 1, :b, 2, :c, 3]</span>
</code></pre>
</div>
<p>Сумма пустой коллекции равна нулю по умолчанию, но это может быть настроено:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 0</span>
<span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>
</code></pre>
</div>
<p>Если задан блок, <code>sum</code> становится итератором, вкладывающим элементы коллекции и суммирующим возвращаемые значения:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">sum</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span> <span class="c1"># =&gt; 30</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 30</span>
</code></pre>
</div>
<p>Сумма пустого получателя также может быть настроена в такой форме:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">**</span><span class="mi">3</span><span class="p">}</span> <span class="c1"># =&gt; 1</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='index_by' class='inside_page_header'><a href="#index_by">10.2.</a> <code>index_by</code></h4><p>Метод [<code>index_by</code>][Enumerable#index_by] генерирует хэш с элементами перечисления, индексированными по некоторому ключу.</p><p>Он перебирает коллекцию и передает каждый элемент в блок. Значение, возвращенное блоком, будет ключом для элемента:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">invoices</span><span class="p">.</span><span class="nf">index_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:number</span><span class="p">)</span>
<span class="c1"># =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}</span>
</code></pre>
</div>
<div class="warning"><p>Ключи, как правило, должны быть уникальными. Если блок возвратит одно и то же значение для нескольких элементов, для этого ключа не будет построена коллекция. А значение получит последний элемент.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><p>[<code>index_by</code>][Enumerable#index_by]</p><h4 id='index_with' class='inside_page_header'><a href="#index_with">10.3.</a> <code>index_with</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-index_with"><code>index_with</code></a> генерирует хэш с элементами перечисления в качестве ключей. Значение является либо переданным по умолчанию, либо возвращенным в блоке.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"hey there"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"what's up?"</span><span class="p">)</span>

<span class="sx">%i( title body )</span><span class="p">.</span><span class="nf">index_with</span> <span class="p">{</span> <span class="o">|</span><span class="n">attr_name</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; { title: "hey there", body: "what's up?" }</span>

<span class="no">WEEKDAYS</span><span class="p">.</span><span class="nf">index_with</span><span class="p">([</span><span class="no">Interval</span><span class="p">.</span><span class="nf">all_day</span><span class="p">])</span>
<span class="c1"># =&gt; { monday: [ 0, 1440 ], … }</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='many' class='inside_page_header'><a href="#many">10.4.</a> <code>many?</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-many-3F"><code>many?</code></a> это сокращение для <code>collection.size &gt; 1</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">pages</span><span class="p">.</span><span class="nf">many?</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">pagination_links</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Если задан опциональный блок, <code>many?</code> учитывает только те элементы, которые возвращают true:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@see_more</span> <span class="o">=</span> <span class="n">videos</span><span class="p">.</span><span class="nf">many?</span> <span class="p">{</span><span class="o">|</span><span class="n">video</span><span class="o">|</span> <span class="n">video</span><span class="p">.</span><span class="nf">category</span> <span class="o">==</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]}</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='exclude' class='inside_page_header'><a href="#exclude">10.5.</a> <code>exclude?</code></h4><p>Предикат <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-exclude-3F"><code>exclude?</code></a> проверяет, является ли заданный объект <strong>не</strong> принадлежащим коллекции. Это противоположность встроенного <code>include?</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">to_visit</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">visited</span><span class="p">.</span><span class="nf">exclude?</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='including' class='inside_page_header'><a href="#including">10.6.</a> <code>including</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-including"><code>including</code></a> возвращает новое перечисление, включающее переданные элементы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>                    <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">].</span><span class="nf">including</span> <span class="sx">%w[ Aaron Todd ]</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron", "Todd"]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='excluding' class='inside_page_header'><a href="#excluding">10.7.</a> <code>excluding</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-excluding"><code>excluding</code></a> возвращает копию перечисления без указанных элементов:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
</code></pre>
</div>
<p>У <code>excluding</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-without"><code>without</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='pluck' class='inside_page_header'><a href="#pluck">10.8.</a> <code>pluck</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-pluck"><code>pluck</code></a> возвращает массив на основе заданного ключа:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron"]</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [[1, "David"], [2, "Rafael"]]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h4 id='pick' class='inside_page_header'><a href="#pick">10.9.</a> <code>pick</code></h4><p>Метод<a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-pick"><code>pick</code></a> извлекает заданный ключ из первого элемента:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; "David"</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [1, "David"]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/enumerable.rb</code>.</p></div><h3 id='rasshireniya-dlya-array' class='inside_page_header'><a href="#rasshireniya-dlya-array">11.</a> Расширения для <code>Array</code></h3><h4 id='dostup2' class='inside_page_header'><a href="#dostup2">11.1.</a> Доступ</h4><p>Active Support расширяет API массивов для облегчения нескольких способов доступа к ним. Например, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to"><code>to</code></a> возвращает подмассив элементов от первого до переданного индекса:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; ["a", "b", "c"]</span>
<span class="p">[].</span><span class="nf">to</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>          <span class="c1"># =&gt; []</span>
</code></pre>
</div>
<p>По аналогии, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-from"><code>from</code></a> возвращает хвост массива, количество элементов которого равно переданному индексу. Если индекс больше длины массива, возвращается пустой массив.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; ["c", "d"]</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; []</span>
<span class="p">[].</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           <span class="c1"># =&gt; []</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-including"><code>including</code></a> возвращает новый массив, включающий переданные элементы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>          <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">].</span><span class="nf">including</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span> <span class="c1"># =&gt; [ [ 0, 1 ], [ 1, 0 ] ]</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-excluding"><code>excluding</code></a> возвращает копию Array с исключенными указанными элементами. Это оптимизация <code>Enumerable#excluding</code>, использующая <code>Array#-</code> вместо <code>Array#reject</code> по причинам производительности.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">].</span><span class="nf">excluding</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span>                  <span class="c1"># =&gt; [ [ 0, 1 ] ]</span>
</code></pre>
</div>
<p>Методы <a href="https://api.rubyonrails.org/classes/Array.html#method-i-second"><code>second</code></a>, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-third"><code>third</code></a>, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-fourth"><code>fourth</code></a> и <a href="https://api.rubyonrails.org/classes/Array.html#method-i-fifth"><code>fifth</code></a> возвращают соответствующие элементы, так же как <a href="https://api.rubyonrails.org/classes/Array.html#method-i-second_to_last"><code>second_to_last</code></a> и <a href="https://api.rubyonrails.org/classes/Array.html#method-i-third_to_last"><code>third_to_last</code></a> (<code>first</code> и <code>last</code> являются встроенными). Благодаря <a href="https://ru.wikipedia.org/wiki/%D0%9E%D1%82%D0%B2%D0%B5%D1%82_%D0%BD%D0%B0_%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D1%8B%D0%B9_%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81_%D0%B6%D0%B8%D0%B7%D0%BD%D0%B8,_%D0%B2%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE%D0%B9_%D0%B8_%D0%B2%D1%81%D0%B5%D0%B3%D0%BE_%D1%82%D0%B0%D0%BA%D0%BE%D0%B3%D0%BE">социальной мудрости и всеобщей позитивной конструктивности</a>, <a href="https://api.rubyonrails.org/classes/Array.html#method-i-forty_two"><code>forty_two</code></a> также доступен.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">third</span> <span class="c1"># =&gt; "c"</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">fifth</span> <span class="c1"># =&gt; nil</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/array/access.rb</code>.</p></div><h4 id='izvlechenie' class='inside_page_header'><a href="#izvlechenie">11.2.</a> Извлечение</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-extract-21"><code>extract!</code></a> убирает и возвращает элементы, для которых блок возвращает истинное значение. Если блок не задан, вместо этого возвратиться Enumerator.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">odd_numbers</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">extract!</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span><span class="p">.</span><span class="nf">odd?</span> <span class="p">}</span> <span class="c1"># =&gt; [1, 3, 5, 7, 9]</span>
<span class="n">numbers</span> <span class="c1"># =&gt; [0, 2, 4, 6, 8]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/array/extract.rb</code>.</p></div><h4 id='izvlechenie-optsiy' class='inside_page_header'><a href="#izvlechenie-optsiy">11.3.</a> Извлечение опций</h4><p>Когда последний аргумент в вызове метода является хэшем, за исключением, пожалуй, аргумента <code>&amp;block</code>, Ruby позволяет опустить скобки:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">])</span>
</code></pre>
</div>
<p>Этот синтаксический сахар часто используется в Rails для избежания позиционных аргументов там, где их не слишком много, предлагая вместо них интерфейсы, эмулирующие именованные параметры. В частности, очень характерно использовать такой хэш для опций.</p><p>Если метод ожидает различное количество аргументов и использует <code>*</code> в своем объявлении, однако хэш опций завершает их и является последним элементом массива аргументов, тогда тип теряет свою роль.</p><p>В этих случаях можно задать хэшу опций отличительную трактовку с помощью <a href="https://api.rubyonrails.org/classes/Array.html#method-i-extract_options-21"><code>extract_options!</code></a>. Метод проверяет тип последнего элемента массива. Если это хэш, он вырезает его и возвращает, в противном случае возвращает пустой хэш.</p><p>Давайте рассмотрим пример определения макроса контроллера <code>caches_action</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">caches_action</span><span class="p">(</span><span class="o">*</span><span class="n">actions</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="n">cache_configured?</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">actions</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Этот метод получает произвольное число имен экшнов и опциональный хэш опций как последний аргумент. Вызвав <code>extract_options!</code>, получаем хэш опций и убираем его из <code>actions</code> простым и явным способом.</p><div class="note"><p>Определено в <code>active_support/core_ext/array/extract_options.rb</code>.</p></div><h4 id='preobrazovanie2' class='inside_page_header'><a href="#preobrazovanie2">11.4.</a> Преобразование</h4><h5 id='to_sentence' class='inside_page_header'><a href="#to_sentence">11.4.1.</a> <code>to_sentence</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_sentence"><code>to_sentence</code></a> превращает массив в строку, содержащую предложение, в котором перечисляются элементы массива:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w()</span><span class="p">.</span><span class="nf">to_sentence</span>                <span class="c1"># =&gt; ""</span>
<span class="sx">%w(Earth)</span><span class="p">.</span><span class="nf">to_sentence</span>           <span class="c1"># =&gt; "Earth"</span>
<span class="sx">%w(Earth Wind)</span><span class="p">.</span><span class="nf">to_sentence</span>      <span class="c1"># =&gt; "Earth and Wind"</span>
<span class="sx">%w(Earth Wind Fire)</span><span class="p">.</span><span class="nf">to_sentence</span> <span class="c1"># =&gt; "Earth, Wind, and Fire"</span>
</code></pre>
</div>
<p>Этот метод принимает три опции:</p><ul><li><code>:two_words_connector</code>: Что используется для массивов с длиной 2. По умолчанию &quot; and &quot;.
</li><li><code>:words_connector</code>: Что используется для соединения элементов массивов с 3 и более элементами, кроме последних двух. По умолчанию &quot;, &quot;.
</li><li><code>:last_word_connector</code>: Что используется для соединения последних элементов массива из 3 и более элементов. По умолчанию &quot;, and &quot;.
</li></ul><p>По умолчанию эти опции могут быть локализованы, их ключи следующие:</p><table class='table table-striped'><tr>
<th>Опция</th>
<th>Ключ I18n</th>
</tr>
<tr>
<td><code>:two_words_connector</code></td>
<td><code>support.array.two_words_connector</code></td>
</tr>
<tr>
<td><code>:words_connector</code></td>
<td><code>support.array.words_connector</code></td>
</tr>
<tr>
<td><code>:last_word_connector</code></td>
<td><code>support.array.last_word_connector</code></td>
</tr>
</table><div class="note"><p>Определено в <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h5 id='to_fs' class='inside_page_header'><a href="#to_fs">11.4.2.</a> <code>to_fs</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_fs"><code>to_fs</code></a> по умолчанию работает как <code>to_s</code>.</p><p>Однако, если массив содержит элементы, откликающиеся на <code>id</code>, как аргумент можно передать символ <code>:db</code>. Это обычно используется с коллекциями объектов Active Record. Возвращаемые строки следующие:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>            <span class="c1"># =&gt; "null"</span>
<span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>        <span class="c1"># =&gt; "8456"</span>
<span class="n">invoice</span><span class="p">.</span><span class="nf">lines</span><span class="p">.</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span> <span class="c1"># =&gt; "23,567,556,12"</span>
</code></pre>
</div>
<p>Целые числа в примере выше предполагается, что приходят от соответствующих вызовов <code>id</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h5 id='to_xml' class='inside_page_header'><a href="#to_xml">11.4.3.</a> <code>to_xml</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-to_xml"><code>to_xml</code></a> возвращает строку, содержащую представление XML его получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors type="array"&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre>
</div>
<p>Чтобы это сделать, он посылает <code>to_xml</code> к каждому элементу за раз и собирает результаты в корневом узле. Все элементы должны откликаться на <code>to_xml</code>, иначе будет вызвано исключение.</p><p>По умолчанию имя корневого элемента - это подчеркнутое и <code>dasherize</code> имя класса первого элемента во множественном числе, при условии что остальные элементы принадлежат этому типу (проверяется с помощью <code>is_a?</code>) и они не являются хэшами. В примере выше это &quot;contributors&quot;.</p><p>Если есть какой-либо элемент, не принадлежащий типу первого, корневой узел становится &quot;objects&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="no">Contributor</span><span class="p">.</span><span class="nf">first</span><span class="p">,</span> <span class="no">Commit</span><span class="p">.</span><span class="nf">first</span><span class="p">].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;4583&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Aaron Batalion&lt;/name&gt;</span>
<span class="c1">#     &lt;rank type="integer"&gt;53&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;author&gt;Joshua Peek&lt;/author&gt;</span>
<span class="c1">#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;</span>
<span class="c1">#     &lt;branch&gt;origin/master&lt;/branch&gt;</span>
<span class="c1">#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;</span>
<span class="c1">#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;</span>
<span class="c1">#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;</span>
<span class="c1">#     &lt;id type="integer"&gt;190316&lt;/id&gt;</span>
<span class="c1">#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;</span>
<span class="c1">#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;</span>
<span class="c1">#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre>
</div>
<p>Если получатель является массивом хэшей, корневой элемент по умолчанию также &quot;objects&quot;:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">}].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;b type="integer"&gt;2&lt;/b&gt;</span>
<span class="c1">#     &lt;a type="integer"&gt;1&lt;/a&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1">#   &lt;object&gt;</span>
<span class="c1">#     &lt;c type="integer"&gt;3&lt;/c&gt;</span>
<span class="c1">#   &lt;/object&gt;</span>
<span class="c1"># &lt;/objects&gt;</span>
</code></pre>
</div>
<div class="warning"><p>Если коллекция пустая, корневой элемент по умолчанию &quot;nil-classes&quot;. Пример для понимания, корневой элемент вышеописанного списка вкладчиков будет не &quot;contributors&quot;, если коллекция пустая, а &quot;nil-classes&quot;. Можно использовать опцию <code>:root</code> для обеспечения согласованного корневого элемента.</p></div><p>Имя дочерних узлов по умолчанию является именем корневого узла в единственном числе. В вышеприведенных примерах мы видели &quot;contributor&quot; и &quot;object&quot;. Опция <code>:children</code> позволяет установить эти имена узлов.</p><p>По умолчанию билдер XML является свежим экземпляром <code>Builder::XmlMarkup</code>. Можно сконфигурировать свой собственный билдер через опцию <code>:builder</code>. Метод также принимает опции, такие как <code>:dasherize</code> и ему подобные, они перенаправляются в билдер:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span><span class="p">(</span><span class="ss">skip_types: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4356&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;1&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1">#   &lt;contributor&gt;</span>
<span class="c1">#     &lt;id&gt;4404&lt;/id&gt;</span>
<span class="c1">#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1">#     &lt;rank&gt;2&lt;/rank&gt;</span>
<span class="c1">#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1">#   &lt;/contributor&gt;</span>
<span class="c1"># &lt;/contributors&gt;</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/array/conversions.rb</code>.</p></div><h4 id='oborachivanie' class='inside_page_header'><a href="#oborachivanie">11.5.</a> Оборачивание</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-c-wrap"><code>Array.wrap</code></a> оборачивает свои аргументы в массив, кроме случая когда это уже массив (или массивоподобные).</p><p>А именно:</p><ul><li>Если аргумент <code>nil</code>, возвращается пустой массив.
</li><li>В противном случае, если аргумент откликается на <code>to_ary</code>, он вызывается, и, если значение <code>to_ary</code> не <code>nil</code>, оно возвращается.
</li><li>В противном случае, возвращается массив с аргументом в качестве его первого элемента.
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>       <span class="c1"># =&gt; []</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># =&gt; [1, 2, 3]</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>         <span class="c1"># =&gt; [0]</span>
</code></pre>
</div>
<p>Этот метод похож на <code>Kernel#Array</code>, но с некоторыми отличиями:</p><ul><li>Если аргумент откликается на <code>to_ary</code>, метод вызывается. <code>Kernel#Array</code> начинает пробовать <code>to_a</code>, если вернувшееся значение <code>nil</code>, а <code>Arraw.wrap</code> сразу возвращает массив с аргументом в качестве единственного элемента.
</li><li>Если возвращаемое значение от <code>to_ary</code> и не <code>nil</code>, и не объект <code>Array</code>, то <code>Kernel#Array</code> вызывает исключение, в то время как <code>Array.wrap</code> нет, он просто возвращает значение.
</li><li>Он не вызывает <code>to_a</code> на аргументе, если аргумент не откликается на <code>to_ary</code>, а возвращает массив с аргументом в качестве своего единственного элемента.
</li></ul><p>Последний пункт особенно заметен для некоторых перечислений:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span> <span class="c1"># =&gt; [{:foo=&gt;:bar}]</span>
<span class="no">Array</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span>      <span class="c1"># =&gt; [[:foo, :bar]]</span>
</code></pre>
</div>
<p>Также имеется связанная идиома, использующая оператор расплющивания:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="o">*</span><span class="n">object</span><span class="p">]</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/array/wrap.rb</code>.</p></div><h4 id='dublirovanie' class='inside_page_header'><a href="#dublirovanie">11.6.</a> Дублирование</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-deep_dup"><code>Array#deep_dup</code></a> дублирует себя и все объекты внутри рекурсивно с помощью метода Active Support <code>Object#deep_dup</code>. Он работает так же, как <code>Array#map</code>, посылая метод <code>deep_dup</code> для каждого объекта внутри.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="nb">dup</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id='gruppirovka' class='inside_page_header'><a href="#gruppirovka">11.7.</a> Группировка</h4><h5 id='in_groups_of-number-fill_with-nil' class='inside_page_header'><a href="#in_groups_of-number-fill_with-nil">11.7.1.</a> <code>in_groups_of(number, fill_with = nil)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-in_groups_of"><code>in_groups_of</code></a> разделяет массив на последовательные группы определенного размера. Он возвращает массив с группами:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, nil]]</span>
</code></pre>
</div>
<p>или выдает их по очереди, если передается блок:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">sample</span><span class="p">.</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">a</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">b</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">c</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Первый пример показывает, как <code>in_groups_of</code> заполняет последнюю группу столькими элементами <code>nil</code>, сколько нужно, чтобы получить требуемый размер. Можно изменить это набивочное значение используя второй опциональный аргумент:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, 0]]</span>
</code></pre>
</div>
<p>Наконец, можно сказать методу не заполнять последнюю группу, передав <code>false</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3]]</span>
</code></pre>
</div>
<p>Как следствие <code>false</code> не может использоваться как набивочное значение.</p><div class="note"><p>Определено в <code>active_support/core_ext/array/grouping.rb</code>.</p></div><h5 id='in_groups-number-fill_with-nil' class='inside_page_header'><a href="#in_groups-number-fill_with-nil">11.7.2.</a> <code>in_groups(number, fill_with = nil)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-in_groups"><code>in_groups</code></a> разделяет массив на определенное количество групп. Метод возвращает массив с группами:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]</span>
</code></pre>
</div>
<p>или выдает их по очереди, если передается блок:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">group</span><span class="o">|</span> <span class="nb">p</span> <span class="n">group</span><span class="p">}</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
</code></pre>
</div>
<p>Примеры выше показывают, что <code>in_groups</code> заполняет некоторые группы с помощью заключительного элемента <code>nil</code>, если необходимо. Группа может получить не более одного из этих дополнительных элементов, самый правый, если таковой имеется. И группы, получившие его, будут всегда последние.</p><p>Можно изменить это набивочное значение, используя второй опциональный аргумент:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]</span>
</code></pre>
</div>
<p>Также можно сказать методу не заполнять меньшие группы, передав <code>false</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]</span>
</code></pre>
</div>
<p>Как следствие, <code>false</code> не может быть набивочным значением.</p><div class="note"><p>Определено в <code>active_support/core_ext/array/grouping.rb</code>.</p></div><h5 id='split-value-nil' class='inside_page_header'><a href="#split-value-nil">11.7.3.</a> <code>split(value = nil)</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Array.html#method-i-split"><code>split</code></a> разделяет массив разделителем и возвращает получившиеся куски.</p><p>Если передан блок, разделителями будут те элементы массива, для которых блок возвращает true:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">split</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]</span>
</code></pre>
</div>
<p>В противном случае, значение, полученное как аргумент, которое по умолчанию является <code>nil</code>, будет разделителем:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; [[0], [-5], [], ["foo", "bar"]]</span>
</code></pre>
</div>
<div class="info"><p>Отметьте, в предыдущем примере, что последовательные разделители приводят к пустым массивам.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/array/grouping.rb</code>.</p></div><h3 id='rasshireniya-dlya-hash' class='inside_page_header'><a href="#rasshireniya-dlya-hash">12.</a> Расширения для <code>Hash</code></h3><h4 id='konversiya' class='inside_page_header'><a href="#konversiya">12.1.</a> Конверсия</h4><h5 id='to_xml2' class='inside_page_header'><a href="#to_xml2">12.1.1.</a> <code>to_xml</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_xml"><code>to_xml</code></a> возвращает строку, содержащую представление XML его получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}.</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;hash&gt;</span>
<span class="c1">#   &lt;foo type="integer"&gt;1&lt;/foo&gt;</span>
<span class="c1">#   &lt;bar type="integer"&gt;2&lt;/bar&gt;</span>
<span class="c1"># &lt;/hash&gt;</span>
</code></pre>
</div>
<p>Чтобы это сделать, метод в цикле проходит пары и создает узлы, зависимые от <em>value</em>. Для заданной пары <code>key</code>, <code>value</code>:</p><ul><li>Если <code>value</code> - хэш, происходит рекурсивный вызов с <code>key</code> как <code>:root</code>.
</li><li>Если <code>value</code> - массив, происходит рекурсивный вызов с <code>key</code> как <code>:root</code>, и <code>key</code> в единственном числе как <code>:children</code>.
</li><li>Если <code>value</code> - вызываемый объект, он должен ожидать один или два аргумента. В зависимости от ситуации, вызываемый объект вызывается с помощью хэша <code>options</code> в качестве первого аргумента с <code>key</code> как <code>:root</code>, и <code>key</code> в единственном числе в качестве второго аргумента. Возвращенное значение становится новым узлом.
</li><li>Если <code>value</code> откликается на <code>to_xml</code>, метод вызывается с <code>key</code> как <code>:root</code>.
</li><li>В иных случаях, узел с <code>key</code> в качестве тега создается со строковым представлением <code>value</code> в качестве текстового узла. Если <code>value</code> является <code>nil</code>, добавляется атрибут &quot;nil&quot;, установленный в &quot;true&quot;. Кроме случаев, когда существует опция <code>:skip_types</code> со значением true, добавляется атрибут &quot;type&quot;, соответствующий следующему преобразованию:
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">XML_TYPE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Symbol"</span>     <span class="o">=&gt;</span> <span class="s2">"symbol"</span><span class="p">,</span>
  <span class="s2">"Integer"</span>    <span class="o">=&gt;</span> <span class="s2">"integer"</span><span class="p">,</span>
  <span class="s2">"BigDecimal"</span> <span class="o">=&gt;</span> <span class="s2">"decimal"</span><span class="p">,</span>
  <span class="s2">"Float"</span>      <span class="o">=&gt;</span> <span class="s2">"float"</span><span class="p">,</span>
  <span class="s2">"TrueClass"</span>  <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"FalseClass"</span> <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"Date"</span>       <span class="o">=&gt;</span> <span class="s2">"date"</span><span class="p">,</span>
  <span class="s2">"DateTime"</span>   <span class="o">=&gt;</span> <span class="s2">"datetime"</span><span class="p">,</span>
  <span class="s2">"Time"</span>       <span class="o">=&gt;</span> <span class="s2">"datetime"</span>
<span class="p">}</span>
</code></pre>
</div>
<p>По умолчанию корневой узел является &quot;hash&quot;, но это настраивается с помощью опции <code>:root</code>.</p><p>По умолчанию билдер XML является новым экземпляром <code>Builder::XmlMarkup</code>. Можно настроить свой собственный билдер с помощью опции <code>:builder</code>. Метод также принимает опции, такие как <code>:dasherize</code> и ему подобные, они направляются в билдер.</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/conversions.rb</code>.</p></div><h4 id='ob-edinenie' class='inside_page_header'><a href="#ob-edinenie">12.2.</a> Объединение</h4><p>В Ruby имеется встроенный метод <code>Hash#merge</code>, который позволяет объединять два хэша:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">a: </span><span class="mi">0</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}</span>
</code></pre>
</div>
<p>Active Support определяет еще несколько способов объединения хэшей, которые могут быть полезными.</p><h5 id='reverse_merge-i-reverse_merge' class='inside_page_header'><a href="#reverse_merge-i-reverse_merge">12.2.1.</a> <code>reverse_merge</code> и <code>reverse_merge!</code></h5><p>В случае коллизии, в <code>merge</code> остается ключ в хэше аргумента. Можно компактно предоставить хэш-опцию со значениями по умолчанию с помощью такой идиомы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</code></pre>
</div>
<p>Active Support определяет <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_merge"><code>reverse_merge</code></a> в случае, если нужна альтернативная запись:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
</div>
<p>И вариант с восклицательным знаком <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_merge-21"><code>reverse_merge!</code></a>, который выполняет объединение, модифицируя на месте:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge!</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
</div>
<div class="warning"><p>Обратите внимание, что <code>reverse_merge!</code> может изменить хэш в вызывающем методе, что может как быть, так и не быть хорошей идеей.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/hash/reverse_merge.rb</code>.</p></div><h5 id='reverse_update' class='inside_page_header'><a href="#reverse_update">12.2.2.</a> <code>reverse_update</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-reverse_update"><code>reverse_update</code></a> это псевдоним для <code>reverse_merge!</code>, описанного выше.</p><div class="warning"><p>Отметьте, что у <code>reverse_update</code> нет варианта с восклицательным знаком.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/hash/reverse_merge.rb</code>.</p></div><h5 id='deep_merge-i-deep_merge' class='inside_page_header'><a href="#deep_merge-i-deep_merge">12.2.3.</a> <code>deep_merge</code> и <code>deep_merge!</code></h5><p>Как можно было видеть в предыдущем примере, если ключ обнаруживается в обоих хэшах, выбирается значение первого из аргументов.</p><p>Active Support определяет <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_merge"><code>Hash#deep_merge</code></a>. В углубленном объединении, если один и тот же ключ обнаруживается в обоих хэшах, и их значения также хэши, то в результирующем хэше будет <em>объединение</em> их значений.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="p">{</span><span class="ss">b: </span><span class="mi">1</span><span class="p">}}.</span><span class="nf">deep_merge</span><span class="p">(</span><span class="ss">a: </span><span class="p">{</span><span class="ss">c: </span><span class="mi">2</span><span class="p">})</span>
<span class="c1"># =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_merge-21"><code>deep_merge!</code></a> выполняет углубленное объединение, модифицируя на месте:</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/deep_merge.rb</code>.</p></div><h4 id='glubokoe-dublirovanie' class='inside_page_header'><a href="#glubokoe-dublirovanie">12.3.</a> Глубокое дублирование</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_dup"><code>Hash#deep_dup</code></a> дублирует себя, а также все ключи и значения внутри, рекурсивно с помощью метода Active Support <code>Object#deep_dup</code>. Он работает так же, как <code>Enumerator#each_with_object</code>, посылая метод <code>deep_dup</code> в каждую пару внутри.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="p">{</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">d: </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">dup</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>

<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>      <span class="c1"># =&gt; true</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>   <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/object/deep_dup.rb</code>.</p></div><h4 id='rabota-s-klyuchami' class='inside_page_header'><a href="#rabota-s-klyuchami">12.4.</a> Работа с ключами</h4><h5 id='except-i-except' class='inside_page_header'><a href="#except-i-except">12.4.1.</a> <code>except</code> и <code>except!</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-except"><code>except</code></a> возвращает хэш с убранными ключами, содержащимися в перечне аргументов, если они существуют:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
</div>
<p>Если получатель откликается на <code>convert_key</code>, метод вызывается на каждом из аргументов. Это позволяет <code>except</code> хорошо обращаться с хэшами с индифферентным доступом, например:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># =&gt; {}</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># =&gt; {}</span>
</code></pre>
</div>
<p>Также имеется вариант с восклицательным знаком <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-except-21"><code>except!</code></a>, который убирает ключи в самом получателе.</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/except.rb</code>.</p></div><h5 id='stringify_keys-i-stringify_keys' class='inside_page_header'><a href="#stringify_keys-i-stringify_keys">12.4.2.</a> <code>stringify_keys</code> и <code>stringify_keys!</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-stringify_keys"><code>stringify_keys</code></a> возвращает хэш, в котором ключи получателя преобразованы в строку. Это выполняется с помощью применения к ним <code>to_s</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: :a</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}</span>
</code></pre>
</div>
<p>В случае коллизии ключей, значением будет то, которое вставлено в хэш позже:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># Результатом будет</span>
<span class="c1"># =&gt; {"a"=&gt;2}</span>
</code></pre>
</div>
<p>Метод может быть полезным, к примеру, для простого принятия и символов, и строк как опций. Например, <code>ActionView::Helpers::FormHelper</code> определяет:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">to_check_box_tag</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">checked_value</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">unchecked_value</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">stringify_keys</span>
  <span class="n">options</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"checkbox"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Вторая строчка может безопасно обратиться к ключу &quot;type&quot; и позволить пользователю передавать или <code>:type</code>, или &quot;type&quot;.</p><p>Также имеется вариант с восклицательным знаком <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-stringify_keys-21"><code>stringify_keys!</code></a>, который преобразует к строке ключи в самом получателе.</p><p>Кроме этого, можно использовать <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_stringify_keys"><code>deep_stringify_keys</code></a> и <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_stringify_keys-21"><code>deep_stringify_keys!</code></a> для преобразования к строке всех ключей в заданном хэше и всех хэшей, вложенных в него. Пример результата:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">nested: </span><span class="p">{</span><span class="ss">a: </span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_stringify_keys</span>
<span class="c1"># =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id='symbolize_keys-i-symbolize_keys' class='inside_page_header'><a href="#symbolize_keys-i-symbolize_keys">12.4.3.</a> <code>symbolize_keys</code> и <code>symbolize_keys!</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-symbolize_keys"><code>symbolize_keys</code></a> возвращает хэш, в котором ключи получателя преобразованы к символам там, где это возможно. Это выполняется с помощью применения к ним <code>to_sym</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"a"</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}</span>
</code></pre>
</div>
<div class="warning"><p>Отметьте в предыдущем примере, что только один ключ был преобразован к символу.</p></div><p>В случае коллизии ключей, значением будет то, которое вставлено в хэш позже:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {:a=&gt;2}</span>
</code></pre>
</div>
<p>Метод может быть полезным, к примеру, для простого принятия и символов, и строк как опций. Например, <code>ActionText::TagHelper</code> определяет</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">rich_text_area_tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">symbolize_keys</span>

  <span class="n">options</span><span class="p">[</span><span class="ss">:input</span><span class="p">]</span> <span class="o">||=</span> <span class="s2">"trix_input_</span><span class="si">#{</span><span class="no">ActionText</span><span class="o">::</span><span class="no">TagHelper</span><span class="p">.</span><span class="nf">id</span> <span class="o">+=</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Третья строчка может безопасно обратиться к ключу <code>:input</code> и позволить пользователю передавать или <code>:input</code>, или &quot;input&quot;.</p><p>Также имеется вариант с восклицательным знаком <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-symbolize_keys-21"><code>symbolize_keys!</code></a>, который приводит к символу ключи в самом получателе.</p><p>Кроме этого, можно использовать <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_symbolize_keys"><code>deep_symbolize_keys</code></a> и <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_symbolize_keys-21"><code>deep_symbolize_keys!</code></a> для преобразования к символам всех ключей в заданном хэше и всех хэшей, вложенных в него. Пример результата:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nested"</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id='to_options-i-to_options' class='inside_page_header'><a href="#to_options-i-to_options">12.4.4.</a> <code>to_options</code> и <code>to_options!</code></h5><p>Методы <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_options"><code>to_options</code></a> и <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-to_options-21"><code>to_options!</code></a> являются псевдонимами <code>symbolize_keys</code> и <code>symbolize_keys!</code> соответственно.</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h5 id='assert_valid_keys' class='inside_page_header'><a href="#assert_valid_keys">12.4.5.</a> <code>assert_valid_keys</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-assert_valid_keys"><code>assert_valid_keys</code></a> получает определенное число аргументов и проверяет, имеет ли получатель хоть один ключ вне этого белого списка. Если имеет, вызывается <code>ArgumentError</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># passes</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># ArgumentError</span>
</code></pre>
</div>
<p>Active Record не принимает незнакомые опции при создании связей, к примеру. Он реализует такой контроль через <code>assert_valid_keys</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/keys.rb</code>.</p></div><h4 id='rabota-so-znacheniyam' class='inside_page_header'><a href="#rabota-so-znacheniyam">12.5.</a> Работа со значениям</h4><h5 id='deep_transform_values-i-deep_transform_values' class='inside_page_header'><a href="#deep_transform_values-i-deep_transform_values">12.5.1.</a> <code>deep_transform_values</code> и <code>deep_transform_values!</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_transform_values"><code>deep_transform_values</code></a> возвращает новый хэш со всеми значениями, конвертированными с помощью операции блока. Он включает значения корневого хэша и из всех вложенных хэшей и массивов.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">person: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Rob'</span><span class="p">,</span> <span class="ss">age: </span><span class="s1">'28'</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">hash</span><span class="p">.</span><span class="nf">deep_transform_values</span><span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">value</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">upcase</span> <span class="p">}</span>
<span class="c1"># =&gt; {person: {name: "ROB", age: "28"}}</span>
</code></pre>
</div>
<p>Также имеется восклицательный вариант <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-deep_transform_values-21"><code>deep_transform_values!</code></a>, деструктивно конвертирующий все значения с помощью операции блока.</p><div class="note"><p>Определено в <code>active_support/core_ext/hash/deep_transform_values.rb</code>.</p></div><h4 id='narezka' class='inside_page_header'><a href="#narezka">12.6.</a> Нарезка</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-slice-21"><code>slice!</code></a> заменяет хэш только заданными ключами и возвращает хэш, содержащий убранные пары ключ/значение.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">slice!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
<span class="nb">hash</span>                   <span class="c1"># =&gt; {:a=&gt;1}</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/hash/slice.rb</code>.</p></div><h4 id='izvlechenie2' class='inside_page_header'><a href="#izvlechenie2">12.7.</a> Извлечение</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-extract-21"><code>extract!</code></a> убирает и возвращает пары ключ/значение, соответствующие заданным ключам.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:a=&gt;1}</span>
<span class="nb">hash</span>                     <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
</div>
<p>Метод <code>extract!</code> возвращает тот же подкласс Hash, каким является получатель.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">with_indifferent_access</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">).</span><span class="nf">class</span>
<span class="c1"># =&gt; ActiveSupport::HashWithIndifferentAccess</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/hash/slice.rb</code>.</p></div><h4 id='indifferentnyy-dostup' class='inside_page_header'><a href="#indifferentnyy-dostup">12.8.</a> Индифферентный доступ</h4><p>Метод <a href="https://api.rubyonrails.org/classes/Hash.html#method-i-with_indifferent_access"><code>with_indifferent_access</code></a> возвращает <a href="https://api.rubyonrails.org/classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a> из своего получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/hash/indifferent_access.rb</code>.</p></div><h3 id='rasshireniya-dlya-regexp' class='inside_page_header'><a href="#rasshireniya-dlya-regexp">13.</a> Расширения для <code>Regexp</code></h3><h4 id='multiline' class='inside_page_header'><a href="#multiline">13.1.</a> <code>multiline?</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Regexp.html#method-i-multiline-3F"><code>multiline?</code></a> говорит, имеет ли регулярное выражение установленный флаг <code>/m</code>, то есть соответствует ли точка новым строкам.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sr">%r{.}</span><span class="p">.</span><span class="nf">multiline?</span>  <span class="c1"># =&gt; false</span>
<span class="sr">%r{.}m</span><span class="p">.</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>

<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">).</span><span class="nf">multiline?</span>                    <span class="c1"># =&gt; false</span>
<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="no">Regexp</span><span class="o">::</span><span class="no">MULTILINE</span><span class="p">).</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Rails использует этот метод в одном месте, в коде маршрутизации. Регулярные выражения Multiline недопустимы для маршрутных требований, и этот флаг облегчает соблюдение этого ограничения.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">verify_regexp_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">if</span> <span class="n">requirement</span><span class="p">.</span><span class="nf">multiline?</span>
    <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"Regexp multiline option is not allowed in routing requirements: </span><span class="si">#{</span><span class="n">requirement</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/regexp.rb</code>.</p></div><h3 id='rasshireniya-dlya-range' class='inside_page_header'><a href="#rasshireniya-dlya-range">14.</a> Расширения для <code>Range</code></h3><h4 id='to_fs2' class='inside_page_header'><a href="#to_fs2">14.1.</a> <code>to_fs</code></h4><p>Active Support определяет <code>Range#to_s</code> как альтернативу <code>to_s</code>, которая понимает опциональный аргумент формата. В настоящий момент имеется только один поддерживаемый формат, отличный от дефолтного, это <code>:db</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_fs</span>
<span class="c1"># =&gt; "2009-10-25..2009-10-26"</span>

<span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_fs</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
<span class="c1"># =&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"</span>
</code></pre>
</div>
<p>Как изображено в примере, формат <code>:db</code> генерирует SQL условие <code>BETWEEN</code>. Это используется Active Record в поддержке значений интервала в условиях.</p><div class="note"><p>Определено в <code>active_support/core_ext/range/conversions.rb</code>.</p></div><h4 id='i-include' class='inside_page_header'><a href="#i-include">14.2.</a> <code>===</code> и <code>include?</code></h4><p>Методы <code>Range#===</code> и <code>Range#include?</code> сообщают, лежит ли некоторое значение между концами заданного экземпляра:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="no">Math</span><span class="o">::</span><span class="no">E</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Active Support расширяет эти методы так, что аргумент, в свою очередь, может быть другим интервалом. В этом случае проверяется, принадлежат ли концы интервала аргументов самому получателю:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/range/compare_range.rb</code>.</p></div><h4 id='overlaps' class='inside_page_header'><a href="#overlaps">14.3.</a> <code>overlaps?</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Range.html#method-i-overlaps-3F"><code>Range#overlaps?</code></a> говорит, имеют ли два заданных интервала непустое пересечение:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">7</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">11</span><span class="o">..</span><span class="mi">27</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/range/overlaps.rb</code>.</p></div><h3 id='rasshireniya-dlya-date' class='inside_page_header'><a href="#rasshireniya-dlya-date">15.</a> Расширения для <code>Date</code></h3><h4 id='vychisleniya' class='inside_page_header'><a href="#vychisleniya">15.1.</a> Вычисления</h4><div class="info"><p>Следующие методы вычисления имеют <a href="https://ru.wikipedia.org/wiki/%D0%93%D1%80%D0%B8%D0%B3%D0%BE%D1%80%D0%B8%D0%B0%D0%BD%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%B0%D0%BB%D0%B5%D0%BD%D0%B4%D0%B0%D1%80%D1%8C">временную пропасть</a> в октябре 1582 года, когда дней с 5 по 14 (включительно) просто не существовало. Это руководство не документирует свое поведение в те дни для краткости, но достаточно сказать, будет происходит то, что от них ожидается. То есть, <code>Date.new(1582, 10, 4).tomorrow</code> возвратит <code>Date.new(1582, 10, 15)</code>, и так далее. Пожалуйста, проверьте <code>test/core_ext/date_ext_test.rb</code> в тестовом наборе Active Support, чтобы понять ожидаемое поведение.</p></div><h5 id='date-current' class='inside_page_header'><a href="#date-current">15.1.1.</a> <code>Date.current</code></h5><p>Active Support определяет <a href="https://api.rubyonrails.org/classes/Date.html#method-c-current"><code>Date.current</code></a> как сегодняшний день в текущей временной зоне. Он похож на <code>Date.today</code>, за исключением того, что он учитывает временную зону пользователя, если она определена. Он также определяет <a href="https://api.rubyonrails.org/classes/Date.html#method-c-yesterday"><code>Date.yesterday</code></a> и <a href="https://api.rubyonrails.org/classes/Date.html#method-c-tomorrow"><code>Date.tomorrow</code></a>, и предикаты экземпляра <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code>next_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code>prev_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-on_weekday-3F"><code>on_weekday?</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-on_weekend-3F"><code>on_weekend?</code></a>, все они зависят от <code>Date.current</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id='imenovannye-daty' class='inside_page_header'><a href="#imenovannye-daty">15.1.2.</a> Именованные даты</h5><h6 id='beginning_of_week-end_of_week' class='inside_page_header'><a href="#beginning_of_week-end_of_week">15.1.2.1.</a> <code>beginning_of_week</code>, <code>end_of_week</code></h6><p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_week"><code>beginning_of_week</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_week"><code>end_of_week</code></a> возвращают даты начала и конца недели соответственно. Предполагается, что неделя начинается с понедельника, но это может быть изменено переданным аргументом, установив локально для треда <code>Date.beginning_of_week</code> или <a href="/configuring#config-beginning-of-week"><code>config.beginning_of_week</code></a>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span>          <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 02 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span>                <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>       <span class="c1"># =&gt; Sat, 08 May 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_week</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_week"><code>at_beginning_of_week</code></a>, а у <code>end_of_week</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_week"><code>at_end_of_week</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='monday-sunday' class='inside_page_header'><a href="#monday-sunday">15.1.2.2.</a> <code>monday</code>, <code>sunday</code></h6><p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-monday"><code>monday</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-sunday"><code>sunday</code></a> возвращают даты предыдущего понедельника или следующего воскресенья соответственно.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 09 May 2010</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 10 Sep 2012</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='prev_week-next_week' class='inside_page_header'><a href="#prev_week-next_week">15.1.2.3.</a> <code>prev_week</code>, <code>next_week</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_week"><code>next_week</code></a> принимает символ с днем недели на английском (по умолчанию локально для треда <a href="https://api.rubyonrails.org/classes/Date.html#method-c-beginning_of_week"><code>Date.beginning_of_week</code></a> или <a href="/configuring#config-beginning-of-week"><code>config.beginning_of_week</code></a>, или <code>:monday</code>) и возвращает дату, соответствующую этому дню на следующей неделе:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span>              <span class="c1"># =&gt; Mon, 10 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 15 May 2010</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_week"><code>prev_week</code></a> работает аналогично:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span>              <span class="c1"># =&gt; Mon, 26 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:friday</span><span class="p">)</span>     <span class="c1"># =&gt; Fri, 30 Apr 2010</span>
</code></pre>
</div>
<p>У <code>prev_week</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_week"><code>last_week</code></a>.</p><p>И <code>next_week</code>, и <code>prev_week</code> работают так, как нужно, когда установлен <code>Date.beginning_of_week</code> или <code>config.beginning_of_week</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='beginning_of_month-end_of_month' class='inside_page_header'><a href="#beginning_of_month-end_of_month">15.1.2.4.</a> <code>beginning_of_month</code>, <code>end_of_month</code></h6><p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_month"><code>beginning_of_month</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_month"><code>end_of_month</code></a> возвращают даты начала и конца месяца:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_month</span>     <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_month</span>           <span class="c1"># =&gt; Mon, 31 May 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_month</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_month"><code>at_beginning_of_month</code></a>, а у <code>end_of_month</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_month"><code>at_end_of_month</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='quarter-beginning_of_quarter-end_of_quarter' class='inside_page_header'><a href="#quarter-beginning_of_quarter-end_of_quarter">15.1.2.5.</a> <code>quarter</code>, <code>beginning_of_quarter</code>, <code>end_of_quarter</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-quarter"><code>quarter</code></a> возвращает квартал календарного года получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">quarter</span>                <span class="c1"># =&gt; 2</span>
</code></pre>
</div>
<p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_quarter"><code>beginning_of_quarter</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_quarter"><code>end_of_quarter</code></a> возвращают даты начала и конца квартала календарного года получателя:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_quarter</span>   <span class="c1"># =&gt; Thu, 01 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_quarter</span>         <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_quarter</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_quarter"><code>at_beginning_of_quarter</code></a>, а у <code>end_of_quarter</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_quarter"><code>at_end_of_quarter</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='beginning_of_year-end_of_year' class='inside_page_header'><a href="#beginning_of_year-end_of_year">15.1.2.6.</a> <code>beginning_of_year</code>, <code>end_of_year</code></h6><p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-beginning_of_year"><code>beginning_of_year</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-end_of_year"><code>end_of_year</code></a> возвращают даты начала и конца года:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_year</span>      <span class="c1"># =&gt; Fri, 01 Jan 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_year</span>            <span class="c1"># =&gt; Fri, 31 Dec 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_year</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_year"><code>at_beginning_of_year</code></a>, а у <code>end_of_year</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-at_end_of_year"><code>at_end_of_year</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h5 id='drugie-vychisleniya-dat' class='inside_page_header'><a href="#drugie-vychisleniya-dat">15.1.3.</a> Другие вычисления дат</h5><h6 id='years_ago-years_since' class='inside_page_header'><a href="#years_ago-years_since">15.1.3.1.</a> <code>years_ago</code>, <code>years_since</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-years_ago"><code>years_ago</code></a> получает число лет и возвращает ту же дату, что и много лет назад:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 07 Jun 2000</span>
</code></pre>
</div>
<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-years_since"><code>years_since</code></a> перемещает вперед по времени:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 07 Jun 2020</span>
</code></pre>
</div>
<p>Если такая дата не найдена, возвращается последний день соответствующего месяца:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 28 Feb 2009</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 28 Feb 2015</span>
</code></pre>
</div>
<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_year"><code>last_year</code></a> это сокращение для <code>#years_ago(1)</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='months_ago-months_since' class='inside_page_header'><a href="#months_ago-months_since">15.1.3.2.</a> <code>months_ago</code>, <code>months_since</code></h6><p>Методы <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-months_ago"><code>months_ago</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-months_since"><code>months_since</code></a> работают аналогично, но для месяцев:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
</div>
<p>Если такой день не существует, возвращается последний день соответствующего месяца:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
</code></pre>
</div>
<p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_month"><code>last_month</code></a> это сокращение для <code>#months_ago(1)</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='weeks_ago' class='inside_page_header'><a href="#weeks_ago">15.1.3.3.</a> <code>weeks_ago</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-weeks_ago"><code>weeks_ago</code></a> работает аналогично для недель:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 17 May 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 May 2010</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h6 id='advance' class='inside_page_header'><a href="#advance">15.1.3.4.</a> <code>advance</code></h6><p>Более обычным способом перейти на другие дни является <a href="https://api.rubyonrails.org/classes/Date.html#method-i-advance"><code>advance</code></a>. Этот метод получает хэш с ключами <code>:years</code>, <code>:months</code>, <code>:weeks</code>, <code>:days</code>, и возвращает дату, передвинутую на столько, сколько указывают существующие ключи:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">weeks: </span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; Mon, 20 Jun 2011</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">days: </span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 04 Aug 2010</span>
</code></pre>
</div>
<p>Отметьте в предыдущем примере, что приросты могут быть отрицательными.</p><p>Для выполнения вычисления метод сначала приращивает года, затем месяцы, затем недели, и, наконец, дни. Этот порядок важен в концах месяцев. Скажем, к примеру, мы в конце февраля 2010, и мы хотим переместиться на один месяц и один день вперед.</p><p>Метод <code>advance</code> передвигает сначала на один месяц, и затем на один день, результат такой:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 29 Mar 2010</span>
</code></pre>
</div>
<p>Хотя, если бы мы делали по-другому, результат тоже был бы другой:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">days: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Thu, 01 Apr 2010</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id='izmenenie-komponentov' class='inside_page_header'><a href="#izmenenie-komponentov">15.1.4.</a> Изменение компонентов</h5><p>Метод <a href="https://api.rubyonrails.org/classes/Date.html#method-i-change"><code>change</code></a> позволяет получить новую дату, которая идентична получателю, за исключением заданного года, месяца или дня:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">month: </span><span class="mi">11</span><span class="p">)</span>
<span class="c1"># =&gt; Wed, 23 Nov 2011</span>
</code></pre>
</div>
<p>Метод не принимает несуществующие даты, если изменение невалидно, вызывается <code>ArgumentError</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h5 id='dlitelnosti' class='inside_page_header'><a href="#dlitelnosti">15.1.5.</a> Длительности</h5><p>Объекты <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code>Duration</code></a> могут добавляться и вычитаться из дат:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010</span>
<span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011</span>
<span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="c1"># =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00</span>
</code></pre>
</div>
<p>Они переводят в вызовы <code>since</code> или <code>advance</code>. Например, здесь мы получим правильный переход ко времени календарной реформы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582</span>
</code></pre>
</div>
<h5 id='vremennye-metki' class='inside_page_header'><a href="#vremennye-metki">15.1.6.</a> Временные метки</h5><div class="info"><p>Следующие методы возвращают объект <code>Time</code>, если возможно, в противном случае <code>DateTime</code>. Если установлено, учитывается временная зона пользователя.</p></div><h6 id='beginning_of_day-end_of_day' class='inside_page_header'><a href="#beginning_of_day-end_of_day">15.1.6.1.</a> <code>beginning_of_day</code>, <code>end_of_day</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/Date.html#method-i-beginning_of_day"><code>beginning_of_day</code></a> возвращает временную метку для начала дня (00:00:00):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_day</span> <span class="c1"># =&gt; Mon Jun 07 00:00:00 +0200 2010</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/Date.html#method-i-end_of_day"><code>end_of_day</code></a> возвращает временную метку для конца дня (23:59:59):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_day</span> <span class="c1"># =&gt; Mon Jun 07 23:59:59 +0200 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_day</code> есть псевдонимы <a href="https://api.rubyonrails.org/classes/Date.html#method-i-at_beginning_of_day"><code>at_beginning_of_day</code></a>, <a href="https://api.rubyonrails.org/classes/Date.html#method-i-midnight"><code>midnight</code></a>, <a href="https://api.rubyonrails.org/classes/Date.html#method-i-at_midnight"><code>at_midnight</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h6 id='beginning_of_hour-end_of_hour' class='inside_page_header'><a href="#beginning_of_hour-end_of_hour">15.1.6.2.</a> <code>beginning_of_hour</code>, <code>end_of_hour</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> возвращает временную метку в начале часа (hh:00:00):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:00:00 +0200 2010</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a> возвращает временную метку в конце часа (hh:59:59):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:59:59 +0200 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_hour</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id='beginning_of_minute-end_of_minute' class='inside_page_header'><a href="#beginning_of_minute-end_of_minute">15.1.6.3.</a> <code>beginning_of_minute</code>, <code>end_of_minute</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_minute"><code>beginning_of_minute</code></a> возвращает временную метку в начале минуты (hh:mm:00):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:00 +0200 2010</span>
</code></pre>
</div>
<p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_minute"><code>end_of_minute</code></a> возвращает временную метку в конце минуты (hh:mm:59):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:59 +0200 2010</span>
</code></pre>
</div>
<p>У <code>beginning_of_minute</code> есть псевдоним <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_minute"><code>at_beginning_of_minute</code></a>.</p><div class="info"><p><code>beginning_of_hour</code>, <code>end_of_hour</code>, <code>beginning_of_minute</code> и <code>end_of_minute</code> реализованы для <code>Time</code> и <code>DateTime</code>, но <strong>не</strong> для <code>Date</code>, так как у экземпляра <code>Date</code> не имеет смысла спрашивать о начале или окончании часа или минуты.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id='ago-since' class='inside_page_header'><a href="#ago-since">15.1.6.4.</a> <code>ago</code>, <code>since</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/Date.html#method-i-ago"><code>ago</code></a> получает количество секунд как аргумент и возвращает временную метку, имеющую столько секунд до полуночи:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00</span>
</code></pre>
</div>
<p>Подобным образом <a href="https://api.rubyonrails.org/classes/Date.html#method-i-since"><code>since</code></a> двигается вперед:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">since</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date/calculations.rb</code>.</p></div><h3 id='rasshireniya-dlya-datetime' class='inside_page_header'><a href="#rasshireniya-dlya-datetime">16.</a> Расширения для <code>DateTime</code></h3><div class="warning"><p><code>DateTime</code> не знает о правилах DST (переходов на летнее время), и поэтому некоторые из этих методов сталкиваются с временной пропастью, когда переход на и с летнего времени имеет место. К примеру, <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> может не возвратить настоящее значение для таких дней.</p></div><h4 id='vychisleniya2' class='inside_page_header'><a href="#vychisleniya2">16.1.</a> Вычисления</h4><p>Класс <code>DateTime</code> является подклассом <code>Date</code>, поэтому загрузив <code>active_support/core_ext/date/calculations.rb</code> будут унаследованы эти методы и их псевдонимы, за исключением того, что они будут всегда возвращать дату и время.</p><p>Следующие методы переопределены, поэтому <strong>не</strong> нужно загружать <code>active_support/core_ext/date/calculations.rb</code> для них:</p><ul><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_day"><code>beginning_of_day</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-midnight"><code>midnight</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_midnight"><code>at_midnight</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_day"><code>at_beginning_of_day</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_day"><code>end_of_day</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-ago"><code>ago</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-since"><code>since</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-in"><code>in</code></a>
</li></ul><p>С другой стороны, <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-advance"><code>advance</code></a> и <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-change"><code>change</code></a> также определены, они описаны ниже.</p><p>Следующие методы реализованы только в <code>active_support/core_ext/date_time/calculations.rb</code>, так как они имеют смысл только при использовании с экземпляром <code>DateTime</code>:</p><ul><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> / <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>
</li><li><a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a>
</li></ul><h5 id='imenovannye-datetime' class='inside_page_header'><a href="#imenovannye-datetime">16.1.1.</a> Именованные Datetime</h5><h6 id='datetime-current' class='inside_page_header'><a href="#datetime-current">16.1.1.1.</a> <code>DateTime.current</code></h6><p>Active Support определяет <a href="https://api.rubyonrails.org/classes/DateTime.html#method-c-current"><code>DateTime.current</code></a> похожим на <code>Time.now.to_datetime</code>, за исключением того, что он учитывает временную зону пользователя, если она определена. Он также определяет <code>DateTime.yesterday</code> и <code>DateTime.tomorrow</code>, и предикаты экземпляра <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> относительно <code>DateTime.current</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h5 id='drugie-rasshireniya' class='inside_page_header'><a href="#drugie-rasshireniya">16.1.2.</a> Другие расширения</h5><h6 id='seconds_since_midnight' class='inside_page_header'><a href="#seconds_since_midnight">16.1.2.1.</a> <code>seconds_since_midnight</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> возвращает число секунд, прошедших с полуночи:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>     <span class="c1"># =&gt; Mon, 07 Jun 2010 20:26:36 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">seconds_since_midnight</span> <span class="c1"># =&gt; 73596</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id='utc' class='inside_page_header'><a href="#utc">16.1.2.2.</a> <code>utc</code></h6><p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-utc"><code>utc</code></a> выдает такую же дату и время получателя, но выраженную в UTC.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:27:52 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span>                <span class="c1"># =&gt; Mon, 07 Jun 2010 23:27:52 +0000</span>
</code></pre>
</div>
<p>Также у этого метода есть псевдоним <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-getutc"><code>getutc</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id='utc2' class='inside_page_header'><a href="#utc2">16.1.2.3.</a> <code>utc?</code></h6><p>Предикат <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-utc-3F"><code>utc?</code></a> сообщает, имеет ли получатель UTC в качестве своей временной зоны:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">now</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:30:47 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc?</span>           <span class="c1"># =&gt; false</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span><span class="p">.</span><span class="nf">utc?</span>       <span class="c1"># =&gt; true</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h6 id='date-time-advance' class='inside_page_header'><a href="#date-time-advance">16.1.2.4.</a> <code>advance</code></h6><p>Более обычным способом перейти к другим дате и времени является <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-advance"><code>advance</code></a>. Этот метод получает хэш с ключами <code>:years</code>, <code>:months</code>, <code>:weeks</code>, <code>:days</code>, <code>:hours</code>, <code>:minutes</code> и <code>:seconds</code>, и возвращает дату и время, передвинутые на столько, на сколько указывают существующие ключи.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Thu, 05 Aug 2010 11:33:31 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">hours: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">minutes: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 06 Sep 2011 12:34:32 +0000</span>
</code></pre>
</div>
<p>Этот метод сначала вычисляет дату назначения, передавая <code>:years</code>, <code>:months</code>, <code>:weeks</code> и <code>:days</code> в <code>Date#advance</code>, описанный <a href="/active-support-core-extensions#advance">ранее</a>. После этого, он корректирует время, вызвав <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-since"><code>since</code></a> с количеством секунд, на которое нужно передвинуть. Этот порядок обоснован, другой порядок мог бы дать другие дату и время для некоторых временных пропастей. Используем пример в <code>Date#advance</code>, и расширим его, показав обоснованность порядка, применимого к единицам измерения времени.</p><p>Если сначала передвинуть единицы измерения даты (относительный порядок вычисления, показанный ранее), а затем единицы измерения времени, мы получим для примера следующее вычисление:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 28 Feb 2010 23:59:59 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Mon, 29 Mar 2010 00:00:00 +0000</span>
</code></pre>
</div>
<p>но если мы вычисляем обратным способом, результат будет иным:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Thu, 01 Apr 2010 00:00:00 +0000</span>
</code></pre>
</div>
<div class="warning"><p>Поскольку <code>DateTime</code> не поддерживает DST (переход на летнее время), можно получить несуществующий момент времени без каких-либо предупреждений или сообщений об ошибке.</p></div><div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h5 id='izmenenie-komponentov2' class='inside_page_header'><a href="#izmenenie-komponentov2">16.1.3.</a> Изменение компонентов</h5><p>Метод <a href="https://api.rubyonrails.org/classes/DateTime.html#method-i-change"><code>change</code></a> позволяет получить новые дату и время, которая идентична получателю, за исключением заданных опций, включающих <code>:year</code>, <code>:month</code>, <code>:day</code>, <code>:hour</code>, <code>:min</code>, <code>:sec</code>, <code>:offset</code>, <code>:start</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:56:22 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">offset: </span><span class="no">Rational</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="c1"># =&gt; Wed, 08 Jun 2011 01:56:22 +0600</span>
</code></pre>
</div>
<p>Если часы обнуляются, то минуты и секунды тоже (если у них не заданы значения):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">hour: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 00:00:00 +0000</span>
</code></pre>
</div>
<p>Аналогично, если минуты обнуляются, то секунды тоже (если у них не задано значение):</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">min: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; Tue, 08 Jun 2010 01:00:00 +0000</span>
</code></pre>
</div>
<p>Этот метод не принимает несуществующие даты, если изменение невалидно, вызывается <code>ArgumentError</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">day: </span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: invalid date</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_time/calculations.rb</code>.</p></div><h5 id='dlitelnosti2' class='inside_page_header'><a href="#dlitelnosti2">16.1.4.</a> Длительности</h5><p>Объекты <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code>Duration</code></a> могут добавляться и вычитаться из даты и времени:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:15:17 +0000</span>
</code></pre>
</div>
<p>Они переводят в вызовы <code>since</code> или <code>advance</code>. Например, здесь мы получим правильный переход ко времени календарной реформы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span>
<span class="c1"># =&gt; Fri, 15 Oct 1582 00:00:00 +0000</span>
</code></pre>
</div>
<h3 id='rasshireniya-dlya-time' class='inside_page_header'><a href="#rasshireniya-dlya-time">17.</a> Расширения для <code>Time</code></h3><h4 id='vychisleniya3' class='inside_page_header'><a href="#vychisleniya3">17.1.</a> Вычисления</h4><p>Это аналоги. Обратитесь к их документации выше, но примите во внимание следующие различия:</p><ul><li><a href="https://api.rubyonrails.org/classes/Time.html#method-i-change"><code>change</code></a> принимает дополнительную опцию <code>:usec</code>.
</li><li><code>Time</code> понимает летнее время (DST), поэтому вы получите правильные вычисления времени как тут:
</li></ul><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>

<span class="c1"># В Барселоне, 2010/03/28 02:00 +0100 становится 2010/03/28 03:00 +0200 благодаря переходу на летнее время.</span>
<span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 01:59:59 +0100 2010</span>
<span class="n">t</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; Sun Mar 28 03:00:00 +0200 2010</span>
</code></pre>
</div>
<ul><li>Если <a href="https://api.rubyonrails.org/classes/Time.html#method-i-since"><code>since</code></a> или <a href="https://api.rubyonrails.org/classes/Time.html#method-i-ago"><code>ago</code></a> переходят на время, которое не может быть выражено с помощью <code>Time</code>, вместо него возвращается объект <code>DateTime</code>.
</li></ul><h5 id='time-current' class='inside_page_header'><a href="#time-current">17.1.1.</a> <code>Time.current</code></h5><p>Active Support определяет <a href="https://api.rubyonrails.org/classes/Time.html#method-c-current"><code>Time.current</code></a> как сегодняшний день в текущей временной зоне. Он похож на <code>Time.now</code>, за исключением того, что он учитывает временную зону пользователя, если она определена. Он также определяет предикаты экземпляра <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code>next_day?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code>prev_day?</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a>, все они относительны к <code>Time.current</code>.</p><p>При осуществлении сравнения Time с использованием методов, учитывающих временную зону пользователя, убедитесь, что используете <code>Time.current</code> вместо <code>Time.now</code>. Есть случаи, когда временная зона пользователя может быть в будущем по сравнению с временной зоной системы, в которой по умолчанию используется <code>Time.now</code>. Это означает, что <code>Time.now.to_date</code> может быть равным <code>Date.yesterday</code>.</p><div class="note"><p>Определено в <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id='all_day-all_week-all_month-all_quarter-i-all_year' class='inside_page_header'><a href="#all_day-all_week-all_month-all_quarter-i-all_year">17.1.2.</a> <code>all_day</code>, <code>all_week</code>, <code>all_month</code>, <code>all_quarter</code> и <code>all_year</code></h5><p>Метод <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_day"><code>all_day</code></a> возвращает интервал, представляющий целый день для текущего времени.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_day</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00</span>
</code></pre>
</div>
<p>Аналогично, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_week"><code>all_week</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_month"><code>all_month</code></a>, <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_quarter"><code>all_quarter</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-all_year"><code>all_year</code></a> служат целям генерации временных интервалов.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>
<span class="c1"># =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_month</span>
<span class="c1"># =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_quarter</span>
<span class="c1"># =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_year</span>
<span class="c1"># =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h5 id='prev_day-next_day' class='inside_page_header'><a href="#prev_day-next_day">17.1.3.</a> <code>prev_day</code>, <code>next_day</code></h5><p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_day"><code>prev_day</code></a> и <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_day"><code>next_day</code></a> возвращают время в предыдущем или следующем дне:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_day</span>               <span class="c1"># =&gt; 2010-05-07 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_day</span>               <span class="c1"># =&gt; 2010-05-09 00:00:00 +0900</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id='prev_month-next_month' class='inside_page_header'><a href="#prev_month-next_month">17.1.4.</a> <code>prev_month</code>, <code>next_month</code></h5><p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_month"><code>prev_month</code></a> и <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_month"><code>next_month</code></a> возвращают время в том же дне в предыдущем или следующем месяце:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_month</span>             <span class="c1"># =&gt; 2010-04-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_month</span>             <span class="c1"># =&gt; 2010-06-08 00:00:00 +0900</span>
</code></pre>
</div>
<p>Если такой день не существует, возвращается последний день соответствующего месяца:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-04-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-06-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id='prev_year-next_year' class='inside_page_header'><a href="#prev_year-next_year">17.1.5.</a> <code>prev_year</code>, <code>next_year</code></h5><p><a href="https://api.rubyonrails.org/classes/Time.html#method-i-prev_year"><code>prev_year</code></a> и <a href="https://api.rubyonrails.org/classes/Time.html#method-i-next_year"><code>next_year</code></a> возвращают время в том же дне/месяце в предыдущем или следующем году:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>              <span class="c1"># =&gt; 2009-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>              <span class="c1"># =&gt; 2011-05-08 00:00:00 +0900</span>
</code></pre>
</div>
<p>Если датой является 29 февраля високосного года, возвратится 28-е:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>               <span class="c1"># =&gt; 1999-02-28 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>               <span class="c1"># =&gt; 2001-02-28 00:00:00 +0900</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/time/calculations.rb</code>.</p></div><h5 id='prev_quarter-next_quarter' class='inside_page_header'><a href="#prev_quarter-next_quarter">17.1.6.</a> <code>prev_quarter</code>, <code>next_quarter</code></h5><p><a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-prev_quarter"><code>prev_quarter</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-next_quarter"><code>next_quarter</code></a> возвращают дату с тем же днем в предыдущем или следующем квартале:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 0300</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_quarter</span>             <span class="c1"># =&gt; 2010-02-08 00:00:00 0200</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_quarter</span>             <span class="c1"># =&gt; 2010-08-08 00:00:00 0300</span>
</code></pre>
</div>
<p>Если такой день не существует, возвращается последний день соответствующего месяца:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-04-30 00:00:00 0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-02-29 00:00:00 0200</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span> <span class="c1"># =&gt; 2000-07-31 00:00:00 0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_quarter</span> <span class="c1"># =&gt; 2001-03-01 00:00:00 0200</span>
</code></pre>
</div>
<p><code>prev_quarter</code> имеет псевдоним <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-last_quarter"><code>last_quarter</code></a>.</p><div class="note"><p>Определено в <code>active_support/core_ext/date_and_time/calculations.rb</code>.</p></div><h4 id='konstruktory-time' class='inside_page_header'><a href="#konstruktory-time">17.2.</a> Конструкторы Time</h4><p>Active Support определяет <a href="https://api.rubyonrails.org/classes/Time.html#method-c-current"><code>Time.current</code></a> как <code>Time.zone.now</code>, если у пользователя определена временная зона, а иначе <code>Time.now</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00</span>
</code></pre>
</div>
<p>Как и у <code>DateTime</code>, предикаты <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a> и <a href="https://api.rubyonrails.org/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> выполняются относительно <code>Time.current</code>.</p><p>Если время, подлежащее конструированию лежит за пределами интервала, поддерживаемого <code>Time</code> на запущенной платформе, usecs отбрасываются и вместо этого возвращается объект <code>DateTime</code>.</p><h5 id='dlitelnosti3' class='inside_page_header'><a href="#dlitelnosti3">17.2.1.</a> Длительности</h5><p>Объекты <a href="https://api.rubyonrails.org/classes/ActiveSupport/Duration.html"><code>Duration</code></a> могут быть добавлены и вычтены из объектов времени:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00</span>
</code></pre>
</div>
<p>Они переводят в вызовы <code>since</code> или <code>advance</code>. Например, здесь мы получим правильный переход ко времени календарной реформы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">utc</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">days</span>
<span class="c1"># =&gt; Mon Oct 18 00:00:00 UTC 1582</span>
</code></pre>
</div>
<h3 id='rasshireniya-dlya-file' class='inside_page_header'><a href="#rasshireniya-dlya-file">18.</a> Расширения для <code>File</code></h3><h4 id='atomic_write' class='inside_page_header'><a href="#atomic_write">18.1.</a> <code>atomic_write</code></h4><p>С помощью метода класса <a href="https://api.rubyonrails.org/classes/File.html#method-c-atomic_write"><code>File.atomic_write</code></a> можно записать в файл способом, предотвращающим от просмотра недописанного содержимого.</p><p>Имя файла передается как аргумент, и в метод вкладываются обработчики файла, открытого для записи. Как только блок выполняется, <code>atomic_write</code> закрывает файл и завершает свое задание.</p><p>Например, Action Pack использует этот метод для записи файлов кэша ассетов, таких как <code>all.css</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">File</span><span class="p">.</span><span class="nf">atomic_write</span><span class="p">(</span><span class="n">joined_asset_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">cache</span><span class="o">|</span>
  <span class="n">cache</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">join_asset_file_contents</span><span class="p">(</span><span class="n">asset_paths</span><span class="p">))</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Для выполнения этого <code>atomic_write</code> создает временный файл. Фактически код в блоке пишет в этот файл. При выполнении временный файл переименовывается, что является атомарной операцией в системах POSIX. Если целевой файл существует, <code>atomic_write</code> перезаписывает его и сохраняет владельцев и права доступа. Однако в некоторых случаях <code>atomic_write</code> не может изменить владельца или права доступа на файл, эта ошибка отлавливается и пропускается, позволяя файловой системе убедиться, что файл доступен для необходимых манипуляций.</p><div class="note"><p>Благодаря операции chmod, выполняемой <code>atomic_write</code>, если у целевого файла установлен ACL, то этот ACL будет пересчитан/модифицирован.</p></div><div class="warning"><p>Отметьте, что с помощью <code>atomic_write</code> нельзя дописывать.</p></div><p>Вспомогательный файл записывается в стандартной директории для временных файлов, но можно передать эту директорию как второй аргумент.</p><div class="note"><p>Определено в <code>active_support/core_ext/file/atomic.rb</code>.</p></div><h3 id='rasshireniya-dlya-nameerror' class='inside_page_header'><a href="#rasshireniya-dlya-nameerror">19.</a> Расширения для <code>NameError</code></h3><p>Active Support добавляет <a href="https://api.rubyonrails.org/classes/NameError.html#method-i-missing_name-3F"><code>missing_name?</code></a> к <code>NameError</code>, который проверяет было ли исключение вызвано в связи с тем, что имя было передано как аргумент.</p><p>Имя может быть задано как символ или строка. Символ проверяется как простое имя константы, строка - как полностью ограниченное имя константы.</p><div class="info"><p>Символ может представлять полностью ограниченное имя константы как <code>:&quot;ActiveRecord::Base&quot;</code>, такое поведение для символов определено для удобства, а не потому, что такое возможно технически.</p></div><p>К примеру, когда вызывается экшн <code>ArticlesController</code>, Rails пытается оптимистично использовать <code>ArticlesHelper</code>. Это нормально, когда не существует модуля хелпера, поэтому если вызывается исключение для этого имени константы, оно должно молчать. Но в случае, если <code>articles_helper.rb</code> вызывает <code>NameError</code> благодаря неизвестной константе, оно должно быть перевызвано. Метод <code>missing_name?</code> предоставляет способ проведения различия в этих двух случаях:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/name_error.rb</code>.</p></div><h3 id='rasshireniya-dlya-loaderror' class='inside_page_header'><a href="#rasshireniya-dlya-loaderror">20.</a> Расширения для <code>LoadError</code></h3><p>Active Support добавляет <a href="https://api.rubyonrails.org/classes/LoadError.html#method-i-is_missing-3F"><code>is_missing?</code></a> к <code>LoadError</code>.</p><p>Для заданного имени пути <code>is_missing?</code> проверяет, будет ли вызвано исключение из-за определенного файла (за исключением файлов с расширением &quot;.rb&quot;).</p><p>Например, когда вызывается экшн <code>ArticlesController</code>, Rails пытается загрузить <code>articles_helper.rb</code>, но этот файл может не существовать. Это нормально, модуль хелпера не обязателен, поэтому Rails умалчивает ошибку загрузки. Но может быть случай, что модуль хелпера существует, и в свою очередь требует другую библиотеку, которая отсутствует. В этом случае Rails должен вызвать исключение. Метод <code>is_missing?</code> предоставляет способ проведения различия в этих двух случаях:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/load_error.rb</code>.</p></div><h3 id='rasshireniya-dlya-pathname' class='inside_page_header'><a href="#rasshireniya-dlya-pathname">21.</a> Расширения для Pathname</h3><h4 id='existence' class='inside_page_header'><a href="#existence">21.1.</a> <code>existence</code></h4><p>Метод <a href="https://api.rubyonrails.org/classes/Pathname.html#method-i-existence"><code>existence</code></a> возвращает получатель, если существует названный файл, а в противном случае возвращает <code>nil</code>. Это полезно для подобных идиом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">content</span> <span class="o">=</span> <span class="no">Pathname</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"file"</span><span class="p">).</span><span class="nf">existence</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">read</span>
</code></pre>
</div>
<div class="note"><p>Определено в <code>active_support/core_ext/pathname/existence.rb</code>.</p></div>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
              <a target="blank" href="http://twitter.com/rusrails"><img src="/assets/twitter-50e0e767c8793dec313a7dc5cfbcfe2067e3e89ea6ec64784eb7c6640f578758.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-8ee447905888b153d8458707061a14b1f15f69b6733e871a3ad91d80ae89e87b.js"></script>
  </body>
</html>

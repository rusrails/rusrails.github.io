<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Хелперы форм в Action View" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/form-helpers" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Хелперы форм в Action View
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_2_release_notes">Версия 7.2 - ?</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#rabota-s-prostymi-formami">1. Работа с простыми формами</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#harakternaya-forma-poiska">1.1. Характерная форма поиска</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#helpery-dlya-generatsii-elementov-formy">1.2. Хелперы для генерации элементов формы</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#chekboksy">1.2.1. Чекбоксы</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#radioknopki">1.2.2. Радиокнопки</a>
</h6>      </li>
      <li>
        <h5>
          <a href="#other-helpers-of-interest">1.3. Другие интересные хелперы</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#creating-forms-with-model-objects">2. Создание форм с помощью объектов модели</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#privyazyvanie-formy-k-ob-ektu">2.1. Привязывание формы к объекту</a>
</h5>      </li>
      <li>
        <h6>
          <a href="#formy-c-sostavnym-pervichnym-klyuchom">2.1.1. Формы c составным первичным ключом</a>
</h6>      </li>
      <li>
        <h6>
          <a href="#helper-fields_for">2.1.2. Хелпер <code>fields_for</code></a>
</h6>      </li>
      <li>
        <h5>
          <a href="#relying-on-record-identification">2.2. Положитесь на идентификацию записи</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#rabota-s-prostranstvami-imen">2.3. Работа с пространствами имен</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#formy-s-metodami-patch-put-ili-delete">2.4. Формы с методами PATCH, PUT или DELETE</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#legkoe-sozdanie-spiskov-vybora">3. Легкое создание списков выбора</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#gruppy-optsiy-dlya-spiska-vyborov">3.1. Группы опций для списка выборов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#privyazka-spiskov-vybora-k-ob-ektam-modeli">3.2. Привязка списков выбора к объектам модели</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#ispolzovanie-helperov-daty-i-vremeni">4. Использование хелперов даты и времени</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#spiski-vybora-dlya-komponentov-vremeni-ili-daty">4.1. Списки выбора для компонентов времени или даты</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#vybor-chasovogo-poyasa">4.2. Выбор часового пояса</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#collection-related-helpers">5. Хелперы, относящиеся к коллекции</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#vybor-iz-kollektsii-proizvolnyh-ob-ektov">6. Выбор из коллекции произвольных объектов</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#helper-collection_select">6.1. Хелпер <code>collection_select</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#helper-collection_radio_buttons">6.2. Хелпер <code>collection_radio_buttons</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#helper-collection_checkboxes">6.3. Хелпер <code>collection_checkboxes</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#uploading-files">7. Загрузка файлов</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#primer-zagruzki-csv-fayla">7.1. Пример загрузки CSV-файла</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#nastroyka-form-bilderov-form-builder">8. Настройка Форм-билдеров (Form Builder)</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#form-input-naming-conventions-and-params-hash">9. Соглашения по именованию полей ввода формы и хэш <code>params</code></a>
</h4>      </li>
      <li>
        <h5>
          <a href="#bazovaya-struktura">9.1. Базовая структура</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#kombinirovanie-massivov-i-heshey">9.2. Комбинирование массивов и хэшей</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#heshi-s-indeksom">9.3. Хэши с индексом</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#sozdanie-slozhnyh-form">10. Создание сложных форм</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#nastroyka-vlozhennyh-atributov-modeli">10.1. Настройка вложенных атрибутов модели</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#vlozhennye-formy-vo-vyu">10.2. Вложенные формы во вью</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#permitting-parameters-in-the-controller">10.3. Разрешение параметров в контроллере</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#udalenie-svyazannyh-ob-ektov">10.4. Удаление связанных объектов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#predotvraschenie-pustyh-zapisey">10.5. Предотвращение пустых записей</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#formy-k-vneshnim-resursam">11. Формы к внешним ресурсам</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#ispolzovanie-helperov-tega-bez-postroitelya-form">12. Использование хелперов тега без построителя форм</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#ispolzovanie-form_tag-i-form_for">13. Использование <code>form_tag</code> и <code>form_for</code></a>
</h4>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='helpery-form-v-action-view' class='inside_page_header'> Хелперы форм в Action View</h2><p>Формы - это обычный интерфейс в веб-приложениях. Однако, разметка форм может быть нудной в написании и поддержке из-за необходимости обрабатывать элементы управления формы, имена и атрибуты. Rails упрощает это, предоставляя вспомогательные методы для вью, которые генерируют HTML-разметку форм. Это руководство поможет вам понять различные вспомогательные методы и когда использовать каждый из них.</p><p>После прочтения этого руководства, вы узнаете:</p><ul><li>Как создать простые формы, такие как форма поиска.
</li><li>Как работать с формами на основе моделей для создания и редактирования конкретных записей базы данных.
</li><li>Как сгенерировать списки выбора (select box) с различными типами данных
</li><li>Какие хелперы даты и времени предоставляет Rails
</li><li>В чем особенность формы загрузки файлов
</li><li>Как отправлять формы на внешние ресурсы и указывать настройку <code>authenticity_token</code>.
</li><li>Как создавать сложные формы
</li></ul><p>Это руководство не является подробным списком всех доступных хелперов форм. Обратитесь к <a href="https://api.rubyonrails.org/classes/ActionView/Helpers.html">документации по Rails API</a> за полным списком хелперов форм и их аргументов.</p><h3 id='rabota-s-prostymi-formami' class='inside_page_header'><a href="#rabota-s-prostymi-formami">1.</a> Работа с простыми формами</h3><p>Главный хелпер форм - это <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Содержимое формы
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>При вызове без аргументов, он создает HTML-тег <code>&lt;form&gt;</code> со значением атрибута <code>method</code>, установленным на <code>post</code>, и значением атрибута <code>action</code>, установленным на текущую страницу. Например, предполагая, что текущая страница является домашней страницей по адресу <code>/home</code>, сгенерированный HTML будет выглядеть следующим образом:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/home"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"Lz6ILqUEs2CGdDa-oz38TqcqQORavGnbGkG0CQA8zc8peOps-K7sHgFSTPSkBx89pQxh3p5zPIkjoOTiA_UWbQ"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>
  Содержимое формы
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Обратите внимание, что форма содержит элемент <code>input</code> с типом <code>hidden</code>. Этот скрытый элемент ввода <code>authenticity_token</code> требуется для отправки форм, отличных от GET. Этот токен является функцией безопасности в Rails, используемой для предотвращения атак подделки межсайтовых запросов (CSRF), и хелперы форм автоматически генерируют его для каждой формы, отличной от GET (при условии, что функция безопасности включена). Вы можете прочитать об этом подробнее в руководстве <a href="/security#cross-site-request-forgery-csrf">Безопасность приложений на Rails</a>.</p><h4 id='harakternaya-forma-poiska' class='inside_page_header'><a href="#harakternaya-forma-poiska">1.1.</a> Характерная форма поиска</h4><p>Одной из наиболее простых форм в вебе является форма поиска. Эта форма содержит:</p><ul><li>элемент формы с методом &quot;GET&quot;,
</li><li>метку для поля ввода,
</li><li>элемент поля ввода текста и
</li><li>элемент отправки.
</li></ul><p>Вот как создать форму поиска с помощью <code>form_with</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/search"</span><span class="p">,</span> <span class="ss">method: :get</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:query</span><span class="p">,</span> <span class="s2">"Search for:"</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:query</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="s2">"Search"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Это сгенерирует следующий HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/search"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"query"</span><span class="nt">&gt;</span>Search for:<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"query"</span> <span class="na">id=</span><span class="s">"query"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Search"</span> <span class="na">data-disable-with=</span><span class="s">"Search"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Обратите внимание, что для поисковой формы мы используем опцию <code>url</code> метода <code>form_with</code>. Установка <code>url: &quot;/search&quot;</code> изменяет значение атрибута action формы со значения по умолчанию (путь текущей страницы) на <code>action=&quot;/search&quot;</code>.</p><p>В общем случае, передача <code>url: my_path</code> в <code>form_with</code> указывает форме, куда отправлять запрос. Другим вариантом является передача объектов Active Model в форму, как вы узнаете <a href="#creating-forms-with-model-objects">ниже</a>. Вы также можете использовать <a href="/routing#path-and-url-helpers">хелперы URL</a>.</p><p>В приведенном выше примере поисковой формы также показан объект <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html">построитель форм</a>. О множестве хелперов, предоставляемых объектом построителя форм (например, <code>form.label</code> и <code>form.text_field</code>), вы узнаете в следующем разделе.</p><div class="info"><p>Для каждого элемента <code>input</code> формы из его названия генерируется атрибут <code>id</code> (<code>&quot;query&quot;</code> в приведенном выше примере). Эти идентификаторы могут быть очень полезны для стилизации CSS или манипулирования элементами управления формы с помощью JavaScript.</p></div><div class="warning"><p>Для поисковых форм используйте метод &quot;GET&quot;. В целом, соглашения Rails рекомендуют использовать правильный HTTP-метод для экшнов контроллера. Использование &quot;GET&quot; для поиска позволяет пользователям добавлять конкретный поиск в закладки.</p></div><h4 id='helpery-dlya-generatsii-elementov-formy' class='inside_page_header'><a href="#helpery-dlya-generatsii-elementov-formy">1.2.</a> Хелперы для генерации элементов формы</h4><p>Объект построителя формы, вкладываемый <code>form_with</code>, предоставляет множество вспомогательных методов для генерации обычных элементов формы, таких как чекбоксы, текстовые поля и радиокнопки.</p><p>Первый аргумент для этих методов всегда является именем ввода. Это полезно помнить, потому что при отправке формы это имя будет передано контроллеру вместе с данными формы в хэше <code>params</code>. Имя будет ключом в <code>params</code> для значения, введенного пользователем для этого поля.</p><p>Например, если форма содержит <code>&lt;%= form.text_field :query %&gt;</code>, то вы сможете получить значение этого поля в контроллере с помощью <code>params[:query]</code>.</p><p>При именовании полей ввода Rails использует определенные соглашения, делающие возможным отправлять параметры с нескалярными величинами, такими как массивы и хэши, которые также будут доступны в <code>params</code>. Подробнее об этом можно прочесть в разделе <a href="#form-input-naming-conventions-and-params-hash">Соглашения по именованию полей ввода формы и хэш <code>params</code></a>. Для подробностей по точному использованию этих хелперов, обратитесь к <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html">документации по API</a>.</p><h5 id='chekboksy' class='inside_page_header'><a href="#chekboksy">1.2.1.</a> Чекбоксы</h5><p>Чекбокс - это элемент управления формой, который позволяет выбрать или снять один параметр. Группа чекбоксов обычно используется для того, чтобы пользователь мог выбрать один или несколько вариантов из группы.</p><p>Вот пример с тремя чекбоксами в форме:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">checkbox</span> <span class="ss">:biography</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:biography</span><span class="p">,</span> <span class="s2">"Biography"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">checkbox</span> <span class="ss">:romance</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:romance</span><span class="p">,</span> <span class="s2">"Romance"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">checkbox</span> <span class="ss">:mystery</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:mystery</span><span class="p">,</span> <span class="s2">"Mystery"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное сгенерирует следующее:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"biography"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">name=</span><span class="s">"biography"</span> <span class="na">id=</span><span class="s">"biography"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"biography"</span><span class="nt">&gt;</span>Biography<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"romance"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">name=</span><span class="s">"romance"</span> <span class="na">id=</span><span class="s">"romance"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"romance"</span><span class="nt">&gt;</span>Romance<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"mystery"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">name=</span><span class="s">"mystery"</span> <span class="na">id=</span><span class="s">"mystery"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"mystery"</span><span class="nt">&gt;</span>Mystery<span class="nt">&lt;/label&gt;</span>
</code></pre>
</div>
<p>Первый параметр <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-checkbox"><code>checkbox</code></a> — это имя элемента ввода, который можно найти в хэше <code>params</code>. Если пользователь выбрал только чекбокс &quot;Biography&quot;, хэш <code>params</code> будет содержать:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s2">"biography"</span> <span class="o">=&gt;</span> <span class="s2">"1"</span><span class="p">,</span>
  <span class="s2">"romance"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span><span class="p">,</span>
  <span class="s2">"mystery"</span> <span class="o">=&gt;</span> <span class="s2">"0"</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Вы можете использовать <code>params[:biography]</code>, чтобы проверить, установлен ли этот чекбокс пользователем.</p><p>Значения чекбокса (значений, которые появятся в <code>params</code>), можно необязательно указать с помощью параметров <code>checked_value</code> и <code>unchecked_value</code>. Более подробную информацию смотрите в <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-checkbox">документации API</a>.</p><p>Существует также <code>collection_checkboxes</code>, о котором вы можете узнать в разделе <a href="#collection-related-helpers">Вспомогательные методы, связанные с коллекциями</a>.</p><h5 id='radioknopki' class='inside_page_header'><a href="#radioknopki">1.2.2.</a> Радиокнопки</h5><p>Радиокнопки - это элементы управления формами, которые позволяют пользователю выбрать только один вариант из списка доступных.</p><p>Например, радиокнопки для выбора любимого вкуса мороженого:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">radio_button</span> <span class="ss">:flavor</span><span class="p">,</span> <span class="s2">"chocolate_chip"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:flavor_chocolate_chip</span><span class="p">,</span> <span class="s2">"Chocolate Chip"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">radio_button</span> <span class="ss">:flavor</span><span class="p">,</span> <span class="s2">"vanilla"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:flavor_vanilla</span><span class="p">,</span> <span class="s2">"Vanilla"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">radio_button</span> <span class="ss">:flavor</span><span class="p">,</span> <span class="s2">"hazelnut"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:flavor_hazelnut</span><span class="p">,</span> <span class="s2">"Hazelnut"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное сгенерирует следующий HTML-код:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"chocolate_chip"</span> <span class="na">name=</span><span class="s">"flavor"</span> <span class="na">id=</span><span class="s">"flavor_chocolate_chip"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"flavor_chocolate_chip"</span><span class="nt">&gt;</span>Chocolate Chip<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"vanilla"</span> <span class="na">name=</span><span class="s">"flavor"</span> <span class="na">id=</span><span class="s">"flavor_vanilla"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"flavor_vanilla"</span><span class="nt">&gt;</span>Vanilla<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"hazelnut"</span> <span class="na">name=</span><span class="s">"flavor"</span> <span class="na">id=</span><span class="s">"flavor_hazelnut"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"flavor_hazelnut"</span><span class="nt">&gt;</span>Hazelnut<span class="nt">&lt;/label&gt;</span>
</code></pre>
</div>
<p>Второй аргумент для <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-radio_button"><code>radio_button</code></a> - это значение поля ввода. Так как эти радиокнопки имеют одинаковое имя (<code>flavor</code>), пользователь может выбрать одну, и <code>params[:flavor]</code> будет содержать <code>&quot;chocolate_chip&quot;</code>, <code>&quot;vanilla&quot;</code> или <code>hazelnut</code>.</p><div class="note"><p>Всегда используйте метки (labels) для чекбоксов и радиокнопок. Они связывают текст с определенной опцией с помощью атрибута <code>for</code> и, предоставляя большее пространство для клика, упрощают выбор пользователем нужного пункта радиокнопки.</p></div><h4 id='other-helpers-of-interest' class='inside_page_header'><a href="#other-helpers-of-interest">1.3.</a> Другие интересные хелперы</h4><p>Существует множество других элементов управления формами, включая текст, электронную почту, пароль, дату и время. Примеры ниже показывают некоторые другие хелперы и их сгенерированный HTML.</p><p>Хелперы, связанные с датой и временем:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">date_field</span> <span class="ss">:born_on</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">time_field</span> <span class="ss">:started_at</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">datetime_local_field</span> <span class="ss">:graduation_day</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">month_field</span> <span class="ss">:birthday_month</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">week_field</span> <span class="ss">:birthday_week</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">name=</span><span class="s">"born_on"</span> <span class="na">id=</span><span class="s">"born_on"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"time"</span> <span class="na">name=</span><span class="s">"started_at"</span> <span class="na">id=</span><span class="s">"started_at"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"datetime-local"</span> <span class="na">name=</span><span class="s">"graduation_day"</span> <span class="na">id=</span><span class="s">"graduation_day"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"month"</span> <span class="na">name=</span><span class="s">"birthday_month"</span> <span class="na">id=</span><span class="s">"birthday_month"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"week"</span> <span class="na">name=</span><span class="s">"birthday_week"</span> <span class="na">id=</span><span class="s">"birthday_week"</span><span class="nt">&gt;</span>
</code></pre>
</div>
<p>Хелперы со специальным форматированием:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">password_field</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">email_field</span> <span class="ss">:address</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">telephone_field</span> <span class="ss">:phone</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">url_field</span> <span class="ss">:homepage</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">id=</span><span class="s">"password"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"address"</span> <span class="na">id=</span><span class="s">"address"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"tel"</span> <span class="na">name=</span><span class="s">"phone"</span> <span class="na">id=</span><span class="s">"phone"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"url"</span> <span class="na">name=</span><span class="s">"homepage"</span> <span class="na">id=</span><span class="s">"homepage"</span><span class="nt">&gt;</span>
</code></pre>
</div>
<p>Другие обычные хелперы:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">textarea</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">size: </span><span class="s2">"70x5"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">hidden_field</span> <span class="ss">:parent_id</span><span class="p">,</span> <span class="ss">value: </span><span class="s2">"foo"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">number_field</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">in: </span><span class="mf">1.0</span><span class="o">..</span><span class="mf">20.0</span><span class="p">,</span> <span class="ss">step: </span><span class="mf">0.5</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">range_field</span> <span class="ss">:discount</span><span class="p">,</span> <span class="ss">in: </span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">search_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">color_field</span> <span class="ss">:favorite_color</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"message"</span> <span class="na">id=</span><span class="s">"message"</span> <span class="na">cols=</span><span class="s">"70"</span> <span class="na">rows=</span><span class="s">"5"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">"foo"</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"parent_id"</span> <span class="na">id=</span><span class="s">"parent_id"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">step=</span><span class="s">"0.5"</span> <span class="na">min=</span><span class="s">"1.0"</span> <span class="na">max=</span><span class="s">"20.0"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">id=</span><span class="s">"price"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">min=</span><span class="s">"1"</span> <span class="na">max=</span><span class="s">"100"</span> <span class="na">type=</span><span class="s">"range"</span> <span class="na">name=</span><span class="s">"discount"</span> <span class="na">id=</span><span class="s">"discount"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">id=</span><span class="s">"name"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">"#000000"</span> <span class="na">type=</span><span class="s">"color"</span> <span class="na">name=</span><span class="s">"favorite_color"</span> <span class="na">id=</span><span class="s">"favorite_color"</span><span class="nt">&gt;</span>
</code></pre>
</div>
<p>Скрытые поля не отображаются пользователю, вместо этого они содержат данные, как и любое текстовое поле. Их значения могут быть изменены с помощью JavaScript.</p><div class="info"><p>Если используются поля для ввода пароля, вы можете настроить свое приложение для предотвращения появления их значений в логах приложения. Это можно изучить в руководстве <a href="/security">Безопасность приложений на Rails</a>.</p></div><h3 id='creating-forms-with-model-objects' class='inside_page_header'><a href="#creating-forms-with-model-objects">2.</a> Создание форм с помощью объектов модели</h3><h4 id='privyazyvanie-formy-k-ob-ektu' class='inside_page_header'><a href="#privyazyvanie-formy-k-ob-ektu">2.1.</a> Привязывание формы к объекту</h4><p>Хелпер <code>form_with</code> имеет опцию <code>:model</code>, которая позволяет связать объект конструктора формы с объектом модели. Это означает, что форма будет связана с этим объектом модели, а поля формы будут заполнены значениями из этого объекта модели.</p><p>К примеру, если у нас есть объект модели <code>@book</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Book id: 42, title: "Walden", author: "Henry David Thoreau"&gt;</span>
</code></pre>
</div>
<p>И следующая форма для создания новой книги:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@book</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:author</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Сгенерирует такой HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/books"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"book_title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"book[title]"</span> <span class="na">id=</span><span class="s">"book_title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"book_author"</span><span class="nt">&gt;</span>Author<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"book[author]"</span> <span class="na">id=</span><span class="s">"book_author"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Create Book"</span> <span class="na">data-disable-with=</span><span class="s">"Create Book"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Некоторые важные моменты при использовании <code>form_with</code> с объектом модели:</p><ul><li><code>action</code> формы автоматически заполняется подходящим значением, <code>action=&quot;/books&quot;</code>. Если бы вы обновляли книгу, это было бы <code>action=&quot;/books/42&quot;</code>.
</li><li>Имена полей формы имеют область видимости <code>book[...]</code>. Это означает, что <code>params[:book]</code> будет хешем, содержащим значения всех этих полей. Вы можете узнать больше о значении имен ввода в разделе <a href="#form-input-naming-conventions-and-params-hash">про именование параметров</a> этого руководства.
</li><li>Кнопке отправки автоматически присваивается подходящее текстовое значение, в данном случае &quot;Create Book&quot;.
</li></ul><p>СОВЕТ: Обычно ваши поля ввода формы будут отражать атрибуты модели. Однако это не обязательно. Если вам нужна другая информация, вы можете включить поле в свою форму и получить доступ к нему через <code>params[:book][:my_non_attribute_input]</code>.</p><h5 id='formy-c-sostavnym-pervichnym-klyuchom' class='inside_page_header'><a href="#formy-c-sostavnym-pervichnym-klyuchom">2.1.1.</a> Формы c составным первичным ключом</h5><p>Если у вас есть модель с <a href="/active_record_composite_primary_keys">TODO: составным первичным ключом</a>, синтаксис построения формы такой же, но с небольшими отличиями в выводе.</p><p>Например, для обновления объекта модели <code>@book</code> с составным ключом <code>[:author_id, :id]</code> следующим образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@book</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">])</span>
<span class="c1"># =&gt; #&lt;Book id: 25, title: "Some book", author_id: 2&gt;</span>
</code></pre>
</div>
<p>Следующая форма:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@book</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Сгенерирует этот вывод HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/books/2_25"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"ChwHeyegcpAFDdBvXvDuvbfW7yCA3e8gvhyieai7DhG28C3akh-dyuv-IBittsjPrIjETlQQvQJ91T77QQ8xWA"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"book[title]"</span> <span class="na">id=</span><span class="s">"book_title"</span> <span class="na">value=</span><span class="s">"Some book"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Update Book"</span> <span class="na">data-disable-with=</span><span class="s">"Update Book"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Обратите внимание, что сгенерированный URL содержит <code>author_id</code> и <code>id</code>, разделенные подчеркиванием. После отправки контроллер может извлечь каждое значение первичного ключа <a href="/action-controller-overview#composite-key-parameters">извлечь каждое значение первичного ключа</a> из параметров и обновить запись, как это делается с одиночным первичным ключом.</p><h5 id='helper-fields_for' class='inside_page_header'><a href="#helper-fields_for">2.1.2.</a> Хелпер <code>fields_for</code></h5><p>Хелпер <code>fields_for</code> используется для отображения полей для связанных объектов модели в одной и той же форме. Связанная &quot;внутренняя&quot; модель обычно связана с &quot;основной&quot; моделью формы через связь Active Record. Например, если имеется модель <code>Person</code> со связанной моделью <code>ContactDetail</code>, можно создать форму для создания обеих моделей подобным образом:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">person_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">fields_for</span> <span class="ss">:contact_detail</span><span class="p">,</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">contact_detail</span> <span class="k">do</span> <span class="o">|</span><span class="n">contact_detail_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">contact_detail_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:phone_number</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное выдаст такой результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/people"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"..."</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"contact_detail[phone_number]"</span> <span class="na">id=</span><span class="s">"contact_detail_phone_number"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Объект, предоставляемый <code>fields_for</code> - это форм-билдер, подобный тому, который предоставляется <code>form_with</code>. Хелпер <code>fields_for</code> создает похожее связывание, но не отрисовывает тег <code>&lt;form&gt;</code>. Вы можете узнать больше о <code>field_for</code> в <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-fields_for">API-документации</a>.</p><h4 id='relying-on-record-identification' class='inside_page_header'><a href="#relying-on-record-identification">2.2.</a> Положитесь на идентификацию записи</h4><p>При работе с RESTful ресурсами вызовы <code>form_with</code> можно упростить, используя <strong>идентификацию записей</strong>. Это означает, что вы передаете экземпляр модели и позволяете Rails определить имя модели, метод и другие вещи. В приведенном ниже примере для создания новой записи оба вызова <code>form_with</code> генерируют одинаковый HTML:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># долгий способ:</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">articles_path</span><span class="p">)</span>
<span class="c1"># сокращение:</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">)</span>
</code></pre>
</div>
<p>Аналогично, для редактирования существующей статьи, как показано ниже, оба вызова <code>form_with</code> также будут генерировать одинаковый HTML:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># долгий способ:</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span> <span class="ss">method: </span><span class="s2">"patch"</span><span class="p">)</span>
<span class="c1"># сокращение:</span>
<span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">)</span>
</code></pre>
</div>
<p>Отметьте, что вызов сокращения <code>form_with</code> является идентичным, независимо от того, запись новая или уже существует. Идентификация записи достаточно сообразительная, чтобы выяснить, новая ли запись, запрашивая <a href="https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-persisted-3F"><code>record.persisted?</code></a>. Она также выбирает правильный путь для подтверждения и имя, основанное на классе объекта.</p><p>Это предполагает, что модель <code>Article</code> объявлена с <code>resources :articles</code> в файле маршрутов.</p><p>Если у вас <a href="/routing#singular-resources">одиночный ресурс</a>, нужно вызвать <code>resource</code> и <code>resolve</code> для работы с <code>form_with</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">resource</span> <span class="ss">:article</span>
<span class="n">resolve</span><span class="p">(</span><span class="s1">'Article'</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="ss">:article</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
</div>
<div class="info"><p>Объявление ресурса имеет ряд побочных эффектов. Смотрите руководство <a href="/routing#resource-routing-the-rails-default">Rails Routing from the Outside In</a> для получения дополнительной информации о настройке и использовании ресурсов.</p></div><div class="warning"><p>Когда используется <a href="/active-record-associations#single-table-inheritance-sti">наследование с единой таблицей</a> с вашими моделями, нельзя полагаться на идентификацию записей подкласса, если только их родительский класс определен ресурсом. Необходимо явно указывать <code>:url</code> и <code>:scope</code> (имя модели).</p></div><h4 id='rabota-s-prostranstvami-imen' class='inside_page_header'><a href="#rabota-s-prostranstvami-imen">2.3.</a> Работа с пространствами имен</h4><p>Если имеется пространство имен для маршрутов, в <code>form_with</code> также есть сокращение для этого. Например, сли в приложении есть пространство имен <code>admin</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="vi">@article</span><span class="p">]</span>
</code></pre>
</div>
<p>Вышеуказанное создаст форму, которая передается <code>ArticlesController</code> в пространстве имен admin, следовательно в <code>admin_article_path(@article)</code> в случае с обновлением.</p><p>Если у вас несколько уровней пространства имен, тогда синтаксис подобный:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="ss">:management</span><span class="p">,</span> <span class="vi">@article</span><span class="p">]</span>
</code></pre>
</div>
<p>Более подробно о системе маршрутизации Rails и связанным соглашениям смотрите руководство <a href="/routing">Роутинг в Rails</a>.</p><h4 id='formy-s-metodami-patch-put-ili-delete' class='inside_page_header'><a href="#formy-s-metodami-patch-put-ili-delete">2.4.</a> Формы с методами PATCH, PUT или DELETE</h4><p>Фреймворк Rails поддерживает стиль RESTful, что подразумевает, что формы в ваших приложениях будут делать запросы, где <code>method</code> <code>PATCH</code>, <code>PUT</code> или <code>DELETE</code>, в дополнение к <code>GET</code> и <code>POST</code>. Однако, формы HTML <em>не поддерживают</em> методы, отличные от <code>GET</code> и <code>POST</code>, когда дело доходит до подтверждения форм.</p><p>Rails работает с этим ограничением, эмулируя другие методы с помощью POST со скрытым полем, названным <code>&quot;_method&quot;</code>. Например:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">form_with</span><span class="p">(</span><span class="ss">url: </span><span class="n">search_path</span><span class="p">,</span> <span class="ss">method: </span><span class="s2">"patch"</span><span class="p">)</span>
</code></pre>
</div>
<p>Вышеуказанная форма сгенерирует результирующий HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/search"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"R4quRuXQAq75TyWpSf8AwRyLt-R1uMtPP1dHTTWJE5zbukiaY8poSTXxq3Z7uAjXfPHiKQDsWE1i2_-h0HSktQ"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>При парсинге данных, отправленных с помощью POST, Rails принимает во внимание специальный параметр <code>_method</code> и продолжает обработку, как если бы метод HTTP-запроса был тем, что установлен в <code>_method</code> (<code>PATCH</code> в этом примере).</p><p>При рендере формы кнопки отправки могут переопределять атрибут <code>method</code> с помощью ключевого слова <code>formmethod:</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/posts/1"</span><span class="p">,</span> <span class="ss">method: :patch</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">button</span> <span class="s2">"Delete"</span><span class="p">,</span> <span class="ss">formmethod: :delete</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">button</span> <span class="s2">"Update"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Как и для элементов <code>&lt;form&gt;</code>, многие браузеры <em>не поддерживают</em> переопределение методов формы, объявленные с помощью <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a>, отличные от <code>GET</code> и <code>POST</code>.</p><p>Rails обходит эту проблему, эмулируя остальные методы на основе POST с помощью комбинации атрибутов <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-formmethod">formmethod</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-value">value</a> и <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#attr-name">name</a>:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/posts/1"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"f755bb0ed134b76c432144748a6d4b7a7ddf2b71"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>

  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">formmethod=</span><span class="s">"post"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"delete"</span> <span class="na">data-confirm=</span><span class="s">"Are you sure?"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"button"</span><span class="nt">&gt;</span>Update<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>В этом случае кнопка &quot;Update&quot; будет обрабатываться как <code>PATCH</code>, а кнопка &quot;Delete&quot; - как <code>DELETE</code>.</p><h3 id='legkoe-sozdanie-spiskov-vybora' class='inside_page_header'><a href="#legkoe-sozdanie-spiskov-vybora">3.</a> Легкое создание списков выбора</h3><p>Список выбора, также известный как раскрывающийся список, позволяют пользователям выбирать из списка вариантов. HTML для полей выбора требует значительного количества разметки - один элемент <code>&lt;option&gt;</code> для каждого варианта на выбор. Rails предоставляет вспомогательные методы для создания этой разметки.</p><p>Например, скажем у нас есть список городов для выбора пользователем. Можно использовать хелпер <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-select"><code>select</code></a>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"Lisbon"</span><span class="p">,</span> <span class="s2">"Madrid"</span><span class="p">]</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное сгенерирует результирующий HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Berlin"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Chicago"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Madrid"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<p>И выбранное значение будет доступно в <code>params[:city]</code> как обычно.</p><p>Можно указать значения <code>&lt;option&gt;</code> отличные от их надписи:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]]</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<p>Таким образом, пользователь увидит полные имена городов, но <code>params[:city]</code> будет одним из <code>&quot;BE&quot;</code>, <code>&quot;CHI&quot;</code> или <code>&quot;MD&quot;</code>.</p><p>Наконец, можно указать выбор по умолчанию для списка выбора с помощью аргумента <code>:selected</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]],</span> <span class="ss">selected: </span><span class="s2">"CHI"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<h4 id='gruppy-optsiy-dlya-spiska-vyborov' class='inside_page_header'><a href="#gruppy-optsiy-dlya-spiska-vyborov">3.1.</a> Группы опций для списка выборов</h4><p>Иногда нужно улучшить пользовательский опыт, сгруппировав вместе схожие опции. Это можно сделать, передав <code>Hash</code> (ли совместимый <code>Array</code>) в <code>select</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="s2">"Europe"</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="p">[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]</span> <span class="p">],</span>
        <span class="s2">"North America"</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">]</span> <span class="p">],</span>
      <span class="p">},</span>
      <span class="ss">selected: </span><span class="s2">"CHI"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Результат:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">id=</span><span class="s">"city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;optgroup</span> <span class="na">label=</span><span class="s">"Europe"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;/optgroup&gt;</span>
  <span class="nt">&lt;optgroup</span> <span class="na">label=</span><span class="s">"North America"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;/optgroup&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<h4 id='privyazka-spiskov-vybora-k-ob-ektam-modeli' class='inside_page_header'><a href="#privyazka-spiskov-vybora-k-ob-ektam-modeli">3.2.</a> Привязка списков выбора к объектам модели</h4><p>Подобно другим элементам формы, список выбора может быть связан с атрибутом модели. Например, если имеется такой объект модели <code>@person</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">city: </span><span class="s2">"MD"</span><span class="p">)</span>
</code></pre>
</div>
<p>Следующая форма:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city</span><span class="p">,</span> <span class="p">[[</span><span class="s2">"Berlin"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Chicago"</span><span class="p">,</span> <span class="s2">"CHI"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Madrid"</span><span class="p">,</span> <span class="s2">"MD"</span><span class="p">]]</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет подобный список выбора:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[city]"</span> <span class="na">id=</span><span class="s">"person_city"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"BE"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"CHI"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"MD"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span> <span class="na">end</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre>
</div>
<p>Единственное отличие заключается в том, что выбранный вариант будет найден в <code>params[:person][:city]</code> вместо <code>params[:city]</code>.</p><p>Отметьте, что подходящая опция была автоматически отмечена <code>selected=&quot;selected&quot;</code>. Так как этот список выбора был привязан к существующей записи <code>@person</code>, не нужно указывать аргумент <code>:selected</code>!</p><h3 id='ispolzovanie-helperov-daty-i-vremeni' class='inside_page_header'><a href="#ispolzovanie-helperov-daty-i-vremeni">4.</a> Использование хелперов даты и времени</h3><p>Кроме хелперов <code>date_field</code> и <code>time_field</code>, упомянутых <a href="#other-helpers-of-interest">ранее</a>, Rails предоставляет альтернативные хелперы для форм даты и времени, которые отображают обычные списки выбора. Хелпер <code>date_select</code> отображает отдельный список выбора для года, месяца и дня.</p><p>Например, если у нас есть такой объект модели <code>@person</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">birth_date: </span><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
</code></pre>
</div>
<p>Следующая форма:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">date_select</span> <span class="ss">:birth_date</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет списки выбора наподобие:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(1i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_1i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1990"</span><span class="nt">&gt;</span>1990<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1991"</span><span class="nt">&gt;</span>1991<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1992"</span><span class="nt">&gt;</span>1992<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1993"</span><span class="nt">&gt;</span>1993<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1994"</span><span class="nt">&gt;</span>1994<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1995"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>1995<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1996"</span><span class="nt">&gt;</span>1996<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1997"</span><span class="nt">&gt;</span>1997<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1998"</span><span class="nt">&gt;</span>1998<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1999"</span><span class="nt">&gt;</span>1999<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2000"</span><span class="nt">&gt;</span>2000<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(2i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_2i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>January<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2"</span><span class="nt">&gt;</span>February<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>March<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"4"</span><span class="nt">&gt;</span>April<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"5"</span><span class="nt">&gt;</span>May<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"6"</span><span class="nt">&gt;</span>June<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"7"</span><span class="nt">&gt;</span>July<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"8"</span><span class="nt">&gt;</span>August<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"9"</span><span class="nt">&gt;</span>September<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>October<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"11"</span><span class="nt">&gt;</span>November<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"12"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>December<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[birth_date(3i)]"</span> <span class="na">id=</span><span class="s">"person_birth_date_3i"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/option&gt;</span>
  ...
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"21"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>21<span class="nt">&lt;/option&gt;</span>
  ...
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"31"</span><span class="nt">&gt;</span>31<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<p>Отметьте, что при отправке формы не будет одиночного значения в хэше <code>params</code>. содержащего полную дату. Вместо этого будет несколько значений со специальными именами наподобие <code>&quot;birth_date(1i)&quot;</code>. Однако, Active Record знает, как собрать эти значения в полную дату или время, основываясь на объявленном типе атрибута модели. Таким образом, можно просто передать <code>params[:person]</code> в <code>Person.new</code> или <code>Person#update</code>, как будто бы форма использовала единственное поле, представляющее полную дату.</p><p>В дополнение к хелперу <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-date_select"><code>date_select</code></a>, Rails предоставляет <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_select"><code>time_select</code></a>, выводящий списки выбора для часа и минуты. Также имеется <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-datetime_select"><code>datetime_select</code></a>, который объединяет оба списка выбора даты и времени.</p><h4 id='spiski-vybora-dlya-komponentov-vremeni-ili-daty' class='inside_page_header'><a href="#spiski-vybora-dlya-komponentov-vremeni-ili-daty">4.1.</a> Списки выбора для компонентов времени или даты</h4><p>Rails также предоставляет хелперы для рендера списков выбора для отдельных компонентов времени или даты: <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_year"><code>select_year</code></a>, <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_month"><code>select_month</code></a>, <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_day"><code>select_day</code></a>, <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_hour"><code>select_hour</code></a>, <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_minute"><code>select_minute</code></a> и <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#method-i-select_second"><code>select_second</code></a>. Эти хелперы являются &quot;чистыми&quot; методами, что означает, что они не вызываются на экземпляре построителя формы. Например:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">select_year</span> <span class="mi">2024</span><span class="p">,</span> <span class="ss">prefix: </span><span class="s2">"party"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное выведет подобный список выбора</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"party_year"</span> <span class="na">name=</span><span class="s">"party[year]"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2019"</span><span class="nt">&gt;</span>2019<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2020"</span><span class="nt">&gt;</span>2020<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2021"</span><span class="nt">&gt;</span>2021<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2022"</span><span class="nt">&gt;</span>2022<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2023"</span><span class="nt">&gt;</span>2023<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2024"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>2024<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2025"</span><span class="nt">&gt;</span>2025<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2026"</span><span class="nt">&gt;</span>2026<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2027"</span><span class="nt">&gt;</span>2027<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2028"</span><span class="nt">&gt;</span>2028<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2029"</span><span class="nt">&gt;</span>2029<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<p>Для каждого из этих хелперов вы можете указать объект <code>Date</code> или <code>Time</code> вместо числа в качестве значения по умолчанию (например, <code>&lt;%= select_year Date.today, prefix: &quot;party&quot; %&gt;</code> вместо приведенного выше), при этом будут извлечены соответствующие части даты и времени и использованы.</p><h4 id='vybor-chasovogo-poyasa' class='inside_page_header'><a href="#vybor-chasovogo-poyasa">4.2.</a> Выбор часового пояса</h4><p>Когда вам нужно спросить пользователей, в каком часовом поясе они находятся, есть очень удобный хелпер <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-time_zone_select"><code>time_zone_select</code></a>, который можно использовать.</p><p>Обычно вам пришлось бы предоставлять список вариантов часовых поясов для выбора пользователями. Это может быть утомительно, если бы не список предопределенных объектов <a href="https://api.rubyonrails.org/classes/ActiveSupport/TimeZone.html"><code>ActiveSupport::TimeZone</code></a>. Хелпер <code>time_with_zone</code> оборачивает это и может быть использован следующим образом:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">time_zone_select</span> <span class="ss">:time_zone</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"time_zone"</span> <span class="na">id=</span><span class="s">"time_zone"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"International Date Line West"</span><span class="nt">&gt;</span>(GMT-12:00) International Date Line West<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"American Samoa"</span><span class="nt">&gt;</span>(GMT-11:00) American Samoa<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Midway Island"</span><span class="nt">&gt;</span>(GMT-11:00) Midway Island<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Hawaii"</span><span class="nt">&gt;</span>(GMT-10:00) Hawaii<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Alaska"</span><span class="nt">&gt;</span>(GMT-09:00) Alaska<span class="nt">&lt;/option&gt;</span>
  ...
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Samoa"</span><span class="nt">&gt;</span>(GMT+13:00) Samoa<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Tokelau Is."</span><span class="nt">&gt;</span>(GMT+13:00) Tokelau Is.<span class="nt">&lt;/option&gt;</span>
</code></pre>
</div>
<h3 id='collection-related-helpers' class='inside_page_header'><a href="#collection-related-helpers">5.</a> Хелперы, относящиеся к коллекции</h3><h3 id='vybor-iz-kollektsii-proizvolnyh-ob-ektov' class='inside_page_header'><a href="#vybor-iz-kollektsii-proizvolnyh-ob-ektov">6.</a> Выбор из коллекции произвольных объектов</h3><p>Если нужно создать набор вариантов из коллекции произвольных объектов, в Rails есть хелперы <code>collection_select</code>, <code>collection_radio_button</code> и <code>collection_checkboxes</code>.</p><p>Для иллюстрации полезности этих хелперов, допустим у нас есть модель <code>City</code> и соответствующая связь <code>belongs_to :city</code> с <code>Person</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">City</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:city</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Допустим, у нас есть следующие города, сохраненные в базе данных:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span> <span class="p">[</span><span class="n">city</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">city</span><span class="p">.</span><span class="nf">id</span><span class="p">]</span> <span class="p">}</span>
<span class="c1"># =&gt; [["Berlin", 1], ["Chicago", 3], ["Madrid", 2]]</span>
</code></pre>
</div>
<p>Можно позволить пользователю выбирать город с помощью следующей формы:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">select</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span> <span class="p">[</span><span class="n">city</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="n">city</span><span class="p">.</span><span class="nf">id</span><span class="p">]</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеуказанное сгенерирует такой HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[city_id]"</span> <span class="na">id=</span><span class="s">"person_city_id"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<p>Вышеприведенный пример показывает, как можно сгенерировать варианты вручную. Однако Rails имеет хелперы, которые генерируют варианты из коллекции без необходимости явно перебирать ее. Эти хелперы определяют значение и текстовую метку каждого варианта, вызывая указанные методы для каждого объекта в коллекции.</p><div class="note"><p>При рендере поля для связи <code>belongs_to</code>, необходимо указать имя внешнего ключа (<code>city_id</code> в вышеприведенном примере), а не имя самой связи.</p></div><h4 id='helper-collection_select' class='inside_page_header'><a href="#helper-collection_select">6.1.</a> Хелпер <code>collection_select</code></h4><p>Чтобы создать список выбора, можно использовать <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_select"><code>collection_select</code></a>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_select</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Вышеприведенный вывод совпадает с HTML, полученным при ручном переборе:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"person[city_id]"</span> <span class="na">id=</span><span class="s">"person_city_id"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre>
</div>
<div class="note"><p>Порядок аргументов для <code>collection_select</code> отличается от порядка для <code>select</code>. С помощью <code>collection_select</code> мы определяем сначала метод значения (<code>:id</code> в вышеуказанном примере), а затем метод текстовой надписи (<code>:name</code> в вышеуказанном примере). Это отличается от порядка, используемого при указании вариантов для хелпера <code>select</code>, когда сначала идет текстовая надпись, а потом значение (<code>[&quot;Berlin&quot;, 1]</code> в предыдущем примере).</p></div><h4 id='helper-collection_radio_buttons' class='inside_page_header'><a href="#helper-collection_radio_buttons">6.2.</a> Хелпер <code>collection_radio_buttons</code></h4><p>Чтобы создать набор радиокнопок, можно использовать <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_radio_buttons"><code>collection_radio_buttons</code></a>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_radio_buttons</span> <span class="ss">:city_id</span><span class="p">,</span> <span class="no">City</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">name=</span><span class="s">"person[city_id]"</span> <span class="na">id=</span><span class="s">"person_city_id_1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_city_id_1"</span><span class="nt">&gt;</span>Berlin<span class="nt">&lt;/label&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="na">name=</span><span class="s">"person[city_id]"</span> <span class="na">id=</span><span class="s">"person_city_id_3"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_city_id_3"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/label&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="na">name=</span><span class="s">"person[city_id]"</span> <span class="na">id=</span><span class="s">"person_city_id_2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_city_id_2"</span><span class="nt">&gt;</span>Madrid<span class="nt">&lt;/label&gt;</span>
</code></pre>
</div>
<h4 id='helper-collection_checkboxes' class='inside_page_header'><a href="#helper-collection_checkboxes">6.3.</a> Хелпер <code>collection_checkboxes</code></h4><p>Чтобы создать набор чекбоксов — к примеру, чтобы поддерживать связь <code>has_and_belongs_to_many</code> — можно использовать <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-collection_checkboxes"><code>collection_checkboxes</code></a>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">collection_checkboxes</span> <span class="ss">:interest_ids</span><span class="p">,</span> <span class="no">Interest</span><span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"person[interest_id][]"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="na">id=</span><span class="s">"person_interest_id_3"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_interest_id_3"</span><span class="nt">&gt;</span>Engineering<span class="nt">&lt;/label&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"person[interest_id][]"</span> <span class="na">value=</span><span class="s">"4"</span> <span class="na">id=</span><span class="s">"person_interest_id_4"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_interest_id_4"</span><span class="nt">&gt;</span>Math<span class="nt">&lt;/label&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"person[interest_id][]"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">id=</span><span class="s">"person_interest_id_1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_interest_id_1"</span><span class="nt">&gt;</span>Science<span class="nt">&lt;/label&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"person[interest_id][]"</span> <span class="na">value=</span><span class="s">"2"</span> <span class="na">id=</span><span class="s">"person_interest_id_2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_interest_id_2"</span><span class="nt">&gt;</span>Technology<span class="nt">&lt;/label&gt;</span>
</code></pre>
</div>
<h3 id='uploading-files' class='inside_page_header'><a href="#uploading-files">7.</a> Загрузка файлов</h3><p>Обычная задача с формами - это позволить пользователям загружать файл. Это может быть изображение аватара или CSV-файл с данными для обработки. Поля загрузки файлов могут быть отрендерены с помощью хелпера <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-file_field"><code>file_field</code></a>.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">file_field</span> <span class="ss">:csv_file</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Самое важное, это помнить при загрузке файла, что атрибут <code>enctype</code> формы <em>должен</em> быть установлен как <code>multipart/form-data</code>. Это будет выполнено автоматически, если используете <code>file_field</code> внутри <code>form_with</code>. Также можно установить этот атрибут самому:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s2">"/uploads"</span><span class="p">,</span> <span class="ss">multipart: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">file_field_tag</span> <span class="ss">:csv_file</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Оба из которых выводят следующую HTML-форму:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span> <span class="na">action=</span><span class="s">"/people"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Обратите внимание, что согласно соглашениям <code>form_with</code> имена полей в двух формах выше будут отличаться. В первой форме это будет <code>person[csv_file]</code>(доступно через <code>params[:person][:csv_file]</code>), а во второй форме это будет просто <code>csv_file</code> (доступно через <code>params[:csv_file]</code>).</p><h4 id='primer-zagruzki-csv-fayla' class='inside_page_header'><a href="#primer-zagruzki-csv-fayla">7.1.</a> Пример загрузки CSV-файла</h4><p>При использовании <code>file_field</code>, объект в хэше <code>params</code> - это экземпляр <a href="https://api.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html"><code>ActionDispatch::Http::UploadedFile</code></a>. Вот пример того, как сохранить данные из загруженного CSV-файла в записи в вашем приложении:</p><div class="code_container">
  <pre><code class="highlight ruby">  <span class="nb">require</span> <span class="s1">'csv'</span>

  <span class="k">def</span> <span class="nf">upload</span>
    <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:csv_file</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">uploaded_file</span><span class="p">.</span><span class="nf">present?</span>
      <span class="n">csv_data</span> <span class="o">=</span> <span class="no">CSV</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">.</span><span class="nf">read</span><span class="p">,</span> <span class="ss">headers: </span><span class="kp">true</span><span class="p">)</span>
      <span class="n">csv_data</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
        <span class="c1"># Обработка каждого ряда CSV-файла</span>
        <span class="c1"># SomeInvoiceModel.create(amount: row['Amount'], status: row['Status'])</span>
        <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="n">row</span><span class="p">.</span><span class="nf">inspect</span>
        <span class="c1">#&lt;CSV::Row "id":"po_1KE3FRDSYPMwkcNz9SFKuaYd" "Amount":"96.22" "Created (UTC)":"2022-01-04 02:59" "Arrival Date (UTC)":"2022-01-05 00:00" "Status":"paid"&gt;</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
</code></pre>
</div>
<p>Если файл является изображением, которое необходимо хранить с моделью (например, изображение профиля пользователя), необходимо рассмотреть ряд задач, таких как место хранения файла (на диске, Amazon S3 и т.д.), изменение размера файлов изображений и создание миниатюр и т.д. Для помощи с такими задачами разработан <a href="/active_storage_overview">Active Storage</a>.</p><h3 id='nastroyka-form-bilderov-form-builder' class='inside_page_header'><a href="#nastroyka-form-bilderov-form-builder">8.</a> Настройка Форм-билдеров (Form Builder)</h3><p>Мы называем объекты, предоставляемые <code>form_with</code> или  <code>fields_for</code>, Форм-билдерами (Form Builders). Форм-билдеры позволяют вам генерировать элементы формы, связанные с объектом модели, и являются экземпляром <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html"><code>ActionView::Helpers::FormBuilder</code></a>. Этот класс можно расширять, чтобы добавлять пользовательские вспомогательные методы для вашего приложения.</p><p>Например, если вы хотите отобразить поле <code>text_field</code> вместе с меткой <code>label</code> по всему вашему приложению, вы можете добавить следующий вспомогательный метод в <code>application_helper.rb</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ApplicationHelper</span>
  <span class="k">def</span> <span class="nf">text_field_with_label</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">attribute</span><span class="p">)</span>
    <span class="n">form</span><span class="p">.</span><span class="nf">label</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">+</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>И используйте его в форме как обычно:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">text_field_with_label</span> <span class="n">form</span><span class="p">,</span> <span class="ss">:first_name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Но вы также можете создать подкласс <code>ActionView::Helpers::FormBuilder</code> и добавить хелперы туда. После определения этого подкласса <code>LabellingFormBuilder</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">LabellingFormBuilder</span> <span class="o">&lt;</span> <span class="no">ActionView</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">FormBuilder</span>
  <span class="k">def</span> <span class="nf">text_field</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="c1"># super вызовет оригинальный метод text_field</span>
    <span class="n">label</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">+</span> <span class="k">super</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Вышеуказанная форма может быть заменена на:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span><span class="p">,</span> <span class="ss">builder: </span><span class="no">LabellingFormBuilder</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:first_name</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Если это используется часто, можно определить хелпер <code>labeled_form_with</code> который автоматически определяет опцию <code>builder: LabellingFormBuilder</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ApplicationHelper</span>
  <span class="k">def</span> <span class="nf">labeled_form_with</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:builder</span><span class="p">]</span> <span class="o">=</span> <span class="no">LabellingFormBuilder</span>
    <span class="n">form_with</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Вышеуказанное можно использовать вместо <code>form_with</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="sb">```erb
&lt;%= labeled_form_with model: @person do |form| %&gt;
  &lt;%= form.text_field :first_name %&gt;
&lt;% end %&gt;
</span></code></pre>
</div>
<p>Все три случая выше (хелпер <code>text_field_with_label</code>, подкласс <code>LabellingFormBuilder</code> и хелпер <code>labeled_form_with</code>) будут генерировать одинаковый HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/people"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_first_name"</span><span class="nt">&gt;</span>First name<span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[first_name]"</span> <span class="na">id=</span><span class="s">"person_first_name"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Форм-билдер также определяет, что произойдет, если вы сделаете:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="ss">partial: </span><span class="n">f</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Если <code>f</code> - это экземпляр <code>ActionView::Helpers::FormBuilder</code>, тогда это отрендерит партиал <code>form</code>, установив объект партиала как форм-билдер. Если у форм-билдера есть класс <code>LabellingFormBuilder</code>, тогда вместо него будет отрендерен партиал <code>labelling_form</code>.</p><p>Настройка форм-билдеров, таких как <code>LabellingFormBuilder</code>, позволяет скрыть детали реализации (и может показаться избыточным для простого примера выше). Выбирайте между различными вариантами настройки, расширяя класс <code>FormBuilder</code> или создавая хелперы, в зависимости от того, насколько часто ваши формы используют пользовательские элементы.</p><h3 id='form-input-naming-conventions-and-params-hash' class='inside_page_header'><a href="#form-input-naming-conventions-and-params-hash">9.</a> Соглашения по именованию полей ввода формы и хэш <code>params</code></h3><p>Все описанные выше хелперы для форм помогают генерировать HTML для элементов формы, чтобы пользователь мог вводить различные типы данных. Как получить доступ к значениям пользовательского ввода в контроллере? Ответ - хэш <code>params</code>. Вы уже видели хэш <code>params</code> в приведенном выше примере. В этом разделе мы более подробно рассмотрим соглашения об именовании, связанные со структурой ввода формы в хэше <code>params</code>.</p><p>Хэш <code>params</code> может содержать массивы и массивы хэшей. Значения могут находиться на верхнем уровне хэша <code>params</code> или быть вложенными в другой хэш. Например, в стандартном экшне <code>create</code> для модели Person, <code>params[:person]</code> будет хэшем всех атрибутов объекта <code>Person</code>.</p><p>Обратите внимание, что HTML-формы не имеют внутренней структуры для пользовательских данных ввода, они только генерируют строковые пары имя-значение. Массивы и хэши, которые вы видите в своем приложении, являются результатом соглашений об именовании параметров, используемых Rails.</p><div class="note"><p>Поля в хэше <code>params</code> должны быть <a href="#permitting-parameters-in-the-controller">разрешены в контроллере</a>.</p></div><h4 id='bazovaya-struktura' class='inside_page_header'><a href="#bazovaya-struktura">9.1.</a> Базовая структура</h4><p>Две основные структуры для данных пользовательских форм — это массивы и хэши.</p><p>Хэши отражают синтаксис, используемый для доступа к значению в <code>params</code>. Например, если форма содержит:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"Henry"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>хэш <code>params</code> будет содержать</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span> <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Henry'</span> <span class="p">}</span> <span class="p">}</span>
</code></pre>
</div>
<p>и <code>params[:person][:name]</code> получит отправленное значение в контроллере.</p><p>Хэши могут быть вложены на столько уровней, сколько требуется, например:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_city"</span> <span class="na">name=</span><span class="s">"person[address][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">value=</span><span class="s">"New York"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Вышеприведенное вернет такой хэш <code>params</code></p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span> <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">'address'</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">'city'</span> <span class="o">=&gt;</span> <span class="s1">'New York'</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</code></pre>
</div>
<p>Другая структура это массив. Обычно Rails игнорирует дублирующиеся имена параметра, но если имя параметра заканчивается пустым набором квадратных скобок <code>[]</code>, то параметры будут накоплены в массиве.</p><p>Например, если нужно, чтобы пользователи могли оставить несколько телефонных номеров, можно поместить это в форму:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[phone_number][]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Что приведет к тому, что <code>params[:person][:phone_number]</code> будет массивом, содержащим отправленные телефонные номера.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span> <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">'phone_number'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'555-0123'</span><span class="p">,</span> <span class="s1">'555-0124'</span><span class="p">,</span> <span class="s1">'555-0125'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>
</code></pre>
</div>
<h4 id='kombinirovanie-massivov-i-heshey' class='inside_page_header'><a href="#kombinirovanie-massivov-i-heshey">9.2.</a> Комбинирование массивов и хэшей</h4><p>Вы можете комбинировать эти два понятия. Один элемент хэша может быть массивом, как в предыдущем примере, хэш <code>params[:person]</code> имеет ключ <code>[:phone_number]</code>, значение которого является массивом.</p><p>Вы также можете иметь массив хэшей. Например, вы можете создать любое количество адресов, повторяя следующий фрагмент формы:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line1]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line2]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][city]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line1]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][line2]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"person[addresses][][city]"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Это приведет к тому, что <code>params[:person][:addresses]</code> будет массивом хэшей. В каждом хэше в массиве будут ключи <code>line1</code>, <code>line2</code> и <code>city</code>, наподобие:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span> <span class="s1">'person'</span> <span class="o">=&gt;</span>
  <span class="p">{</span> <span class="s1">'addresses'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s1">'line1'</span> <span class="o">=&gt;</span> <span class="s1">'1000 Fifth Avenue'</span><span class="p">,</span>
      <span class="s1">'line2'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
      <span class="s1">'city'</span> <span class="o">=&gt;</span> <span class="s1">'New York'</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s1">'line1'</span> <span class="o">=&gt;</span> <span class="s1">'Calle de Ruiz de Alarcón'</span><span class="p">,</span>
      <span class="s1">'line2'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
      <span class="s1">'city'</span> <span class="o">=&gt;</span> <span class="s1">'Madrid'</span>
    <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Важно отметить, что в то время как хэши могут быть вложены произвольно, является допустимым только один уровень &quot;массивности&quot;. Массивы обычно могут быть заменены хэшами. Например, вместо массива объектов модели можно иметь хэш объектов модели с ключами, равными их id или подобному.</p><div class="warning"><p>Параметры массива не очень хорошо работают с хелпером <code>checkbox</code>. В соответствии со спецификацией HTML, невыбранные чекбоксы не возвращают значения. Однако, было бы удобно, чтобы чекбоксы всегда возвращали значение. Хелпер <code>checkbox</code> обходит это, создавая вспомогательное скрытое поле с тем же именем. Если чекбокс не нажат, подтверждается только скрытое поле. Если он нажат, то они оба подтверждаются, но значение от чекбокса получает приоритет. Имеется опция <code>include_hidden</code>, которой можно установить <code>false</code>, если хотите опустить это скрытое поле. По умолчанию эта опция <code>true</code>.</p></div><h4 id='heshi-s-indeksom' class='inside_page_header'><a href="#heshi-s-indeksom">9.3.</a> Хэши с индексом</h4><p>Скажем, нам нужно рендерить форму с набором полей ввода для каждого адреса человека. Тут может помочь хелпер [<code>fields_for</code>][] и его аргумент <code>:index</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">person_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">addresses</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">address</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">person_form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="n">address</span><span class="p">,</span> <span class="ss">index: </span><span class="n">address</span><span class="p">.</span><span class="nf">id</span> <span class="k">do</span> <span class="o">|</span><span class="n">address_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">address_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:city</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Предположим, у кого-то есть два адреса с ID 23 и 45, вышеприведенная форма отрендерит это:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">action=</span><span class="s">"/people/1"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"patch"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_name"</span> <span class="na">name=</span><span class="s">"person[name]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_23_city"</span> <span class="na">name=</span><span class="s">"person[address][23][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"person_address_45_city"</span> <span class="na">name=</span><span class="s">"person[address][45][city]"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p>Что приведет к тому, что хэш <code>params</code> будет выглядеть так</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s2">"person"</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"Bob"</span><span class="p">,</span>
    <span class="s2">"address"</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s2">"23"</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s2">"city"</span> <span class="o">=&gt;</span> <span class="s2">"Paris"</span>
      <span class="p">},</span>
      <span class="s2">"45"</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s2">"city"</span> <span class="o">=&gt;</span> <span class="s2">"London"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Все поля ввода формы связаны с хэшем <code>&quot;person&quot;</code>, так как мы вызывали <code>fields_for</code> на построителе формы <code>person_form</code>. Также, указывая <code>index: address.id</code>, мы рендерим атрибут <code>name</code> каждого поля ввода города как <code>person[address][#{address.id}][city]</code> вместо <code>person[address][city]</code>. Таким образом можно сообщить, какие записи <code>Address</code> должны быть изменены при обработке хэша <code>params</code>.</p><p>Больше примеров об опции индекса <code>fields_for</code> можно обнаружить в <a href="https://api.rubyonrails.org/v7.1.3.4/classes/ActionView/Helpers/FormHelper.html#method-i-fields_for">документации API</a>.</p><h3 id='sozdanie-slozhnyh-form' class='inside_page_header'><a href="#sozdanie-slozhnyh-form">10.</a> Создание сложных форм</h3><p>По мере роста вашего приложения вам может потребоваться создавать более сложные формы, выходящие за рамки редактирования одного объекта. Например, при создании объекта <code>Person</code> вы можете позволить пользователю создавать несколько записей <code>Address</code> (домашний, рабочий и т.д.) в рамках одной формы. При последующем редактировании записи <code>Person</code> пользователь должен иметь возможность добавлять, удалять или обновлять адреса.</p><h4 id='nastroyka-vlozhennyh-atributov-modeli' class='inside_page_header'><a href="#nastroyka-vlozhennyh-atributov-modeli">10.1.</a> Настройка вложенных атрибутов модели</h4><p>Для редактирования связанной записи определенной модели (в данном случае <code>Person</code>) Active Record предлагает поддержку на уровне модели с помощью метода <a href="https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html#method-i-accepts_nested_attributes_for"><code>accepts_nested_attributes_for</code></a>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">inverse_of: :person</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span>

<span class="k">end</span>

<span class="k">class</span> <span class="nc">Address</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:person</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Это создаст метод <code>addresses_attributes=</code> в <code>Person</code>, позволяющий создавать, обновлять и уничтожать адреса.</p><h4 id='vlozhennye-formy-vo-vyu' class='inside_page_header'><a href="#vlozhennye-formy-vo-vyu">10.2.</a> Вложенные формы во вью</h4><p>Следующая форма позволяет пользователю создать <code>Person</code> и связанные с ним адреса.</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Addresses:
  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:addresses</span> <span class="k">do</span> <span class="o">|</span><span class="n">addresses_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>

        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:street</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:street</span> <span class="cp">%&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Когда связь принимает вложенные атрибуты, <code>fields_for</code> рендерит свой блок для каждого элемента связи. В частности, если у person нет адресов, он ничего не рендерит.</p><p>Обычным паттерном для контроллера является построение одного или более пустых дочерних элементов, чтобы как минимум один набор полей был показан пользователю. Следующий пример покажет 2 набора полей адресов в форме нового person.</p><p>К примеру, вышеприведенный <code>form_with</code> с этим изменением:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span>
  <span class="mi">2</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="vi">@person</span><span class="p">.</span><span class="nf">addresses</span><span class="p">.</span><span class="nf">build</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Выведет следующий HTML:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/people"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"lWTbg-4_5i4rNe6ygRFowjDfTj7uf-6UPFQnsL7H9U9Fe2GGUho5PuOxfcohgm2Z-By3veuXwcwDIl-MLdwFRg"</span> <span class="na">autocomplete=</span><span class="s">"off"</span><span class="nt">&gt;</span>
  Addresses:
  <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_addresses_attributes_0_kind"</span><span class="nt">&gt;</span>Kind<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[addresses_attributes][0][kind]"</span> <span class="na">id=</span><span class="s">"person_addresses_attributes_0_kind"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_addresses_attributes_0_street"</span><span class="nt">&gt;</span>Street<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[addresses_attributes][0][street]"</span> <span class="na">id=</span><span class="s">"person_addresses_attributes_0_street"</span><span class="nt">&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>

      <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_addresses_attributes_1_kind"</span><span class="nt">&gt;</span>Kind<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[addresses_attributes][1][kind]"</span> <span class="na">id=</span><span class="s">"person_addresses_attributes_1_kind"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"person_addresses_attributes_1_street"</span><span class="nt">&gt;</span>Street<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[addresses_attributes][1][street]"</span> <span class="na">id=</span><span class="s">"person_addresses_attributes_1_street"</span><span class="nt">&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
</div>
<p><code>fields_for</code> вкладывает форм-билдер. Имя параметра будет таким, какое ожидает <code>accepts_nested_attributes_for</code>. К примеру, при создании персоны с 2 адресами, отправленные параметры будут выглядеть так</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'John Doe'</span><span class="p">,</span>
    <span class="s1">'addresses_attributes'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'0'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Home'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'221b Baker Street'</span>
      <span class="p">},</span>
      <span class="s1">'1'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Office'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'31 Spooner Street'</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Фактическое значение ключей хэша <code>:addresses_attributes</code> не важно. Но они должны быть числовыми строками и различаться для каждого адреса.</p><p>Если связанный объект уже сохранен, <code>fields_for</code> автоматически генерирует скрытое поле с <code>id</code> сохраненной записи. Это можно отключить, передав <code>include_id: false</code> в <code>fields_for</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="p">{</span>
  <span class="s1">'person'</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'John Doe'</span><span class="p">,</span>
    <span class="s1">'addresses_attributes'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'0'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Home'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'221b Baker Street'</span>
      <span class="p">},</span>
      <span class="s1">'1'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="s1">'2'</span><span class="p">,</span>
        <span class="s1">'kind'</span> <span class="o">=&gt;</span> <span class="s1">'Office'</span><span class="p">,</span>
        <span class="s1">'street'</span> <span class="o">=&gt;</span> <span class="s1">'31 Spooner Street'</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<h4 id='permitting-parameters-in-the-controller' class='inside_page_header'><a href="#permitting-parameters-in-the-controller">10.3.</a> Разрешение параметров в контроллере</h4><p>Как обычно, в контроллере необходимо
<a href="action_controller_overview.html#strong-parameters">объявить разрешенные параметры</a>, перед их передачей в модель:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@person</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">person_params</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">person_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:person</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">addresses_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:kind</span><span class="p">,</span> <span class="ss">:street</span><span class="p">])</span>
  <span class="k">end</span>
</code></pre>
</div>
<h4 id='udalenie-svyazannyh-ob-ektov' class='inside_page_header'><a href="#udalenie-svyazannyh-ob-ektov">10.4.</a> Удаление связанных объектов</h4><p>Можно позволить пользователям удалять связанные объекты, передав <code>allow_destroy: true</code> в <code>accepts_nested_attributes_for</code></p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">allow_destroy: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Если хэш атрибутов для объекта содержит ключ <code>_destroy</code> со значением, вычисляющимся как <code>true</code> (например, <code>1</code>, <code>&#39;1&#39;</code>, <code>true</code> или <code>&#39;true&#39;</code>), тогда объект будет уничтожен. Эта форма позволяет пользователям удалять адреса:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@person</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  Addresses:
  <span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:addresses</span> <span class="k">do</span> <span class="o">|</span><span class="n">addresses_form</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">checkbox</span> <span class="ss">:_destroy</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">addresses_form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:kind</span> <span class="cp">%&gt;</span>
        ...
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>HTML для поля <code>_destroy</code>:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="na">name=</span><span class="s">"person[addresses_attributes][0][_destroy]"</span> <span class="na">id=</span><span class="s">"person_addresses_attributes_0__destroy"</span><span class="nt">&gt;</span>
</code></pre>
</div>
<p>Также необходимо обновить список разрешенных параметров в вашем контроллере, включив туда поле <code>_destroy</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">person_params</span>
  <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:person</span><span class="p">).</span>
    <span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">addresses_attributes: </span><span class="p">[</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:kind</span><span class="p">,</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">:_destroy</span><span class="p">])</span>
<span class="k">end</span>
</code></pre>
</div>
<h4 id='predotvraschenie-pustyh-zapisey' class='inside_page_header'><a href="#predotvraschenie-pustyh-zapisey">10.5.</a> Предотвращение пустых записей</h4><p>Часто полезно игнорировать наборы полей, которые пользователь не заполнял. Этим можно управлять, передав <code>:reject_if</code> proc в <code>accepts_nested_attributes_for</code>. Этот proc будет вызван для каждого хэша атрибутов, отправляемого формой. Если proc возвращает <code>true</code>, тогда Active Record не создаст связанный объект для этого хэша. Следующий пример пытается создать адрес, если установлен атрибут <code>kind</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:addresses</span>
  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">reject_if: </span><span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">attributes</span><span class="o">|</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">'kind'</span><span class="p">].</span><span class="nf">blank?</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Вместо этого для удобства можно передать символ <code>:all_blank</code>, который создаст proc, который отвергнет записи, когда все атрибуты пустые, за исключением любого значения для <code>_destroy</code>.</p><h3 id='formy-k-vneshnim-resursam' class='inside_page_header'><a href="#formy-k-vneshnim-resursam">11.</a> Формы к внешним ресурсам</h3><p>Хелперы форм Rails можно использовать для создания форм для передачи данных внешнему ресурсу. Если внешний API ожидает <code>authenticity_token</code> для ресурса, его можно передать как параметр <code>authenticity_token: &#39;your_external_token&#39;</code> в <code>form_with</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s1">'http://farfar.away/form'</span><span class="p">,</span> <span class="ss">authenticity_token: </span><span class="s1">'external_token'</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Form contents
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Иной раз, поля, которые можно использовать в форме, ограничены внешним API, и генерация <code>authenticity_token</code> нежелательна. Чтобы <em>не</em> посылать токен, можно передать <code>false</code> в опцию <code>:authenticity_token</code>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">url: </span><span class="s1">'http://farfar.away/form'</span><span class="p">,</span> <span class="ss">authenticity_token: </span><span class="kp">false</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  Form contents
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<h3 id='ispolzovanie-helperov-tega-bez-postroitelya-form' class='inside_page_header'><a href="#ispolzovanie-helperov-tega-bez-postroitelya-form">12.</a> Использование хелперов тега без построителя форм</h3><p>Если нужно отрендерить поля формы вне контекста построителя формы, Rails предоставляет хелперы тега для обычных элементов формы. Например, <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#method-i-checkbox_tag"><code>checkbox_tag</code></a>:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">checkbox_tag</span> <span class="s2">"accept"</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Выведет:</p><div class="code_container">
  <pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"accept"</span> <span class="na">id=</span><span class="s">"accept"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
</code></pre>
</div>
<p>Обычно у этих хелперов те же имена, что и у их аналогов в построителе форм плюс суффикс <code>_tag</code>. Полный список смотрите в <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html">документации <code>FormTagHelper</code> API</a>.</p><h3 id='ispolzovanie-form_tag-i-form_for' class='inside_page_header'><a href="#ispolzovanie-form_tag-i-form_for">13.</a> Использование <code>form_tag</code> и <code>form_for</code></h3><p>До того, как <code>form_with</code> был представлен в Rails 5.1, его функционал был разделен между <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormTagHelper.html#method-i-form_tag"><code>form_tag</code></a> и <a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/FormHelper.html#method-i-form_for"><code>form_for</code></a>. Последние сейчас мягко устаревшие в пользу <code>form_with</code>.</p>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-48ac5c5be8858f5558a99606c2d341f9fee482f22db6deee5def03837c505584.js"></script>
  </body>
</html>

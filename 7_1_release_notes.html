<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
<meta content="Ruby on Rails, Ruby, Rails, Rails 3, Rails 4, Rails 5, Rails 6, Rails 6.0, Rails 6.1, Rails 7.0, Rails 7.1 руководство, начинающим, самоучитель, manual, мануал, справочник, учебник, примеры, Руби, рельсы" name="keywords"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" name="description"/>
<meta content="website" property="og:type"/>
<meta content="Rusrails: Заметки о релизе Ruby on Rails 7.1" property="og:title"/>
<meta content="Ruby on Rails руководства, учебники, статьи на русском языке" property="og:description"/>
<meta content="http://localhost:3000/7_1_release_notes" property="og:url"/>
<meta content="http://rusrails.ru/assets/rusrails.png" property="og:image"/>
    <title>
      Rusrails: Заметки о релизе Ruby on Rails 7.1
    </title>
    <link rel="stylesheet" href="/assets/application-f9dfa6ce7fa871006d478e422639671663284ddaa3126cf81ddfe371ac3533c4.css" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="/"></a>
          <ul class="nav pull-right top-menu">
            <li>
              <a href="/">Главная</a>
            </li>
            <li class="dropdown">
              <a class="index-popover" href="#">
                Содержание
                <b class="caret"></b>
</a>              <div class="index-popover-content hide">
                  <ul><li><p><strong>С чего начать?</strong></p><ul><li><a href="/getting-started">Rails для начинающих</a>
</li></ul></li><li><p><strong>Модели</strong></p><ul><li><a href="/active-record-basics">Основы Active Record</a>
</li><li><a href="/active-record-migrations">Миграции Active Record</a>
</li><li><a href="/active-record-validations">Валидации Active Record</a>
</li><li><a href="/active-record-callbacks">Колбэки Active Record</a>
</li><li><a href="/active-record-associations">Связи (ассоциации) Active Record</a>
</li><li><a href="/active-record-querying">Интерфейс запросов Active Record</a>
</li><li><a href="/active-model-basics">Основы Active Model</a>
</li></ul></li><li><p><strong>Вью</strong></p><ul><li><a href="/action-view-overview">Обзор Action View</a>
</li><li><a href="/layouts-and-rendering">Макеты и рендеринг в Rails</a>
</li><li><a href="/action-view-helpers">Хелперы Action View</a>
</li><li><a href="/form-helpers">Хелперы форм в Action View</a>
</li></ul></li><li><p><strong>Контроллеры</strong></p><ul><li><a href="/action-controller-overview">Обзор Action Controller</a>
</li><li><a href="/routing">Роутинг в Rails</a>
</li></ul></li><li><p><strong>Другие компоненты</strong></p><ul><li><a href="/active-support-core-extensions">Расширения ядра Active Support</a>
</li><li><a href="/action-mailer-basics">Основы Action Mailer</a>
</li><li><a href="/action-mailbox-basics">Основы Action Mailbox</a>
</li><li><a href="/action-text-overview">Обзор Action Text</a>
</li><li><a href="/active_job_basics">Основы Active Job</a>
</li><li><a href="/active_storage_overview">Обзор Active Storage</a>
</li><li><a href="/action-cable-overview">Обзор Action Cable</a>
</li></ul></li><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/i18n">API интернационализации Rails (I18n)</a>
</li><li><a href="/testing">Тестирование приложений на Rails</a>
</li><li><a href="/security">Безопасность приложений на Rails</a>
</li><li><a href="/error-reporting">Отчет об ошибках в приложениях Rails</a>
</li><li><a href="/debugging-rails-applications">Отладка приложений на Rails</a>
</li></ul></li></ul><p>next_column</p><ul><li><p><strong>Копаем глубже</strong></p><ul><li><a href="/configuring">Конфигурирование приложений на Rails</a>
</li><li><a href="/command-line">Командная строка Rails</a>
</li><li><a href="/asset-pipeline">Asset Pipeline</a>
</li><li><a href="/working-with-javascript-in-rails">Работа с JavaScript в Rails</a>
</li><li><a href="/initialization">Процесс инициализации в Rails</a>
</li><li><a href="/autoloading-and-reloading-constants">Автозагрузка и перезагрузка констант</a>
</li><li><a href="/caching-with-rails">Кэширование с Rails: Обзор</a>
</li><li><a href="/active-support-instrumentation">Инструментарий Active Support</a>
</li><li><a href="/api-app">Использование Rails для API-приложений</a>
</li><li><a href="/active-record-postgresql">Active Record для PostgreSQL</a>
</li><li><a href="/active-record-multiple-databases">Несколько баз данных с Active Record</a>
</li><li><a href="/active-record-encryption">Шифрование Active Record</a>
</li></ul></li><li><p><strong>Расширяем Rails</strong></p><ul><li><a href="/plugins">Основы создания плагинов Rails</a>
</li><li><a href="/rails-on-rack">Rails on Rack</a>
</li><li><a href="/generators">Создание и настройка генераторов и шаблонов Rails</a>
</li><li><a href="/engines">Engine для начинающих</a>
</li><li><a href="/threading_and_code_execution">Треды и выполнение кода в Rails</a>
</li><li><a href="/rails-application-templates">Шаблоны приложения Rails</a>
</li></ul></li><li><p><strong>Вносим вклад в Ruby on Rails</strong></p><ul><li><a href="/contributing_to_ruby_on_rails">Вносим вклад в Ruby on Rails</a>
</li><li><a href="/api_documentation_guidelines">Рекомендации по документированию API</a>
</li><li><a href="/ruby_on_rails_guides_guidelines">Рекомендации для руководств по Ruby on Rails</a>
</li><li><a href="/development_dependencies_install">Установка зависимостей для разработки</a>
</li><li><a href="/maintenance-policy">Политика поддержки (версий)</a>
</li></ul></li><li><p><strong>Заметки о релизах</strong></p><ul><li><a href="/upgrading-ruby-on-rails">Апгрейд Ruby on Rails</a>
</li><li><a href="/7_2_release_notes">Версия 7.2 - ?</a>
</li><li><a href="/7_1_release_notes">Версия 7.1 - Октябрь 2023</a>
</li><li><a href="/7_0_release_notes">Версия 7.0 - Декабрь 2021</a>
</li><li><a href="/6_1_release_notes">Версия 6.1 - Декабрь 2020</a>
</li><li><a href="/6_0_release_notes">Версия 6.0 - Август 2019</a>
</li></ul></li></ul>
              </div>
            </li>
            <li>
              <a href="/search">Поиск</a>
            </li>
            <li>
              <a target="blank" href="http://api.rusrails.ru">Ruby &amp; Rails API</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span3 pull-right">
            <div class="well social">
              <h4>Принимаем пожелания и пул-реквесты!</h4>
              <iframe allowtransparency="true" frameborder="0" height="30" src="http://ghbtns.com/github-btn.html?user=rusrails&repo=rusrails&type=watch&count=true&size=large" width="180"></iframe>
            </div>
              <div class="well menu">
                    <ul class="nav nav-list">
      <li>
        <h4>
          <a href="#apgreyd-do-rails-7-1">1. Апгрейд до Rails 7.1</a>
</h4>      </li>
      <li>
        <h4>
          <a href="#osnovnye-osobennosti">2. Основные особенности</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#generatsiya-dockerfile-dlya-novyh-prilozheniy-rails">2.1. Генерация Dockerfile для новых приложений Rails</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dobavlen-activerecord-base-normalizes">2.2. Добавлен <code>ActiveRecord::Base.normalizes</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dobavlen-activerecord-base-generates_token_for">2.3. Добавлен <code>ActiveRecord::Base.generates_token_for</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dobavlen-perform_all_later-chtoby-pomestit-v-ochered-neskolko-zadaniy-za-raz">2.4. Добавлен <code>perform_all_later</code>, чтобы поместит в очередь несколько заданий за раз</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#sostavnye-pervichnye-klyuchi">2.5. Составные первичные ключи</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#predstavlen-adapter-dlya-trilogy">2.6. Представлен адаптер для <code>Trilogy</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#add-activesupport-messagepack">2.7. Add <code>ActiveSupport::MessagePack</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#predstavleny-config-autoload_lib-i-config-autoload_lib_once-dlya-uluchshennoy-avtomaticheskoy-zagruzki">2.8. Представлены <code>config.autoload_lib</code> и <code>config.autoload_lib_once</code> для улучшенной автоматической загрузки</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#active-record-api-dlya-obychnyh-asinhronnyh-zaprosov">2.9. Active Record API для обычных асинхронных запросов</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#razresheny-shablony-dlya-ustanovki-strogih-locals">2.10. Разрешены шаблоны для установки строгих <code>locals</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#dobavlen-rails-application-deprecators">2.11. Добавлен <code>Rails.application.deprecators</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#podderzhka-sopostavleniy-s-obraztsom-pattern-matching-dlya-json-response-parsed_body">2.12. Поддержка сопоставлений с образцом (pattern matching) для JSON <code>response.parsed_body</code></a>
</h5>      </li>
      <li>
        <h5>
          <a href="#rasshiren-response-parsed_body-chtoby-parsit-html-s-pomoschyu-nokogiri">2.13. Расширен <code>response.parsed_body</code>, чтобы парсить HTML с помощью Nokogiri</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#predstavlen-actionview-testcase-register_parser">2.14. Представлен <code>ActionView::TestCase.register_parser</code></a>
</h5>      </li>
      <li>
        <h4>
          <a href="#railties">3. Railties</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno">3.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo">3.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya">3.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-cable">4. Action Cable</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno2">4.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo2">4.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya2">4.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-pack">5. Action Pack</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno3">5.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo3">5.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya3">5.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-view">6. Action View</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno4">6.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo4">6.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya4">6.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-mailer">7. Action Mailer</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno5">7.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo5">7.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya5">7.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-record">8. Active Record</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno6">8.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo6">8.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya6">8.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-storage">9. Active Storage</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno7">9.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo7">9.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya7">9.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-model">10. Active Model</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno8">10.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo8">10.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya8">10.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-support">11. Active Support</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno9">11.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo9">11.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya9">11.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#active-job">12. Active Job</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno10">12.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo10">12.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya10">12.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-text">13. Action Text</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno11">13.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo11">13.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya11">13.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#action-mailbox">14. Action Mailbox</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#udaleno12">14.1. Удалено</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#ustarelo12">14.2. Устарело</a>
</h5>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya12">14.3. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#ruby-on-rails-guides">15. Ruby on Rails Guides</a>
</h4>      </li>
      <li>
        <h5>
          <a href="#znachimye-izmeneniya13">15.1. Значимые изменения</a>
</h5>      </li>
      <li>
        <h4>
          <a href="#blagodarnosti">16. Благодарности</a>
</h4>      </li>
</ul>

              </div>
            <div class="well banner300 banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- sidebar rusrails -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-7764391801669990"
     data-ad-slot="6089520660"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
          <div class="span9 content pull-left">
            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <!-- top rusrails -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:980px;height:120px"
       data-ad-client="ca-pub-7764391801669990"
       data-ad-slot="4891989065"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
              <h2 id='zametki-o-relize-ruby-on-rails-7-1' class='inside_page_header'> Заметки о релизе Ruby on Rails 7.1</h2><p>Ключевые новинки в Rails 7.1:</p><ul><li>Генерация Dockerfile для новых приложений Rails
</li><li>Добавлен <code>ActiveRecord::Base.normalizes</code>
</li><li>Добавлен <code>ActiveRecord::Base.generates_token_for</code>
</li><li>Добавлен <code>perform_all_later</code> для одновременной постановки в очередь нескольких заданий
</li><li>Составные первичные ключи
</li><li>Представлен адаптер для <code>Trilogy</code>
</li><li>Добавлен <code>ActiveSupport::MessagePack</code>
</li><li>Представлены <code>config.autoload_lib</code> и <code>config.autoload_lib_once</code> для улучшенной автозагрузки
</li><li>API Active Record для обычных асинхронных запросов
</li><li>Возможность для шаблонов устанавливать строгие <code>locals</code>
</li><li>Добавлен <code>Rails.application.deprecators</code>
</li><li>Поддержка сопоставления с образцом для JSON <code>response.parsed_body</code>
</li><li>Расширение <code>response.parsed_body</code> для парсинга HTML с помощью Nokogiri
</li><li>Представлен <code>ActionView::TestCase.register_parser</code>
</li></ul><p>Эти заметки о релизе покрывают только основные изменения. Чтобы узнать о других обновлениях, различных исправлениях программных ошибок и изменениях, обратитесь к логам изменений или к <a href="https://github.com/rails/rails/commits/7-1-stable">списку коммитов</a> в главном репозитории Rails на GitHub.</p>
<hr>
<h3 id='apgreyd-do-rails-7-1' class='inside_page_header'><a href="#apgreyd-do-rails-7-1">1.</a> Апгрейд до Rails 7.1</h3><p>Прежде чем апгрейднуть существующее приложение, было бы хорошо иметь перед этим покрытие тестами. Также, до попытки обновиться до Rails 7.1, необходимо сначала произвести апгрейд до Rails 7.0 и убедиться, что приложение все еще выполняется так, как нужно. Список вещей, которые нужно выполнить для апгрейда доступен в руководстве <a href="/upgrading-ruby-on-rails#upgrading-from-rails-7-0-to-rails-7-1">Апгрейд Ruby on Rails</a>.</p><h3 id='osnovnye-osobennosti' class='inside_page_header'><a href="#osnovnye-osobennosti">2.</a> Основные особенности</h3><h4 id='generatsiya-dockerfile-dlya-novyh-prilozheniy-rails' class='inside_page_header'><a href="#generatsiya-dockerfile-dlya-novyh-prilozheniy-rails">2.1.</a> Генерация Dockerfile для новых приложений Rails</h4><p><a href="https://github.com/rails/rails/pull/46762">Поддержка Docker по умолчанию</a> для новых приложений Rails. При генерации нового приложения, Rails теперь включит файлы для Docker в приложение.</p><p>Эти файлы служат основополагающей настройкой для развертывания вашего приложения Rails в среде production с помощью Docker. Важно отметить, что эти файлы не предназначены для целей разработки.</p><p>Вот быстрый пример того, как собрать и запустить ваше приложение Rails с помощью этих файлов Docker:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">-t</span> app <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>docker volume create app-storage
<span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">-v</span> app-storage:/rails/storage <span class="nt">-p</span> 3000:3000 <span class="nt">--env</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span>&lt;your-config-master-key&gt; app
</code></pre>
</div>
<p>Также из этого образа Docker можно запустить console или runner:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">-v</span> app-storage:/rails/storage <span class="nt">--env</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span>&lt;your-config-master-key&gt; app console
</code></pre>
</div>
<p>Те, кто ищет, как создать мультиплатформенный образ (например, развертывание на Apple Silicon для AMD или Intel), и передать его на Docker Hub, следуйте этим шагам:</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span>docker login <span class="nt">-u</span> &lt;your-user&gt;
<span class="gp">$</span><span class="w"> </span>docker buildx create <span class="nt">--use</span>
<span class="gp">$</span><span class="w"> </span>docker buildx build <span class="nt">--push</span> <span class="nt">--platform</span><span class="o">=</span>linux/amd64,linux/arm64 <span class="nt">-t</span> &lt;your-user/image-name&gt; <span class="nb">.</span>
</code></pre>
</div>
<p>Это улучшение упрощает процесс развертывания, предоставляя удобную стартовую точку для поднятия и запуска вашего приложения Rails в среде production.</p><h4 id='dobavlen-activerecord-base-normalizes' class='inside_page_header'><a href="#dobavlen-activerecord-base-normalizes">2.2.</a> Добавлен <code>ActiveRecord::Base.normalizes</code></h4><p><a href="https://api.rubyonrails.org/v7.1/classes/ActiveRecord/Normalization/ClassMethods.html#method-i-normalizes"><code>ActiveRecord::Base.normalizes</code></a> объявляет нормализацию атрибутов. Нормализация применяется, когда атрибут назначается или обновляется, и нормализованное значение будет записано в базу данных. Нормализация также применяется к соответствующему аргументу с ключом в методах запроса, позволяя запрашивать записи с помощью неформализованных значений.</p><p>Например:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">normalizes</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">with: </span><span class="o">-&gt;</span> <span class="n">email</span> <span class="p">{</span> <span class="n">email</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">downcase</span> <span class="p">}</span>
  <span class="n">normalizes</span> <span class="ss">:phone</span><span class="p">,</span> <span class="ss">with: </span><span class="o">-&gt;</span> <span class="n">phone</span> <span class="p">{</span> <span class="n">phone</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="s2">"^0-9"</span><span class="p">).</span><span class="nf">delete_prefix</span><span class="p">(</span><span class="s2">"1"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">email: </span><span class="s2">" CRUISE-CONTROL@EXAMPLE.COM</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">user</span><span class="p">.</span><span class="nf">email</span>                  <span class="c1"># =&gt; "cruise-control@example.com"</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">email: </span><span class="s2">"</span><span class="se">\t</span><span class="s2">CRUISE-CONTROL@EXAMPLE.COM "</span><span class="p">)</span>
<span class="n">user</span><span class="p">.</span><span class="nf">email</span>                  <span class="c1"># =&gt; "cruise-control@example.com"</span>
<span class="n">user</span><span class="p">.</span><span class="nf">email_before_type_cast</span> <span class="c1"># =&gt; "cruise-control@example.com"</span>

<span class="no">User</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">email: </span><span class="s2">"</span><span class="se">\t</span><span class="s2">CRUISE-CONTROL@EXAMPLE.COM "</span><span class="p">).</span><span class="nf">count</span>         <span class="c1"># =&gt; 1</span>
<span class="no">User</span><span class="p">.</span><span class="nf">where</span><span class="p">([</span><span class="s2">"email = ?"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">CRUISE-CONTROL@EXAMPLE.COM "</span><span class="p">]).</span><span class="nf">count</span> <span class="c1"># =&gt; 0</span>

<span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="ss">email: </span><span class="s2">"</span><span class="se">\t</span><span class="s2">CRUISE-CONTROL@EXAMPLE.COM "</span><span class="p">)</span>         <span class="c1"># =&gt; true</span>
<span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">([</span><span class="s2">"email = ?"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">CRUISE-CONTROL@EXAMPLE.COM "</span><span class="p">])</span> <span class="c1"># =&gt; false</span>

<span class="no">User</span><span class="p">.</span><span class="nf">normalize_value_for</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="s2">"+1 (555) 867-5309"</span><span class="p">)</span> <span class="c1"># =&gt; "5558675309"</span>
</code></pre>
</div>
<h4 id='dobavlen-activerecord-base-generates_token_for' class='inside_page_header'><a href="#dobavlen-activerecord-base-generates_token_for">2.3.</a> Добавлен <code>ActiveRecord::Base.generates_token_for</code></h4><p><a href="https://api.rubyonrails.org/v7.1/classes/ActiveRecord/TokenFor/ClassMethods.html#method-i-generates_token_for"><code>ActiveRecord::Base.generates_token_for</code></a> определяет генерацию токенов для определенной цели. Сгенерированные токены могут стать просроченными, а также содержать данные записи. При использовании токена для получения записи, будут сравнены данные из токена и данные из записи. Если они не совпадут, токен будет считаться невалидным, и то же самое, если он просрочен.</p><p>Вот пример реализации одноразового токена сброса пароля:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_secure_password</span>

  <span class="n">generates_token_for</span> <span class="ss">:password_reset</span><span class="p">,</span> <span class="ss">expires_in: </span><span class="mi">15</span><span class="p">.</span><span class="nf">minutes</span> <span class="k">do</span>
    <span class="c1"># `password_salt` (определенный `has_secure_password`) возвращает соль для</span>
    <span class="c1"># пароля. Соль изменяется при изменении пароля, таким образом, токен</span>
    <span class="c1"># будет просрочен, если пароль изменится.</span>
    <span class="n">password_salt</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">last</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">first</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">generate_token_for</span><span class="p">(</span><span class="ss">:password_reset</span><span class="p">)</span>

<span class="no">User</span><span class="p">.</span><span class="nf">find_by_token_for</span><span class="p">(</span><span class="ss">:password_reset</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> <span class="c1"># =&gt; user</span>

<span class="n">user</span><span class="p">.</span><span class="nf">update!</span><span class="p">(</span><span class="ss">password: </span><span class="s2">"new password"</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">find_by_token_for</span><span class="p">(</span><span class="ss">:password_reset</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
</div>
<h4 id='dobavlen-perform_all_later-chtoby-pomestit-v-ochered-neskolko-zadaniy-za-raz' class='inside_page_header'><a href="#dobavlen-perform_all_later-chtoby-pomestit-v-ochered-neskolko-zadaniy-za-raz">2.4.</a> Добавлен <code>perform_all_later</code>, чтобы поместит в очередь несколько заданий за раз</h4><p><a href="https://github.com/rails/rails/pull/46603">Метод <code>perform_all_later</code> в Active Job</a> разработан, чтобы упростить процесс помещения в очередь нескольких заданий одновременно. Это мощное дополнение позволяет эффективно помещать задания в очередь без запуска колбэков. Это в особенности полезно, когда необходимо поместить набор заданий в очередь за раз, что уменьшает накладные расходы на несколько запросов к хранилищу данных очереди.</p><p>Вот как можно воспользоваться преимуществом <code>perform_all_later</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># Постановка в очередь отдельных заданий</span>
<span class="no">ActiveJob</span><span class="p">.</span><span class="nf">perform_all_later</span><span class="p">(</span><span class="no">MyJob</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span> <span class="no">MyJob</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"world"</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Постановка в очередь массива заданий</span>
<span class="n">user_jobs</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:id</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <span class="no">UserJob</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">user_id: </span><span class="nb">id</span><span class="p">)</span> <span class="p">}</span>
<span class="no">ActiveJob</span><span class="p">.</span><span class="nf">perform_all_later</span><span class="p">(</span><span class="n">user_jobs</span><span class="p">)</span>
</code></pre>
</div>
<p>Пользуясь <code>perform_all_later</code>, можно оптимизировать процесс постановки заданий в очередь и пользоваться преимуществом улучшенной эффективности, в особенности при работе с большими наборами заданий. Стоит отметить, что в адаптерах очереди, поддерживающих новый метод <code>enqueue_all</code>, таких как адаптер Sidekiq, процесс постановки в очередь еще более оптимизирован с помощью <code>push_bulk</code>.</p><p>Предупреждаем, что этот новый метод представляет отдельное событие, <code>enqueue_all.active_job</code>, и не использует существующее событие <code>enqueue.active_job</code>. С помощью этого достигается точное отслеживание и отчетность о процессе массовой постановки в очередь.</p><h4 id='sostavnye-pervichnye-klyuchi' class='inside_page_header'><a href="#sostavnye-pervichnye-klyuchi">2.5.</a> Составные первичные ключи</h4><p>Составные первичные ключи теперь поддерживаются и на уровне базы данных, и приложения. Rails способен извлечь эти ключи напрямую из схемы. Эта функция особенно полезна для отношений many-to-many и других сложных моделей данных, когда единственного столбца недостаточно для уникальной идентификации записи.</p><p>SQL, генерируемый методами запроса в Active Record (например, <code>#reload</code>, <code>#update</code>, <code>#delete</code>) будет содержать все части составного первичного ключа. Методы, наподобие <code>#first</code> и <code>#last</code>, будут использовать полный составной первичный ключ в выражениях <code>ORDER BY</code>.</p><p>Можно использовать макрос <code>query_constraints</code> в качестве &quot;виртуального первичного ключа&quot;, чтобы достичь того же поведения без изменения схемы базы данных. Пример:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">TravelRoute</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">query_constraints</span> <span class="ss">:origin</span><span class="p">,</span> <span class="ss">:destination</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Схожим образом связи принимают опцию <code>query_constraints:</code>. Эта опция служит в качестве составного внешнего ключа, настраивая список столбцов, используемых для доступа к связанной записи.</p><p>Example:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">TravelRouteReview</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:travel_route</span><span class="p">,</span> <span class="ss">query_constraints: </span><span class="p">[</span><span class="ss">:travel_route_origin</span><span class="p">,</span> <span class="ss">:travel_route_destination</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
</div>
<h4 id='predstavlen-adapter-dlya-trilogy' class='inside_page_header'><a href="#predstavlen-adapter-dlya-trilogy">2.6.</a> Представлен адаптер для <code>Trilogy</code></h4><p><a href="https://github.com/rails/rails/pull/47880">Был представлен новый адаптер</a> для содействия бесшовной интеграции <code>Trilogy</code>, клиента базы данных, совместимой с MySQL, с приложением Rails. Теперь у приложений Rails есть вариант включения функционала <code>Trilogy</code>, настраивая их файл <code>config/database.yml</code>. К примеру:</p><div class="code_container">
  <pre><code class="highlight yaml"><span class="na">development</span><span class="pi">:</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">trilogy</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">blog_development</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
</code></pre>
</div>
<p>Альтернативно можно достичь интеграции с помощью переменной среды <code>DATABASE_URL</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">ENV</span><span class="p">[</span><span class="s1">'DATABASE_URL'</span><span class="p">]</span> <span class="c1"># =&gt; "trilogy://localhost/blog_development?pool=5"</span>
</code></pre>
</div>
<h4 id='add-activesupport-messagepack' class='inside_page_header'><a href="#add-activesupport-messagepack">2.7.</a> Add <code>ActiveSupport::MessagePack</code></h4><p><a href="https://api.rubyonrails.org/v7.1/classes/ActiveSupport/MessagePack.html"><code>ActiveSupport::MessagePack</code></a> это сериализатор, интегрированный с <a href="https://github.com/msgpack/msgpack-ruby">гемом <code>msgpack</code></a>. <code>ActiveSupport::MessagePack</code> может сериализовывать базовые типы Ruby, поддерживаемые <code>msgpack</code>, а также несколько дополнительных типов, таких как <code>Time</code>, <code>ActiveSupport::TimeWithZone</code> и <code>ActiveSupport::HashWithIndifferentAccess</code>.
По сравнению с <code>JSON</code> и <code>Marshal</code>, <code>ActiveSupport::MessagePack</code> может уменьшить размер полезной нагрузки и улучшить производительность.</p><p><code>ActiveSupport::MessagePack</code> можно использовать в качестве <a href="/configuring#config-active-support-message-serializer">сериализатора сообщения</a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">active_support</span><span class="p">.</span><span class="nf">message_serializer</span> <span class="o">=</span> <span class="ss">:message_pack</span>

<span class="c1"># Или отдельно:</span>
<span class="no">ActiveSupport</span><span class="o">::</span><span class="no">MessageEncryptor</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="ss">serializer: :message_pack</span><span class="p">)</span>
<span class="no">ActiveSupport</span><span class="o">::</span><span class="no">MessageVerifier</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="ss">serializer: :message_pack</span><span class="p">)</span>
</code></pre>
</div>
<p>В качестве <a href="/configuring#config-action-dispatch-cookies-serializer">сериализатора куки</a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">action_dispatch</span><span class="p">.</span><span class="nf">cookies_serializer</span> <span class="o">=</span> <span class="ss">:message_pack</span>
</code></pre>
</div>
<p>И в качестве <a href="/caching-with-rails#configuration">сериализатора кэша</a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">cache_store</span> <span class="o">=</span> <span class="ss">:file_store</span><span class="p">,</span> <span class="s2">"tmp/cache"</span><span class="p">,</span> <span class="p">{</span> <span class="ss">serializer: :message_pack</span> <span class="p">}</span>

<span class="c1"># Или отдельно:</span>
<span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Cache</span><span class="p">.</span><span class="nf">lookup_store</span><span class="p">(</span><span class="ss">:file_store</span><span class="p">,</span> <span class="s2">"tmp/cache"</span><span class="p">,</span> <span class="ss">serializer: :message_pack</span><span class="p">)</span>
</code></pre>
</div>
<h4 id='predstavleny-config-autoload_lib-i-config-autoload_lib_once-dlya-uluchshennoy-avtomaticheskoy-zagruzki' class='inside_page_header'><a href="#predstavleny-config-autoload_lib-i-config-autoload_lib_once-dlya-uluchshennoy-avtomaticheskoy-zagruzki">2.8.</a> Представлены <code>config.autoload_lib</code> и <code>config.autoload_lib_once</code> для улучшенной автоматической загрузки</h4><p>Был представлен <a href="https://github.com/rails/rails/pull/48572">новый конфигурационный метод, <code>config.autoload_lib(ignore:)</code></a>. Этот метод используется для улучшения путей автозагрузки приложений, с помощью включения директории <code>lib</code>, которая по умолчанию не включена. А также для новых приложений генерируется <code>config.autoload_lib(ignore: %w(assets tasks))</code>.</p><p>При вызове из <code>config/application.rb</code>, либо <code>config/environments/*.rb</code>, этот метод добавляет директорию <code>lib</code> в <code>config.autoload_paths</code> и <code>config.eager_load_paths</code>. Важно отметить, что эта особенность не доступно для engine.</p><p>Для обеспечения гибкости можно использовать ключевой аргумент <code>ignore</code>, чтобы указать поддиректории в директории <code>lib</code>, которые не должны управляться автозагрузчиками. К примеру, можно исключить директории, такие как <code>assets</code>, <code>tasks</code> и <code>generators</code>, передав их в качестве аргумента <code>ignore</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">config</span><span class="p">.</span><span class="nf">autoload_lib</span><span class="p">(</span><span class="ss">ignore: </span><span class="sx">%w(assets tasks generators)</span><span class="p">)</span>
</code></pre>
</div>
<p><a href="https://github.com/rails/rails/pull/48610">Метод <code>config.autoload_lib_once</code></a> подобен <code>config.autoload_lib</code>, за исключением того, что он добавляет <code>lib</code> в <code>config.autoload_once_paths</code>.</p><p>За подробностями обратитесь к <a href="autoloading-and-reloading-constants#config-autoload-lib-ignore">руководству по автоматической загрузке</a></p><h4 id='active-record-api-dlya-obychnyh-asinhronnyh-zaprosov' class='inside_page_header'><a href="#active-record-api-dlya-obychnyh-asinhronnyh-zaprosov">2.9.</a> Active Record API для обычных асинхронных запросов</h4><p>Было представлено значительное улучшение для Active Record API, расширяющее его <a href="https://github.com/rails/rails/pull/44446">поддержку асинхронных запросов</a>. Это улучшение посвящено необходимости более эффективной обработки не очень быстрых запросов, в частности фокусируясь на аггрегирующих (таких как <code>count</code>, <code>sum</code> и т.д.) и всех методах, возвращающих единственную запись, или что-то отличающееся от <code>Relation</code>.</p><p>Новый API включает следующие асинхронные методы:</p><ul><li><code>async_count</code>
</li><li><code>async_sum</code>
</li><li><code>async_minimum</code>
</li><li><code>async_maximum</code>
</li><li><code>async_average</code>
</li><li><code>async_pluck</code>
</li><li><code>async_pick</code>
</li><li><code>async_ids</code>
</li><li><code>async_find_by_sql</code>
</li><li><code>async_count_by_sql</code>
</li></ul><p>Вот краткий пример того, как использовать один из этих методов, <code>async_count</code>, чтобы подсчитать количество опубликованных сообщений асинхронным образом:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># Синхронный подсчет</span>
<span class="n">published_count</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">published: </span><span class="kp">true</span><span class="p">).</span><span class="nf">count</span> <span class="c1"># =&gt; 10</span>

<span class="c1"># Асинхронный подсчет</span>
<span class="n">promise</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">published: </span><span class="kp">true</span><span class="p">).</span><span class="nf">async_count</span> <span class="c1"># =&gt; #&lt;ActiveRecord::Promise status=pending&gt;</span>
<span class="n">promise</span><span class="p">.</span><span class="nf">value</span> <span class="c1"># =&gt; 10</span>
</code></pre>
</div>
<p>Эти методы позволяют запускать эти операции асинхронным образом, что может значительно улучшить эффективность определенных типов запросов к базе данных.</p><h4 id='razresheny-shablony-dlya-ustanovki-strogih-locals' class='inside_page_header'><a href="#razresheny-shablony-dlya-ustanovki-strogih-locals">2.10.</a> Разрешены шаблоны для установки строгих <code>locals</code></h4><p>Представлена новая особенность, <a href="https://github.com/rails/rails/pull/45602">позволяющая шаблонам устанавливать явные <code>locals</code></a>. Это улучшение предоставляет большее управление и ясность при передаче переменных в ваши шаблоны.</p><p>По умолчанию шаблоны принимают любые <code>locals</code> как ключевые аргументы. Однако, теперь можно определить, какие <code>locals</code> шаблон должен принимать, добавляя магический комментарий <code>locals</code> в начале файла шаблона.</p><p>Вот как это работает:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# locals: (message:) -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Также можно установить значения по умолчанию для этих локальных переменных:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# locals: (message: "Hello, world!") -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Необязательные ключевые аргументы могут быть расплющены:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# locals: (message: "Hello, world!", **attributes) -%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">tag</span><span class="p">.</span><span class="nf">p</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
</div>
<p>Если хотите отключить использование локальных переменных полностью, это можно сделать так:</p><div class="code_container">
  <pre><code class="highlight erb"><span class="c">&lt;%# locals: () %&gt;</span>
</code></pre>
</div>
<p>Action View будет обрабатывать магический комментарий <code>locals:</code> в любом шаблонизаторе, который поддерживает комментарии с префиксом <code>#</code>. Он может считывать этот комментарий с любой строки в партиале.</p><div class="warning"><p>Поддерживаются только ключевые аргументы. Определение позиционных или блочных аргументов вызовет ошибку Action View во время отрисовки.</p></div><h4 id='dobavlen-rails-application-deprecators' class='inside_page_header'><a href="#dobavlen-rails-application-deprecators">2.11.</a> Добавлен <code>Rails.application.deprecators</code></h4><p>Новый <a href="https://github.com/rails/rails/pull/46049">метод <code>Rails.application.deprecators</code></a> возвращает коллекцию управляемых депрекаторов в вашем приложении и позволяет добавлять и получать отдельные депрекаторы:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:my_gem</span><span class="p">]</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Deprecation</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"2.0"</span><span class="p">,</span> <span class="s2">"MyGem"</span><span class="p">)</span>
<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:other_gem</span><span class="p">]</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Deprecation</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"3.0"</span><span class="p">,</span> <span class="s2">"OtherGem"</span><span class="p">)</span>
</code></pre>
</div>
<p>Конфигурационные настройки коллекции влияют на все депрекаторы в коллекции.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">.</span><span class="nf">debug</span> <span class="o">=</span> <span class="kp">true</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:my_gem</span><span class="p">].</span><span class="nf">debug</span>
<span class="c1"># =&gt; true</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:other_gem</span><span class="p">].</span><span class="nf">debug</span>
<span class="c1"># =&gt; true</span>
</code></pre>
</div>
<p>Есть сценарии, в которых нужно приглушить все сообщения об устаревании для определенного блока кода. С помощью коллекции депрекаторов возможно с легкостью заглушить все предупреждения депрекаторов в пределах блока:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">.</span><span class="nf">silence</span> <span class="k">do</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:my_gem</span><span class="p">].</span><span class="nf">warn</span>    <span class="c1"># Нет предупреждения (заглушено)</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">deprecators</span><span class="p">[</span><span class="ss">:other_gem</span><span class="p">].</span><span class="nf">warn</span> <span class="c1"># Нет предупреждения (заглушено)</span>
<span class="k">end</span>
</code></pre>
</div>
<h4 id='podderzhka-sopostavleniy-s-obraztsom-pattern-matching-dlya-json-response-parsed_body' class='inside_page_header'><a href="#podderzhka-sopostavleniy-s-obraztsom-pattern-matching-dlya-json-response-parsed_body">2.12.</a> Поддержка сопоставлений с образцом (pattern matching) для JSON <code>response.parsed_body</code></h4><p>Когда блоки тестов <code>ActionDispatch::IntegrationTest</code> вызывают <code>response.parsed_body</code> для откликов JSON, их полезная нагрузка будет доступна с indifferent access. Это включает интеграцию с <a href="https://docs.ruby-lang.org/en/master/syntax/pattern_matching_rdoc.html">Pattern Matching в Ruby</a>, и встроенной <a href="https://docs.seattlerb.org/minitest/Minitest/Assertions.html#method-i-assert_pattern">поддержкой Minitest для pattern matching</a>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">get</span> <span class="s2">"/posts.json"</span>

<span class="n">response</span><span class="p">.</span><span class="nf">content_type</span>         <span class="c1"># =&gt; "application/json; charset=utf-8"</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span><span class="p">.</span><span class="nf">class</span>    <span class="c1"># =&gt; Array</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span>          <span class="c1"># =&gt; [{"id"=&gt;42, "title"=&gt;"Title"},...</span>

<span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span> <span class="o">=&gt;</span> <span class="p">[{</span> <span class="ss">id: </span><span class="mi">42</span> <span class="p">}]</span> <span class="p">}</span>

<span class="n">get</span> <span class="s2">"/posts/42.json"</span>

<span class="n">response</span><span class="p">.</span><span class="nf">content_type</span>         <span class="c1"># =&gt; "application/json; charset=utf-8"</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span><span class="p">.</span><span class="nf">class</span>    <span class="c1"># =&gt; ActiveSupport::HashWithIndifferentAccess</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span>          <span class="c1"># =&gt; {"id"=&gt;42, "title"=&gt;"Title"}</span>

<span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span> <span class="o">=&gt;</span> <span class="p">[{</span> <span class="ss">title: </span><span class="sr">/title/i</span> <span class="p">}]</span> <span class="p">}</span>
</code></pre>
</div>
<h4 id='rasshiren-response-parsed_body-chtoby-parsit-html-s-pomoschyu-nokogiri' class='inside_page_header'><a href="#rasshiren-response-parsed_body-chtoby-parsit-html-s-pomoschyu-nokogiri">2.13.</a> Расширен <code>response.parsed_body</code>, чтобы парсить HTML с помощью Nokogiri</h4><p><a href="https://github.com/rails/rails/pull/47144">Расширен модуль <code>ActionDispatch::Testing</code></a>, чтобы поддерживать парсинг значения HTML <code>response.body</code> в экземпляр <code>Nokogiri::HTML5::Document</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">get</span> <span class="s2">"/posts"</span>

<span class="n">response</span><span class="p">.</span><span class="nf">content_type</span>         <span class="c1"># =&gt; "text/html; charset=utf-8"</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span><span class="p">.</span><span class="nf">class</span>    <span class="c1"># =&gt; Nokogiri::HTML5::Document</span>
<span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span><span class="p">.</span><span class="nf">to_html</span>  <span class="c1"># =&gt; "&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n..."</span>
</code></pre>
</div>
<p>Недавно добавленная <a href="https://nokogiri.org/rdoc/Nokogiri/XML/Attr.html#method-i-deconstruct_keys">поддержка Nokogiri для pattern matching</a>, вместе со встроенной <a href="https://docs.seattlerb.org/minitest/Minitest/Assertions.html#method-i-assert_pattern">поддержкой Minitest для pattern matching</a> представляют возможности для тестовых утверждений о структуре и содержимом отклика HTML:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">get</span> <span class="s2">"/posts"</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">parsed_body</span> <span class="c1"># =&gt; &lt;html&gt;</span>
                            <span class="c1">#      &lt;head&gt;&lt;/head&gt;</span>
                            <span class="c1">#        &lt;body&gt;</span>
                            <span class="c1">#          &lt;main&gt;&lt;h1&gt;Some main content&lt;/h1&gt;&lt;/main&gt;</span>
                            <span class="c1">#        &lt;/body&gt;</span>
                            <span class="c1">#     &lt;/html&gt;</span>

<span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">html</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="s2">"main"</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">content: </span><span class="s2">"Some main content"</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">html</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="s2">"main"</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">content: </span><span class="sr">/content/</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">html</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="s2">"main"</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">children: </span><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"h1"</span><span class="p">,</span> <span class="ss">content: </span><span class="sr">/content/</span> <span class="p">}]</span> <span class="p">}</span> <span class="p">}</span>
</code></pre>
</div>
<h4 id='predstavlen-actionview-testcase-register_parser' class='inside_page_header'><a href="#predstavlen-actionview-testcase-register_parser">2.14.</a> Представлен <code>ActionView::TestCase.register_parser</code></h4><p><a href="https://github.com/rails/rails/pull/49194">Расширен <code>ActionView::TestCase</code></a> для поддержки парсинга содержимого, отрендеренного партиалами вью, в известные структуры. По умолчанию определяет <code>rendered_html</code> для парсинга HTML в <code>Nokogiri::XML::Node</code> и <code>rendered_json</code> для парсинга JSON в <code>ActiveSupport::HashWithIndifferentAccess</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="nb">test</span> <span class="s2">"renders HTML"</span> <span class="k">do</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello, world"</span><span class="p">)</span>

  <span class="n">render</span> <span class="ss">partial: </span><span class="s2">"articles/article"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">article: </span><span class="n">article</span> <span class="p">}</span>

  <span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">rendered_html</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="s2">"main h1"</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">content: </span><span class="s2">"Hello, world"</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>

<span class="nb">test</span> <span class="s2">"renders JSON"</span> <span class="k">do</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello, world"</span><span class="p">)</span>

  <span class="n">render</span> <span class="ss">formats: :json</span><span class="p">,</span> <span class="ss">partial: </span><span class="s2">"articles/article"</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">article: </span><span class="n">article</span> <span class="p">}</span>

  <span class="n">assert_pattern</span> <span class="p">{</span> <span class="n">rendered_json</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">title: </span><span class="s2">"Hello, world"</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Чтобы парсить отрендеренное содержимое в RSS, зарегистрируйте вызов к <code>RSS::Parser.parse</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">register_parser</span> <span class="ss">:rss</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="n">rendered</span> <span class="p">{</span> <span class="no">RSS</span><span class="o">::</span><span class="no">Parser</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span> <span class="p">}</span>

<span class="nb">test</span> <span class="s2">"renders RSS"</span> <span class="k">do</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello, world"</span><span class="p">)</span>

  <span class="n">render</span> <span class="ss">formats: :rss</span><span class="p">,</span> <span class="ss">partial: </span><span class="n">article</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span> <span class="ss">article: </span><span class="n">article</span> <span class="p">}</span>

  <span class="n">assert_equal</span> <span class="s2">"Hello, world"</span><span class="p">,</span> <span class="n">rendered_rss</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">title</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Чтобы парсить отрендеренное содержимое в Capybara::Simple::Node, перерегистрируйте парсер <code>:html</code> с помощью вызова к <code>Capybara.string</code>:</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">register_parser</span> <span class="ss">:html</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="n">rendered</span> <span class="p">{</span> <span class="no">Capybara</span><span class="p">.</span><span class="nf">string</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span> <span class="p">}</span>

<span class="nb">test</span> <span class="s2">"renders HTML"</span> <span class="k">do</span>
  <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello, world"</span><span class="p">)</span>

  <span class="n">render</span> <span class="ss">partial: </span><span class="n">article</span>

  <span class="n">rendered_html</span><span class="p">.</span><span class="nf">assert_css</span> <span class="s2">"main h1"</span><span class="p">,</span> <span class="ss">text: </span><span class="s2">"Hello, world"</span>
<span class="k">end</span>
</code></pre>
</div>
<h3 id='railties' class='inside_page_header'><a href="#railties">3.</a> Railties</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/railties/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno' class='inside_page_header'><a href="#udaleno">3.1.</a> Удалено</h4><ul><li><p>  Удалена устаревшая команда <code>bin/rails secrets:setup</code>.</p></li><li><p>  Удален заголовок по умолчанию <code>X-Download-Options</code>, так как он использовался только Internet Explorer.</p></li></ul><h4 id='ustarelo' class='inside_page_header'><a href="#ustarelo">3.2.</a> Устарело</h4><ul><li><p>  Устарело использование <code>Rails.application.secrets</code>.</p></li><li><p>  Устарели команды <code>secrets:show</code> и <code>secrets:edit</code> в пользу <code>credentials</code>.</p></li><li><p>  Устарел <code>Rails::Generators::Testing::Behaviour</code> в пользу <code>Rails::Generators::Testing::Behavior</code>.</p></li></ul><h4 id='znachimye-izmeneniya' class='inside_page_header'><a href="#znachimye-izmeneniya">3.3.</a> Значимые изменения</h4><ul><li><p>  Добавлена опция <code>sandbox_by_default</code>, чтобы запускать консоль rails в режиме песочницы по умолчанию.</p></li><li><p>  Добавлен новый синтаксис для поддержки фильтрации тестов по диапазону строк.</p></li><li><p>  Добавлена опция <code>DATABASE</code>, включающая определение целевой базы данных при запуске команды <code>rails railties:install:migrations</code>, чтобы скопировать миграции.</p></li><li><p>  Добавлена поддержка Bun в генераторе <code>rails new --javascript</code>.</p><div class="code_container">
  <pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new my_new_app <span class="nt">--javascript</span><span class="o">=</span>bun
</code></pre>
</div>
</li><li><p>  Добавлена возможность показывать медленные тесты запускающему тесты.</p></li></ul><h3 id='action-cable' class='inside_page_header'><a href="#action-cable">4.</a> Action Cable</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actioncable/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno2' class='inside_page_header'><a href="#udaleno2">4.1.</a> Удалено</h4><h4 id='ustarelo2' class='inside_page_header'><a href="#ustarelo2">4.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya2' class='inside_page_header'><a href="#znachimye-izmeneniya2">4.3.</a> Значимые изменения</h4><ul><li><p>  Добавлен тестовый вспомогательный метод <code>capture_broadcasts</code> для отлова всех сообщений, транслируемых в блоке.</p></li><li><p>  Добавлена возможность адаптеру Redis для pub/sub автоматически пересоединяться, когда соединение Redis потеряно.</p></li><li><p>  Добавлены управляющие колбэки <code>before_command</code>, <code>after_command</code> и <code>around_command</code> к <code>ActionCable::Connection::Base</code>.</p></li></ul><h3 id='action-pack' class='inside_page_header'><a href="#action-pack">5.</a> Action Pack</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actionpack/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno3' class='inside_page_header'><a href="#udaleno3">5.1.</a> Удалено</h4><ul><li><p>  Удалено устаревшее поведение у <code>Request#content_type</code></p></li><li><p>  Удалена устаревшая возможность присвоения одиночного значения <code>config.action_dispatch.trusted_proxies</code>.</p></li><li><p>  Удалена регистрация устаревших драйверов <code>poltergeist</code> и <code>webkit</code> (capybara-webkit) для системного тестирования.</p></li></ul><h4 id='ustarelo3' class='inside_page_header'><a href="#ustarelo3">5.2.</a> Устарело</h4><ul><li><p>  Устарел <code>config.action_dispatch.return_only_request_media_type_on_content_type</code>.</p></li><li><p>  Устарел <code>AbstractController::Helpers::MissingHelperError</code>.</p></li><li><p>  Устарел <code>ActionDispatch::IllegalStateError</code>.</p></li><li><p>  Устарели директивы политики разрешений <code>speaker</code>, <code>vibrate</code> и <code>vr</code>.</p></li><li><p>  Устарели значения <code>true</code> и <code>false</code> для <code>config.action_dispatch.show_exceptions</code> в пользу <code>:all</code>, <code>:rescuable</code> или <code>:none</code>.</p></li></ul><h4 id='znachimye-izmeneniya3' class='inside_page_header'><a href="#znachimye-izmeneniya3">5.3.</a> Значимые изменения</h4><ul><li><p>  Добавлен метод <code>exclude?</code> в <code>ActionController::Parameters</code>. Он противоположен методу <code>include?</code>.</p></li><li><p>  Добавлен метод <code>ActionController::Parameters#extract_value</code>, чтобы позволять извлечение сериализуемы значений из параметров.</p></li><li><p>  Добавлена возможность использования пользовательской логики для хранения и получения токенов CSRF.</p></li><li><p>  Добавлены ключевые аргументы <code>html</code> и <code>screenshot</code> для вспомогательного метода системного тестирования скриншотов.</p></li></ul><h3 id='action-view' class='inside_page_header'><a href="#action-view">6.</a> Action View</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actionview/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno4' class='inside_page_header'><a href="#udaleno4">6.1.</a> Удалено</h4><ul><li><p>  Удалена устаревшая константа <code>ActionView::Path</code>.</p></li><li><p>  Удалена устаревшая поддержка передачи переменных экземпляра как локальных в партиалы.</p></li></ul><h4 id='ustarelo4' class='inside_page_header'><a href="#ustarelo4">6.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya4' class='inside_page_header'><a href="#znachimye-izmeneniya4">6.3.</a> Значимые изменения</h4><ul><li><p>  <code>check_box_tag</code> и <code>radio_button_tag</code> теперь принимают <code>checked</code> как ключевой аргумент.</p></li><li><p>  Добавлен вспомогательный метод <code>picture_tag</code>, чтобы генерировать теги HTML <code>&lt;picture&gt;</code>.</p></li><li><p>  Вспомогательный метод <code>simple_format</code> теперь принимает функционал <code>:sanitize_options</code>, позволяя добавление дополнительных опций для процесса обработки.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">simple_format</span><span class="p">(</span><span class="s2">"&lt;a target=</span><span class="se">\"</span><span class="s2">_blank</span><span class="se">\"</span><span class="s2"> href=</span><span class="se">\"</span><span class="s2">http://example.com</span><span class="se">\"</span><span class="s2">&gt;Continue&lt;/a&gt;"</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span> <span class="ss">sanitize_options: </span><span class="p">{</span> <span class="ss">attributes: </span><span class="sx">%w[target href]</span> <span class="p">}</span> <span class="p">})</span>
<span class="c1"># =&gt; "&lt;p&gt;&lt;a target=\"_blank\" href=\"http://example.com\"&gt;Continue&lt;/a&gt;&lt;/p&gt;"</span>
</code></pre>
</div>
</li></ul><h3 id='action-mailer' class='inside_page_header'><a href="#action-mailer">7.</a> Action Mailer</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actionmailer/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno5' class='inside_page_header'><a href="#udaleno5">7.1.</a> Удалено</h4><h4 id='ustarelo5' class='inside_page_header'><a href="#ustarelo5">7.2.</a> Устарело</h4><ul><li><p>  Устарел <code>config.action_mailer.preview_path</code>.</p></li><li><p>  Устарела передача параметров в <code>assert_enqueued_email_with</code> с помощью ключевого аргумента <code>:args</code>. Теперь поддерживается ключевой аргумент <code>:params</code>, используйте его для передачи параметров.</p></li></ul><h4 id='znachimye-izmeneniya5' class='inside_page_header'><a href="#znachimye-izmeneniya5">7.3.</a> Значимые изменения</h4><ul><li><p>  Добавлен <code>config.action_mailer.preview_paths</code> для поддержки нескольких путей предварительного просмотра.</p></li><li><p>  Добавлен <code>capture_emails</code> в тестовые вспомогательные методы, чтобы для отлова всех писем, отправленных в блоке.</p></li><li><p>  Добавлен <code>deliver_enqueued_emails</code> к <code>ActionMailer::TestHelper</code> для доставки всех отложенных заданий почты.</p></li></ul><h3 id='active-record' class='inside_page_header'><a href="#active-record">8.</a> Active Record</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/activerecord/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno6' class='inside_page_header'><a href="#udaleno6">8.1.</a> Удалено</h4><ul><li><p>  Удалена поддержка <code>ActiveRecord.legacy_connection_handling</code>.</p></li><li><p>  Удалены устаревшие методы доступа конфигурации <code>ActiveRecord::Base</code></p></li><li><p>  Удалена поддержка <code>:include_replicas</code> у <code>configs_for</code>. Вместо него используйте <code>:include_hidden</code>.</p></li><li><p>  Удален устаревший <code>config.active_record.partial_writes</code>.</p></li><li><p>  Удален устаревший <code>Tasks::DatabaseTasks.schema_file_type</code>.</p></li><li><p>  Убран флажок <code>--no-comments</code> в структурных выгрузках для PostgreSQL.</p></li></ul><h4 id='ustarelo6' class='inside_page_header'><a href="#ustarelo6">8.2.</a> Устарело</h4><ul><li><p>  Устарел аргумент <code>name</code> у <code>#remove_connection</code>.</p></li><li><p>  Устарел <code>check_pending!</code> в пользу <code>check_all_pending!</code>.</p></li><li><p>  Устарела опция <code>deferrable: true</code> у <code>add_foreign_key</code> в пользу <code>deferrable: :immediate</code>.</p></li><li><p>  Устарел <code>TestFixtures#fixture_path</code> в пользу <code>TestFixtures#fixture_paths</code>.</p></li><li><p>  Устарела делегация из <code>Base</code> к <code>connection_handler</code>.</p></li><li><p>  Устарела <code>config.active_record.suppress_multiple_database_warning</code>.</p></li><li><p>  Устарело использование <code>ActiveSupport::Duration</code> в качестве интерполируемого связанного параметра в строковом шаблоне SQL.</p></li><li><p>  Устарел <code>all_connection_pools</code> и <code>connection_pool_list</code> сделан более явным.</p></li><li><p>  Устарело, что <code>read_attribute(:id)</code> возвращает первичный ключ, если первичный ключ не <code>:id</code>.</p></li><li><p>  Устарел аргумент <code>rewhere</code> у <code>#merge</code>.</p></li><li><p>  Устарело создание псевдонимов не-атрибутов с помощью <code>alias_attribute</code>.</p></li></ul><h4 id='znachimye-izmeneniya6' class='inside_page_header'><a href="#znachimye-izmeneniya6">8.3.</a> Значимые изменения</h4><ul><li><p>  Добавлен <code>TestFixtures#fixture_paths</code> для поддержки нескольких путей фикстур.</p></li><li><p>  Добавлен <code>authenticate_by</code> при использовании <code>has_secure_password</code>.</p></li><li><p>  Добавлен <code>update_attribute!</code> к <code>ActiveRecord::Persistence</code>, похожий на <code>update_attribute</code>, но вызывающий <code>ActiveRecord::RecordNotSaved</code>, если колбэк <code>before_*</code> выкидывает <code>:abort</code>.</p></li><li><p>  Разрешено использование псевдонимов атрибутов в <code>insert_all</code>/<code>upsert_all</code>.</p></li><li><p>  Добавлена опция <code>:include</code> к <code>add_index</code>.</p></li><li><p>  Добавлен метод запроса <code>#regroup</code>, как сокращение для <code>.unscope(:group).group(fields)</code>.</p></li><li><p>  Добавлена поддержка автозаполняемых столбцов и произвольных первичных ключей адаптеру <code>SQLite3</code>.</p></li><li><p>  Добавлены современные производительные значения по умолчанию для соединений с базой данных <code>SQLite3</code>.</p></li><li><p>  Разрешено указывать выражения where с синтаксисом кортежа столбцов.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">Topic</span><span class="p">.</span><span class="nf">where</span><span class="p">([</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:author_name</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">[[</span><span class="s2">"The Alchemist"</span><span class="p">,</span> <span class="s2">"Paulo Coelho"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"Harry Potter"</span><span class="p">,</span> <span class="s2">"J.K Rowling"</span><span class="p">]])</span>
</code></pre>
</div>
</li><li><p>  Автоматически генерируемые имена индексов теперь ограничены 62 байтами, что вписывается в лимиты длины имени индекса по умолчанию для MySQL, PostgreSQL и SQLite.</p></li><li><p>  Представлен адаптер для клиента базы данных Trilogy.</p></li><li><p>  Добавлен метод <code>ActiveRecord.disconnect_all!</code> для немедленного закрытия всех соединений у всех пулов.</p></li><li><p>  Добавлены команды миграции PostgreSQL для переименования enum, добавления значения и переименования значения.</p></li><li><p>  Добавлен псевдоним <code>ActiveRecord::Base#id_value</code> для доступа к необработанному значению столбца id записи.</p></li><li><p>  Добавлена опция валидации для <code>enum</code>.</p></li></ul><h3 id='active-storage' class='inside_page_header'><a href="#active-storage">9.</a> Active Storage</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/activestorage/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno7' class='inside_page_header'><a href="#udaleno7">9.1.</a> Удалено</h4><ul><li><p>  Удалены устаревшие неправильные типы содержимого в конфигурациях Active Storage.</p></li><li><p>  Удалены устаревшие методы <code>ActiveStorage::Current#host</code> и <code>ActiveStorage::Current#host=</code>.</p></li><li><p>  Удалено устаревшие поведение при присвоении коллекции вложений. Вместо добавления к коллекции, сейчас коллекция заменяется.</p></li><li><p>  Удалены устаревшие методы <code>purge</code> и <code>purge_later</code> из связи с вложениями.</p></li></ul><h4 id='ustarelo7' class='inside_page_header'><a href="#ustarelo7">9.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya7' class='inside_page_header'><a href="#znachimye-izmeneniya7">9.3.</a> Значимые изменения</h4><ul><li><p>  <code>ActiveStorage::Analyzer::AudioAnalyzer</code> теперь выводит <code>sample_rate</code> и <code>tags</code> в хэше вывода <code>metadata</code>.</p></li><li><p>  Добавлена опция использования предопределенных вариантов при вызове методов <code>preview</code> или <code>representation</code> на вложении.</p></li><li><p>  Добавлена опция <code>preprocessed</code> при объявлении вариантов к предобработанным вариантам.</p></li><li><p>  Добавлена возможность уничтожать варианты Active Storage.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="no">User</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">avatar</span><span class="p">.</span><span class="nf">variant</span><span class="p">(</span><span class="ss">resize_to_limit: </span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]).</span><span class="nf">destroy</span>
</code></pre>
</div>
</li></ul><h3 id='active-model' class='inside_page_header'><a href="#active-model">10.</a> Active Model</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/activemodel/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno8' class='inside_page_header'><a href="#udaleno8">10.1.</a> Удалено</h4><h4 id='ustarelo8' class='inside_page_header'><a href="#ustarelo8">10.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya8' class='inside_page_header'><a href="#znachimye-izmeneniya8">10.3.</a> Значимые изменения</h4><ul><li><p>  Добавлена поддержка бесконечных рядов в опции <code>LengthValidator</code> <code>:in</code>/<code>:within</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">validates_length_of</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">in: </span><span class="o">..</span><span class="mi">30</span>
</code></pre>
</div>
</li><li><p>  Добавлена поддержка безначальных рядов в валидаторах <code>inclusivity/exclusivity</code>.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="n">validates_inclusion_of</span> <span class="ss">:birth_date</span><span class="p">,</span> <span class="ss">in: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="p">(</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
</div>
<div class="code_container">
  <pre><code class="highlight ruby"><span class="n">validates_exclusion_of</span> <span class="ss">:birth_date</span><span class="p">,</span> <span class="ss">in: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="p">(</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
</div>
</li><li><p>  Добавлена поддержка для вызовов (challenges) пароля в <code>has_secure_password</code>. Когда установлена, проверяет, что вызов пароля соответствует сохраненному <code>password_digest</code>.</p></li><li><p>  Разрешает валидаторам принимать lambda без аргумента записи.</p><div class="code_container">
  <pre><code class="highlight ruby"><span class="c1"># До</span>
<span class="n">validates_comparison_of</span> <span class="ss">:birth_date</span><span class="p">,</span> <span class="ss">less_than_or_equal_to: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">_record</span><span class="p">)</span> <span class="p">{</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span> <span class="p">}</span>

<span class="c1"># После</span>
<span class="n">validates_comparison_of</span> <span class="ss">:birth_date</span><span class="p">,</span> <span class="ss">less_than_or_equal_to: </span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Date</span><span class="p">.</span><span class="nf">today</span> <span class="p">}</span>
</code></pre>
</div>
</li></ul><h3 id='active-support' class='inside_page_header'><a href="#active-support">11.</a> Active Support</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/activesupport/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno9' class='inside_page_header'><a href="#udaleno9">11.1.</a> Удалено</h4><ul><li><p>  Удалено устаревшее переопределение <code>Enumerable#sum</code>.</p></li><li><p>  Удален устаревший <code>ActiveSupport::PerThreadRegistry</code>.</p></li><li><p>  Удалены устаревшие опции для передачи формата в <code>#to_s</code> в <code>Array</code>, <code>Range</code>, <code>Date</code>, <code>DateTime</code>, <code>Time</code>, <code>BigDecimal</code>, <code>Float</code> и <code>Integer</code>.</p></li><li><p>  Удалено устаревшее переопределение <code>ActiveSupport::TimeWithZone.name</code>.</p></li><li><p>  Удален устаревший файл <code>active_support/core_ext/uri</code>.</p></li><li><p>  Удален устаревший файл <code>active_support/core_ext/range/include_time_with_zone</code>.</p></li><li><p>  Удалено неявное преобразование объектов в <code>String</code> в <code>ActiveSupport::SafeBuffer</code>.</p></li><li><p>  Удалена устаревшая поддержка генерации несоответствующих RFC 4122 UUID при предоставлении ID пространства имен, не являющегося одной из констант, определенных в <code>Digest::UUID</code>.</p></li></ul><h4 id='ustarelo9' class='inside_page_header'><a href="#ustarelo9">11.2.</a> Устарело</h4><ul><li><p>  Устарел <code>config.active_support.disable_to_s_conversion</code>.</p></li><li><p>  Устарел <code>config.active_support.remove_deprecated_time_with_zone_name</code>.</p></li><li><p>  Устарел <code>config.active_support.use_rfc4122_namespaced_uuids</code>.</p></li><li><p>  Устарел <code>SafeBuffer#clone_empty</code>.</p></li><li><p>  Устарело использование синглтона <code>ActiveSupport::Deprecation</code>.</p></li><li><p>  Устарела инициализация <code>ActiveSupport::Cache::MemCacheStore</code> с помощью экземпляра <code>Dalli::Client</code>.</p></li><li><p>  Устарели методы <code>Notification::Event</code> <code>#children</code> и <code>#parent_of?</code>.</p></li></ul><h4 id='znachimye-izmeneniya9' class='inside_page_header'><a href="#znachimye-izmeneniya9">11.3.</a> Значимые изменения</h4><h3 id='active-job' class='inside_page_header'><a href="#active-job">12.</a> Active Job</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/activejob/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno10' class='inside_page_header'><a href="#udaleno10">12.1.</a> Удалено</h4><ul><li>  Удален <code>QueAdapter</code>.
</li></ul><h4 id='ustarelo10' class='inside_page_header'><a href="#ustarelo10">12.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya10' class='inside_page_header'><a href="#znachimye-izmeneniya10">12.3.</a> Значимые изменения</h4><ul><li><p>  Добавлен <code>perform_all_later</code> для постановки в очередь нескольких задания за раз.</p></li><li><p>  Добавлена опция <code>--parent</code> к генератору задания, чтобы указать родительский класс задания.</p></li><li><p>  Добавлен метод <code>after_discard</code> к <code>ActiveJob::Base</code>, чтобы запустить колбэк, перед тем, как задание будет сброшено.</p></li><li><p>  Добавлена поддержка логирования вызова добавления в очередь фонового задания.</p></li></ul><h3 id='action-text' class='inside_page_header'><a href="#action-text">13.</a> Action Text</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actiontext/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno11' class='inside_page_header'><a href="#udaleno11">13.1.</a> Удалено</h4><h4 id='ustarelo11' class='inside_page_header'><a href="#ustarelo11">13.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya11' class='inside_page_header'><a href="#znachimye-izmeneniya11">13.3.</a> Значимые изменения</h4><h3 id='action-mailbox' class='inside_page_header'><a href="#action-mailbox">14.</a> Action Mailbox</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/actionmailbox/CHANGELOG.md">Changelog</a>.</p><h4 id='udaleno12' class='inside_page_header'><a href="#udaleno12">14.1.</a> Удалено</h4><h4 id='ustarelo12' class='inside_page_header'><a href="#ustarelo12">14.2.</a> Устарело</h4><h4 id='znachimye-izmeneniya12' class='inside_page_header'><a href="#znachimye-izmeneniya12">14.3.</a> Значимые изменения</h4><ul><li><p>  Добавлены адреса <code>X-Forwarded-To</code> к получателям.</p></li><li><p>  Добавлен метод <code>bounce_now_with</code> к <code>ActionMailbox::Base</code>, чтобы посылать возвращенное письмо без прохождения через очередь рассыльщика.</p></li></ul><h3 id='ruby-on-rails-guides' class='inside_page_header'><a href="#ruby-on-rails-guides">15.</a> Ruby on Rails Guides</h3><p>За подробностями обратитесь к <a href="https://github.com/rails/rails/blob/7-1-stable/guides/CHANGELOG.md">Changelog</a>.</p><h4 id='znachimye-izmeneniya13' class='inside_page_header'><a href="#znachimye-izmeneniya13">15.1.</a> Значимые изменения</h4><h3 id='blagodarnosti' class='inside_page_header'><a href="#blagodarnosti">16.</a> Благодарности</h3><p>Взгляните <a href="http://contributors.rubyonrails.org/">на полный список контрибьюторов Rails</a>, на людей, которые потратили много часов, сделав Rails стабильнее и надёжнее. Спасибо им всем.</p>

            <div class="banner">
              <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

   <!-- bottom rusrails -->
   <ins class="adsbygoogle"
        style="display:inline-block;width:580px;height:400px"
        data-ad-client="ca-pub-7764391801669990"
        data-ad-slot="7566253867"></ins>


<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

            </div>
          </div>
        </div>
        <div class="row-fluid">
          <div class="span12" id="footer">
            <p>
              <a target="blank" href="https://github.com/rusrails/rusrails"><img src="/assets/github-7cc23602a5ac2465f14c19492358a5a67dc24636761cc723e4d621cea0c09225.png" /></a>
            </p>
            <p>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/">Лицензия CC BY-SA 4.0</a>
              "Rails", "Ruby on Rails" и логотип Rails - торговые марки DHH
              <!-- Yandex.Metrika counter -->
<script>
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1006929 = new Ya.Metrika({id:1006929,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>

<noscript>
  <div>
    <img style="position:absolute; left:-9999px;" alt="" src="//mc.yandex.ru/watch/1006929" />
  </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64955373-1', 'auto');
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    ga('send', 'event', 'outbound', 'click', url, {
      'transport': 'beacon',
      'hitCallback': function(){ }
    });
  }
</script>

            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="to_top" style="display: block">
      <div class="to_top_panel"></div>
    </div>
    <script src="/assets/application-48ac5c5be8858f5558a99606c2d341f9fee482f22db6deee5def03837c505584.js"></script>
  </body>
</html>
